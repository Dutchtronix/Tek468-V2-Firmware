 AS V1.42 Beta [Bld 37] - source file rom468combined.asm - page 1 - 5/16/2023 15:57:44


       1/       0 :                     	PAGE 0
       2/       0 :                     ;
       3/       0 :                     ; Assemble this file using "Makroassembler AS v1.42" by Alfred Arnold,
       4/       0 :                     ;	ported to windows in a package called "aswcurr"
       5/       0 :                     ;	http://john.ccac.rwth-aachen.de:8000/as/
       6/       0 :                     ;
       7/       0 :                     ; ..\aswcurr\bin\asw -i . -cpu 8085 -L rom468combined.asm
       8/       0 :                     ; ..\aswcurr\bin\p2bin.exe rom468combined -r $0000-$3fff
       9/       0 :                     ; comp Rom4682roms.bin rom468combined.bin <no.txt
      10/       0 :                     ;
      11/       0 :                     ; where Rom4682roms.bin is a binary copy of the original roms
      12/       0 :                     ; and no.txt just contains the word "no"
      13/       0 :                     ;
      14/       0 :                     	
      15/       0 :                               ORG 0000H
      16/       0 :                     
      17/       0 :                     		INCLUDE "Tek468DeviceInfo.inc"
(1)    1/       0 : =E040H              DEV_FPC		equ			0E040H
(1)    2/       0 : =E041H              DEV_CONTRL	equ			0E041H
(1)    3/       0 : =E042H              DEV_FP2		equ			0E042H
(1)    4/       0 : =E043H              DEV_FP1		equ			0E043H
(1)    5/       0 : =E044H              DEV_LEDRO	equ         0E044H
(1)    6/       0 : =E045H              DEV_SVNSEG	equ         0E045H
(1)    7/       0 : =E200H              DEV_RSTACQ	equ			0E200H
(1)    8/       0 : =E201H              DEV_WRSR1	equ			0E201H
(1)    9/       0 : =E202H              DEV_WRSR2	equ			0E202H
(1)   10/       0 : =E203H              DEV_MTRIG	equ			0E203H
(1)   11/       0 : =E204H              DEV_RDSTAT	equ			0E204H
(1)   12/       0 : =E205H              DEV_RDMAR	equ			0E205H
(1)   13/       0 : =E206H              DEV_RDJC8	equ			0E206H
(1)   14/       0 : =E207H              DEV_RDJC4	equ			0E207H
(1)   15/       0 : =E380H              DEV_RSTACQ2	equ			0E380H
(1)   16/       0 : =E400H              DEV_DIPSW	equ         0E400H
(1)   17/       0 : =E401H              DEV_LINER	equ			0E401H
(1)   18/       0 : =E402H              DEV_DISREG	equ			0E402H
(1)   19/       0 : =E403H              DEV_CURSOR	equ			0E403H
(1)   20/       0 : =E404H              DEV_JITTER	equ			0E404H
(1)   21/       0 : =E405H              DEV_VGAIN	equ			0E405H
(1)   22/       0 : =E406H              DEV_HGAIN	equ			0E406H
(1)   23/       0 : =E407H              DEV_STOPDIS	equ			0E407H
(1)   24/       0 : =E800H              DEV_CH1		equ			0E800H
(1)   25/       0 : =E801H              DEV_CH2		equ			0E801H
(1)   26/       0 : =E802H              DEV_ATIME	equ			0E802H
(1)   27/       0 : =E803H              DEV_BTIME	equ			0E803H
(1)   28/       0 : =E804H              DEV_MODE	equ			0E804H
(1)   29/       0 : =E805H              DEV_LIGHTS	equ			0E805H
(1)   30/       0 : =E806H              DEV_VSM		equ			0E806H
(1)   31/       0 : =F000H              DEV_TALKREG	equ			0F000H
(1)   32/       0 : =F001H              DEV_SNTACK	equ			0F001H
(1)   33/       0 : =F002H              DEV_DATACC	equ			0F002H
(1)   34/       0 : =F003H              DEV_ATNFLS	equ			0F003H
(1)   35/       0 : =F004H              DEV_WIFDO	equ			0F004H
(1)   36/       0 : =F005H              DEV_RIFDI	equ			0F005H
(1)   37/       0 : =F006H              DEV_WIFCTL	equ			0F006H
(1)   38/       0 : =F007H              DEV_RIFSTAT	equ			0F007H
(1)   39/       0 : =F200H              DEV_PRICLR	equ			0F200H
(1)   40/       0 :                     
(1)   41/       0 : =8000H              RAM_SYSTEM	equ			08000H
(1)   42/       0 : =83FFH              RAM_SYSTEM_END equ		083FFH
(1)   43/       0 : =8200H              RAM_MIDDLE	equ			08200H
(1)   44/       0 : =8800H              RAM_SCRATCH	equ			08800H
(1)   45/       0 : =8BFFH              RAM_SCRATCH_END		equ	08BFFH
(1)   46/       0 : =A000H              RAM_DISPLAY	equ			0A000H
(1)   47/       0 : =A7FFH              RAM_DISPLAY_END		equ	0A7FFH
(1)   48/       0 : =B000H              RAM_DOT		equ			0B000H
(1)   49/       0 : =B3FFH              RAM_DOT_END	equ			0B3FFH
(1)   50/       0 : =C000H              RAM_ACQ		equ			0C000H
(1)   51/       0 : =C1FFH              RAM_ACQ_END	equ			0C1FFH
(1)   52/       0 :                     
      18/       0 :                     		INCLUDE "Tek468Variables.inc"
(1)    1/       0 :                     ;
(1)    2/       0 :                     ; variables in System RAM.
(1)    3/       0 :                     ;
(1)    4/       0 : =8000H              DivLoopCntr	equ			08000H
(1)    5/       0 : =8001H              V_fOK2ProcessAcq equ	08001H
(1)    6/       0 : =8002H              V_fOK2UpdateDispWF equ	08002H
(1)    7/       0 : =8003H              V_fSkipAcquiredWF equ	08003H
(1)    8/       0 : =8004H              V_GPIB_txt	equ			08004H
(1)    9/       0 : =8006H              VAR_8006	equ			08006H
(1)   10/       0 : =8007H              V_GPIB_XmitWFRQSFActive	equ	08007H
(1)   11/       0 : =8008H              V_ACQ_Mode	equ			08008H
(1)   12/       0 : =8009H              VAR_8009	equ			08009H
(1)   13/       0 : =800AH              V_pDEVICE	equ			0800AH
(1)   14/       0 : =800CH              V_ActualTB_2	equ		0800CH
(1)   15/       0 : =800DH              V_GPIB_ActionWasRemoved	equ 0800DH
(1)   16/       0 : =800EH              VAR_800E	equ			0800EH
(1)   17/       0 : =800FH              V_fSAVEREFPushed equ	0800FH
(1)   18/       0 : =8010H              V_CursorEdgeTimeCnt equ 08010H
(1)   19/       0 : =8012H              V_fAtCursorEdge		equ	08012H
(1)   20/       0 : =8013H              V_fCursorEdgeTracking equ 08013H
(1)   21/       0 : =8014H              V_fSnappedCursor	equ	08014H
(1)   22/       0 : =8015H              V_fCursor1Snapped equ	08015H
(1)   23/       0 : =8016H              VAR_8016	equ			08016H
(1)   24/       0 : =8017H              V_WIFCTL	equ			08017H
(1)   25/       0 : =8018H              V_ATIME	equ				08018H
(1)   26/       0 : =8019H              V_BTIME	equ				08019H
(1)   27/       0 : =801AH              V_CH1_Info	equ			0801AH
(1)   28/       0 : =801BH              V_CH2_Info	equ			0801BH
(1)   29/       0 : =801CH              V_CH1_Coupling	equ		0801CH
(1)   30/       0 : =801DH              V_CH2_Coupling	equ		0801DH
(1)   31/       0 : =801EH              V_fCH1	equ				0801EH
(1)   32/       0 : =801FH              V_fCH2	equ				0801FH
(1)   33/       0 : =8020H              V_fADD	equ				08020H
(1)   34/       0 : =8021H              V_fTRIGVIEW	equ			08021H
(1)   35/       0 : =8022H              V_fALT	equ				08022H
(1)   36/       0 : =8023H              V_ATimebaseActive	equ	08023H
(1)   37/       0 : =8024H              V_fTRIGVIEWENA	equ		08024H
(1)   38/       0 : =8025H              V_fXY	equ				08025H
(1)   39/       0 : =8026H              V_UIVolts	equ			08026H
(1)   40/       0 : =8027H              VAR_8027	equ			08027H
(1)   41/       0 : =8028H              V_SCALECode	equ			08028H
(1)   42/       0 : =8029H              V_ChannelMode	equ		08029H
(1)   43/       0 : =802AH              V_fAlternating	equ		0802AH
(1)   44/       0 : =802BH              V_fChopped	equ			0802BH		;boolean
(1)   45/       0 : =802CH              V_NumWinValue	equ		0802CH
(1)   46/       0 : =802EH              V_NumWinBuf	equ			0802EH
(1)   47/       0 : =8032H              V_DecPntDigit	equ		08032H
(1)   48/       0 : =8033H              V_Curr_LEDRO	equ		08033H
(1)   49/       0 : =8034H              V_CursorIncrementValue equ	08034H
(1)   50/       0 : =8035H              V_TimerCntrRateInc2	equ	08035H
(1)   51/       0 : =8036H              V_PRFastMode	equ		08036H
(1)   52/       0 : =8037H              V_CursorPos2	equ		08037H
(1)   53/       0 : =8039H              V_CursorPos1	equ		08039H
(1)   54/       0 : =803BH              V_PreviousPRCount equ	0803BH
(1)   55/       0 : =803DH              V_CursorPot_Delay equ	0803DH
(1)   56/       0 : =803EH              V_CurrWF equ 			0803EH
(1)   57/       0 : =803FH              V_GPIB_Enabled	equ		0803FH
(1)   58/       0 : =8040H              V_DispWF	equ			08040H
(1)   59/       0 : =8041H              V_CursorLine	equ		08041H
(1)   60/       0 : =8042H              VAR_8042	equ			08042H		;assigned but never used
(1)   61/       0 : =8043H              V_MainActionEnd equ		08043H
(1)   62/       0 : =8044H              V_MainActionStart equ	08044H
(1)   63/       0 : =8045H              V_MainActionTbl equ		08045H		;length 16.
(1)   64/       0 : =8055H              V_GPIB_MTAReceived equ	08055H
(1)   65/       0 : =8056H              V_Jitter	equ			08056H
(1)   66/       0 : =8057H              V_Jitter_Tbl	equ		08057H		;table
(1)   67/       0 : =805BH              V_GPIB_Bool9	equ		0805BH
(1)   68/       0 :                     ;
(1)   69/       0 :                     ; GPIB status variables
(1)   70/       0 :                     ;
(1)   71/       0 : =805CH              V_GPIB_Bool8	equ		0805CH
(1)   72/       0 : =805DH              V_GPIB_Bool7	equ		0805DH
(1)   73/       0 : =805EH              V_GPIB_NRFD	equ			0805EH
(1)   74/       0 : =805FH              V_GPIB_ATNDAV	equ		0805FH
(1)   75/       0 : =8060H              V_GPIB_60	equ			08060H
(1)   76/       0 : =8061H              V_GPIB_RATN	equ			08061H
(1)   77/       0 : =8062H              V_GPIB_Bool6	equ		08062H
(1)   78/       0 : =8063H              V_GPIB_NDAC	equ			08063H
(1)   79/       0 : =8064H              V_TALKREG	equ			08064H
(1)   80/       0 : =8065H              V_TALKADDR	equ			08065H
(1)   81/       0 :                     ;
(1)   82/       0 :                     ;
(1)   83/       0 : =8066H              V_GPIB_XmittingWF equ	08066H
(1)   84/       0 : =8067H              V_GPIB_EndOfMessage	equ	08067H
(1)   85/       0 : =8068H              V_GPIB_Bool2	equ		08068H
(1)   86/       0 : =8069H              V_WIFDO	equ				08069H
(1)   87/       0 : =806AH              V_GPIBStage	equ			0806AH
(1)   88/       0 : =806BH              V_GPIB_cnt0	equ			0806BH
(1)   89/       0 : =806DH              V_GPIB_Bool3 equ		0806DH
(1)   90/       0 : =806EH              V_GPIB_Bool4 equ		0806EH
(1)   91/       0 : =806FH              V_GPIB_Bool5	equ		0806FH
(1)   92/       0 : =8070H              V_FPC		equ			08070H
(1)   93/       0 : =8071H              V_DisplayRB_End	equ		08071H		;counter 1..10
(1)   94/       0 : =8072H              V_DisplayRB_Start equ	08072H
(1)   95/       0 : =8073H              V_DisplayRB	equ			08073H		;table of 10 entries
(1)   96/       0 : =807DH              V_pDispWF	equ			0807DH		;pointer value
(1)   97/       0 : =807FH              V_WFTable equ			0807FH		;table of 4 entries, 8 bytes each
(1)   98/       0 : =809FH              V_ValidWFs	equ			0809FH		;table of 4 booleans
(1)   99/       0 : =80A3H              V_PrimaryWF	equ			080A3H
(1)  100/       0 : =80A4H              V_DISREG	equ			080A4H
(1)  101/       0 : =80A5H              V_DigitalMode equ		080A5H
(1)  102/       0 : =80A6H              V_fSAVEREFShowing equ	080A6H
(1)  103/       0 : =80A7H              V_fPostPreTrigger equ	080A7H
(1)  104/       0 : =80A8H              V_fPulseSine	equ		080A8H
(1)  105/       0 : =80A9H              V_GPIBOut	equ			080A9H
(1)  106/       0 : =80AAH              V_CursorMode	equ		080AAH
(1)  107/       0 : =80ABH              V_PositionRateCount_Values equ 080ABH
(1)  108/       0 : =80ADH              V_fFirstCursorActive equ 080ADH
(1)  109/       0 : =80AFH              V_VoltsCursorPos equ	080AFH		;table
(1)  110/       0 : =80B3H              V_TimeCursorPos	equ		080B3H
(1)  111/       0 : =80B7H              V_LineCursorPos	equ		080B7H
(1)  112/       0 : =80BBH              V_TmpCursorPos	equ		080BBH
(1)  113/       0 : =80BFH              V_CONTRL	equ			080BFH
(1)  114/       0 : =80C1H              V_TimerCntrSweepsIncrement equ	080C1H
(1)  115/       0 : =80C2H              V_AVG_Sweeps	equ		080C2H
(1)  116/       0 : =80C4H              V_ENV_Sweeps	equ		080C4H
(1)  117/       0 : =80C6H              V_Sweep_Cnt1	equ		080C6H
(1)  118/       0 : =80C8H              V_NotCountingDown equ	080C8H
(1)  119/       0 : =80C9H              V_FP2		equ			080C9H
(1)  120/       0 : =80CAH              V_FP1		equ			080CAH		;inverted copy of DEV_FP1
(1)  121/       0 : =80C0H              V_Rate_Direction equ	080C0H
(1)  122/       0 : =80CCH              V_LclFlag	equ			080CCH
(1)  123/       0 : =80CDH              V_Action5_Flg	equ		080CDH
(1)  124/       0 : =80CEH              V_Action9_Flg	equ		080CEH
(1)  125/       0 : =80CFH              V_Action7_Flg	equ		080CFH
(1)  126/       0 : =80D0H              V_Action3_Flg	equ		080D0H
(1)  127/       0 : =80D1H              V_Action6_Flg	equ		080D1H
(1)  128/       0 : =80D2H              V_CURSOR_Select	equ		080D2H
(1)  129/       0 : =80D3H              V_Lights	equ			080D3H
(1)  130/       0 : =80D4H              V_VSM	equ				080D4H
(1)  131/       0 : =80D5H              V_Saved_Arg_HL	equ		080D5H
(1)  132/       0 : =80D7H              V_Saved_Arg_DE	equ		080D7H
(1)  133/       0 : =80D9H              V_nSamples	equ			080D9H
(1)  134/       0 : =80DAH              V_Loop_Cntr_1	equ		080DAH
(1)  135/       0 : =80DBH              VAR_80DB	equ			080DBH
(1)  136/       0 : =80DCH              V_pWF_Destination equ	080DCH
(1)  137/       0 : =80DEH              V_pWF_Source equ		080DEH
(1)  138/       0 : =80E0H              VAR_80E0	equ			080E0H
(1)  139/       0 : =80E1H              V_pRAM_DOT	equ			080E1H
(1)  140/       0 : =80E3H              V_pRAM_DOT2	equ			080E3H
(1)  141/       0 : =80E5H              V_BOTHODD	equ			080E5H
(1)  142/       0 : =80E8H              V_CNT	equ				080E8H
(1)  143/       0 : =80E9H              V_Cnt_2	equ				080E9H
(1)  144/       0 : =80EAH              V_TargetTB2	equ			080EAH
(1)  145/       0 : =80EBH              V_DigitalMode_4a equ	080EBH
(1)  146/       0 : =80ECH              V_WF_4	equ				080ECH
(1)  147/       0 : =80EDH              VAR_80ED	equ			080EDH
(1)  148/       0 : =80EEH              V_DisplayAction	equ		080EEH
(1)  149/       0 : =80EFH              V_fAVGENVFinished equ	080EFH
(1)  150/       0 : =80F0H              V_Sweep_Cnt2	equ		080F0H
(1)  151/       0 : =80F2H              V_ACQWF_Ptr	equ			080F2H
(1)  152/       0 : =80F4H              V_pScratchRAM	equ		080F4H
(1)  153/       0 : =80F6H              V_pScratchRAM2	equ		080F6H
(1)  154/       0 : =80F8H              V_pWF_4	equ				080F8H
(1)  155/       0 : =80FAH              V_LclWFEntry	equ		080FAH		;8 byte WF entry
(1)  156/       0 : =8102H              V_SavedpWF_4	equ		08102H
(1)  157/       0 : =8104H              V_LclWFEntry_2	equ		08104H		;8 byte WF Entry
(1)  158/       0 : =810CH              V_SavedChannelMode equ	0810CH
(1)  159/       0 : =810DH              V_Local810D	equ			0810DH
(1)  160/       0 : =810EH              V_VoltSteps	equ			0810EH
(1)  161/       0 : =810FH              V_LoopCntAVG	equ		0810FH
(1)  162/       0 : =8111H              VAR_8111	equ			08111H
(1)  163/       0 : =8113H              V_cnt01		equ			08113H
(1)  164/       0 : =8114H              V_LocalMinSweeps equ	08114H
(1)  165/       0 : =8116H              V_LocalMaxSweeps equ	08116H
(1)  166/       0 : =8118H              V_CurrentSweeps	equ		08118H
(1)  167/       0 : =811AH              V_ThisLineCursorPos	equ	0811AH
(1)  168/       0 : =811CH              V_fShortWF	equ			0811CH
(1)  169/       0 : =811DH              V_pWFTable3	equ			0811DH
(1)  170/       0 : =8120H              V_Saved_Arg equ			08120H
(1)  171/       0 : =8121H              V_SAVED_INT_Mask equ	08121H
(1)  172/       0 : =8122H              V_DisplayRB_Index equ	08122H
(1)  173/       0 : =8123H              V_Index_7	equ			08123H
(1)  174/       0 : =8124H              V_Tmp_7	equ				08124H
(1)  175/       0 : =8125H              V_AcquiredTB_7	equ		08125H
(1)  176/       0 : =8126H              V_pWFTbl_7	equ			08126H
(1)  177/       0 : =8128H              V_pSrc_4	equ			08128H
(1)  178/       0 : =812AH              V_pDest_4	equ			0812AH
(1)  179/       0 : =812CH              V_RAM_Area	equ			0812CH
(1)  180/       0 : =812EH              V_Cnt2	equ				0812EH
(1)  181/       0 : =8130H              V_samplesCnt	equ		08130H
(1)  182/       0 : =8131H              V_deltaTB_4_2	equ		08131H
(1)  183/       0 : =8132H              V_deltaTB_4	equ			08132H
(1)  184/       0 : =8133H              V_TargetTB_4	equ		08133H
(1)  185/       0 : =8134H              V_AcquiredTB_4	equ		08134H
(1)  186/       0 : =8135H              V_LocalHGAIN_4	equ		08135H
(1)  187/       0 : =8136H              V_WF_4a	equ				08136H
(1)  188/       0 : =8137H              V_DigitalMode_4	equ		08137H
(1)  189/       0 : =8138H              V_oddFlg_4	equ			08138H
(1)  190/       0 : =813AH              V_Saved_Int_Mask_2	equ 0813AH
(1)  191/       0 : =813BH              V_ActionLoopIdx	equ		0813BH
(1)  192/       0 : =813CH              V_LastPRCount	equ		0813CH
(1)  193/       0 : =813EH              VAR_813E	equ			0813EH
(1)  194/       0 : =8140H              VAR_8140	equ			08140H
(1)  195/       0 : =8142H              V_TMP8142	equ			08142H
(1)  196/       0 : =8144H              V_PRCount	equ			08144H
(1)  197/       0 : =8147H              V_CH1_Info_Copy	equ		08147H
(1)  198/       0 : =8148H              V_CH2_Info_Copy	equ		08148H
(1)  199/       0 : =8149H              V_AcqVolts	equ			08149H
(1)  200/       0 : =814AH              V_bit_6_cleared	equ		0814AH
(1)  201/       0 : =814BH              V_fUNCAL	equ			0814BH
(1)  202/       0 : =814CH              V_fAVGVolts	equ			0814CH
(1)  203/       0 : =814DH              V_TMP814D	equ			0814DH
(1)  204/       0 : =814EH              V_BCD_Input	equ			0814EH
(1)  205/       0 : =8150H              V_SCALECode2 equ		08150H
(1)  206/       0 : =8151H              V_BCD_Result equ		08151H
(1)  207/       0 : =8154H              V_TMP8154	equ			08154H
(1)  208/       0 : =8155H              VAR_8155	equ			08155H
(1)  209/       0 : =8157H              V_DecPoint	equ			08157H
(1)  210/       0 : =8158H              V_LedCode	equ			08158H
(1)  211/       0 : =8159H              V_WF_6	equ				08159H
(1)  212/       0 : =815AH              V_FlippedWF_6 equ		0815AH
(1)  213/       0 : =815BH              V_CopySize_6 equ		0815BH
(1)  214/       0 : =815CH              V_Flg_6	equ				0815CH
(1)  215/       0 : =815DH              V_Ptr1_6 equ			0815DH
(1)  216/       0 : =815FH              V_Ptr2_6 equ			0815FH
(1)  217/       0 : =8162H              V_Lcl_fActionRemoved equ 08162H
(1)  218/       0 : =8164H              V_GPIB8164	equ			08164H
(1)  219/       0 : =8165H              VAR_8165	equ			08165H
(1)  220/       0 : =8166H              VAR_8166	equ			08166H
(1)  221/       0 : =8168H              VAR_8168	equ			08168H
(1)  222/       0 : =816AH              VAR_816A	equ			0816AH
(1)  223/       0 : =816BH              VAR_816B	equ			0816BH
(1)  224/       0 : =816DH              VAR_816D	equ			0816DH
(1)  225/       0 : =816FH              VAR_816F	equ			0816FH
(1)  226/       0 : =8170H              VAR_8170	equ			08170H
(1)  227/       0 : =8171H              VAR_8171	equ			08171H
(1)  228/       0 : =8174H              VAR_8174	equ			08174H
(1)  229/       0 : =8176H              VAR_8176	equ			08176H
(1)  230/       0 : =8178H              V_GPIB_Ptr3	equ			08178H
(1)  231/       0 : =817AH              V_GPIB_Ptr2	equ			0817AH
(1)  232/       0 : =817CH              V_GPIB_Ptr1	equ			0817CH
(1)  233/       0 : =817EH              VAR_817E	equ			0817EH		;boolean
(1)  234/       0 : =817FH              VAR_817F	equ			0817FH		;boolean
(1)  235/       0 : =8180H              VAR_8180	equ			08180H		;boolean
(1)  236/       0 : =8181H              V_LED_Digit	equ			08181H
(1)  237/       0 : =8182H              V_Range_Start equ		08182H
(1)  238/       0 : =8184H              V_Range_End	equ			08184H
(1)  239/       0 : =8186H              V_RAM_Test_Status	equ	08186H
(1)  240/       0 : =8187H              V_FP_Display_Curr_Digit	equ	08187H
(1)  241/       0 : =8188H              V_Saved_Param1 	equ		08188H
(1)  242/       0 : =8189H              V_Saved_Param2	equ		08189H
(1)  243/       0 : =8191H              V_RecorderJitter equ	08191H
(1)  244/       0 : =8192H              V_Jitter_TB18	equ		08192H
(1)  245/       0 : =8194H              V_Jitter_TB19	equ		08194H
(1)  246/       0 : =8196H              V_Jitter_TB20	equ		08196H
(1)  247/       0 : =8198H              VAR_8198	equ			08198H
(1)  248/       0 : =819AH              V_TimerCntr	equ			0819AH
(1)  249/       0 : =819BH              V_TimerCntr2	equ		0819BH
(1)  250/       0 : =819CH              V_TimerCntr3	equ		0819CH 
(1)  251/       0 : =819DH              V_TimerCntr4	equ		0819DH
(1)  252/       0 : =819EH              V_TimerCntr_Rate_Stop2 equ 0819EH
(1)  253/       0 : =819FH              V_TimerCntrSweepsStop equ 0819FH
(1)  254/       0 :                     
      19/       0 :                     
      20/       0 : =0H                 DIGITAL_OFF		equ	0
      21/       0 : =1H                 DIGITAL_NORM	equ	1
      22/       0 : =2H                 DIGITAL_ENV		equ	2
      23/       0 : =3H                 DIGITAL_AVG		equ	3
      24/       0 : =4H                 DIGITAL_SAVE	equ	4
      25/       0 :                     
      26/       0 : =0H                 NUMWINNONE			equ	0
      27/       0 : =1H                 NUMWINVOLTS			equ	1
      28/       0 : =2H                 NUMWINTIME			equ	2
      29/       0 : =3H                 NUMWINCPLVT			equ	3
      30/       0 : =4H                 NUMWINSWEEPS		equ	4
      31/       0 : =5H                 NUMWINCNTDOWN		equ	5
      32/       0 :                     
      33/       0 :                     ; WFTbl has 4 entries of 8 bytes each
      34/       0 :                     ; Layout 
      35/       0 :                     ; each record:	0	JITTER
      36/       0 :                     ;				1	GNDREF
      37/       0 :                     ;				2	HGAIN
      38/       0 :                     ;				3	VGAIN
      39/       0 :                     ;				4	CHANMODE
      40/       0 :                     ;				5	STATUS
      41/       0 :                     ;				6	TIMEBASE
      42/       0 :                     ;				7	VOLTS
      43/       0 :                     ;
      44/       0 :                     ; There is a parallel V_ValidWFs of 4 entries, 1 byte each
      45/       0 :                     ;
      46/       0 :                     ;offsets in struct. WFTbl
      47/       0 : =0H                 S_JITTER		equ	0
      48/       0 : =1H                 S_GNDREF		equ	1
      49/       0 : =2H                 S_HGAIN			equ	2
      50/       0 : =3H                 S_VGAIN			equ	3
      51/       0 : =4H                 S_CHANMODE		equ	4		;Channel mode
      52/       0 : =5H                 S_STATUS		equ	5
      53/       0 : =6H                 S_TB			equ	6
      54/       0 : =7H                 S_VOLTS			equ	7
      55/       0 :                     
      56/       0 : =4H                 VOLTAGE4		equ	4
      57/       0 : =8H                 WFENTRYSIZE		equ	8
      58/       0 : =14H                TB20			equ	20
      59/       0 : =4H                 LONGWFMASK		equ	04h		;bit 2 in S_STATUS
      60/       0 :                     
      61/       0 : =1H                 MAIN_ACTION_1_ID equ 1		;Update Numeric Window values
      62/       0 : =2H                 MAIN_ACTION_2_ID equ 2
      63/       0 : =3H                 MAIN_ACTION_3_ID equ 3
      64/       0 : =4H                 MAIN_ACTION_4_ID equ 4
      65/       0 : =5H                 MAIN_ACTION_5_ID equ 5
      66/       0 : =6H                 MAIN_ACTION_6_ID equ 6
      67/       0 : =7H                 MAIN_ACTION_7_ID equ 7
      68/       0 : =8H                 MAIN_ACTION_8_ID equ 8
      69/       0 : =9H                 MAIN_ACTION_9_ID equ 9
      70/       0 : =AH                 MAIN_ACTION_10_ID equ 10
      71/       0 :                     
      72/       0 : =>FALSE             	if 0
      73/       0 :                     ;
      74/       0 :                     ; Necessary when assembling code for ROM1 separately
      75/       0 :                     ;
      76/       0 :                     ;
      77/       0 :                     ; ROM575 Entry Points
      78/       0 :                     ;
      79/       0 :                     Display_Interrupt equ	02029H
      80/       0 :                     AddDisplayAction equ	02035H
      81/       0 :                     Set_IE		equ			0205FH
      82/       0 :                     CursorPotInt2 equ		0206BH
      83/       0 :                     ScratchRamTable	equ		02019H
      84/       0 :                     L201B		equ			0201BH
      85/       0 :                     L201F		equ			0201FH
      86/       0 :                     DisplayRamTable	equ		02021H
      87/       0 :                     Init_Display	equ		0202CH
      88/       0 :                     InitDisplayRB	equ		0202FH
      89/       0 :                     Init_GPIB	equ			02032H
      90/       0 :                     Main_Action_6	equ		02038H
      91/       0 :                     Main_Action_1	equ		0203BH
      92/       0 :                     Remove_GPIB_Actions	equ	02047H
      93/       0 :                     Display_Action_5	equ	02062H
      94/       0 :                     Update_DEV_WIFCTL_and equ 02065H
      95/       0 :                     Update_DEV_FPC_and	equ	02068H
      96/       0 :                     Get_GPIB_Status		equ	0206EH
      97/       0 :                     ClrCursorSnap		equ	02071H
      98/       0 :                     AdjustCursorTime equ	02074H
      99/       0 :                     GetWFExpandVal	equ		02077H
     100/       0 :                     Test_Equal_A_L	equ		03D5DH
     101/       0 :                     L3FFC		equ			03FFCH
     102/       0 :                     Action_Table2	equ		02001H		
     103/       0 : [72]                	endif
     104/       0 :                     	
     105/       0 :                     RST0:
     106/       0 : 7F                  	mov	a,a
     107/       1 : C3 53 17            	jmp	Start
     108/       4 : 76                  	hlt	
     109/       5 : 76                  	hlt	
     110/       6 : 76                  	hlt	
     111/       7 : 76                  	hlt
     112/       8 :                     ;
     113/       8 :                     ; Get *(DE + A) in A. Leave ptr in HL
     114/       8 :                     ;
     115/       8 :                     RST1:
     116/       8 : 6F                  	mov	l,a
     117/       9 : 26 00               	mvi	h,00h
     118/       B : 19                  	dad	d
     119/       C : 7E                  	mov	a,m
     120/       D : C9                  	ret
     121/       E : 76                  	hlt	
     122/       F : 76                  	hlt
     123/      10 :                     RST2:
     124/      10 : 00                  	nop
     125/      11 : 76                  	hlt	
     126/      12 : 76                  	hlt	
     127/      13 : 76                  	hlt	
     128/      14 : 76                  	hlt	
     129/      15 : 76                  	hlt	
     130/      16 : 76                  	hlt	
     131/      17 : 76                  	hlt
     132/      18 :                     ;
     133/      18 :                     ; two's complement HL
     134/      18 :                     ;
     135/      18 :                     RST3:
     136/      18 : 7D                  	mov	a,l
     137/      19 : 2F                  	cma
     138/      1A : 6F                  	mov	l,a
     139/      1B : 7C                  	mov	a,h
     140/      1C : 2F                  	cma
     141/      1D : 67                  	mov	h,a
     142/      1E : 23                  	inx	h
     143/      1F : C9                  	ret
     144/      20 :                     ;
     145/      20 :                     ; Jump to HL
     146/      20 :                     ;
     147/      20 :                     RST4:	
     148/      20 : E9                  	pchl
     149/      21 : 76                  	hlt	
     150/      22 : 76                  	hlt	
     151/      23 : 76                  	hlt	
     152/      24 :                     TRAP:
     153/      24 : 23                  	inx	h
     154/      25 : 7E                  	mov	a,m
     155/      26 : C3 24 00            	jmp	TRAP
     156/      29 : 76                  	hlt	
     157/      2A : 76                  	hlt	
     158/      2B : 76                  	hlt
     159/      2C :                     ;
     160/      2C :                     ; GPIB Interrupt
     161/      2C :                     ;
     162/      2C :                     RST5dot5:
     163/      2C : 7F                  	mov	a,a
     164/      2D : C3 F7 0F            	jmp	GPIBInterrupt
     165/      30 :                     ;
     166/      30 :                     ; Fatal error
     167/      30 :                     ;
     168/      30 :                     RST6:
     169/      30 : 7F                  	mov	a,a
     170/      31 : F3                  	di
     171/      32 : 76                  	hlt	
     172/      33 : 76                  	hlt	
     173/      34 :                     ;
     174/      34 :                     ; Display Interrupt
     175/      34 :                     ;
     176/      34 :                     RST6dot5	
     177/      34 : 7F                  	mov	a,a
     178/      35 : C3 29 20            	jmp	Display_Interrupt
     179/      38 :                     ;
     180/      38 :                     ; Position Rate Pot Interrupt
     181/      38 :                     ;
     182/      38 :                     RST7:
     183/      38 : 7F                  	mov	a,a
     184/      39 : C3 57 1A            	jmp	CursorPotInt
     185/      3C :                     ;
     186/      3C :                     ; Firmware Timing.
     187/      3C :                     ; External timer running at 500Hz (triggered every 2 mSec)
     188/      3C :                     ;	
     189/      3C :                     RST7dot5:	
     190/      3C : 7F                  	mov	a,a
     191/      3D : C3 A3 1D            	jmp	Timer_Interrupt
     192/      40 :                     ;
     193/      40 :                     SYSRAM_Area:	
     194/      40 : 00 82               	dw	RAM_MIDDLE
     195/      42 : 00 83               	dw	08300H
     196/      44 : 00 82               	dw	RAM_MIDDLE
     197/      46 :                     Display_Action_7:	
     198/      46 : C3 E0 11            	jmp	Display_Action_7_0
     199/      49 :                     AddMainAction:
     200/      49 : C3 BF 14            	jmp	AddMainAction_0
     201/      4C :                     Display_Action_6:	
     202/      4C : C3 10 15            	jmp	Display_Action_6_0
     203/      4F :                     ;
     204/      4F :                     ; input A, DE. Output HL
     205/      4F :                     ;	
     206/      4F :                     Get_Word_From_Table:
     207/      4F : C3 98 16            	jmp	Get_Word_From_Table_0
     208/      52 :                     RenderCursorLine:
     209/      52 : C3 37 10            	jmp	RenderCursorLine_0
     210/      55 :                     StrobeDisplayRAM:
     211/      55 : C3 B0 11            	jmp	StrobeDisplayRAM_0
     212/      58 :                     SetUpLineCursor:	
     213/      58 : C3 B9 11            	jmp	SetUpLineCursor_0
     214/      5B :                     EnableLineCursor:	
     215/      5B : C3 CD 11            	jmp	EnableLineCursor_0
     216/      5E :                     ;
     217/      5E :                     ; Reset because of a UI change
     218/      5E :                     ;	
     219/      5E :                     Main_Action_5:	
     220/      5E : 3A A5 80            	lda	V_DigitalMode
     221/      61 : FE 03               	cpi	DIGITAL_AVG
     222/      63 : C2 70 00            	jnz	L0070				;brif !DIGITAL_AVG
     223/      66 :                     $$L:
     224/      66 : 3A 01 80            	lda	V_fOK2ProcessAcq	;wait for Display Interrupt to finish
     225/      69 : 17                  	ral						;boolean test
     226/      6A : D2 66 00            	jnc	$$L					;brif FALSE
     227/      6D : CD 9D 00            	call Clear_ValidWFs		;invalidate all WFs
     228/      70 :                     L0070:
     229/      70 : 3E FF               	mvi	a,0FFH				;TRUE
     230/      72 : 32 02 80            	sta	V_fOK2UpdateDispWF
     231/      75 : 3E FF               	mvi	a,0FFH				;TRUE
     232/      77 : 32 03 80            	sta	V_fSkipAcquiredWF
     233/      7A : 3E 08               	mvi	a,MAIN_ACTION_8_ID	;set INITAVG bit
     234/      7C : CD 49 00            	call AddMainAction
     235/      7F : 3A 08 80            	lda	V_ACQ_Mode
     236/      82 : E6 7F               	ani	7Fh					;01111111 Clr LT2
     237/      84 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
     238/      87 : 3E 3F               	mvi	a,03FH
     239/      89 : 32 02 E2            	sta	DEV_WRSR2
     240/      8C : 3A 03 E2            	lda	DEV_MTRIG			;stop time base trigger
     241/      8F : 32 09 80            	sta	VAR_8009
     242/      92 :                     ;
     243/      92 :                     ; wait for ACQUIRE bit in DEV_RDSTAT to go LOW
     244/      92 :                     ;
     245/      92 :                     $$L:
     246/      92 : 3A 04 E2            	lda	DEV_RDSTAT
     247/      95 : E6 01               	ani	01h
     248/      97 : FE 01               	cpi	01h					;A - 1
     249/      99 : C2 92 00            	jnz	$$L					;loop until 0
     250/      9C : C9                  	ret						;end Main_Action_5
     251/      9D :                     ;
     252/      9D :                     ; Update V_ValidWFs, based on V_WFTable entries
     253/      9D :                     ;
     254/      9D :                     Clear_ValidWFs:
     255/      9D : 11 9F 80            	lxi	d,V_ValidWFs		;p2 = &V_ValidWFs. Table of 4 booleans
     256/      A0 : 21 83 80            	lxi	h,V_WFTable+S_CHANMODE
     257/      A3 : 06 04               	mvi	b,04h				;loop counter: 4, 3, 2, 1
     258/      A5 :                     L00A5:
     259/      A5 : 7E                  	mov	a,m					;*p
     260/      A6 : A7                  	ana	a					;test
     261/      A7 : FA AC 00            	jm	L00AC				;jump if bit 7 set
     262/      AA : AF                  	xra	a					;clr
     263/      AB : 12                  	stax	d				;set V_ValidWFs table entry to FALSE
     264/      AC : 78                  L00AC:	mov	a,b				;save
     265/      AD : 01 08 00            	lxi	b,WFENTRYSIZE
     266/      B0 : 09                  	dad	b					;p += 8
     267/      B1 : 47                  	mov	b,a					;restore
     268/      B2 : 13                  	inx	d					;p2++
     269/      B3 : 05                  	dcr	b					;loop 4 times
     270/      B4 : C2 A5 00            	jnz	L00A5				;brif != 0
     271/      B7 : C9                  	ret
     272/      B8 :                     ;
     273/      B8 :                     ; Read Front Panel Buttons
     274/      B8 :                     ;
     275/      B8 :                     ReadDeviceControls:
     276/      B8 : 3A 42 E0            	lda	DEV_FP2				;Front Panel push buttons XMIT, NO.AVG, TIME, VOLTS
     277/      BB : 2F                  	cma						;store as Active High
     278/      BC : 32 C9 80            	sta	V_FP2
     279/      BF : 3A 66 80            	lda	V_GPIB_XmittingWF
     280/      C2 : 2F                  	cma
     281/      C3 : 17                  	ral						;boolean test
     282/      C4 : D2 9C 01            	jnc	L019C
     283/      C7 : AF                  	xra	a
     284/      C8 : 32 CF 80            	sta	V_Action7_Flg
     285/      CB : 32 CD 80            	sta	V_Action5_Flg		;set FALSE
     286/      CE : 32 D0 80            	sta	V_Action3_Flg
     287/      D1 : 32 CE 80            	sta	V_Action9_Flg
     288/      D4 : 32 D1 80            	sta	V_Action6_Flg
     289/      D7 : 32 CC 80            	sta	V_LclFlag
     290/      DA : 3A 43 E0            	lda	DEV_FP1				;other Front Panel push buttons
     291/      DD : 2F                  	cma
     292/      DE : 32 CA 80            	sta	V_FP1				;store as Active High
     293/      E1 : CD A0 01            	call RecordVerticalMode
     294/      E4 : 3A CF 80            	lda	V_Action7_Flg
     295/      E7 : 32 CD 80            	sta	V_Action5_Flg
     296/      EA : 3A 1E 80            	lda	V_fCH1
     297/      ED : 17                  	ral
     298/      EE : DA F8 00            	jc	L00F8
     299/      F1 : 3A 20 80            	lda	V_fADD
     300/      F4 : 17                  	ral
     301/      F5 : D2 FB 00            	jnc	L00FB
     302/      F8 :                     L00F8:
     303/      F8 : CD 00 02            	call RecordCh1Info
     304/      FB :                     L00FB:
     305/      FB : 3A 1F 80            	lda	V_fCH2				;boolean test
     306/      FE : 17                  	ral
     307/      FF : DA 09 01            	jc	L0109
     308/     102 : 3A 20 80            	lda	V_fADD				;boolean test
     309/     105 : 17                  	ral
     310/     106 : D2 0C 01            	jnc	L010C
     311/     109 :                     L0109:
     312/     109 : CD 62 02            	call RecordCh2Info
     313/     10C : AF                  L010C:	xra	a
     314/     10D : CD D1 02            	call SetDigitalMode
     315/     110 : CD 55 03            	call ReadPOST_PRETRIGGER_Settings
     316/     113 : CD 64 03            	call ReadPULSE_SINE_Settings
     317/     116 : CD 73 03            	call ReadSAVEREFSettings
     318/     119 : CD B1 03            	call ReadTB
     319/     11C : 3A 3F 80            	lda	V_GPIB_Enabled		;boolean test
     320/     11F : 17                  	ral
     321/     120 : D2 4E 01            	jnc	L014E				;not active
     322/     123 :                     ;
     323/     123 :                     ; GPIB active
     324/     123 :                     ;	
     325/     123 : 3A C9 80            	lda	V_FP2
     326/     126 : E6 10               	ani	10h					;00010000 XMIT
     327/     128 : 2E 00               	mvi	l,00h
     328/     12A : CD BF 1E            	call Test_Different
     329/     12D : 21 68 80            	lxi	h,V_GPIB_Bool2
     330/     130 : B6                  	ora	m
     331/     131 : 32 66 80            	sta	V_GPIB_XmittingWF
     332/     134 : 17                  	ral						;test boolean
     333/     135 : D2 48 01            	jnc	L0148
     334/     138 : 3A A5 80            	lda	V_DigitalMode
     335/     13B : FE 03               	cpi	DIGITAL_AVG
     336/     13D : CA 48 01            	jz	L0148
     337/     140 : 3A A5 80            	lda	V_DigitalMode
     338/     143 : FE 02               	cpi	DIGITAL_ENV
     339/     145 : C2 4B 01            	jnz	L014B
     340/     148 : C3 4E 01            L0148:	jmp	L014E
     341/     14B : CD 7C 04            L014B:	call GPIB_SendWF
     342/     14E :                     
     343/     14E : 3A CE 80            L014E:	lda	V_Action9_Flg
     344/     151 : A7                  	ana	a					;test A
     345/     152 : CA 5A 01            	jz	L015A
     346/     155 : 3E 09               	mvi	a,09h
     347/     157 : CD 49 00            	call AddMainAction
     348/     15A : 3A CF 80            L015A:	lda	V_Action7_Flg
     349/     15D : A7                  	ana	a					;test A
     350/     15E : CA 66 01            	jz	L0166
     351/     161 : 3E 07               	mvi	a,MAIN_ACTION_7_ID
     352/     163 : CD 49 00            	call AddMainAction
     353/     166 :                     L0166:
     354/     166 : 3A CD 80            	lda	V_Action5_Flg
     355/     169 : A7                  	ana	a					;test A
     356/     16A : CA 72 01            	jz	L0172
     357/     16D : 3E 05               	mvi	a,05h
     358/     16F : CD 49 00            	call AddMainAction
     359/     172 : 3A D0 80            L0172:	lda	V_Action3_Flg
     360/     175 : A7                  	ana	a					;test A
     361/     176 : CA 7E 01            	jz	L017E
     362/     179 : 3E 03               	mvi	a,03h
     363/     17B : CD 49 00            	call AddMainAction
     364/     17E : 3A A5 80            L017E:	lda	V_DigitalMode
     365/     181 : FE 04               	cpi	DIGITAL_SAVE
     366/     183 : C2 94 01            	jnz	L0194
     367/     186 : 3A D1 80            	lda	V_Action6_Flg		;boolean test
     368/     189 : 17                  	ral
     369/     18A : D2 94 01            	jnc	L0194
     370/     18D : 3A 01 80            	lda	V_fOK2ProcessAcq
     371/     190 : 17                  	ral
     372/     191 : DA 97 01            	jc	L0197
     373/     194 : C3 9C 01            L0194:	jmp	L019C
     374/     197 :                     L0197:
     375/     197 : 3E 07               	mvi	a,MAIN_ACTION_7_ID
     376/     199 : CD 35 20            	call AddDisplayAction
     377/     19C :                     L019C:
     378/     19C : CD 08 04            	call Read_FP2_Buttons
     379/     19F : C9                  	ret
     380/     1A0 :                     ;
     381/     1A0 :                     RecordVerticalMode:
     382/     1A0 : 3A A5 80            	lda	V_DigitalMode
     383/     1A3 : FE 04               	cpi	DIGITAL_SAVE
     384/     1A5 : CA FF 01            	jz	L01FF
     385/     1A8 : 3A 04 E8            	lda	DEV_MODE
     386/     1AB : EE EC               	xri	0ECh				;XOR 11101100
     387/     1AD : 47                  	mov	b,a
     388/     1AE : 3E 02               	mvi	a,02h
     389/     1B0 : 21 24 80            	lxi	h,V_fTRIGVIEWENA
     390/     1B3 : 11 CF 80            	lxi	d,V_Action7_Flg		;preserved across calls to L04A4
     391/     1B6 : CD AA 04            	call UpdateFlagsifChange
     392/     1B9 : 3E 40               	mvi	a,40h
     393/     1BB : 21 21 80            	lxi	h,V_fTRIGVIEW
     394/     1BE : CD AA 04            	call UpdateFlagsifChange
     395/     1C1 : 3E 04               	mvi	a,04h
     396/     1C3 : 21 25 80            	lxi	h,V_fXY
     397/     1C6 : 11 CC 80            	lxi	d,V_LclFlag
     398/     1C9 : CD AA 04            	call UpdateFlagsifChange
     399/     1CC : 3E 08               	mvi	a,08h
     400/     1CE : 21 1F 80            	lxi	h,V_fCH2
     401/     1D1 : CD AA 04            	call UpdateFlagsifChange
     402/     1D4 : 3E 10               	mvi	a,10h
     403/     1D6 : 21 22 80            	lxi	h,V_fALT
     404/     1D9 : CD AA 04            	call UpdateFlagsifChange
     405/     1DC : 3E 20               	mvi	a,20h
     406/     1DE : 21 20 80            	lxi	h,V_fADD
     407/     1E1 : CD AA 04            	call UpdateFlagsifChange
     408/     1E4 : 3E 80               	mvi	a,80h
     409/     1E6 : 21 1E 80            	lxi	h,V_fCH1
     410/     1E9 : CD AA 04            	call UpdateFlagsifChange
     411/     1EC : 3A CC 80            	lda	V_LclFlag
     412/     1EF : 47                  	mov	b,a
     413/     1F0 : 21 CF 80            	lxi	h,V_Action7_Flg
     414/     1F3 : B6                  	ora	m
     415/     1F4 : 77                  	mov	m,a
     416/     1F5 : 78                  	mov	a,b
     417/     1F6 : A7                  	ana	a
     418/     1F7 : CA FF 01            	jz	L01FF
     419/     1FA : 3E 0A               	mvi	a,MAIN_ACTION_10_ID	;clear S_GNDREF fields
     420/     1FC : CD 49 00            	call AddMainAction
     421/     1FF : C9                  L01FF:	ret
     422/     200 :                     ;
     423/     200 :                     RecordCh1Info:
     424/     200 : 3A 00 E8            	lda	DEV_CH1
     425/     203 : 47                  	mov	b,a
     426/     204 : 2F                  	cma
     427/     205 : E6 0F               	ani	0Fh					;00001111 Volts/Division Mask
     428/     207 : 4F                  	mov	c,a					;range 1..13
     429/     208 : 3A A5 80            	lda	V_DigitalMode
     430/     20B : FE 04               	cpi	DIGITAL_SAVE
     431/     20D : C2 1A 02            	jnz	L021A
     432/     210 : 3A 1A 80            	lda	V_CH1_Info			;previous CH1 info
     433/     213 : E6 C0               	ani	0C0h				;isolate channel properties
     434/     215 : B1                  	ora	c					;move previous properties to new CH1 info
     435/     216 : 4F                  	mov	c,a					;new CH1 info
     436/     217 : C3 2E 02            	jmp	L022E
     437/     21A :                     L021A:
     438/     21A : 3E 40               	mvi	a,40h				;old UNCAL mask
     439/     21C : A0                  	ana	b
     440/     21D : C2 24 02            	jnz	L0224
     441/     220 : 3E 80               	mvi	a,80h				;new UNCAL bit
     442/     222 : B1                  	ora	c
     443/     223 : 4F                  	mov	c,a
     444/     224 :                     L0224:
     445/     224 : 3E 80               	mvi	a,80h				;old PROBE mask
     446/     226 : A0                  	ana	b
     447/     227 : CA 2E 02            	jz	L022E
     448/     22A : 3E 40               	mvi	a,40h				;new PROBE bit
     449/     22C : B1                  	ora	c
     450/     22D : 4F                  	mov	c,a					;new CH1 info
     451/     22E :                     L022E:
     452/     22E : 3A 1A 80            	lda	V_CH1_Info
     453/     231 : A9                  	xra	c					;new CH1 info
     454/     232 : E6 40               	ani	40h
     455/     234 : CA 3C 02            	jz	L023C
     456/     237 : 3E FF               	mvi	a,0FFh				;changed
     457/     239 : 32 CF 80            	sta	V_Action7_Flg
     458/     23C : 79                  L023C:	mov	a,c
     459/     23D : 21 1A 80            	lxi	h,V_CH1_Info
     460/     240 : AE                  	xra	m
     461/     241 : E6 8F               	ani	8Fh					;new UNCAL & VOLTS MASK
     462/     243 : CA 51 02            	jz	L0251
     463/     246 : 3E FF               	mvi	a,0FFh
     464/     248 : 32 CD 80            	sta	V_Action5_Flg
     465/     24B : 32 CF 80            	sta	V_Action7_Flg
     466/     24E : 32 D1 80            	sta	V_Action6_Flg
     467/     251 :                     L0251:
     468/     251 : 79                  	mov	a,c
     469/     252 : 32 1A 80            	sta	V_CH1_Info			;update
     470/     255 : 78                  	mov	a,b					;DEV_CH1
     471/     256 : 21 1C 80            	lxi	h,V_CH1_Coupling
     472/     259 : CD C4 02            	call UpdateInputCoupling
     473/     25C : 21 CD 80            	lxi	h,V_Action5_Flg
     474/     25F : B6                  	ora	m
     475/     260 : 77                  	mov	m,a
     476/     261 : C9                  	ret
     477/     262 :                     RecordCh2Info:
     478/     262 : 3A 01 E8            	lda	DEV_CH2
     479/     265 : 47                  	mov	b,a
     480/     266 : 2F                  	cma
     481/     267 : E6 0F               	ani	0Fh					;00001111 Volts/Division
     482/     269 : 4F                  	mov	c,a
     483/     26A : 3A A5 80            	lda	V_DigitalMode
     484/     26D : FE 04               	cpi	DIGITAL_SAVE
     485/     26F : C2 7C 02            	jnz	L027C
     486/     272 : 3A 1B 80            	lda	V_CH2_Info
     487/     275 : E6 C0               	ani	0C0h				;11000000
     488/     277 : B1                  	ora	c
     489/     278 : 4F                  	mov	c,a
     490/     279 : C3 90 02            	jmp	L0290
     491/     27C : 3E 40               L027C:	mvi	a,40h			;01000000
     492/     27E : A0                  	ana	b
     493/     27F : C2 86 02            	jnz	L0286
     494/     282 : 3E 80               	mvi	a,80h				;10000000
     495/     284 : B1                  	ora	c
     496/     285 : 4F                  	mov	c,a
     497/     286 : 3E 80               L0286:	mvi	a,80h			;10000000
     498/     288 : A0                  	ana	b
     499/     289 : CA 90 02            	jz	L0290
     500/     28C : 3E 40               	mvi	a,40h				;01000000
     501/     28E : B1                  	ora	c
     502/     28F : 4F                  	mov	c,a
     503/     290 : 3A 1B 80            L0290:	lda	V_CH2_Info
     504/     293 : A9                  	xra	c
     505/     294 : E6 40               	ani	40h					;01000000
     506/     296 : CA 9E 02            	jz	L029E
     507/     299 : 3E FF               	mvi	a,0FFh
     508/     29B : 32 CF 80            	sta	V_Action7_Flg
     509/     29E : 79                  L029E:	mov	a,c
     510/     29F : 21 1B 80            	lxi	h,V_CH2_Info
     511/     2A2 : AE                  	xra	m
     512/     2A3 : E6 8F               	ani	8Fh					;10001111
     513/     2A5 : CA B3 02            	jz	L02B3
     514/     2A8 : 3E FF               	mvi	a,0FFh
     515/     2AA : 32 CD 80            	sta	V_Action5_Flg
     516/     2AD : 32 CF 80            	sta	V_Action7_Flg
     517/     2B0 : 32 D1 80            	sta	V_Action6_Flg
     518/     2B3 : 79                  L02B3:	mov	a,c
     519/     2B4 : 32 1B 80            	sta	V_CH2_Info
     520/     2B7 : 78                  	mov	a,b
     521/     2B8 : 21 1D 80            	lxi	h,V_CH2_Coupling
     522/     2BB : CD C4 02            	call UpdateInputCoupling
     523/     2BE : 21 CD 80            	lxi	h,V_Action5_Flg
     524/     2C1 : B6                  	ora	m
     525/     2C2 : 77                  	mov	m,a
     526/     2C3 : C9                  	ret
     527/     2C4 :                     ;
     528/     2C4 :                     ; test *(HL) for (A&30h). Update *(HL) if non-zero
     529/     2C4 :                     ; returns 0 or 0xff in A
     530/     2C4 :                     ;	
     531/     2C4 :                     UpdateInputCoupling:
     532/     2C4 : 06 30               	mvi	b,30h				;00110000
     533/     2C6 : A0                  	ana	b
     534/     2C7 : BE                  	cmp	m
     535/     2C8 : CA CF 02            	jz	L02CF
     536/     2CB : 77                  	mov	m,a
     537/     2CC : 3E FF               	mvi	a,0FFh
     538/     2CE : C9                  	ret
     539/     2CF : AF                  L02CF:	xra	a
     540/     2D0 : C9                  	ret
     541/     2D1 :                     ;	
     542/     2D1 :                     ; input A = 0 or 0xff (FALSE or TRUE)
     543/     2D1 :                     ; check bits 0..4 in V_FP1: SAVE(4)|AVG|ENV|NORM|OFF(0), stored as Active High
     544/     2D1 :                     ; only 1 bit can be set due to the push buttons design
     545/     2D1 :                     ;
     546/     2D1 :                     SetDigitalMode:
     547/     2D1 : 4F                  	mov	c,a					;save input
     548/     2D2 : 3A CA 80            	lda	V_FP1
     549/     2D5 : E6 1F               	ani	1Fh					;00011111
     550/     2D7 : C8                  	rz
     551/     2D8 :                     ;
     552/     2D8 :                     ; A guaranteed not 0
     553/     2D8 :                     ; determine bit number cleared. range 0..4
     554/     2D8 :                     ;	
     555/     2D8 : 06 00               	mvi	b,00h				
     556/     2DA : 1F                  $$L: rar					;>> 1
     557/     2DB : DA E2 02            	jc	L02E2				;if bit 0 was 1, done
     558/     2DE : 04                  	inr	b
     559/     2DF : C3 DA 02            	jmp	$$L
     560/     2E2 :                     L02E2:
     561/     2E2 :                     ;
     562/     2E2 :                     ; B contains active high bit number 0..4
     563/     2E2 :                     ;
     564/     2E2 : 79                  	mov	a,c					;restore input
     565/     2E3 : A7                  	ana	a					;test boolean
     566/     2E4 : FA FA 02            	jm	L02FA				;jmp if TRUE
     567/     2E7 : 78                  	mov	a,b					;bit number from V_FP1 (0-4)
     568/     2E8 : FE 04               	cpi	04h					;was it bit 4 (SAVE)
     569/     2EA : C2 FA 02            	jnz	L02FA				;no
     570/     2ED :                     ;
     571/     2ED :                     ; bit 4 was set: SAVE
     572/     2ED :                     ;	
     573/     2ED : 3A A5 80            	lda	V_DigitalMode
     574/     2F0 : FE 02               	cpi	DIGITAL_ENV
     575/     2F2 : CA 1F 03            	jz	L031F				;rz!
     576/     2F5 : FE 03               	cpi	DIGITAL_AVG
     577/     2F7 : CA 1F 03            	jz	L031F				;rz!
     578/     2FA :                     ;
     579/     2FA :                     ; B contains bitnumber that was active low
     580/     2FA :                     ;	
     581/     2FA :                     L02FA:
     582/     2FA : 3A A5 80            	lda	V_DigitalMode		;table index.
     583/     2FD : 57                  	mov	d,a
     584/     2FE : 87                  	add	a					;times 5
     585/     2FF : 87                  	add	a
     586/     300 : 82                  	add	d
     587/     301 : 80                  	add	b					;plus B. Offset within entry (0..4)
     588/     302 : 11 C8 1E            	lxi	d,DIGITAL_Tbl		;ROM table, 5 bytes per entry
     589/     305 : CF                  	rst	1					;Get *(DE + A) in A
     590/     306 : 21 A5 80            	lxi	h,V_DigitalMode		;save B: active bit number
     591/     309 : 70                  	mov	m,b					;set V_DigitalMode here
     592/     30A : 21 DF 1E            	lxi	h,DIGITAL_Actions_Tbl-2	;ROM table
     593/     30D :                     L030D:
     594/     30D : 23                  	inx	h					;next table entry
     595/     30E : 23                  	inx	h
     596/     30F : 87                  	add	a					;x2 (result from table DIGITAL_Tbl lookup)
     597/     310 : D2 1C 03            	jnc	L031C				;exit if old A < 0x80
     598/     313 : E5                  	push	h
     599/     314 : F5                  	push	psw				;save A
     600/     315 : 5E                  	mov	e,m					;get function address from table
     601/     316 : 23                  	inx	h
     602/     317 : 56                  	mov	d,m
     603/     318 : EB                  	xchg					;swap HL and DE
     604/     319 : E7                  	rst	4					;push return address, jump to <HL>.
     605/     31A : F1                  	pop	psw					;restore A
     606/     31B : E1                  	pop	h
     607/     31C :                     L031C:
     608/     31C : C2 0D 03            	jnz	L030D
     609/     31F : C9                  L031F:	ret
     610/     320 :                     ;
     611/     320 :                     ;
     612/     320 :                     Set_Action5_Flg:
     613/     320 : 3E FF               	mvi	a,0FFh				;V_Action5_Flg = TRUE
     614/     322 : 32 CD 80            	sta	V_Action5_Flg
     615/     325 : C9                  	ret
     616/     326 :                     ;	
     617/     326 :                     Add_Action_2:	
     618/     326 : 3E 02               	mvi	a,02h
     619/     328 : CD 49 00            	call AddMainAction
     620/     32B : C9                  	ret
     621/     32C :                     L032C:	
     622/     32C : 3E FF               	mvi	a,0FFh				;V_Action7_Flg = TRUE
     623/     32E : 32 CF 80            	sta	V_Action7_Flg
     624/     331 : 3E FF               	mvi	a,0FFh				;V_Action9_Flg = TRUE
     625/     333 : 32 CE 80            	sta	V_Action9_Flg
     626/     336 : C9                  	ret
     627/     337 :                     L0337:
     628/     337 : 3E FF               	mvi	a,0FFh				;V_fOK2ProcessAcq = TRUE
     629/     339 : 32 01 80            	sta	V_fOK2ProcessAcq
     630/     33C : C9                  	ret
     631/     33D :                     L033D:
     632/     33D : 3A A5 80            	lda	V_DigitalMode
     633/     340 : CD CE 04            	call Set_TRACK_HOLD
     634/     343 : C9                  	ret
     635/     344 :                     L0344:	
     636/     344 : 2A C4 80            	lhld V_ENV_Sweeps		;V_Sweep_Cnt1 = *(word *)V_ENV_Sweeps
     637/     347 : 22 C6 80            	shld V_Sweep_Cnt1
     638/     34A : C9                  	ret
     639/     34B :                     L034B:	
     640/     34B : 2A C2 80            	lhld V_AVG_Sweeps		;V_Sweep_Cnt1 = *(word *)V_AVG_Sweeps
     641/     34E : 22 C6 80            	shld V_Sweep_Cnt1
     642/     351 : CD 9D 00            	call Clear_ValidWFs
     643/     354 : C9                  	ret
     644/     355 :                     ;	
     645/     355 :                     ReadPOST_PRETRIGGER_Settings:
     646/     355 : 3A CA 80            	lda	V_FP1
     647/     358 : 06 40               	mvi	b,40h				;01000000 POST/PRETRIGGER
     648/     35A : 21 A7 80            	lxi	h,V_fPostPreTrigger
     649/     35D : 11 CD 80            	lxi	d,V_Action5_Flg
     650/     360 : CD AA 04            	call UpdateFlagsifChange ;Check change status
     651/     363 : C9                  	ret
     652/     364 :                     ;	
     653/     364 :                     ReadPULSE_SINE_Settings:
     654/     364 : 3A CA 80            	lda	V_FP1
     655/     367 : 06 80               	mvi	b,80h				;10000000 PULSE/SINE
     656/     369 : 21 A8 80            	lxi	h,V_fPulseSine
     657/     36C : 11 D1 80            	lxi	d,V_Action6_Flg
     658/     36F : CD AA 04            	call UpdateFlagsifChange
     659/     372 : C9                  	ret
     660/     373 :                     ;
     661/     373 :                     ReadSAVEREFSettings:
     662/     373 : 3A CA 80            	lda	V_FP1
     663/     376 : E6 20               	ani	20h					;00100000 SAVEREF
     664/     378 : 3E FF               	mvi	a,0FFh
     665/     37A : C2 7E 03            	jnz	L037E				;brif SAVEREF active
     666/     37D : 2F                  	cma
     667/     37E :                     L037E:
     668/     37E : 47                  	mov	b,a					;save boolean SAVEREF_Active
     669/     37F : 3A A6 80            	lda	V_fSAVEREFShowing	;boolean test
     670/     382 : A7                  	ana	a
     671/     383 : CA 95 03            	jz	L0395				
     672/     386 :                     ; V_fSAVEREFShowing is TRUE	
     673/     386 : 78                  	mov	a,b					;reload boolean SAVEREF_Active
     674/     387 : A7                  	ana	a					;test
     675/     388 : C2 92 03            	jnz	L0392				;jump if A TRUE
     676/     38B : AF                  	xra	a
     677/     38C : 32 A6 80            	sta	V_fSAVEREFShowing	;flip V_fSAVEREFShowing to FALSE
     678/     38F : CD 03 16            	call RemoveREFWFfromWFTbl
     679/     392 :                     L0392:
     680/     392 : C3 99 03            	jmp	L0399				;skip setting V_fSAVEREFPushed
     681/     395 :                     ; V_fSAVEREFShowing is FALSE
     682/     395 :                     L0395:
     683/     395 : 78                  	mov	a,b					;reload boolean SAVEREF_Active
     684/     396 : 32 0F 80            	sta	V_fSAVEREFPushed
     685/     399 :                     L0399:
     686/     399 : 3A 0F 80            	lda	V_fSAVEREFPushed	;boolean test
     687/     39C : 17                  	ral
     688/     39D : D2 A8 03            	jnc	L03A8
     689/     3A0 : 3A A5 80            	lda	V_DigitalMode
     690/     3A3 : FE 04               	cpi	DIGITAL_SAVE
     691/     3A5 : CA AB 03            	jz	L03AB
     692/     3A8 : C3 B0 03            L03A8:	jmp	L03B0
     693/     3AB : 3E 06               L03AB:	mvi	a,06h
     694/     3AD : CD 35 20            	call AddDisplayAction
     695/     3B0 : C9                  L03B0:	ret
     696/     3B1 :                     ;
     697/     3B1 :                     ; read Time Settings
     698/     3B1 :                     ;
     699/     3B1 :                     ReadTB:
     700/     3B1 : 3A 03 E8            	lda	DEV_BTIME
     701/     3B4 : E6 80               	ani	080h				;10000000 A/B
     702/     3B6 : CA BB 03            	jz	L03BB				;jump if B active
     703/     3B9 : 3E FF               	mvi	a,0FFh				;A active
     704/     3BB :                     L03BB:
     705/     3BB : 21 23 80            	lxi	h,V_ATimebaseActive
     706/     3BE : BE                  	cmp	m
     707/     3BF : CA CB 03            	jz	L03CB				;jmp if no change
     708/     3C2 : 77                  	mov	m,a					;update	V_ATimebaseActive
     709/     3C3 : 3E FF               	mvi	a,0FFh
     710/     3C5 : 32 CD 80            	sta	V_Action5_Flg		;set TRUE
     711/     3C8 : 32 D1 80            	sta	V_Action6_Flg
     712/     3CB :                     L03CB:
     713/     3CB : 3A 02 E8            	lda	DEV_ATIME			;one and only reference to A TIME/DIV
     714/     3CE : 2F                  	cma						;original active Low
     715/     3CF : E6 1F               	ani	1Fh					;00011111 A TIME/DIV	5 bits
     716/     3D1 : 47                  	mov	b,a					;save
     717/     3D2 : 21 18 80            	lxi	h,V_ATIME
     718/     3D5 : BE                  	cmp	m
     719/     3D6 : CA E8 03            	jz	L03E8				;jmp if no change
     720/     3D9 : 3A 23 80            	lda	V_ATimebaseActive	;is A active
     721/     3DC : A7                  	ana	a
     722/     3DD : F2 E8 03            	jp	L03E8				;positive means B active
     723/     3E0 : 3E FF               	mvi	a,0FFh
     724/     3E2 : 32 CD 80            	sta	V_Action5_Flg		;set TRUE
     725/     3E5 : 32 D1 80            	sta	V_Action6_Flg
     726/     3E8 : 70                  L03E8:	mov	m,b				;update V_ATIME
     727/     3E9 : 3A 03 E8            	lda	DEV_BTIME
     728/     3EC : 2F                  	cma
     729/     3ED : E6 1F               	ani	1Fh					;00011111 B TIME/DIV
     730/     3EF : 47                  	mov	b,a
     731/     3F0 : 21 19 80            	lxi	h,V_BTIME
     732/     3F3 : BE                  	cmp	m
     733/     3F4 : CA 06 04            	jz	L0406
     734/     3F7 : 3A 23 80            	lda	V_ATimebaseActive
     735/     3FA : A7                  	ana	a
     736/     3FB : FA 06 04            	jm	L0406				;negative means A active
     737/     3FE : 3E FF               	mvi	a,0FFh
     738/     400 : 32 CD 80            	sta	V_Action5_Flg		;set TRUE
     739/     403 : 32 D1 80            	sta	V_Action6_Flg
     740/     406 : 70                  L0406:	mov	m,b				;update V_BTIME
     741/     407 : C9                  	ret
     742/     408 :                     ;
     743/     408 :                     ;
     744/     408 :                     Read_FP2_Buttons:
     745/     408 : 3A A5 80            	lda	V_DigitalMode
     746/     40B : FE 00               	cpi	DIGITAL_OFF
     747/     40D : C2 1A 04            	jnz	L041A
     748/     410 : 3E FF               	mvi	a,0FFh
     749/     412 : 32 C8 80            	sta	V_NotCountingDown
     750/     415 : 3E 00               	mvi	a,00h
     751/     417 : C3 53 04            	jmp	L0453
     752/     41A : FE 03               L041A:	cpi	DIGITAL_AVG	;A = V_DigitalMode
     753/     41C : CA 24 04            	jz	L0424
     754/     41F : FE 02               	cpi	02h
     755/     421 : C2 49 04            	jnz	L0449
     756/     424 :                     ;
     757/     424 :                     ; V_DigitalMode = 2 or 3
     758/     424 :                     ;	
     759/     424 :                     L0424:
     760/     424 : 3A C9 80            	lda	V_FP2				;active High
     761/     427 : E6 04               	ani	04h					;00000100 NO.AVG
     762/     429 : CA 35 04            	jz	L0435
     763/     42C : AF                  	xra	a
     764/     42D : 32 C8 80            	sta	V_NotCountingDown
     765/     430 : 3E 04               	mvi	a,04h
     766/     432 : C3 46 04            	jmp	L0446
     767/     435 : 3A C8 80            L0435:	lda	V_NotCountingDown
     768/     438 : A7                  	ana	a
     769/     439 : C2 41 04            	jnz	L0441
     770/     43C : 3E 05               	mvi	a,05h
     771/     43E : C3 46 04            	jmp	L0446
     772/     441 : 3A C9 80            L0441:	lda	V_FP2
     773/     444 : E6 03               	ani	03h					;00000011 TIME VOLTS
     774/     446 :                     L0446:
     775/     446 : C3 53 04            	jmp	L0453
     776/     449 :                     ;
     777/     449 :                     ; A != (2 or 3)
     778/     449 :                     L0449:
     779/     449 : 3E FF               	mvi	a,0FFh				;set TRUE
     780/     44B : 32 C8 80            	sta	V_NotCountingDown
     781/     44E : 3A C9 80            	lda	V_FP2				;push buttons
     782/     451 : E6 03               	ani	03h					;00000011 TIME VOLTS
     783/     453 :                     ;
     784/     453 :                     ; multiple jmp from points. A can be 5,4,3,2,1,0
     785/     453 :                     ;	
     786/     453 :                     L0453:
     787/     453 : 21 AA 80            	lxi	h,V_CursorMode 		;p
     788/     456 : BE                  	cmp	m					;A - *p	
     789/     457 : CA 63 04            	jz	L0463				;jump if same
     790/     45A : 77                  	mov	m,a					;*p = A		ONLY TIME V_CursorMode is set
     791/     45B : FE 00               	cpi	00h					;TIME or VOLTS on
     792/     45D : C2 63 04            	jnz	L0463				;jump if yes
     793/     460 : CD D6 16            	call ClrNumWin			;clear LED display
     794/     463 :                     L0463:
     795/     463 : 3A 03 E4            	lda	DEV_CURSOR
     796/     466 : E6 20               	ani	20h					;00100000 SELECT
     797/     468 : 21 D2 80            	lxi	h,V_CURSOR_Select	;test if changed
     798/     46B : BE                  	cmp	m
     799/     46C : CA 7B 04            	jz	Local047B
     800/     46F : 77                  	mov	m,a					;update V_CURSOR_Select
     801/     470 : A7                  	ana	a					;test
     802/     471 : CA 7B 04            	jz	Local047B
     803/     474 : 3A AD 80            	lda	V_fFirstCursorActive ;Reverse Boolean value
     804/     477 : 2F                  	cma
     805/     478 : 32 AD 80            	sta	V_fFirstCursorActive
     806/     47B :                     Local047B:
     807/     47B : C9                  	ret
     808/     47C :                     ;
     809/     47C :                     GPIB_SendWF:
     810/     47C : 3A 3F 80            	lda	V_GPIB_Enabled	;test boolean
     811/     47F : 17                  	ral
     812/     480 : D2 A9 04            	jnc	L04A9				;not active
     813/     483 : 3A 66 80            	lda	V_GPIB_XmittingWF
     814/     486 : A7                  	ana	a
     815/     487 : C2 91 04            	jnz	L0491
     816/     48A : 3A 68 80            	lda	V_GPIB_Bool2
     817/     48D : A7                  	ana	a					;test
     818/     48E : CA A9 04            	jz	L04A9
     819/     491 : 3E FF               L0491:	mvi	a,0FFh
     820/     493 : 32 66 80            	sta	V_GPIB_XmittingWF	;V_GPIB_XmittingWF = TRUE
     821/     496 : AF                  	xra	a
     822/     497 : 32 68 80            	sta	V_GPIB_Bool2		;V_GPIB_Bool2 = FALSE
     823/     49A : 3E 10               	mvi	a,10h				;00010000 SAVE
     824/     49C : 32 CA 80            	sta	V_FP1
     825/     49F : 3E FF               	mvi	a,0FFh
     826/     4A1 : CD D1 02            	call SetDigitalMode
     827/     4A4 : 3E 7E               	mvi	a,7Eh
     828/     4A6 : CD 49 00            	call AddMainAction
     829/     4A9 : C9                  L04A9:	ret
     830/     4AA :                     ;
     831/     4AA :                     ; input A, B, DE, HL.
     832/     4AA :                     ; B is a bitmask
     833/     4AA :                     ; if (A&B) != 0 A = TRUE else A = FALSE
     834/     4AA :                     ; if (*HL != A) {*HL = A;	*DE = TRUE;}
     835/     4AA :                     ; B, DE, HL unchanged
     836/     4AA :                     ;
     837/     4AA :                     UpdateFlagsifChange:
     838/     4AA : A0                  	ana	b
     839/     4AB : CA B0 04            	jz	L04B0				;A is FALSE if jmp
     840/     4AE : 3E FF               	mvi	a,0FFh				;TRUE
     841/     4B0 : 4F                  L04B0:	mov	c,a				;save
     842/     4B1 : BE                  	cmp	m
     843/     4B2 : C8                  	rz
     844/     4B3 : 71                  	mov	m,c					;store A
     845/     4B4 : 3E FF               	mvi	a,0FFh
     846/     4B6 : 12                  	stax	d
     847/     4B7 : C9                  	ret
     848/     4B8 :                     ;
     849/     4B8 :                     ; init function.
     850/     4B8 :                     ;
     851/     4B8 :                     Init_5_Variables:
     852/     4B8 : AF                  	xra	a
     853/     4B9 : 32 A6 80            	sta	V_fSAVEREFShowing
     854/     4BC : 3E FF               	mvi	a,0FFh
     855/     4BE : 32 AD 80            	sta	V_fFirstCursorActive
     856/     4C1 : AF                  	xra	a
     857/     4C2 : 32 68 80            	sta	V_GPIB_Bool2
     858/     4C5 : AF                  	xra	a
     859/     4C6 : 32 66 80            	sta	V_GPIB_XmittingWF
     860/     4C9 : AF                  	xra	a
     861/     4CA : 32 A5 80            	sta	V_DigitalMode		;init. Seems to be display stage/mode
     862/     4CD : C9                  	ret
     863/     4CE :                     ;
     864/     4CE :                     ; init function
     865/     4CE :                     ; in A: 1 or active push button
     866/     4CE :                     ;	
     867/     4CE :                     Set_TRACK_HOLD:
     868/     4CE : FE 04               	cpi	04h					;00000100 SAVE
     869/     4D0 : 3A 70 80            	lda	V_FPC
     870/     4D3 : C2 DB 04            	jnz	L04DB
     871/     4D6 : E6 BF               	ani	0BFh				;10111111 Clr TRACK/HOLD
     872/     4D8 : C3 DD 04            	jmp	L04DD
     873/     4DB : F6 40               L04DB:	ori	40h				;01000000 Set TRACK/HOLD
     874/     4DD : 32 70 80            L04DD:	sta	V_FPC
     875/     4E0 : 32 40 E0            	sta	DEV_FPC
     876/     4E3 : C9                  	ret
     877/     4E4 :                     ;
     878/     4E4 :                     ; Update VSM and LIGHTS
     879/     4E4 :                     ;	
     880/     4E4 :                     Main_Action_7:	
     881/     4E4 : 3A A5 80            	lda	V_DigitalMode
     882/     4E7 : FE 00               	cpi	DIGITAL_OFF
     883/     4E9 : C2 54 05            	jnz	L0554
     884/     4EC : 3A D4 80            	lda	V_VSM
     885/     4EF : E6 80               	ani	80h					;10000000 SWEEP DISABLE
     886/     4F1 : F6 08               	ori	08h					;00001000 XY (active low)
     887/     4F3 : 47                  	mov	b,a					;running bits
     888/     4F4 : 3A 1E 80            	lda	V_fCH1
     889/     4F7 : A7                  	ana	a					;boolean test
     890/     4F8 : F2 FF 04            	jp	L04FF
     891/     4FB : 78                  	mov	a,b
     892/     4FC : F6 10               	ori	10h					;00010000 CH1
     893/     4FE : 47                  	mov	b,a					;running bits
     894/     4FF : 3A 1F 80            L04FF:	lda	V_fCH2
     895/     502 : A7                  	ana	a					;boolean test
     896/     503 : F2 0A 05            	jp	L050A
     897/     506 : 78                  	mov	a,b
     898/     507 : F6 04               	ori	04h					;00000100 CH2
     899/     509 : 47                  	mov	b,a					;running bits
     900/     50A : 3A 20 80            L050A:	lda	V_fADD
     901/     50D : A7                  	ana	a					;boolean test
     902/     50E : F2 15 05            	jp	L0515
     903/     511 : 78                  	mov	a,b
     904/     512 : F6 02               	ori	02h					;00000010 ADD
     905/     514 : 47                  	mov	b,a					;running bits
     906/     515 : 3A 21 80            L0515:	lda	V_fTRIGVIEW
     907/     518 : A7                  	ana	a					;boolean test
     908/     519 : F2 2B 05            	jp	L052B
     909/     51C : 78                  	mov	a,b
     910/     51D : F6 01               	ori	01h					;00000001 TRIG VIEW
     911/     51F : 47                  	mov	b,a					;running bits
     912/     520 : 3A 24 80            	lda	V_fTRIGVIEWENA
     913/     523 : A7                  	ana	a					;boolean test
     914/     524 : F2 2B 05            	jp	L052B
     915/     527 : 78                  	mov	a,b
     916/     528 : F6 40               	ori	40h					;01000000 TRIGVIEW ENABLE
     917/     52A : 47                  	mov	b,a					;running bits
     918/     52B : 3A 22 80            L052B:	lda	V_fALT
     919/     52E : A7                  	ana	a					;boolean test
     920/     52F : F2 36 05            	jp	L0536
     921/     532 : 78                  	mov	a,b
     922/     533 : F6 20               	ori	20h					;00100000 ALT/CHOP
     923/     535 : 47                  	mov	b,a					;running bits
     924/     536 : 3A 25 80            L0536:	lda	V_fXY
     925/     539 : A7                  	ana	a					;boolean test
     926/     53A : F2 41 05            	jp	L0541
     927/     53D : 78                  	mov	a,b
     928/     53E : E6 D7               	ani	0D7h				;11010111 Clr XY ALT/CHOP
     929/     540 : 47                  	mov	b,a					;running bits
     930/     541 : 78                  L0541:	mov	a,b
     931/     542 : 32 D4 80            	sta	V_VSM				;save
     932/     545 : E6 DF               	ani	0DFh				;11011111 Clr ALT/CHOP (select CHOP)
     933/     547 : 32 06 E8            	sta	DEV_VSM				;update VSM
     934/     54A : 0E 2D               	mvi	c,2Dh
     935/     54C : 0D                  L054C:	dcr	c				;delay loop
     936/     54D : C2 4C 05            	jnz	L054C
     937/     550 : 78                  	mov	a,b					;temp reload
     938/     551 : 32 06 E8            	sta	DEV_VSM				;update VSM with original ALT/CHOP
     939/     554 : AF                  L0554:	xra	a
     940/     555 : 32 D3 80            	sta	V_Lights		;clear
     941/     558 : 3A 1E 80            	lda	V_fCH1
     942/     55B : 21 20 80            	lxi	h,V_fADD
     943/     55E : B6                  	ora	m					;boolean test
     944/     55F : 17                  	ral
     945/     560 : D2 7B 05            	jnc	L057B
     946/     563 : 3A A5 80            	lda	V_DigitalMode
     947/     566 : 2E 00               	mvi	l,00h
     948/     568 : CD BF 1E            	call Test_Different
     949/     56B : 47                  	mov	b,a					;temp store
     950/     56C : 3A 1A 80            	lda	V_CH1_Info
     951/     56F : E6 1F               	ani	1Fh					;00011111 mod 32
     952/     571 : 2E 04               	mvi	l,04h
     953/     573 : CD 85 1E            	call Is_A_LE_L
     954/     576 : B0                  	ora	b					;temp stored value
     955/     577 : 17                  	ral						;boolean test
     956/     578 : DA 7E 05            	jc	L057E
     957/     57B : C3 9C 05            L057B:	jmp	L059C
     958/     57E : 3A 1A 80            L057E:	lda	V_CH1_Info
     959/     581 : E6 40               	ani	40h					;01000000
     960/     583 : FE 00               	cpi	00h
     961/     585 : CA 93 05            	jz	L0593
     962/     588 : 3A D3 80            	lda	V_Lights
     963/     58B : F6 08               	ori	08h					;00001000 Set CH1X10
     964/     58D : 32 D3 80            	sta	V_Lights
     965/     590 : C3 9C 05            	jmp	L059C
     966/     593 : 3E 04               L0593:	mvi	a,04h			;00000100 Set CH2X10
     967/     595 : 21 D3 80            	lxi	h,V_Lights
     968/     598 : B6                  	ora	m
     969/     599 : 32 D3 80            	sta	V_Lights
     970/     59C : 3A A5 80            L059C:	lda	V_DigitalMode
     971/     59F : 2E 00               	mvi	l,00h
     972/     5A1 : CD 5D 3D            	call Test_Equal_A_L
     973/     5A4 : 47                  	mov	b,a					;TRUE if equal
     974/     5A5 : 3A 1F 80            	lda	V_fCH2
     975/     5A8 : 21 20 80            	lxi	h,V_fADD
     976/     5AB : B6                  	ora	m
     977/     5AC : 4F                  	mov	c,a
     978/     5AD : 3A 1B 80            	lda	V_CH2_Info
     979/     5B0 : E6 1F               	ani	1Fh
     980/     5B2 : 2E 04               	mvi	l,04h
     981/     5B4 : CD 85 1E            	call Is_A_LE_L
     982/     5B7 : A1                  	ana	c
     983/     5B8 : A0                  	ana	b
     984/     5B9 : 17                  	ral						;boolean test
     985/     5BA : DA DF 05            	jc	L05DF
     986/     5BD : 3A A5 80            	lda	V_DigitalMode
     987/     5C0 : 2E 00               	mvi	l,00h
     988/     5C2 : CD BF 1E            	call Test_Different
     989/     5C5 : 47                  	mov	b,a
     990/     5C6 : 3A 22 80            	lda	V_fALT
     991/     5C9 : 21 1E 80            	lxi	h,V_fCH1
     992/     5CC : A6                  	ana	m
     993/     5CD : 21 A6 80            	lxi	h,V_fSAVEREFShowing			;boolean test
     994/     5D0 : A6                  	ana	m
     995/     5D1 : 2F                  	cma
     996/     5D2 : 21 1F 80            	lxi	h,V_fCH2
     997/     5D5 : A6                  	ana	m
     998/     5D6 : 21 20 80            	lxi	h,V_fADD
     999/     5D9 : B6                  	ora	m
    1000/     5DA : A0                  	ana	b
    1001/     5DB : 17                  	ral						;boolean test
    1002/     5DC : D2 FD 05            	jnc	L05FD
    1003/     5DF : 3E 40               L05DF:	mvi	a,40h			;01000000
    1004/     5E1 : 21 1B 80            	lxi	h,V_CH2_Info
    1005/     5E4 : A6                  	ana	m
    1006/     5E5 : FE 00               	cpi	00h
    1007/     5E7 : CA F5 05            	jz	L05F5
    1008/     5EA : 3A D3 80            	lda	V_Lights		;update
    1009/     5ED : F6 02               	ori	02h					;00000010 Set CH2X10
    1010/     5EF : 32 D3 80            	sta	V_Lights
    1011/     5F2 : C3 FD 05            	jmp	L05FD
    1012/     5F5 : 3A D3 80            L05F5:	lda	V_Lights	;update
    1013/     5F8 : F6 01               	ori	01h					;00000001 Set CH2X1
    1014/     5FA : 32 D3 80            	sta	V_Lights
    1015/     5FD : 3A D3 80            L05FD:	lda	V_Lights
    1016/     600 : 2F                  	cma						;all bits active low
    1017/     601 : 32 05 E8            	sta	DEV_LIGHTS
    1018/     604 : C9                  	ret
    1019/     605 :                     	
    1020/     605 :                     Main_Action_9:	
    1021/     605 : 3A A5 80            	lda	V_DigitalMode
    1022/     608 : FE 00               	cpi	DIGITAL_OFF
    1023/     60A : C2 46 06            	jnz	L0646
    1024/     60D : 3A BF 80            	lda	V_CONTRL
    1025/     610 : E6 F7               	ani	0F7H				;11110111 Set TRIGVIEW (Active Low)
    1026/     612 : F6 04               	ori	04H					;00000100 Clr STORDIS (Active Low)
    1027/     614 : 32 BF 80            	sta	V_CONTRL
    1028/     617 : 32 41 E0            	sta	DEV_CONTRL
    1029/     61A : 3E 7F               	mvi	a,7Fh				;01111111 Clr SWEEP DISABLE
    1030/     61C : 21 D4 80            	lxi	h,V_VSM
    1031/     61F : A6                  	ana	m
    1032/     620 : 32 D4 80            	sta	V_VSM
    1033/     623 : 3E DF               	mvi	a,0DFh				;11011111 Toggle CHOP (Active Low)
    1034/     625 : 21 D4 80            	lxi	h,V_VSM
    1035/     628 : A6                  	ana	m
    1036/     629 : 32 06 E8            	sta	DEV_VSM
    1037/     62C : 3E 2D               	mvi	a,2Dh				;45 x 2 instructions delay
    1038/     62E :                     $$L:
    1039/     62E : 3D                  	dcr	a
    1040/     62F : C2 2E 06            	jnz	$$L
    1041/     632 : 3A D4 80            	lda	V_VSM				;reload
    1042/     635 : 32 06 E8            	sta	DEV_VSM
    1043/     638 : 3A 08 80            	lda	V_ACQ_Mode
    1044/     63B : E6 BF               	ani	0BFH				;10111111 Clr STORON
    1045/     63D : 32 08 80            	sta	V_ACQ_Mode
    1046/     640 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    1047/     643 : C3 73 06            	jmp	L0673
    1048/     646 : 3A BF 80            L0646:	lda	V_CONTRL
    1049/     649 : E6 FB               	ani	0FBh				;11111011 STORDIS
    1050/     64B : F6 08               	ori	08h					;00001000 TRIGVIEW
    1051/     64D : 32 BF 80            	sta	V_CONTRL
    1052/     650 : 32 41 E0            	sta	DEV_CONTRL
    1053/     653 : 3E DF               	mvi	a,0DFH				;11011111 ALT/CHOP
    1054/     655 : E6 C9               	ani	0C9H				;11001001 
    1055/     657 : 32 06 E8            	sta	DEV_VSM
    1056/     65A : 3E 2D               	mvi	a,02DH				;busy wait
    1057/     65C :                     $$L:						;L065C:
    1058/     65C : 3D                  	dcr	a
    1059/     65D : C2 5C 06            	jnz	$$L					;L065C
    1060/     660 : 3E C9               	mvi	a,0C9H				;11001001		SWEEP DISABLE|TRIGVIEW ENABLE|NOT XY|TRIG VIEW
    1061/     662 : 32 06 E8            	sta	DEV_VSM
    1062/     665 : 3A 08 80            	lda	V_ACQ_Mode
    1063/     668 : F6 40               	ori	040H				;01000000 Set STORON
    1064/     66A : 32 08 80            	sta	V_ACQ_Mode
    1065/     66D : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    1066/     670 : CD 5F 20            	call Set_IE				;set IE bit
    1067/     673 : C9                  L0673:	ret
    1068/     674 :                     ;
    1069/     674 :                     ; RAM TEST Finished or Skipped. Start the scope.
    1070/     674 :                     ;
    1071/     674 :                     Main_Init:
    1072/     674 : 31 00 82            	lxi	sp,RAM_MIDDLE
    1073/     677 : CD 05 15            	call Init_Action_Table
    1074/     67A : CD 2F 20            	call InitDisplayRB
    1075/     67D : CD B8 04            	call Init_5_Variables
    1076/     680 : CD A8 0F            	call Init_WFTable
    1077/     683 : CD 2C 20            	call Init_Display		;more init
    1078/     686 : CD D6 16            	call ClrNumWin
    1079/     689 : CD 8A 1B            	call InitJitterVars
    1080/     68C : CD 71 20            	call ClrCursorSnap
    1081/     68F :                     	
    1082/     68F : 3A 00 E4            	lda	DEV_DIPSW			;get switch settings
    1083/     692 : 2F                  	cma						;always complement
    1084/     693 : E6 80               	ani	80h					;test for GPIB option
    1085/     695 : FE 80               	cpi	80h
    1086/     697 : C2 A5 06            	jnz	$$L					;L06A5
    1087/     69A : 3E FF               	mvi	a,0FFh				;set GPIB flag
    1088/     69C : 32 3F 80            	sta	V_GPIB_Enabled
    1089/     69F : CD 32 20            	call Init_GPIB		;init GPIB
    1090/     6A2 : C3 A9 06            	jmp	$$L1				;L06A9
    1091/     6A5 :                     $$L:						;L06A5:
    1092/     6A5 : AF                  	xra	a					;clear GPIB flag
    1093/     6A6 : 32 3F 80            	sta	V_GPIB_Enabled
    1094/     6A9 :                     $$L1:						;L06A9:
    1095/     6A9 :                     	
    1096/     6A9 : 3E 01               	mvi	a,01h
    1097/     6AB : CD CE 04            	call Set_TRACK_HOLD
    1098/     6AE : CD B8 00            	call ReadDeviceControls ;read Front Panel
    1099/     6B1 : 3E 09               	mvi	a,MAIN_ACTION_9_ID
    1100/     6B3 : CD 49 00            	call AddMainAction
    1101/     6B6 : 3E 07               	mvi	a,MAIN_ACTION_7_ID
    1102/     6B8 : CD 49 00            	call AddMainAction
    1103/     6BB : 3E 05               	mvi	a,MAIN_ACTION_5_ID
    1104/     6BD : CD 49 00            	call AddMainAction
    1105/     6C0 : 3E 02               	mvi	a,MAIN_ACTION_2_ID
    1106/     6C2 : CD 49 00            	call AddMainAction
    1107/     6C5 : 20                  	rim						;code similar to Set_IE but not identical
    1108/     6C6 : E6 0B               	ani	0Bh					;00001011	preserve MSE, M6.5 and M5.5 mask
    1109/     6C8 : F6 08               	ori	08h					;00001000	set MSE
    1110/     6CA : 30                  	sim
    1111/     6CB : FB                  	ei
    1112/     6CC : C3 66 1D            	jmp	Main
    1113/     6CF :                     ;
    1114/     6CF :                     ; in A, B, HL
    1115/     6CF :                     ; A always loaded from V_samplesCnt
    1116/     6CF :                     ;	
    1117/     6CF :                     Do_Interpolation:
    1118/     6CF : 32 D9 80            	sta	V_nSamples
    1119/     6D2 : 78                  	mov	a,b
    1120/     6D3 : FE 02               	cpi	02h					;DIGITAL_ENV
    1121/     6D5 : C2 E2 06            	jnz	L06E2
    1122/     6D8 :                     ; input B was 2	
    1123/     6D8 : 23                  	inx	h					;HL += 4
    1124/     6D9 : 23                  	inx	h
    1125/     6DA : 23                  	inx	h
    1126/     6DB : 23                  	inx	h
    1127/     6DC : CD 34 07            	call ENV_Interpolation	;uses V_nSamples
    1128/     6DF : C3 F9 06            	jmp	L06F9
    1129/     6E2 :                     L06E2:
    1130/     6E2 : CD CE 08            	call DoubleJitter
    1131/     6E5 : 3A A8 80            	lda	V_fPulseSine
    1132/     6E8 : A7                  	ana	a					;test
    1133/     6E9 : F2 F2 06            	jp	L06F2
    1134/     6EC : CD 6D 07            	call Sine_Interpolation	;uses V_nSamples
    1135/     6EF : C3 F9 06            	jmp	L06F9
    1136/     6F2 :                     L06F2:
    1137/     6F2 : 23                  	inx	h
    1138/     6F3 : 23                  	inx	h
    1139/     6F4 : 23                  	inx	h
    1140/     6F5 : 23                  	inx	h
    1141/     6F6 : CD 1F 07            	call Pulse_Interpolation
    1142/     6F9 : C9                  L06F9:	ret
    1143/     6FA :                     ;
    1144/     6FA :                     ; in A,B, HL
    1145/     6FA :                     ; A always loaded from V_samplesCnt
    1146/     6FA :                     ;
    1147/     6FA :                     Do_Interpolation_2:
    1148/     6FA : 32 D9 80            	sta	V_nSamples
    1149/     6FD : 78                  	mov	a,b
    1150/     6FE : FE 02               	cpi	02h					;DIGITAL_ENV
    1151/     700 : C2 0A 07            	jnz	L070A
    1152/     703 :                     ; input B was 2	
    1153/     703 : 23                  	inx	h
    1154/     704 : CD 34 07            	call ENV_Interpolation	;uses V_nSamples
    1155/     707 : C3 1E 07            	jmp	L071E
    1156/     70A :                     L070A:
    1157/     70A : CD CE 08            	call DoubleJitter
    1158/     70D : 3A A8 80            	lda	V_fPulseSine
    1159/     710 : A7                  	ana	a					;test
    1160/     711 : F2 1A 07            	jp	L071A
    1161/     714 : CD 40 08            	call Sine_Interpolation2 ;uses V_nSamples
    1162/     717 : C3 1E 07            	jmp	L071E
    1163/     71A : 23                  L071A:	inx	h
    1164/     71B : CD 1F 07            	call Pulse_Interpolation			;uses V_nSamples
    1165/     71E : C9                  L071E:	ret
    1166/     71F :                     ;
    1167/     71F :                     ; in DE,HL
    1168/     71F :                     ;
    1169/     71F :                     Pulse_Interpolation:
    1170/     71F : 3A D9 80            	lda	V_nSamples
    1171/     722 : 47                  	mov	b,a
    1172/     723 :                     L0723:
    1173/     723 : 7E                  	mov	a,m
    1174/     724 : 12                  	stax d
    1175/     725 : 13                  	inx	d
    1176/     726 : 23                  	inx	h
    1177/     727 : 86                  	add	m
    1178/     728 : 1F                  	rar
    1179/     729 : 12                  	stax d
    1180/     72A : 13                  	inx	d
    1181/     72B : 05                  	dcr	b
    1182/     72C : C2 23 07            	jnz	L0723
    1183/     72F : EB                  	xchg
    1184/     730 : CD DA 08            	call Clear_Memory_Block
    1185/     733 : C9                  	ret
    1186/     734 :                     ;
    1187/     734 :                     ; in DE,HL
    1188/     734 :                     ;	
    1189/     734 :                     ENV_Interpolation:
    1190/     734 : 22 D5 80            	shld V_Saved_Arg_HL		;ptr p1
    1191/     737 : EB                  	xchg
    1192/     738 : 22 D7 80            	shld V_Saved_Arg_DE		;ptr p2
    1193/     73B : EB                  	xchg
    1194/     73C : 0E 02               	mvi	c,02h				;outer loop counter
    1195/     73E :                     ;outer loop
    1196/     73E :                     ; inner loopcounter B = V_nSamples ? V_nSamples/2 : 128
    1197/     73E :                     ; meaning V_nSamples/2 where V_nSamples==0 means V_nSamples==256
    1198/     73E :                     L073E:
    1199/     73E : 3A D9 80            	lda	V_nSamples
    1200/     741 : A7                  	ana	a					;test
    1201/     742 : C2 46 07            	jnz	L0746				;brif != 0
    1202/     745 : 37                  	stc						;0 becomes 128 after rar
    1203/     746 :                     L0746:
    1204/     746 : 1F                  	rar					
    1205/     747 : 47                  	mov	b,a					;loop counter
    1206/     748 :                     ;inner loop
    1207/     748 : 7E                  L0748:	mov	a,m				;A=*p1
    1208/     749 : 12                  	stax d					;*p2++ = A
    1209/     74A : 13                  	inx	d					
    1210/     74B : 13                  	inx	d					;p2++	skip
    1211/     74C : 23                  	inx	h					;p1++
    1212/     74D : 23                  	inx	h					;p1++	skip
    1213/     74E : 86                  	add	m					;A += *p1
    1214/     74F : 1F                  	rar						;A >> 1
    1215/     750 : 12                  	stax d					;*p2++ = A
    1216/     751 : 13                  	inx	d
    1217/     752 : 13                  	inx	d					;p2++
    1218/     753 : 05                  	dcr	b					;loop counter
    1219/     754 : C2 48 07            	jnz	L0748				;loop
    1220/     757 : 0D                  	dcr	c
    1221/     758 : CA 67 07            	jz	L0767				;done
    1222/     75B : 2A D7 80            	lhld V_Saved_Arg_DE		;reload p2
    1223/     75E : EB                  	xchg
    1224/     75F : 2A D5 80            	lhld V_Saved_Arg_HL		;reload p1
    1225/     762 : 23                  	inx	h					;p1++
    1226/     763 : 13                  	inx	d					;p2++
    1227/     764 : C3 3E 07            	jmp	L073E				;loop again
    1228/     767 :                     L0767:
    1229/     767 : EB                  	xchg
    1230/     768 : 2B                  	dcx	h
    1231/     769 : CD DA 08            	call Clear_Memory_Block
    1232/     76C : C9                  	ret
    1233/     76D :                     ;
    1234/     76D :                     ; in DE  p2
    1235/     76D :                     ; in HL  p1
    1236/     76D :                     ;	
    1237/     76D :                     Sine_Interpolation:
    1238/     76D : 3A D9 80            	lda	V_nSamples
    1239/     770 : 32 DA 80            	sta	V_Loop_Cntr_1
    1240/     773 : 22 D5 80            	shld V_Saved_Arg_HL		;save p1
    1241/     776 : EB                  	xchg
    1242/     777 : 22 D7 80            	shld V_Saved_Arg_DE		;save p2
    1243/     77A :                     ;
    1244/     77A :                     ; loop V_Loop_Cntr_1 times
    1245/     77A :                     ;	
    1246/     77A :                     L077A:
    1247/     77A : 2A D5 80            	lhld V_Saved_Arg_HL		;reload p1
    1248/     77D : 5E                  	mov	e,m
    1249/     77E : 16 00               	mvi	d,00h
    1250/     780 : 01 09 00            	lxi	b,09h				;L0009
    1251/     783 : 09                  	dad	b					;HL + 9
    1252/     784 : E5                  	push	h
    1253/     785 : 6E                  	mov	l,m
    1254/     786 : 26 00               	mvi	h,00h
    1255/     788 : 19                  	dad	d
    1256/     789 : 29                  	dad	h
    1257/     78A : 29                  	dad	h
    1258/     78B : 4D                  	mov	c,l
    1259/     78C : 44                  	mov	b,h
    1260/     78D : 2A D5 80            	lhld V_Saved_Arg_HL
    1261/     790 : 23                  	inx	h
    1262/     791 : 22 D5 80            	shld V_Saved_Arg_HL
    1263/     794 : 5E                  	mov	e,m
    1264/     795 : 16 00               	mvi	d,00h
    1265/     797 : E1                  	pop	h
    1266/     798 : 2B                  	dcx	h
    1267/     799 : E5                  	push	h
    1268/     79A : 6E                  	mov	l,m
    1269/     79B : 26 00               	mvi	h,00h
    1270/     79D : 19                  	dad	d
    1271/     79E : 5D                  	mov	e,l
    1272/     79F : 54                  	mov	d,h
    1273/     7A0 : 29                  	dad	h					;x2
    1274/     7A1 : 29                  	dad	h					;x4
    1275/     7A2 : 19                  	dad	d					;x5
    1276/     7A3 : 29                  	dad	h					;x10
    1277/     7A4 : DF                  	rst	3					;two's complement HL
    1278/     7A5 : 09                  	dad	b					;plus BC
    1279/     7A6 : 4D                  	mov	c,l					;save
    1280/     7A7 : 44                  	mov	b,h
    1281/     7A8 : 2A D5 80            	lhld V_Saved_Arg_HL		;reload
    1282/     7AB : 23                  	inx	h
    1283/     7AC : 5E                  	mov	e,m
    1284/     7AD : 16 00               	mvi	d,00h
    1285/     7AF : E1                  	pop	h
    1286/     7B0 : 2B                  	dcx	h
    1287/     7B1 : 6E                  	mov	l,m
    1288/     7B2 : 26 00               	mvi	h,00h
    1289/     7B4 : 19                  	dad	d
    1290/     7B5 : 5D                  	mov	e,l
    1291/     7B6 : 54                  	mov	d,h
    1292/     7B7 : 29                  	dad	h					;x2
    1293/     7B8 : 29                  	dad	h					;x4
    1294/     7B9 : 19                  	dad	d					;x5
    1295/     7BA : 29                  	dad	h					;x10
    1296/     7BB : 29                  	dad	h					;x20
    1297/     7BC : 19                  	dad	d					;x21
    1298/     7BD : 09                  	dad	b
    1299/     7BE : 4D                  	mov	c,l					;save intermediate result
    1300/     7BF : 44                  	mov	b,h
    1301/     7C0 : 2A D5 80            	lhld V_Saved_Arg_HL		;reload
    1302/     7C3 : 23                  	inx	h
    1303/     7C4 : 23                  	inx	h
    1304/     7C5 : 5E                  	mov	e,m
    1305/     7C6 : 16 00               	mvi	d,00h
    1306/     7C8 : 23                  	inx	h
    1307/     7C9 : 23                  	inx	h
    1308/     7CA : 23                  	inx	h
    1309/     7CB : 6E                  	mov	l,m
    1310/     7CC : 26 00               	mvi	h,00h
    1311/     7CE : 19                  	dad	d
    1312/     7CF : 5D                  	mov	e,l
    1313/     7D0 : 54                  	mov	d,h
    1314/     7D1 : 29                  	dad	h					;x2
    1315/     7D2 : 29                  	dad	h					;x4
    1316/     7D3 : 19                  	dad	d					;x5
    1317/     7D4 : 29                  	dad	h					;x10
    1318/     7D5 : 19                  	dad	d					;x11
    1319/     7D6 : 29                  	dad	h					;x22
    1320/     7D7 : 19                  	dad	d					;x23
    1321/     7D8 : 29                  	dad	h					;x46
    1322/     7D9 : 19                  	dad	d					;x47
    1323/     7DA : DF                  	rst	3					;two's complement HL
    1324/     7DB : 09                  	dad	b					;add intermediate result
    1325/     7DC : 4D                  	mov	c,l					;save
    1326/     7DD : 44                  	mov	b,h
    1327/     7DE : 2A D5 80            	lhld V_Saved_Arg_HL		;reload
    1328/     7E1 : 23                  	inx	h					;HL += 3
    1329/     7E2 : 23                  	inx	h
    1330/     7E3 : 23                  	inx	h
    1331/     7E4 : E5                  	push	h
    1332/     7E5 : 5E                  	mov	e,m					;get 2 bytes from memory
    1333/     7E6 : 16 00               	mvi	d,00h				;to E and L
    1334/     7E8 : 23                  	inx	h
    1335/     7E9 : 6E                  	mov	l,m
    1336/     7EA : 26 00               	mvi	h,00h
    1337/     7EC : 19                  	dad	d					;add them
    1338/     7ED : 5D                  	mov	e,l
    1339/     7EE : 54                  	mov	d,h
    1340/     7EF : 29                  	dad	h					;x2
    1341/     7F0 : 29                  	dad	h					;x4
    1342/     7F1 : 19                  	dad	d					;x5
    1343/     7F2 : 29                  	dad	h					;x10
    1344/     7F3 : 29                  	dad	h					;x20
    1345/     7F4 : 29                  	dad	h					;x40
    1346/     7F5 : 29                  	dad	h					;x80
    1347/     7F6 : 29                  	dad	h					;x160
    1348/     7F7 : 16 00               	mvi	d,00h
    1349/     7F9 : D2 FD 07            	jnc	L07FD
    1350/     7FC : 14                  	inr	d					;record overflow
    1351/     7FD : 79                  L07FD:	mov	a,c
    1352/     7FE : 85                  	add	l
    1353/     7FF : 4F                  	mov	c,a
    1354/     800 : 7C                  	mov	a,h
    1355/     801 : CE 00               	aci	00h
    1356/     803 : D2 07 08            	jnc	L0807
    1357/     806 : 14                  	inr	d
    1358/     807 : 6F                  L0807:	mov	l,a
    1359/     808 : 62                  	mov	h,d
    1360/     809 : 78                  	mov	a,b
    1361/     80A : 58                  	mov	e,b
    1362/     80B : 16 00               	mvi	d,00h
    1363/     80D : A7                  	ana	a
    1364/     80E : F2 13 08            	jp	L0813
    1365/     811 : 16 FF               	mvi	d,0FFh
    1366/     813 : 19                  L0813:	dad	d
    1367/     814 : 79                  	mov	a,c
    1368/     815 : A7                  	ana	a
    1369/     816 : F2 1A 08            	jp	L081A
    1370/     819 : 23                  	inx	h
    1371/     81A : 7C                  L081A:	mov	a,h
    1372/     81B : A7                  	ana	a
    1373/     81C : 7D                  	mov	a,l
    1374/     81D : CA 26 08            	jz	L0826
    1375/     820 : 3E 00               	mvi	a,00h
    1376/     822 : FA 26 08            	jm	L0826
    1377/     825 : 2F                  	cma
    1378/     826 : E1                  L0826:	pop	h
    1379/     827 : 46                  	mov	b,m
    1380/     828 : 2A D7 80            	lhld V_Saved_Arg_DE		;reload destination ptr
    1381/     82B : 70                  	mov	m,b
    1382/     82C : 23                  	inx	h
    1383/     82D : 77                  	mov	m,a
    1384/     82E : 23                  	inx	h
    1385/     82F : 22 D7 80            	shld V_Saved_Arg_DE		;save updated dest.ptr.
    1386/     832 : 3A DA 80            	lda	V_Loop_Cntr_1
    1387/     835 : 3D                  	dcr	a
    1388/     836 : 32 DA 80            	sta	V_Loop_Cntr_1
    1389/     839 : C2 7A 07            	jnz	L077A
    1390/     83C : CD DA 08            	call Clear_Memory_Block
    1391/     83F : C9                  	ret
    1392/     840 :                     ;
    1393/     840 :                     ; in DE, HL
    1394/     840 :                     ;
    1395/     840 :                     Sine_Interpolation2:
    1396/     840 : 3A D9 80            	lda	V_nSamples
    1397/     843 : 32 DA 80            	sta	V_Loop_Cntr_1
    1398/     846 : 22 D5 80            	shld V_Saved_Arg_HL
    1399/     849 : EB                  	xchg
    1400/     84A : 22 D7 80            	shld V_Saved_Arg_DE
    1401/     84D :                     L084D:
    1402/     84D : 2A D5 80            	lhld V_Saved_Arg_HL
    1403/     850 : 5E                  	mov	e,m
    1404/     851 : 16 00               	mvi	d,00h
    1405/     853 : 23                  	inx	h
    1406/     854 : 22 D5 80            	shld V_Saved_Arg_HL
    1407/     857 : 23                  	inx	h
    1408/     858 : 23                  	inx	h
    1409/     859 : 6E                  	mov	l,m
    1410/     85A : 26 00               	mvi	h,00h
    1411/     85C : 19                  	dad	d
    1412/     85D : 5D                  	mov	e,l
    1413/     85E : 54                  	mov	d,h
    1414/     85F : 29                  	dad	h
    1415/     860 : 29                  	dad	h
    1416/     861 : 19                  	dad	d
    1417/     862 : 29                  	dad	h
    1418/     863 : 29                  	dad	h
    1419/     864 : 19                  	dad	d
    1420/     865 : DF                  	rst	3				; two's complement HL
    1421/     866 : 4D                  	mov	c,l
    1422/     867 : 44                  	mov	b,h
    1423/     868 : 2A D5 80            	lhld V_Saved_Arg_HL
    1424/     86B : 5E                  	mov	e,m
    1425/     86C : 16 00               	mvi	d,00h
    1426/     86E : 23                  	inx	h
    1427/     86F : 6E                  	mov	l,m
    1428/     870 : 26 00               	mvi	h,00h
    1429/     872 : 19                  	dad	d
    1430/     873 : 5D                  	mov	e,l
    1431/     874 : 54                  	mov	d,h
    1432/     875 : AF                  	xra	a
    1433/     876 : 29                  	dad	h
    1434/     877 : 29                  	dad	h
    1435/     878 : 29                  	dad	h
    1436/     879 : 19                  	dad	d
    1437/     87A : 29                  	dad	h
    1438/     87B : 29                  	dad	h
    1439/     87C : 19                  	dad	d
    1440/     87D : 29                  	dad	h
    1441/     87E : 29                  	dad	h
    1442/     87F : D2 83 08            	jnc	L0883
    1443/     882 : 3C                  	inr	a
    1444/     883 : 19                  L0883:	dad	d
    1445/     884 : D2 88 08            	jnc	L0888
    1446/     887 : 3C                  	inr	a
    1447/     888 : 57                  L0888:	mov	d,a
    1448/     889 : 79                  	mov	a,c
    1449/     88A : 85                  	add	l
    1450/     88B : 4F                  	mov	c,a
    1451/     88C : 7C                  	mov	a,h
    1452/     88D : CE 00               	aci	00h
    1453/     88F : D2 93 08            	jnc	L0893
    1454/     892 : 14                  	inr	d
    1455/     893 :                     L0893:
    1456/     893 : 6F                  	mov	l,a
    1457/     894 : 62                  	mov	h,d
    1458/     895 : 78                  	mov	a,b
    1459/     896 : 58                  	mov	e,b
    1460/     897 : 16 00               	mvi	d,00h
    1461/     899 : A7                  	ana	a					;test
    1462/     89A : F2 9F 08            	jp	L089F
    1463/     89D : 16 FF               	mvi	d,0FFh
    1464/     89F : 19                  L089F:	dad	d
    1465/     8A0 : 79                  	mov	a,c
    1466/     8A1 : A7                  	ana	a
    1467/     8A2 : F2 A6 08            	jp	L08A6
    1468/     8A5 : 23                  	inx	h
    1469/     8A6 : 7C                  L08A6:	mov	a,h
    1470/     8A7 : A7                  	ana	a
    1471/     8A8 : 7D                  	mov	a,l
    1472/     8A9 : CA B2 08            	jz	L08B2
    1473/     8AC : 3E 00               	mvi	a,00h
    1474/     8AE : FA B2 08            	jm	L08B2
    1475/     8B1 : 2F                  	cma
    1476/     8B2 :                     L08B2:
    1477/     8B2 : 2A D5 80            	lhld V_Saved_Arg_HL
    1478/     8B5 : 46                  	mov	b,m
    1479/     8B6 : 2A D7 80            	lhld V_Saved_Arg_DE
    1480/     8B9 : 70                  	mov	m,b
    1481/     8BA : 23                  	inx	h
    1482/     8BB : 77                  	mov	m,a
    1483/     8BC : 23                  	inx	h
    1484/     8BD : 22 D7 80            	shld V_Saved_Arg_DE
    1485/     8C0 : 3A DA 80            	lda	V_Loop_Cntr_1
    1486/     8C3 : 3D                  	dcr	a
    1487/     8C4 : 32 DA 80            	sta	V_Loop_Cntr_1
    1488/     8C7 : C2 4D 08            	jnz	L084D
    1489/     8CA : CD DA 08            	call Clear_Memory_Block
    1490/     8CD : C9                  	ret
    1491/     8CE :                     ;
    1492/     8CE :                     ; in HL
    1493/     8CE :                     ;	
    1494/     8CE :                     DoubleJitter:
    1495/     8CE : 3A 56 80            	lda	V_Jitter
    1496/     8D1 : 87                  	add	a					;x 2
    1497/     8D2 : 32 56 80            	sta	V_Jitter
    1498/     8D5 : C8                  	rz
    1499/     8D6 : D8                  	rc
    1500/     8D7 : 23                  	inx	h
    1501/     8D8 : C9                  	ret						;double
    1502/     8D9 : C9                  	ret
    1503/     8DA :                     ;
    1504/     8DA :                     ; in HL
    1505/     8DA :                     ; Clear memory
    1506/     8DA :                     ;	
    1507/     8DA :                     Clear_Memory_Block:
    1508/     8DA : 3A D9 80            	lda	V_nSamples
    1509/     8DD : 47                  	mov	b,a
    1510/     8DE : 3A 2B 80            	lda	V_fChopped
    1511/     8E1 : A7                  	ana	a
    1512/     8E2 : 3E 80               	mvi	a,80h
    1513/     8E4 : FA E9 08            	jm	L08E9
    1514/     8E7 : 3E 00               	mvi	a,00h
    1515/     8E9 : 90                  L08E9:	sub	b				;(0x80-B) or (0-B)
    1516/     8EA : C8                  	rz						;done
    1517/     8EB :                     $$L:						;L08EB:
    1518/     8EB : 36 00               	mvi	m,00h
    1519/     8ED : 23                  	inx	h
    1520/     8EE : 36 00               	mvi	m,00h
    1521/     8F0 : 23                  	inx	h
    1522/     8F1 : 3D                  	dcr	a
    1523/     8F2 : C2 EB 08            	jnz	$$L					;L08EB
    1524/     8F5 : C9                  	ret
    1525/     8F6 :                     ;
    1526/     8F6 :                     ; Process Acquisition Complete
    1527/     8F6 :                     ;	
    1528/     8F6 :                     Main_Action_4:
    1529/     8F6 : AF                  	xra	a
    1530/     8F7 : 32 01 80            	sta	V_fOK2ProcessAcq
    1531/     8FA : 3A A5 80            	lda	V_DigitalMode
    1532/     8FD : 32 EB 80            	sta	V_DigitalMode_4a
    1533/     900 : FE 04               	cpi	DIGITAL_SAVE
    1534/     902 : CA 0D 09            	jz	L090D
    1535/     905 : 3A EB 80            	lda	V_DigitalMode_4a
    1536/     908 : FE 00               	cpi	00h					;DIGITAL_OFF
    1537/     90A : C2 10 09            	jnz	L0910
    1538/     90D :                     L090D:
    1539/     90D : C3 A0 0C            	jmp	L0CA0				;done
    1540/     910 :                     L0910:
    1541/     910 : 2A 05 E2            	lhld DEV_RDMAR			;read word! Address of Last acquired waveform data point (byte)
    1542/     913 : 2C                  	inr	l					;Address of first data point acquired waveform (256 data points)
    1543/     914 : 26 00               	mvi	h,00h
    1544/     916 : 22 F2 80            	shld V_ACQWF_Ptr		;store first time as an offset!
    1545/     919 : 29                  	dad	h					;HL x 2 since Waveform stored as a word
    1546/     91A : 11 00 C0            	lxi	d,RAM_ACQ			;acquisition memory address
    1547/     91D : 19                  	dad	d					
    1548/     91E : 22 F2 80            	shld V_ACQWF_Ptr		;store second time as a pointer!
    1549/     921 : 3A 2A 80            	lda	V_fAlternating
    1550/     924 : 2F                  	cma
    1551/     925 : 17                  	ral
    1552/     926 : DA 34 09            	jc	L0934
    1553/     929 : 3A 20 80            	lda	V_fADD
    1554/     92C : 21 A6 80            	lxi	h,V_fSAVEREFShowing	;double boolean test
    1555/     92F : A6                  	ana	m
    1556/     930 : 17                  	ral
    1557/     931 : D2 38 09            	jnc	L0938
    1558/     934 :                     L0934:
    1559/     934 : AF                  	xra	a
    1560/     935 : 32 A0 80            	sta	V_ValidWFs+1
    1561/     938 : 3A 1E 80            L0938:	lda	V_fCH1
    1562/     93B : 21 1F 80            	lxi	h,V_fCH2
    1563/     93E : B6                  	ora	m
    1564/     93F : 21 20 80            	lxi	h,V_fADD
    1565/     942 : A6                  	ana	m
    1566/     943 : 21 A6 80            	lxi	h,V_fSAVEREFShowing	;boolean
    1567/     946 : B6                  	ora	m
    1568/     947 : 47                  	mov	b,a
    1569/     948 : 3A 1E 80            	lda	V_fCH1
    1570/     94B : 21 1F 80            	lxi	h,V_fCH2
    1571/     94E : A6                  	ana	m
    1572/     94F : 4F                  	mov	c,a
    1573/     950 : 3A 2A 80            	lda	V_fAlternating
    1574/     953 : 2F                  	cma
    1575/     954 : A1                  	ana	c
    1576/     955 : B0                  	ora	b
    1577/     956 : 2F                  	cma
    1578/     957 : 17                  	ral
    1579/     958 : D2 5F 09            	jnc	L095F
    1580/     95B : AF                  	xra	a
    1581/     95C : 32 A1 80            	sta	V_ValidWFs+2		;set to FALSE
    1582/     95F :                     L095F:
    1583/     95F : CD DB 0F            	call GetWFArea			;returns 1 or 3 in A
    1584/     962 : 32 A3 80            	sta	V_PrimaryWF
    1585/     965 : F3                  	di
    1586/     966 : 3A 00 E8            	lda	DEV_CH1
    1587/     969 : 21 1C 80            	lxi	h,V_CH1_Coupling 
    1588/     96C : CD C4 02            	call UpdateInputCoupling
    1589/     96F : 32 ED 80            	sta	VAR_80ED
    1590/     972 : 3A 01 E8            	lda	DEV_CH2
    1591/     975 : 21 1D 80            	lxi	h,V_CH2_Coupling
    1592/     978 : CD C4 02            	call UpdateInputCoupling
    1593/     97B : 21 ED 80            	lxi	h,VAR_80ED
    1594/     97E : B6                  	ora	m
    1595/     97F : CA 87 09            	jz	L0987
    1596/     982 : 3E 05               	mvi	a,05h
    1597/     984 : CD 49 00            	call AddMainAction
    1598/     987 :                     L0987:
    1599/     987 : FB                  	ei
    1600/     988 : 3A 29 80            	lda	V_ChannelMode
    1601/     98B : FE 02               	cpi	02h
    1602/     98D : C2 B8 09            	jnz	L09B8
    1603/     990 : 3E 02               	mvi	a,02h
    1604/     992 : 32 FE 80            	sta	V_LclWFEntry+S_CHANMODE
    1605/     995 : 3A 1B 80            	lda	V_CH2_Info
    1606/     998 : 32 01 81            	sta	V_LclWFEntry+S_VOLTS
    1607/     99B : 3A 1D 80            	lda	V_CH2_Coupling
    1608/     99E : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1609/     9A1 : 3A 1E 80            	lda	V_fCH1
    1610/     9A4 : 17                  	ral
    1611/     9A5 : D2 B0 09            	jnc	L09B0
    1612/     9A8 : 3E 03               	mvi	a,03h
    1613/     9AA : 32 EC 80            	sta	V_WF_4
    1614/     9AD : C3 B5 09            	jmp	L09B5
    1615/     9B0 : 3E 01               L09B0:	mvi	a,01h
    1616/     9B2 : 32 EC 80            	sta	V_WF_4
    1617/     9B5 : C3 34 0A            L09B5:	jmp	L0A34
    1618/     9B8 : 3A 29 80            L09B8:	lda	V_ChannelMode
    1619/     9BB : FE 03               	cpi	03h
    1620/     9BD : C2 1E 0A            	jnz	L0A1E
    1621/     9C0 : 3E 03               	mvi	a,03h
    1622/     9C2 : 32 FE 80            	sta	V_LclWFEntry+S_CHANMODE
    1623/     9C5 : 3A 1B 80            	lda	V_CH2_Info
    1624/     9C8 : E6 80               	ani	80h
    1625/     9CA : 21 1A 80            	lxi	h,V_CH1_Info
    1626/     9CD : B6                  	ora	m
    1627/     9CE : 32 01 81            	sta	V_LclWFEntry+S_VOLTS
    1628/     9D1 : 3A 1A 80            	lda	V_CH1_Info
    1629/     9D4 : 21 1B 80            	lxi	h,V_CH2_Info
    1630/     9D7 : BE                  	cmp	m
    1631/     9D8 : CA F3 09            	jz	L09F3
    1632/     9DB : 3A 1B 80            	lda	V_CH2_Info
    1633/     9DE : C6 3D               	adi	3Dh
    1634/     9E0 : 21 1A 80            	lxi	h,V_CH1_Info
    1635/     9E3 : BE                  	cmp	m
    1636/     9E4 : CA F3 09            	jz	L09F3
    1637/     9E7 : 3A 1A 80            	lda	V_CH1_Info
    1638/     9EA : C6 3D               	adi	3Dh
    1639/     9EC : 21 1B 80            	lxi	h,V_CH2_Info
    1640/     9EF : BE                  	cmp	m
    1641/     9F0 : C2 F6 09            	jnz	L09F6
    1642/     9F3 : C3 FE 09            L09F3:	jmp	L09FE
    1643/     9F6 : 3A 01 81            L09F6:	lda	V_LclWFEntry+S_VOLTS
    1644/     9F9 : F6 80               	ori	80h
    1645/     9FB : 32 01 81            	sta	V_LclWFEntry+S_VOLTS
    1646/     9FE : 3A 1D 80            L09FE:	lda	V_CH2_Coupling
    1647/     A01 : 21 1C 80            	lxi	h,V_CH1_Coupling
    1648/     A04 : BE                  	cmp	m
    1649/     A05 : C2 11 0A            	jnz	L0A11
    1650/     A08 : 3A 1C 80            	lda	V_CH1_Coupling
    1651/     A0B : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1652/     A0E : C3 15 0A            	jmp	L0A15
    1653/     A11 : AF                  L0A11:	xra	a
    1654/     A12 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1655/     A15 :                     L0A15:
    1656/     A15 : CD DB 0F            	call GetWFArea			;returns AREA1 or AREA3 in A
    1657/     A18 : 32 EC 80            	sta	V_WF_4
    1658/     A1B : C3 34 0A            	jmp	L0A34
    1659/     A1E : 3E 01               L0A1E:	mvi	a,01h
    1660/     A20 : 32 EC 80            	sta	V_WF_4
    1661/     A23 : 3E 01               	mvi	a,01h
    1662/     A25 : 32 FE 80            	sta	V_LclWFEntry+S_CHANMODE
    1663/     A28 : 3A 1A 80            	lda	V_CH1_Info
    1664/     A2B : 32 01 81            	sta	V_LclWFEntry+S_VOLTS
    1665/     A2E : 3A 1C 80            	lda	V_CH1_Coupling
    1666/     A31 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1667/     A34 : 3A 03 80            L0A34:	lda	V_fSkipAcquiredWF
    1668/     A37 : 17                  	ral
    1669/     A38 : DA 5A 0A            	jc	L0A5A
    1670/     A3B : 3A EC 80            	lda	V_WF_4
    1671/     A3E : 2A A3 80            	lhld V_PrimaryWF
    1672/     A41 : CD BF 1E            	call Test_Different
    1673/     A44 : 47                  	mov	b,a
    1674/     A45 : 3A 29 80            	lda	V_ChannelMode
    1675/     A48 : 2E 03               	mvi	l,03h
    1676/     A4A : CD BF 1E            	call Test_Different
    1677/     A4D : 21 20 80            	lxi	h,V_fADD
    1678/     A50 : A6                  	ana	m
    1679/     A51 : B0                  	ora	b
    1680/     A52 : 21 A6 80            	lxi	h,V_fSAVEREFShowing	;boolean test
    1681/     A55 : A6                  	ana	m
    1682/     A56 : 17                  	ral
    1683/     A57 : D2 67 0A            	jnc	L0A67
    1684/     A5A : 3E FF               L0A5A:	mvi	a,0FFh
    1685/     A5C : 32 01 80            	sta	V_fOK2ProcessAcq
    1686/     A5F : 3E FF               	mvi	a,0FFh
    1687/     A61 : 32 02 80            	sta	V_fOK2UpdateDispWF
    1688/     A64 : C3 98 0C            	jmp	L0C98
    1689/     A67 : 3A EC 80            L0A67:	lda	V_WF_4
    1690/     A6A : 87                  	add	a
    1691/     A6B : 6F                  	mov	l,a
    1692/     A6C : 26 00               	mvi	h,00h
    1693/     A6E : 11 17 20            	lxi	d,ScratchRamTable-2
    1694/     A71 : 19                  	dad	d
    1695/     A72 : 5E                  	mov	e,m
    1696/     A73 : 23                  	inx	h
    1697/     A74 : 56                  	mov	d,m
    1698/     A75 : EB                  	xchg
    1699/     A76 : 22 F4 80            	shld V_pScratchRAM
    1700/     A79 : 2A EC 80            	lhld V_WF_4
    1701/     A7C : 2D                  	dcr	l
    1702/     A7D : 7D                  	mov	a,l
    1703/     A7E : 2E 03               	mvi	l,03h
    1704/     A80 : CD 78 1E            	call ShiftL_A_L_times
    1705/     A83 : 3C                  	inr	a
    1706/     A84 : 6F                  	mov	l,a
    1707/     A85 : 26 00               	mvi	h,00h
    1708/     A87 : 11 7E 80            	lxi	d,V_WFTable-1
    1709/     A8A : 19                  	dad	d
    1710/     A8B : 22 F8 80            	shld V_pWF_4
    1711/     A8E : 3A EB 80            	lda	V_DigitalMode_4a
    1712/     A91 : 21 FF 80            	lxi	h,V_LclWFEntry+S_STATUS
    1713/     A94 : B6                  	ora	m
    1714/     A95 : 47                  	mov	b,a
    1715/     A96 : 2A F8 80            	lhld V_pWF_4
    1716/     A99 : 23                  	inx	h
    1717/     A9A : 23                  	inx	h
    1718/     A9B : 23                  	inx	h
    1719/     A9C : 23                  	inx	h
    1720/     A9D : 23                  	inx	h
    1721/     A9E : 7E                  	mov	a,m
    1722/     A9F : E6 80               	ani	80h
    1723/     AA1 : B0                  	ora	b
    1724/     AA2 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1725/     AA5 : 3A A7 80            	lda	V_fPostPreTrigger	;boolean test POST/PRETRIGGER
    1726/     AA8 : 17                  	ral
    1727/     AA9 : D2 B4 0A            	jnc	L0AB4
    1728/     AAC : 3A FF 80            	lda	V_LclWFEntry+S_STATUS
    1729/     AAF : F6 08               	ori	08h
    1730/     AB1 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1731/     AB4 : 3A 23 80            L0AB4:	lda	V_ATimebaseActive
    1732/     AB7 : 17                  	ral
    1733/     AB8 : D2 C4 0A            	jnc	L0AC4
    1734/     ABB : 3A 18 80            	lda	V_ATIME
    1735/     ABE : 32 00 81            	sta	V_LclWFEntry+S_TB
    1736/     AC1 : C3 CA 0A            	jmp	L0ACA
    1737/     AC4 : 3A 19 80            L0AC4:	lda	V_BTIME
    1738/     AC7 : 32 00 81            	sta	V_LclWFEntry+S_TB
    1739/     ACA : 3A EB 80            L0ACA:	lda	V_DigitalMode_4a
    1740/     ACD : FE 03               	cpi	03h					;DIGITAL_AVG
    1741/     ACF : C2 D8 0A            	jnz	L0AD8
    1742/     AD2 : CD A6 0C            	call Update_Average
    1743/     AD5 : C3 10 0B            	jmp	L0B10
    1744/     AD8 : 3A EB 80            L0AD8:	lda	V_DigitalMode_4a
    1745/     ADB : FE 02               	cpi	02h					;DIGITAL_ENV
    1746/     ADD : C2 E6 0A            	jnz	L0AE6
    1747/     AE0 : CD 0D 0D            	call Update_Envelope
    1748/     AE3 : C3 10 0B            	jmp	L0B10
    1749/     AE6 :                     L0AE6:
    1750/     AE6 : CD BC 1A            	call ReadJitter
    1751/     AE9 : 32 56 80            	sta	V_Jitter
    1752/     AEC : 3A 2B 80            	lda	V_fChopped
    1753/     AEF : 17                  	ral
    1754/     AF0 : D2 04 0B            	jnc	L0B04
    1755/     AF3 : 3A 56 80            	lda	V_Jitter
    1756/     AF6 : 2E 01               	mvi	l,01h
    1757/     AF8 : CD 8F 1E            	call ShiftR_A_L_times
    1758/     AFB : 32 56 80            	sta	V_Jitter
    1759/     AFE : CD B3 0D            	call UnzipAcquiredWF
    1760/     B01 : C3 07 0B            	jmp	L0B07
    1761/     B04 :                     L0B04:
    1762/     B04 : CD A5 0D            	call Copy_Acquired_WF
    1763/     B07 :                     L0B07:
    1764/     B07 : AF                  	xra	a
    1765/     B08 : 32 EF 80            	sta	V_fAVGENVFinished
    1766/     B0B : 3E FF               	mvi	a,0FFh
    1767/     B0D : 32 02 80            	sta	V_fOK2UpdateDispWF
    1768/     B10 : 3A 02 80            L0B10:	lda	V_fOK2UpdateDispWF
    1769/     B13 : 17                  	ral
    1770/     B14 : D2 93 0C            	jnc	L0C93
    1771/     B17 : 2A EC 80            	lhld V_WF_4
    1772/     B1A : 26 00               	mvi	h,00h
    1773/     B1C : 11 56 80            	lxi	d,V_Jitter_Tbl-1
    1774/     B1F : 19                  	dad	d
    1775/     B20 : 3A 56 80            	lda	V_Jitter
    1776/     B23 : 77                  	mov	m,a
    1777/     B24 : 3A 2B 80            	lda	V_fChopped
    1778/     B27 : 17                  	ral
    1779/     B28 : D2 38 0B            	jnc	L0B38
    1780/     B2B : 3A 56 80            	lda	V_Jitter
    1781/     B2E : C6 40               	adi	40h
    1782/     B30 : 47                  	mov	b,a
    1783/     B31 : 32 57 80            	sta	V_Jitter_Tbl
    1784/     B34 : 78                  	mov	a,b
    1785/     B35 : 32 56 80            	sta	V_Jitter
    1786/     B38 :                     L0B38:
    1787/     B38 : 3A EC 80            	lda	V_WF_4
    1788/     B3B : 6F                  	mov	l,a
    1789/     B3C : 3A EB 80            	lda	V_DigitalMode_4a
    1790/     B3F : 4F                  	mov	c,a
    1791/     B40 : 3A 00 81            	lda	V_LclWFEntry+S_TB
    1792/     B43 : 06 14               	mvi	b,TB20
    1793/     B45 : CD 12 13            	call TimeExpandWF		;args A, B, C, L
    1794/     B48 : 32 FC 80            	sta	V_LclWFEntry+S_HGAIN
    1795/     B4B : 3E 14               	mvi	a,TB20
    1796/     B4D : 21 00 81            	lxi	h,V_LclWFEntry+S_TB
    1797/     B50 : BE                  	cmp	m
    1798/     B51 : D2 5C 0B            	jnc	L0B5C
    1799/     B54 : 3E 05               	mvi	a,05h
    1800/     B56 : 32 EE 80            	sta	V_DisplayAction
    1801/     B59 : C3 61 0B            	jmp	L0B61
    1802/     B5C : 3E 01               L0B5C:	mvi	a,01h
    1803/     B5E : 32 EE 80            	sta	V_DisplayAction
    1804/     B61 :                     L0B61:
    1805/     B61 : 3A 56 80            	lda	V_Jitter
    1806/     B64 : 32 FA 80            	sta	V_LclWFEntry+S_JITTER
    1807/     B67 : 3A EB 80            	lda	V_DigitalMode_4a
    1808/     B6A : FE 03               	cpi	03h
    1809/     B6C : CA 7A 0B            	jz	L0B7A
    1810/     B6F : 3A 01 81            	lda	V_LclWFEntry+S_VOLTS 
    1811/     B72 : 06 04               	mvi	b,04h
    1812/     B74 : CD 8D 14            	call ComputeVGAIN
    1813/     B77 : 32 FD 80            	sta	V_LclWFEntry+S_VGAIN
    1814/     B7A :                     L0B7A:
    1815/     B7A : 3A 2B 80            	lda	V_fChopped
    1816/     B7D : 2F                  	cma
    1817/     B7E : 17                  	ral
    1818/     B7F : D2 96 0B            	jnc	L0B96
    1819/     B82 : 3A FF 80            	lda	V_LclWFEntry+S_STATUS
    1820/     B85 : F6 04               	ori	04h
    1821/     B87 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1822/     B8A : 21 00 02            	lxi	h,0200h
    1823/     B8D : CD 14 0F            	call ComputeGNDREF
    1824/     B90 : 32 FB 80            	sta	V_LclWFEntry+S_GNDREF
    1825/     B93 : C3 16 0C            	jmp	L0C16
    1826/     B96 :                     L0B96:
    1827/     B96 : AF                  	xra	a
    1828/     B97 : 21 FF 80            	lxi	h,V_LclWFEntry+S_STATUS
    1829/     B9A : B6                  	ora	m
    1830/     B9B : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1831/     B9E : 21 00 01            	lxi	h,0100H
    1832/     BA1 : CD 14 0F            	call ComputeGNDREF
    1833/     BA4 : 32 FB 80            	sta	V_LclWFEntry+S_GNDREF
    1834/     BA7 : 11 FA 80            	lxi	d,V_LclWFEntry
    1835/     BAA : 21 04 81            	lxi	h,V_LclWFEntry_2
    1836/     BAD : 01 08 00            	lxi	b,WFENTRYSIZE
    1837/     BB0 : CD 6D 1E            	call Copy_Bytes			; 8 bytes *DE to *HL
    1838/     BB3 : 2A F8 80            	lhld V_pWF_4
    1839/     BB6 : 22 02 81            	shld V_SavedpWF_4
    1840/     BB9 : 3A 1B 80            	lda	V_CH2_Info
    1841/     BBC : 06 04               	mvi	b,04h
    1842/     BBE : CD 8D 14            	call ComputeVGAIN
    1843/     BC1 : 32 FD 80            	sta	V_LclWFEntry+S_VGAIN
    1844/     BC4 : 3A 57 80            	lda	V_Jitter_Tbl+0
    1845/     BC7 : D6 40               	sui	40h
    1846/     BC9 : 47                  	mov	b,a
    1847/     BCA : 32 58 80            	sta	V_Jitter_Tbl+1
    1848/     BCD : 78                  	mov	a,b
    1849/     BCE : 32 56 80            	sta	V_Jitter
    1850/     BD1 : 3A EB 80            	lda	V_DigitalMode_4a
    1851/     BD4 : 4F                  	mov	c,a
    1852/     BD5 : 3A 00 81            	lda	V_LclWFEntry+S_TB
    1853/     BD8 : 06 14               	mvi	b,TB20
    1854/     BDA : 2E 02               	mvi	l,02h
    1855/     BDC : CD 12 13            	call TimeExpandWF		;args A, B, C, L
    1856/     BDF : 32 FC 80            	sta	V_LclWFEntry+S_HGAIN
    1857/     BE2 : 3A 56 80            	lda	V_Jitter
    1858/     BE5 : 32 FA 80            	sta	V_LclWFEntry+S_JITTER
    1859/     BE8 : 3E 02               	mvi	a,02h
    1860/     BEA : 32 FE 80            	sta	V_LclWFEntry+S_CHANMODE
    1861/     BED : 3E 30               	mvi	a,30h
    1862/     BEF : 2F                  	cma
    1863/     BF0 : 21 FF 80            	lxi	h,V_LclWFEntry+S_STATUS
    1864/     BF3 : A6                  	ana	m
    1865/     BF4 : 21 1D 80            	lxi	h,V_CH2_Coupling
    1866/     BF7 : B6                  	ora	m
    1867/     BF8 : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    1868/     BFB : 3A 1B 80            	lda	V_CH2_Info
    1869/     BFE : 32 01 81            	sta	V_LclWFEntry+S_VOLTS
    1870/     C01 : 2A 1B 20            	lhld ScratchRamTable+2
    1871/     C04 : 22 F4 80            	shld V_pScratchRAM
    1872/     C07 : 21 87 80            	lxi	h,V_WFTable+WFENTRYSIZE	;WFTable[AREA2]
    1873/     C0A : 22 F8 80            	shld V_pWF_4
    1874/     C0D :                     ; Duplicate code. But A == S_VOLTS field
    1875/     C0D : 21 00 01            	lxi	h,0100H
    1876/     C10 : CD 14 0F            	call ComputeGNDREF
    1877/     C13 : 32 FB 80            	sta	V_LclWFEntry+S_GNDREF
    1878/     C16 :                     L0C16:
    1879/     C16 : F3                  	di
    1880/     C17 : CD 88 0F            	call CopyWFTableEntry
    1881/     C1A : 3A 2B 80            	lda	V_fChopped
    1882/     C1D : 17                  	ral
    1883/     C1E : D2 41 0C            	jnc	L0C41
    1884/     C21 : 2A 02 81            	lhld V_SavedpWF_4
    1885/     C24 : 11 04 81            	lxi	d,V_LclWFEntry_2
    1886/     C27 : 01 08 00            	lxi	b,WFENTRYSIZE
    1887/     C2A : CD 6D 1E            	call Copy_Bytes 		; 8 bytes *DE to *HL
    1888/     C2D : 3A A6 80            	lda	V_fSAVEREFShowing	;boolean
    1889/     C30 : 67                  	mov	h,a
    1890/     C31 : 3A 20 80            	lda	V_fADD
    1891/     C34 : B4                  	ora	h
    1892/     C35 : C2 3E 0C            	jnz	L0C3E				;non-zero if either TRUE
    1893/     C38 : 3A 88 80            	lda	V_WFTable+WFENTRYSIZE+S_GNDREF
    1894/     C3B : 32 90 80            	sta	V_WFTable+2*WFENTRYSIZE+S_GNDREF
    1895/     C3E :                     L0C3E:
    1896/     C3E : C3 52 0C            	jmp	L0C52
    1897/     C41 :                     L0C41:
    1898/     C41 : 3A 20 80            	lda	V_fADD
    1899/     C44 : 67                  	mov	h,a
    1900/     C45 : 3A A6 80            	lda	V_fSAVEREFShowing
    1901/     C48 : B4                  	ora	h
    1902/     C49 : C2 52 0C            	jnz	L0C52				;non-zero if either TRUE
    1903/     C4C : 3A 90 80            	lda	V_WFTable+2*WFENTRYSIZE+S_GNDREF
    1904/     C4F : 32 88 80            	sta	V_WFTable+WFENTRYSIZE+S_GNDREF
    1905/     C52 : 3A EC 80            L0C52:	lda	V_WF_4
    1906/     C55 : 87                  	add	a
    1907/     C56 : 87                  	add	a
    1908/     C57 : 87                  	add	a
    1909/     C58 : 87                  	add	a
    1910/     C59 : 47                  	mov	b,a
    1911/     C5A : 3A EE 80            	lda	V_DisplayAction
    1912/     C5D : B0                  	ora	b
    1913/     C5E : CD 35 20            	call AddDisplayAction
    1914/     C61 : 3A 2B 80            	lda	V_fChopped
    1915/     C64 : 17                  	ral
    1916/     C65 : D2 70 0C            	jnc	L0C70
    1917/     C68 : 3A EE 80            	lda	V_DisplayAction
    1918/     C6B : F6 20               	ori	20h
    1919/     C6D : CD 35 20            	call AddDisplayAction
    1920/     C70 : 3A EF 80            L0C70:	lda	V_fAVGENVFinished
    1921/     C73 : 17                  	ral
    1922/     C74 : D2 8F 0C            	jnc	L0C8F
    1923/     C77 : AF                  	xra	a
    1924/     C78 : 32 EF 80            	sta	V_fAVGENVFinished
    1925/     C7B : 3E FF               	mvi	a,0FFh
    1926/     C7D : CD D1 02            	call SetDigitalMode
    1927/     C80 : CD 7C 04            	call GPIB_SendWF
    1928/     C83 : 3A 0F 80            	lda	V_fSAVEREFPushed
    1929/     C86 : 17                  	ral
    1930/     C87 : D2 8F 0C            	jnc	L0C8F
    1931/     C8A : 3E 06               	mvi	a,06h
    1932/     C8C : CD 35 20            	call AddDisplayAction
    1933/     C8F :                     L0C8F:
    1934/     C8F : FB                  	ei
    1935/     C90 : C3 98 0C            	jmp	L0C98
    1936/     C93 :                     L0C93:
    1937/     C93 : 3E FF               	mvi	a,0FFh
    1938/     C95 : 32 01 80            	sta	V_fOK2ProcessAcq
    1939/     C98 :                     L0C98:
    1940/     C98 : 3E 02               	mvi	a,MAIN_ACTION_2_ID
    1941/     C9A : CD 49 00            	call AddMainAction
    1942/     C9D : C3 A5 0C            	jmp	L0CA5
    1943/     CA0 : 3E FF               L0CA0:	mvi	a,0FFh
    1944/     CA2 : 32 01 80            	sta	V_fOK2ProcessAcq
    1945/     CA5 : C9                  L0CA5:	ret
    1946/     CA6 :                     
    1947/     CA6 :                     Update_Average:
    1948/     CA6 : F3                  	di
    1949/     CA7 : 2A F8 80            	lhld V_pWF_4
    1950/     CAA : 11 05 00            	lxi	d,05H
    1951/     CAD : 19                  	dad	d
    1952/     CAE : 7E                  	mov	a,m
    1953/     CAF : 47                  	mov	b,a
    1954/     CB0 : E6 80               	ani	80h
    1955/     CB2 : CA C2 0C            	jz	L0CC2
    1956/     CB5 : 78                  	mov	a,b
    1957/     CB6 : E6 7F               	ani	7Fh
    1958/     CB8 : 77                  	mov	m,a
    1959/     CB9 : 2A C2 80            	lhld V_AVG_Sweeps
    1960/     CBC : 22 C6 80            	shld V_Sweep_Cnt1
    1961/     CBF : 22 F0 80            	shld V_Sweep_Cnt2
    1962/     CC2 :                     L0CC2:
    1963/     CC2 : FB                  	ei
    1964/     CC3 : 2A C6 80            	lhld V_Sweep_Cnt1
    1965/     CC6 : EB                  	xchg
    1966/     CC7 : 2A F0 80            	lhld V_Sweep_Cnt2
    1967/     CCA : 7B                  	mov	a,e
    1968/     CCB : 95                  	sub	l
    1969/     CCC : 6F                  	mov	l,a
    1970/     CCD : 7A                  	mov	a,d
    1971/     CCE : 9C                  	sbb	h
    1972/     CCF : B5                  	ora	l
    1973/     CD0 : C2 E1 0C            	jnz	L0CE1
    1974/     CD3 : AF                  	xra	a
    1975/     CD4 : 32 02 80            	sta	V_fOK2UpdateDispWF
    1976/     CD7 : AF                  	xra	a
    1977/     CD8 : 32 EF 80            	sta	V_fAVGENVFinished
    1978/     CDB : CD 1A 0E            	call Setup_Average
    1979/     CDE : C3 E4 0C            	jmp	L0CE4
    1980/     CE1 :                     L0CE1:
    1981/     CE1 : CD 4B 0E            	call Add_Average
    1982/     CE4 :                     L0CE4:
    1983/     CE4 : 2A C6 80            	lhld V_Sweep_Cnt1
    1984/     CE7 : 2B                  	dcx	h
    1985/     CE8 : 22 C6 80            	shld V_Sweep_Cnt1
    1986/     CEB : 7D                  	mov	a,l
    1987/     CEC : B4                  	ora	h
    1988/     CED : C2 0C 0D            	jnz	L0D0C
    1989/     CF0 : 3E FF               	mvi	a,0FFh
    1990/     CF2 : 32 C8 80            	sta	V_NotCountingDown
    1991/     CF5 : 3E FF               	mvi	a,0FFh
    1992/     CF7 : 32 EF 80            	sta	V_fAVGENVFinished
    1993/     CFA : 2A F0 80            	lhld V_Sweep_Cnt2
    1994/     CFD : 22 C6 80            	shld V_Sweep_Cnt1
    1995/     D00 : CD 7F 0E            	call Finalize_Average
    1996/     D03 : AF                  	xra	a
    1997/     D04 : 32 56 80            	sta	V_Jitter
    1998/     D07 : 3E FF               	mvi	a,0FFh
    1999/     D09 : 32 02 80            	sta	V_fOK2UpdateDispWF
    2000/     D0C :                     L0D0C:
    2001/     D0C : C9                  	ret
    2002/     D0D :                     ;
    2003/     D0D :                     Update_Envelope:
    2004/     D0D : 3A FF 80            	lda	V_LclWFEntry+S_STATUS
    2005/     D10 : E6 80               	ani	80h
    2006/     D12 : FE 00               	cpi	00h
    2007/     D14 : CA 2C 0D            	jz	L0D2C
    2008/     D17 : 3E 7F               	mvi	a,7Fh
    2009/     D19 : 21 FF 80            	lxi	h,V_LclWFEntry+S_STATUS
    2010/     D1C : A6                  	ana	m				;remove bit 7
    2011/     D1D : 32 FF 80            	sta	V_LclWFEntry+S_STATUS
    2012/     D20 : 3A 29 80            	lda	V_ChannelMode
    2013/     D23 : 32 0C 81            	sta	V_SavedChannelMode
    2014/     D26 : 2A C4 80            	lhld V_ENV_Sweeps
    2015/     D29 : 22 C6 80            	shld V_Sweep_Cnt1
    2016/     D2C : 2A C6 80            L0D2C:	lhld V_Sweep_Cnt1
    2017/     D2F : EB                  	xchg
    2018/     D30 : 2A C4 80            	lhld V_ENV_Sweeps
    2019/     D33 : 7B                  	mov	a,e
    2020/     D34 : 95                  	sub	l
    2021/     D35 : 6F                  	mov	l,a
    2022/     D36 : 7A                  	mov	a,d
    2023/     D37 : 9C                  	sbb	h
    2024/     D38 : B5                  	ora	l
    2025/     D39 : C2 46 0D            	jnz	L0D46
    2026/     D3C : AF                  	xra	a
    2027/     D3D : 32 EF 80            	sta	V_fAVGENVFinished
    2028/     D40 : CD CD 0D            	call Setup_Envelope
    2029/     D43 : C3 49 0D            	jmp	L0D49
    2030/     D46 :                     L0D46:
    2031/     D46 : CD EE 0D            	call Add_Envelope
    2032/     D49 :                     L0D49:
    2033/     D49 : 3A A6 80            	lda	V_fSAVEREFShowing	;boolean test
    2034/     D4C : 17                  	ral
    2035/     D4D : DA 5A 0D            	jc	L0D5A
    2036/     D50 : 3A 29 80            	lda	V_ChannelMode
    2037/     D53 : 21 0C 81            	lxi	h,V_SavedChannelMode
    2038/     D56 : BE                  	cmp	m
    2039/     D57 : C2 61 0D            	jnz	L0D61
    2040/     D5A : 2A C6 80            L0D5A:	lhld V_Sweep_Cnt1
    2041/     D5D : 2B                  	dcx	h
    2042/     D5E : 22 C6 80            	shld V_Sweep_Cnt1
    2043/     D61 : 2A C6 80            L0D61:	lhld V_Sweep_Cnt1
    2044/     D64 : 7D                  	mov	a,l
    2045/     D65 : B4                  	ora	h
    2046/     D66 : CA 82 0D            	jz	L0D82
    2047/     D69 : 11 00 0E            	lxi	d,0E00h
    2048/     D6C : 2A C6 80            	lhld V_Sweep_Cnt1
    2049/     D6F : 7B                  	mov	a,e
    2050/     D70 : A5                  	ana	l
    2051/     D71 : 6F                  	mov	l,a
    2052/     D72 : 7A                  	mov	a,d
    2053/     D73 : A4                  	ana	h
    2054/     D74 : 67                  	mov	h,a
    2055/     D75 : EB                  	xchg
    2056/     D76 : 21 00 00            	lxi	h,0H
    2057/     D79 : 7B                  	mov	a,e
    2058/     D7A : 95                  	sub	l
    2059/     D7B : 6F                  	mov	l,a
    2060/     D7C : 7A                  	mov	a,d
    2061/     D7D : 9C                  	sbb	h
    2062/     D7E : B5                  	ora	l
    2063/     D7F : CA 9F 0D            	jz	L0D9F
    2064/     D82 : 3E FF               L0D82:	mvi	a,0FFh
    2065/     D84 : 32 C8 80            	sta	V_NotCountingDown
    2066/     D87 : 3E FF               	mvi	a,0FFh
    2067/     D89 : 32 EF 80            	sta	V_fAVGENVFinished
    2068/     D8C : 11 FF 0F            	lxi	d,0FFFh
    2069/     D8F : 2A C4 80            	lhld V_ENV_Sweeps
    2070/     D92 : 7B                  	mov	a,e
    2071/     D93 : A5                  	ana	l
    2072/     D94 : 6F                  	mov	l,a
    2073/     D95 : 7A                  	mov	a,d
    2074/     D96 : A4                  	ana	h
    2075/     D97 : 67                  	mov	h,a
    2076/     D98 : 22 C6 80            	shld V_Sweep_Cnt1
    2077/     D9B : AF                  	xra	a
    2078/     D9C : 32 56 80            	sta	V_Jitter
    2079/     D9F : 3E FF               L0D9F:	mvi	a,0FFh
    2080/     DA1 : 32 02 80            	sta	V_fOK2UpdateDispWF
    2081/     DA4 : C9                  	ret
    2082/     DA5 :                     ;
    2083/     DA5 :                     ;
    2084/     DA5 :                     Copy_Acquired_WF:
    2085/     DA5 : 2A F2 80            	lhld V_ACQWF_Ptr
    2086/     DA8 : EB                  	xchg
    2087/     DA9 : 2A F4 80            	lhld V_pScratchRAM
    2088/     DAC : 01 00 02            	lxi	b,0200H
    2089/     DAF : CD 6D 1E            	call Copy_Bytes 		; 512 bytes *DE to *HL
    2090/     DB2 : C9                  	ret
    2091/     DB3 :                     UnzipAcquiredWF:
    2092/     DB3 : 01 00 02            	lxi	b,0200H				;loop count
    2093/     DB6 : 2A F2 80            	lhld V_ACQWF_Ptr
    2094/     DB9 : 23                  	inx	h
    2095/     DBA : EB                  	xchg
    2096/     DBB : 2A F4 80            	lhld V_pScratchRAM
    2097/     DBE :                     L0DBE:
    2098/     DBE : 1A                  	ldax d					;copy *DE to *HL
    2099/     DBF : 77                  	mov	m,a
    2100/     DC0 : 23                  	inx	h					;+1
    2101/     DC1 : 13                  	inx	d					;+2
    2102/     DC2 : 13                  	inx	d
    2103/     DC3 : 0D                  	dcr	c
    2104/     DC4 : C2 BE 0D            	jnz	L0DBE
    2105/     DC7 : 1B                  	dcx	d
    2106/     DC8 : 05                  	dcr	b
    2107/     DC9 : C2 BE 0D            	jnz	L0DBE
    2108/     DCC : C9                  	ret
    2109/     DCD :                     Setup_Envelope:
    2110/     DCD : 2A F2 80            	lhld V_ACQWF_Ptr
    2111/     DD0 : EB                  	xchg
    2112/     DD1 : 2A F4 80            	lhld V_pScratchRAM
    2113/     DD4 : 0E 00               	mvi	c,00h
    2114/     DD6 :                     L0DD6:
    2115/     DD6 : 1A                  	ldax d
    2116/     DD7 : 47                  	mov	b,a
    2117/     DD8 : 13                  	inx	d
    2118/     DD9 : 1A                  	ldax d
    2119/     DDA : B8                  	cmp	b
    2120/     DDB : DA E4 0D            	jc	L0DE4
    2121/     DDE : 77                  	mov	m,a
    2122/     DDF : 23                  	inx	h
    2123/     DE0 : 70                  	mov	m,b
    2124/     DE1 : C3 E7 0D            	jmp	L0DE7
    2125/     DE4 : 70                  L0DE4:	mov	m,b
    2126/     DE5 : 23                  	inx	h
    2127/     DE6 : 77                  	mov	m,a
    2128/     DE7 : 23                  L0DE7:	inx	h
    2129/     DE8 : 13                  	inx	d
    2130/     DE9 : 0D                  	dcr	c
    2131/     DEA : C2 D6 0D            	jnz	L0DD6
    2132/     DED : C9                  	ret
    2133/     DEE :                     Add_Envelope:
    2134/     DEE : 0E 00               	mvi	c,00h
    2135/     DF0 : 2A F2 80            	lhld V_ACQWF_Ptr
    2136/     DF3 : EB                  	xchg
    2137/     DF4 : 2A F4 80            	lhld V_pScratchRAM
    2138/     DF7 :                     L0DF7:
    2139/     DF7 : 1A                  	ldax d
    2140/     DF8 : BE                  	cmp	m
    2141/     DF9 : DA FD 0D            	jc	L0DFD
    2142/     DFC : 77                  	mov	m,a
    2143/     DFD : 13                  L0DFD:	inx	d
    2144/     DFE : 1A                  	ldax d
    2145/     DFF : BE                  	cmp	m
    2146/     E00 : DA 04 0E            	jc	L0E04
    2147/     E03 : 77                  	mov	m,a
    2148/     E04 : 23                  L0E04:	inx	h
    2149/     E05 : 1B                  	dcx	d
    2150/     E06 : 1A                  	ldax d
    2151/     E07 : BE                  	cmp	m
    2152/     E08 : D2 0C 0E            	jnc	L0E0C
    2153/     E0B : 77                  	mov	m,a
    2154/     E0C : 13                  L0E0C:	inx	d
    2155/     E0D : 1A                  	ldax d
    2156/     E0E : BE                  	cmp	m
    2157/     E0F : D2 13 0E            	jnc	L0E13
    2158/     E12 : 77                  	mov	m,a
    2159/     E13 : 23                  L0E13:	inx	h
    2160/     E14 : 13                  	inx	d
    2161/     E15 : 0D                  	dcr	c
    2162/     E16 : C2 F7 0D            	jnz	L0DF7
    2163/     E19 : C9                  	ret
    2164/     E1A :                     Setup_Average:
    2165/     E1A : 2A F4 80            	lhld V_pScratchRAM
    2166/     E1D : 7C                  	mov	a,h
    2167/     E1E : EE 02               	xri	02h
    2168/     E20 : 67                  	mov	h,a
    2169/     E21 : 22 F6 80            	shld V_pScratchRAM2
    2170/     E24 : EB                  	xchg
    2171/     E25 : 21 00 82            	lxi	h,RAM_MIDDLE
    2172/     E28 : 01 00 02            	lxi	b,0200H
    2173/     E2B : CD 6D 1E            	call Copy_Bytes  		; 512 bytes *DE to *HL
    2174/     E2E : CD 6B 0E            	call Check_AOM_bit
    2175/     E31 : 2A F2 80            	lhld V_ACQWF_Ptr
    2176/     E34 : EB                  	xchg
    2177/     E35 : 21 00 88            	lxi	h,RAM_SCRATCH
    2178/     E38 : 01 00 02            	lxi	b,0200h
    2179/     E3B : 1A                  L0E3B:	ldax d
    2180/     E3C : 77                  	mov	m,a
    2181/     E3D : 23                  	inx	h
    2182/     E3E : 36 00               	mvi	m,00h
    2183/     E40 : 23                  	inx	h
    2184/     E41 : 13                  	inx	d
    2185/     E42 : 0D                  	dcr	c
    2186/     E43 : C2 3B 0E            	jnz	L0E3B
    2187/     E46 : 05                  	dcr	b
    2188/     E47 : C2 3B 0E            	jnz	L0E3B
    2189/     E4A : C9                  	ret
    2190/     E4B :                     ;
    2191/     E4B :                     ; add 512 byte WaveForm (DE) to 1024 byte WaveForm (HL)
    2192/     E4B :                     ;
    2193/     E4B :                     Add_Average:
    2194/     E4B : CD 6B 0E            	call Check_AOM_bit		; returns (V_ACQWF_Ptr) in HL!
    2195/     E4E : 2A F2 80            	lhld V_ACQWF_Ptr
    2196/     E51 : EB                  	xchg
    2197/     E52 : 21 00 88            	lxi	h,RAM_SCRATCH		;destination WaveForm
    2198/     E55 : 01 00 02            	lxi	b,0200h				;BC loop counter
    2199/     E58 :                     L0E58:
    2200/     E58 : 1A                  	ldax d
    2201/     E59 : 86                  	add	m					;sets carry
    2202/     E5A : 77                  	mov	m,a
    2203/     E5B : 23                  	inx	h
    2204/     E5C : 7E                  	mov	a,m
    2205/     E5D : CE 00               	aci	00h					;add with carry immediate
    2206/     E5F : 77                  	mov	m,a
    2207/     E60 : 23                  	inx	h
    2208/     E61 : 13                  	inx	d
    2209/     E62 : 0D                  	dcr	c
    2210/     E63 : C2 58 0E            	jnz	L0E58
    2211/     E66 : 05                  	dcr	b
    2212/     E67 : C2 58 0E            	jnz	L0E58
    2213/     E6A : C9                  	ret
    2214/     E6B :                     ;
    2215/     E6B :                     ; Check AOM bit. Copy 1 byte at end of waveform if set
    2216/     E6B :                     ; returns (V_ACQWF_Ptr) in HL
    2217/     E6B :                     ;
    2218/     E6B :                     Check_AOM_bit:
    2219/     E6B : 3A 04 E2            	lda	DEV_RDSTAT
    2220/     E6E : E6 02               	ani	02h					;00000010 AOM
    2221/     E70 : C8                  	rz
    2222/     E71 : 2A F2 80            	lhld V_ACQWF_Ptr
    2223/     E74 : 11 00 02            	lxi	d,0200H
    2224/     E77 : 19                  	dad	d
    2225/     E78 : 7E                  	mov	a,m
    2226/     E79 : 2B                  	dcx	h
    2227/     E7A : 77                  	mov	m,a
    2228/     E7B : 22 F2 80            	shld V_ACQWF_Ptr
    2229/     E7E : C9                  	ret
    2230/     E7F :                     ;
    2231/     E7F :                     ;
    2232/     E7F :                     Finalize_Average:
    2233/     E7F : 3A 01 81            	lda	V_LclWFEntry+S_VOLTS
    2234/     E82 : E6 1F               	ani	1Fh					;isolate
    2235/     E84 : FE 04               	cpi	VOLTAGE4
    2236/     E86 : D2 98 0E            	jnc	L0E98				;brif voltage >= VOLTAGE4
    2237/     E89 :                     ;
    2238/     E89 :                     ; A is desired voltage < VOLTAGE4
    2239/     E89 :                     ;
    2240/     E89 : 47                  	mov	b,a
    2241/     E8A : 3E 04               	mvi	a,VOLTAGE4
    2242/     E8C : 90                  	sub	b
    2243/     E8D : 32 0E 81            	sta	V_VoltSteps
    2244/     E90 : 3E C0               	mvi	a,0C0h				;new VGAIN
    2245/     E92 : 32 FD 80            	sta	V_LclWFEntry+S_VGAIN
    2246/     E95 : C3 A1 0E            	jmp	L0EA1
    2247/     E98 :                     L0E98:
    2248/     E98 : AF                  	xra	a
    2249/     E99 : 32 0E 81            	sta	V_VoltSteps
    2250/     E9C : 3E F0               	mvi	a,0F0h				;standard VGAIN
    2251/     E9E : 32 FD 80            	sta	V_LclWFEntry+S_VGAIN
    2252/     EA1 :                     L0EA1:
    2253/     EA1 : 2A F0 80            	lhld V_Sweep_Cnt2		;nr. of WFs to average
    2254/     EA4 :                     ;
    2255/     EA4 :                     ; nr. of WFs to average is always a power of 2.
    2256/     EA4 :                     ; compute 2 ^ (8 - x) where (2 ^ x) is nr. of WFs to average
    2257/     EA4 :                     ;
    2258/     EA4 : 06 08               	mvi	b,08h
    2259/     EA6 : 7C                  	mov	a,h
    2260/     EA7 : 1F                  	rar
    2261/     EA8 : 7D                  	mov	a,l
    2262/     EA9 : 1F                  	rar
    2263/     EAA :                     L0EAA:
    2264/     EAA : 05                  	dcr	b
    2265/     EAB : 1F                  	rar
    2266/     EAC : A7                  	ana	a
    2267/     EAD : C2 AA 0E            	jnz	L0EAA
    2268/     EB0 : 78                  	mov	a,b
    2269/     EB1 : 32 0D 81            	sta	V_Local810D			;store result 2^(8 - x)
    2270/     EB4 : 21 00 02            	lxi	h,0200h
    2271/     EB7 : 22 0F 81            	shld V_LoopCntAVG
    2272/     EBA : 11 00 88            	lxi	d,RAM_SCRATCH		;compress Word buffer to byte buffer
    2273/     EBD : 01 00 88            	lxi	b,RAM_SCRATCH
    2274/     EC0 :                     L0EC0:
    2275/     EC0 : 1A                  	ldax d
    2276/     EC1 : 6F                  	mov	l,a
    2277/     EC2 : 13                  	inx	d
    2278/     EC3 : 1A                  	ldax d
    2279/     EC4 : 67                  	mov	h,a
    2280/     EC5 : 3A 0D 81            	lda	V_Local810D			;2^(8-x)
    2281/     EC8 : A7                  	ana	a
    2282/     EC9 : CA D1 0E            	jz	L0ED1
    2283/     ECC :                     ;
    2284/     ECC :                     ; compute SUM / (2^x) => SUM * (2 ^ (8 - x)) / (2^8)	
    2285/     ECC :                     ;
    2286/     ECC :                     L0ECC:
    2287/     ECC : 29                  	dad	h
    2288/     ECD : 3D                  	dcr	a
    2289/     ECE : C2 CC 0E            	jnz	L0ECC
    2290/     ED1 :                     L0ED1:
    2291/     ED1 : 3A 0E 81            	lda	V_VoltSteps
    2292/     ED4 : A7                  	ana	a
    2293/     ED5 : CA EB 0E            	jz	L0EEB
    2294/     ED8 :                     ;
    2295/     ED8 :                     ; Unresolved Bug in original 468 code
    2296/     ED8 :                     ;
    2297/     ED8 :                     ; V_VoltSteps != 0. Related to a voltage setting < VOLTAGE4
    2298/     ED8 :                     ; VGAIN is set to 0C0h (normally 0F0h). 1.25 magnification.
    2299/     ED8 :                     ; see UpdateChannelVolts() for the same value.
    2300/     ED8 :                     ; WF value (HL) needs to be modified to show the magnified voltage
    2301/     ED8 :                     ; Code adds 0C000h to the Sum and ignores overflow
    2302/     ED8 :                     ; then doubles the Sum and set the MSB of the Sum to 0FFh.
    2303/     ED8 :                     ; This solution does NOT work:
    2304/     ED8 :                     ; The averaged WF will show spikes when moved below the 0 line
    2305/     ED8 :                     ;
    2306/     ED8 : D5                  	push d
    2307/     ED9 : 11 00 C0            	lxi	d,0C000h
    2308/     EDC :                     L0EDC:
    2309/     EDC : 19                  	dad	d					;Sum = 0C000h, ignore carry
    2310/     EDD : 29                  	dad	h					;double Sum
    2311/     EDE : D2 E6 0E            	jnc	L0EE6
    2312/     EE1 : 26 FF               	mvi	h,0FFh
    2313/     EE3 : C3 EA 0E            	jmp	L0EEA
    2314/     EE6 :                     L0EE6:
    2315/     EE6 : 3D                  	dcr	a
    2316/     EE7 : C2 DC 0E            	jnz	L0EDC
    2317/     EEA :                     L0EEA:
    2318/     EEA : D1                  	pop	d
    2319/     EEB :                     L0EEB:
    2320/     EEB :                     ;
    2321/     EEB :                     ; end of 468 code bug
    2322/     EEB :                     ;
    2323/     EEB : 7C                  	mov	a,h					;divide Sum by 256 by taking MSB of Sum
    2324/     EEC : 02                  	stax b
    2325/     EED : 13                  	inx	d
    2326/     EEE : 03                  	inx	b
    2327/     EEF : 2A 0F 81            	lhld V_LoopCntAVG
    2328/     EF2 : 2B                  	dcx	h
    2329/     EF3 : 22 0F 81            	shld V_LoopCntAVG
    2330/     EF6 : 7D                  	mov	a,l
    2331/     EF7 : B4                  	ora	h
    2332/     EF8 : C2 C0 0E            	jnz	L0EC0
    2333/     EFB : 2A F4 80            	lhld V_pScratchRAM
    2334/     EFE : 11 00 88            	lxi	d,RAM_SCRATCH
    2335/     F01 : 01 00 02            	lxi	b,0200H
    2336/     F04 : CD 6D 1E            	call Copy_Bytes  		; 512 bytes *DE to *HL
    2337/     F07 : 2A F6 80            	lhld V_pScratchRAM2
    2338/     F0A : 11 00 82            	lxi	d,RAM_MIDDLE
    2339/     F0D : 01 00 02            	lxi	b,0200H
    2340/     F10 : CD 6D 1E            	call Copy_Bytes 		; 512 bytes *DE to *HL
    2341/     F13 : C9                  	ret
    2342/     F14 :                     ;
    2343/     F14 :                     ;
    2344/     F14 :                     ComputeGNDREF:
    2345/     F14 : EB                  	xchg
    2346/     F15 : 2A F4 80            	lhld V_pScratchRAM
    2347/     F18 : 19                  	dad	d
    2348/     F19 : 22 11 81            	shld VAR_8111
    2349/     F1C : 3A FF 80            	lda	V_LclWFEntry+S_STATUS
    2350/     F1F : E6 30               	ani	30h
    2351/     F21 : FE 20               	cpi	20h
    2352/     F23 : C2 60 0F            	jnz	L0F60
    2353/     F26 : 2A F8 80            	lhld V_pWF_4
    2354/     F29 : 23                  	inx	h
    2355/     F2A : 23                  	inx	h
    2356/     F2B : 23                  	inx	h
    2357/     F2C : 23                  	inx	h
    2358/     F2D : 23                  	inx	h
    2359/     F2E : 7E                  	mov	a,m
    2360/     F2F : E6 30               	ani	30h
    2361/     F31 : FE 20               	cpi	20h
    2362/     F33 : C2 55 0F            	jnz	L0F55
    2363/     F36 : 06 00               	mvi	b,00h
    2364/     F38 : 2A 11 81            	lhld VAR_8111
    2365/     F3B : 11 00 00            	lxi	d,0H
    2366/     F3E : 3E 10               	mvi	a,10h
    2367/     F40 : 2B                  L0F40:	dcx	h
    2368/     F41 : 4E                  	mov	c,m
    2369/     F42 : EB                  	xchg
    2370/     F43 : 09                  	dad	b
    2371/     F44 : EB                  	xchg
    2372/     F45 : 3D                  	dcr	a
    2373/     F46 : C2 40 0F            	jnz	L0F40
    2374/     F49 : EB                  	xchg
    2375/     F4A : 29                  	dad	h					;times 2
    2376/     F4B : 29                  	dad	h					;times 4
    2377/     F4C : 29                  	dad	h					;times 8
    2378/     F4D : 29                  	dad	h					;times 16
    2379/     F4E : 7C                  	mov	a,h
    2380/     F4F : 32 ED 80            	sta	VAR_80ED
    2381/     F52 : C3 5D 0F            	jmp	L0F5D
    2382/     F55 :                     L0F55:
    2383/     F55 : 2A 11 81            	lhld VAR_8111
    2384/     F58 : 2B                  	dcx	h
    2385/     F59 : 7E                  	mov	a,m
    2386/     F5A : 32 ED 80            	sta	VAR_80ED
    2387/     F5D : C3 68 0F            L0F5D:	jmp	L0F68
    2388/     F60 : 2A F8 80            L0F60:	lhld V_pWF_4
    2389/     F63 : 23                  	inx	h
    2390/     F64 : 7E                  	mov	a,m
    2391/     F65 : 32 ED 80            	sta	VAR_80ED
    2392/     F68 : 3A ED 80            L0F68:	lda	VAR_80ED
    2393/     F6B : C9                  	ret
    2394/     F6C :                     ;
    2395/     F6C :                     ; table init function
    2396/     F6C :                     ;	
    2397/     F6C :                     Main_Action_10:
    2398/     F6C : 06 04               	mvi	b,04h
    2399/     F6E : 21 83 80            	lxi	h,V_WFTable+S_CHANMODE
    2400/     F71 :                     L0F71:
    2401/     F71 : 7E                  	mov	a,m
    2402/     F72 : E6 80               	ani	80h					;test SAVEREF bit
    2403/     F74 : C2 7F 0F            	jnz	L0F7F
    2404/     F77 : E5                  	push h
    2405/     F78 : 11 FD FF            	lxi	d,-3
    2406/     F7B : 19                  	dad	d
    2407/     F7C : 36 00               	mvi	m,00h				;p->S_GNDREF = 0
    2408/     F7E : E1                  	pop	h
    2409/     F7F :                     L0F7F:
    2410/     F7F : 11 08 00            	lxi	d,WFENTRYSIZE		;add to hl
    2411/     F82 : 19                  	dad	d
    2412/     F83 : 05                  	dcr	b
    2413/     F84 : C2 71 0F            	jnz	L0F71
    2414/     F87 : C9                  	ret
    2415/     F88 :                     ;
    2416/     F88 :                     ; Copy and entry from Local WFTable to master WFTable
    2417/     F88 :                     ;
    2418/     F88 :                     CopyWFTableEntry:
    2419/     F88 : 2A F8 80            	lhld V_pWF_4
    2420/     F8B : 11 FA 80            	lxi	d,V_LclWFEntry
    2421/     F8E : 01 08 00            	lxi	b,WFENTRYSIZE
    2422/     F91 : CD 6D 1E            	call Copy_Bytes 		; 8 bytes *DE to *HL
    2423/     F94 : C9                  	ret
    2424/     F95 :                     ;
    2425/     F95 :                     ; set INITAVG bit in WFTable[0..3].Status
    2426/     F95 :                     ;
    2427/     F95 :                     Main_Action_8:	
    2428/     F95 : 21 84 80            	lxi	h,V_WFTable+S_STATUS	;p to WF Status, 4 entries, each entry 8 bytes.
    2429/     F98 : 11 08 00            	lxi	d,WFENTRYSIZE
    2430/     F9B : 0E 04               	mvi	c,04h				;loop 4 times 4,3,2,1
    2431/     F9D : 06 80               	mvi	b,80h				;10000000
    2432/     F9F :                     L0F9F:
    2433/     F9F : 78                  	mov	a,b
    2434/     FA0 : B6                  	ora	m					;set bit 7 in p->status
    2435/     FA1 : 77                  	mov	m,a
    2436/     FA2 : 19                  	dad	d					;next WFTbl entry
    2437/     FA3 : 0D                  	dcr	c					;loop 4 times
    2438/     FA4 : C2 9F 0F            	jnz	L0F9F
    2439/     FA7 : C9                  	ret
    2440/     FA8 :                     ;
    2441/     FA8 :                     ; init function.
    2442/     FA8 :                     ;	
    2443/     FA8 :                     Init_WFTable:
    2444/     FA8 : 3E FF               	mvi	a,0FFh
    2445/     FAA : 32 01 80            	sta	V_fOK2ProcessAcq
    2446/     FAD : AF                  	xra	a
    2447/     FAE : 32 A2 80            	sta	V_ValidWFs+3
    2448/     FB1 : AF                  	xra	a
    2449/     FB2 : 32 A1 80            	sta	V_ValidWFs+2 		;set to FALSE
    2450/     FB5 : AF                  	xra	a
    2451/     FB6 : 32 A0 80            	sta	V_ValidWFs+1
    2452/     FB9 : AF                  	xra	a
    2453/     FBA : 32 9F 80            	sta	V_ValidWFs
    2454/     FBD : 21 7F 80            	lxi	h,V_WFTable			;store &V_WFTable in V_pDispWF
    2455/     FC0 : 22 7D 80            	shld V_pDispWF
    2456/     FC3 : 3E 01               	mvi	a,01h
    2457/     FC5 : 32 29 80            	sta	V_ChannelMode
    2458/     FC8 :                     ;	
    2459/     FC8 :                     ; clear 4th byte in each table entry	
    2460/     FC8 :                     ;
    2461/     FC8 : 06 04               	mvi	b,04h				;loop counter
    2462/     FCA : 11 08 00            	lxi	d,08h				;entry size
    2463/     FCD : 21 83 80            	lxi	h,V_WFTable+4		;4 entries table pointer, 4th byte
    2464/     FD0 : AF                  	xra	a
    2465/     FD1 :                     $$Loop:
    2466/     FD1 : 77                  	mov	m,a
    2467/     FD2 : 19                  	dad	d					;update table pointer
    2468/     FD3 : 05                  	dcr	b
    2469/     FD4 : F2 D1 0F            	jp	$$Loop
    2470/     FD7 : CD 6C 0F            	call Main_Action_10
    2471/     FDA : C9                  	ret
    2472/     FDB :                     ;
    2473/     FDB :                     ; in
    2474/     FDB :                     ; out A 1 or 3
    2475/     FDB :                     ;	
    2476/     FDB :                     GetWFArea:
    2477/     FDB : 3A A6 80            	lda	V_fSAVEREFShowing	;Flag
    2478/     FDE : 2F                  	cma
    2479/     FDF : 4F                  	mov	c,a
    2480/     FE0 : 3A 20 80            	lda	V_fADD
    2481/     FE3 : A1                  	ana	c
    2482/     FE4 : 4F                  	mov	c,a
    2483/     FE5 : 3A 1E 80            	lda	V_fCH1
    2484/     FE8 : 47                  	mov	b,a
    2485/     FE9 : 3A 1F 80            	lda	V_fCH2
    2486/     FEC : B0                  	ora	b
    2487/     FED : A1                  	ana	c
    2488/     FEE : F2 F4 0F            	jp	L0FF4
    2489/     FF1 : 3E 03               	mvi	a,03h
    2490/     FF3 : C9                  	ret
    2491/     FF4 : 3E 01               L0FF4:	mvi	a,01h
    2492/     FF6 : C9                  	ret
    2493/     FF7 :                     ;
    2494/     FF7 :                     GPIBInterrupt:
    2495/     FF7 : F5                  	push psw
    2496/     FF8 : C5                  	push b
    2497/     FF9 : D5                  	push d
    2498/     FFA : E5                  	push h
    2499/     FFB : 20                  	rim
    2500/     FFC : E6 07               	ani	07h
    2501/     FFE : F6 09               	ori	09h
    2502/    1000 : 30                  	sim
    2503/    1001 : FB                  	ei
    2504/    1002 : AF                  	xra	a
    2505/    1003 : 32 5B 80            	sta	V_GPIB_Bool9
    2506/    1006 : 32 6E 80            	sta	V_GPIB_Bool4
    2507/    1009 : 32 6D 80            	sta	V_GPIB_Bool3
    2508/    100C : CD 6E 20            	call Get_GPIB_Status
    2509/    100F : 3A 62 80            	lda	V_GPIB_Bool6
    2510/    1012 : A7                  	ana	a
    2511/    1013 : 3E 7B               	mvi	a,7Bh
    2512/    1015 : F2 2A 10            	jp	L102A
    2513/    1018 : AF                  	xra	a
    2514/    1019 : 32 6F 80            	sta	V_GPIB_Bool5
    2515/    101C : 3E 2B               	mvi	a,2Bh
    2516/    101E : 2F                  	cma
    2517/    101F : CD 65 20            	call Update_DEV_WIFCTL_and
    2518/    1022 : 3E 80               	mvi	a,80h
    2519/    1024 : 2F                  	cma
    2520/    1025 : CD 68 20            	call Update_DEV_FPC_and
    2521/    1028 : 3E 7A               	mvi	a,7Ah
    2522/    102A :                     L102A:
    2523/    102A : CD 49 00            	call AddMainAction
    2524/    102D : CD 47 20            	call Remove_GPIB_Actions ;remove certain GPIB actions
    2525/    1030 : F3                  	di
    2526/    1031 : E1                  	pop	h
    2527/    1032 : D1                  	pop	d
    2528/    1033 : C1                  	pop	b
    2529/    1034 : F1                  	pop	psw
    2530/    1035 : FB                  	ei
    2531/    1036 : C9                  	ret
    2532/    1037 :                     ;
    2533/    1037 :                     ; V_pWFTable3 is local
    2534/    1037 :                     ;
    2535/    1037 :                     RenderCursorLine_0:
    2536/    1037 : 3A 70 80            	lda	V_FPC
    2537/    103A : E6 CF               	ani	0CFh				;11001111 Clr CH1POS & CH2POS
    2538/    103C : 32 70 80            	sta	V_FPC
    2539/    103F : 3A AA 80            	lda	V_CursorMode
    2540/    1042 : FE 03               	cpi	03h
    2541/    1044 : C2 F6 10            	jnz	L10F6
    2542/    1047 : 3A A3 80            	lda	V_PrimaryWF			;base 1
    2543/    104A : 3D                  	dcr	a					;base 0
    2544/    104B : 07                  	rlc						;x8
    2545/    104C : 07                  	rlc
    2546/    104D : 07                  	rlc
    2547/    104E : 21 7F 80            	lxi	h,V_WFTable			;p = V_WFTable[V_PrimaryWF]
    2548/    1051 : 85                  	add	l
    2549/    1052 : 6F                  	mov	l,a
    2550/    1053 : AF                  	xra	a
    2551/    1054 : 8C                  	adc	h
    2552/    1055 : 67                  	mov	h,a
    2553/    1056 : 22 1D 81            	shld V_pWFTable3
    2554/    1059 : 11 05 00            	lxi	d,05H
    2555/    105C : 19                  	dad	d
    2556/    105D : 7E                  	mov	a,m					;A = *(p+5)
    2557/    105E : E6 04               	ani	04h
    2558/    1060 : FE 04               	cpi	04h
    2559/    1062 : C2 6C 10            	jnz	L106C
    2560/    1065 : AF                  	xra	a
    2561/    1066 : 32 1C 81            	sta	V_fShortWF
    2562/    1069 : C3 71 10            	jmp	L1071
    2563/    106C : 3E 01               L106C:	mvi	a,01h
    2564/    106E : 32 1C 81            	sta	V_fShortWF
    2565/    1071 :                     L1071:
    2566/    1071 : 2A B3 80            	lhld V_TimeCursorPos
    2567/    1074 : 22 BB 80            	shld V_TmpCursorPos
    2568/    1077 : 2A B5 80            	lhld V_TimeCursorPos+2
    2569/    107A : 22 BD 80            	shld V_TmpCursorPos+2
    2570/    107D : CD 77 20            	call GetWFExpandVal
    2571/    1080 : CD 74 20            	call AdjustCursorTime
    2572/    1083 : 2A BB 80            	lhld V_TmpCursorPos
    2573/    1086 : CD 6B 11            	call ConvertTimePos2VoltsPos
    2574/    1089 : 22 B7 80            	shld V_LineCursorPos
    2575/    108C : 2A BD 80            	lhld V_TmpCursorPos+2
    2576/    108F : CD 6B 11            	call ConvertTimePos2VoltsPos
    2577/    1092 : 22 B9 80            	shld V_LineCursorPos+2
    2578/    1095 : 3A 14 80            	lda	V_fSnappedCursor
    2579/    1098 : 17                  	ral
    2580/    1099 : D2 C8 10            	jnc	L10C8
    2581/    109C : 2A 1D 81            	lhld V_pWFTable3
    2582/    109F : 11 01 00            	lxi	d,S_GNDREF
    2583/    10A2 : 19                  	dad	d
    2584/    10A3 : 7E                  	mov	a,m					;A = *(p+S_GNDREF)
    2585/    10A4 : 07                  	rlc
    2586/    10A5 : 07                  	rlc
    2587/    10A6 : 47                  	mov	b,a
    2588/    10A7 : E6 03               	ani	03h
    2589/    10A9 : 57                  	mov	d,a
    2590/    10AA : 78                  	mov	a,b
    2591/    10AB : E6 FC               	ani	0FCh
    2592/    10AD : 5F                  	mov	e,a
    2593/    10AE : A7                  	ana	a
    2594/    10AF : CA C5 10            	jz	L10C5
    2595/    10B2 : 3A 15 80            	lda	V_fCursor1Snapped
    2596/    10B5 : 17                  	ral
    2597/    10B6 : 21 B7 80            	lxi	h,V_LineCursorPos
    2598/    10B9 : DA BF 10            	jc	L10BF
    2599/    10BC : 21 B9 80            	lxi	h,V_LineCursorPos+2
    2600/    10BF :                     L10BF:
    2601/    10BF : 73                  	mov	m,e
    2602/    10C0 : 23                  	inx	h
    2603/    10C1 : 72                  	mov	m,d
    2604/    10C2 : C3 C8 10            	jmp	L10C8
    2605/    10C5 :                     L10C5:
    2606/    10C5 : CD 71 20            	call ClrCursorSnap
    2607/    10C8 :                     L10C8:
    2608/    10C8 : 3A A5 80            	lda	V_DigitalMode
    2609/    10CB : FE 04               	cpi	DIGITAL_SAVE
    2610/    10CD : C2 02 11            	jnz	L1102
    2611/    10D0 : 2A 1D 81            	lhld V_pWFTable3		;p = (V_pWFTable3)
    2612/    10D3 : 11 04 00            	lxi	d,S_CHANMODE		;*(p+S_CHANMODE)
    2613/    10D6 : 19                  	dad	d
    2614/    10D7 : 7E                  	mov	a,m
    2615/    10D8 : E6 01               	ani	01h					;is this Channel 1
    2616/    10DA : CA E5 10            	jz	L10E5				;no
    2617/    10DD : 3A 70 80            	lda	V_FPC
    2618/    10E0 : F6 20               	ori	20h					;00100000 Set CH1POS
    2619/    10E2 : 32 70 80            	sta	V_FPC
    2620/    10E5 : 7E                  L10E5:	mov	a,m				;*(p+4)
    2621/    10E6 : E6 02               	ani	02h					;is this Channel 2
    2622/    10E8 : CA 02 11            	jz	L1102				;no
    2623/    10EB : 3A 70 80            	lda	V_FPC
    2624/    10EE : F6 10               	ori	10h					;00010000 set CH2POS
    2625/    10F0 : 32 70 80            	sta	V_FPC
    2626/    10F3 : C3 02 11            	jmp	L1102
    2627/    10F6 :                     L10F6:
    2628/    10F6 : 2A AF 80            	lhld V_VoltsCursorPos
    2629/    10F9 : 22 B7 80            	shld V_LineCursorPos
    2630/    10FC : 2A B1 80            	lhld V_VoltsCursorPos+2
    2631/    10FF : 22 B9 80            	shld V_LineCursorPos+2
    2632/    1102 :                     L1102:
    2633/    1102 : CD B0 11            	call StrobeDisplayRAM_0	;result A unused
    2634/    1105 : 3A 41 80            	lda	V_CursorLine
    2635/    1108 : FE 01               	cpi	01h
    2636/    110A : C2 25 11            	jnz	L1125
    2637/    110D : 2A B7 80            	lhld V_LineCursorPos
    2638/    1110 : 22 1A 81            	shld V_ThisLineCursorPos
    2639/    1113 : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    2640/    1116 : 17                  	ral
    2641/    1117 : D2 32 11            	jnc	L1132
    2642/    111A : 3A BF 80            L111A:	lda	V_CONTRL
    2643/    111D : F6 80               	ori	80h					;10000000 ACTIVEL
    2644/    111F : 32 BF 80            	sta	V_CONTRL
    2645/    1122 : C3 32 11            	jmp	L1132
    2646/    1125 : 2A B9 80            L1125:	lhld V_LineCursorPos+2
    2647/    1128 : 22 1A 81            	shld V_ThisLineCursorPos
    2648/    112B : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    2649/    112E : 17                  	ral
    2650/    112F : D2 1A 11            	jnc	L111A
    2651/    1132 : 3A 1A 81            L1132:	lda	V_ThisLineCursorPos
    2652/    1135 : E6 03               	ani	03h
    2653/    1137 : 47                  	mov	b,a
    2654/    1138 : 3A A4 80            	lda	V_DISREG
    2655/    113B : E6 7C               	ani	7Ch
    2656/    113D : B0                  	ora	b
    2657/    113E : 32 A4 80            	sta	V_DISREG
    2658/    1141 : 2A 1A 81            	lhld V_ThisLineCursorPos
    2659/    1144 : 7D                  	mov	a,l
    2660/    1145 : E6 FC               	ani	0FCh
    2661/    1147 : B4                  	ora	h
    2662/    1148 : 0F                  	rrc
    2663/    1149 : 0F                  	rrc
    2664/    114A : 32 01 E4            	sta	DEV_LINER
    2665/    114D : CD B9 11            	call SetUpLineCursor_0
    2666/    1150 : 3A AA 80            	lda	V_CursorMode
    2667/    1153 : FE 03               	cpi	03h
    2668/    1155 : C2 62 11            	jnz	L1162
    2669/    1158 : 2A 1D 81            	lhld V_pWFTable3
    2670/    115B : 23                  	inx	h
    2671/    115C : 23                  	inx	h
    2672/    115D : 23                  	inx	h
    2673/    115E : 7E                  	mov	a,m					;A = *(p+S_VGAIN)
    2674/    115F : C3 64 11            	jmp	L1164
    2675/    1162 : 3E F0               L1162:	mvi	a,0F0h			;11110000
    2676/    1164 : 32 05 E4            L1164:	sta	DEV_VGAIN
    2677/    1167 : CD CD 11            	call EnableLineCursor_0
    2678/    116A : C9                  	ret
    2679/    116B :                     ;
    2680/    116B :                     ; in HL
    2681/    116B :                     ;	
    2682/    116B :                     ConvertTimePos2VoltsPos:
    2683/    116B : 2B                  	dcx	h					;bad move if HL==0 or very tricky
    2684/    116C : 3A 1C 81            	lda	V_fShortWF
    2685/    116F : FE 00               	cpi	00h
    2686/    1171 : C2 78 11            	jnz	L1178
    2687/    1174 : 7D                  	mov	a,l					;save
    2688/    1175 : C3 7D 11            	jmp	L117D
    2689/    1178 : 7C                  L1178:	mov	a,h
    2690/    1179 : 1F                  	rar						;/2
    2691/    117A : 67                  	mov	h,a
    2692/    117B : 7D                  	mov	a,l
    2693/    117C : 1F                  	rar						;/2
    2694/    117D :                     L117D:
    2695/    117D : F5                  	push	psw				;save A
    2696/    117E : E6 FE               	ani	0FEh				;11111110
    2697/    1180 : 6F                  	mov	l,a
    2698/    1181 : 3E 03               	mvi	a,03h				;00000011
    2699/    1183 : A4                  	ana	h					;H &= 03
    2700/    1184 : 67                  	mov	h,a
    2701/    1185 : EB                  	xchg					;save HL in DE, max value is 0x3FE		
    2702/    1186 : 3A A3 80            	lda	V_PrimaryWF			;WaveForm Area index 1..4
    2703/    1189 : 3D                  	dcr	a					;rebase
    2704/    118A : 87                  	add	a					;*2
    2705/    118B : 4F                  	mov	c,a
    2706/    118C : 06 00               	mvi	b,00h
    2707/    118E : 21 21 20            	lxi	h,DisplayRamTable	;p = &DisplayRamTable[index]
    2708/    1191 : 09                  	dad	b
    2709/    1192 : 4E                  	mov	c,m					;HL = *(word*)p
    2710/    1193 : 23                  	inx	h
    2711/    1194 : 66                  	mov	h,m
    2712/    1195 : 69                  	mov	l,c
    2713/    1196 : 19                  	dad	d					;p = HL + DE
    2714/    1197 : 2B                  	dcx	h
    2715/    1198 : 2B                  	dcx	h
    2716/    1199 : 4E                  	mov	c,m					;C = *(byte *)(p - 2)
    2717/    119A : 06 00               	mvi	b,00h
    2718/    119C : F1                  	pop	psw					;restore A
    2719/    119D : 1F                  	rar						;test bit 0
    2720/    119E : D2 A9 11            	jnc	L11A9
    2721/    11A1 : 23                  	inx	h
    2722/    11A2 : 23                  	inx	h
    2723/    11A3 : 6E                  	mov	l,m					;L = *p
    2724/    11A4 : 26 00               	mvi	h,00h
    2725/    11A6 : C3 AD 11            	jmp	L11AD
    2726/    11A9 :                     L11A9:
    2727/    11A9 : 21 00 00            	lxi	h,0000h
    2728/    11AC : 09                  	dad	b					;HL = BC;
    2729/    11AD :                     L11AD:
    2730/    11AD : 09                  	dad	b					;HL += BC
    2731/    11AE : 29                  	dad	h					;HL += HL
    2732/    11AF : C9                  	ret
    2733/    11B0 :                     ;
    2734/    11B0 :                     ; returns A
    2735/    11B0 :                     ;
    2736/    11B0 :                     StrobeDisplayRAM_0:
    2737/    11B0 : 21 21 20            	lxi	h,DisplayRamTable	;data in ROM so invariant
    2738/    11B3 : 5E                  	mov	e,m					;p = *(DisplayRamTable) : RAM_DISPLAY (0xA000)
    2739/    11B4 : 23                  	inx	h
    2740/    11B5 : 56                  	mov	d,m
    2741/    11B6 : 13                  	inx	d
    2742/    11B7 : 1A                  	ldax d					;A = *p
    2743/    11B8 : C9                  	ret
    2744/    11B9 :                     ;	
    2745/    11B9 :                     SetUpLineCursor_0:
    2746/    11B9 : 21 A4 80            	lxi	h,V_DISREG
    2747/    11BC : 3E 40               	mvi	a,40h
    2748/    11BE : F6 20               	ori	20h
    2749/    11C0 : 2F                  	cma
    2750/    11C1 : A6                  	ana	m
    2751/    11C2 : F6 10               	ori	10h
    2752/    11C4 : 32 A4 80            	sta	V_DISREG
    2753/    11C7 : 3E 3D               	mvi	a,3Dh				;00111101
    2754/    11C9 : 32 06 E4            	sta	DEV_HGAIN
    2755/    11CC : C9                  	ret
    2756/    11CD :                     ;
    2757/    11CD :                     EnableLineCursor_0:
    2758/    11CD : AF                  	xra	a
    2759/    11CE : 32 04 E4            	sta	DEV_JITTER
    2760/    11D1 : 3A 70 80            	lda	V_FPC
    2761/    11D4 : 32 40 E0            	sta	DEV_FPC
    2762/    11D7 : 3A BF 80            	lda	V_CONTRL
    2763/    11DA : E6 EF               	ani	0EFh				;11101111 Clr LINECUR
    2764/    11DC : 32 41 E0            	sta	DEV_CONTRL
    2765/    11DF : C9                  	ret
    2766/    11E0 :                     ;
    2767/    11E0 :                     ; Freeze WFs (SAVE)
    2768/    11E0 :                     ;
    2769/    11E0 :                     ; V_pWFTbl_7, V_Index_7, V_Tmp_7 are local to this large function
    2770/    11E0 :                     ; V_AcquiredTB_7 local
    2771/    11E0 :                     ;
    2772/    11E0 :                     Display_Action_7_0:
    2773/    11E0 : 3E 01               	mvi	a,01h
    2774/    11E2 : 32 23 81            	sta	V_Index_7			;V_Index_7 = 1..3
    2775/    11E5 : 21 7F 80            	lxi	h,V_WFTable
    2776/    11E8 : 22 26 81            	shld V_pWFTbl_7			;V_pWFTbl_7 = &V_WFTable Updated each loop
    2777/    11EB :                     ; Loop 3 times
    2778/    11EB :                     L11EB:
    2779/    11EB : 2A 23 81            	lhld V_Index_7
    2780/    11EE : 26 00               	mvi	h,00h
    2781/    11F0 : 11 9E 80            	lxi	d,V_ValidWFs-1		;table of 4 booleans
    2782/    11F3 : 19                  	dad	d
    2783/    11F4 : 4E                  	mov	c,m
    2784/    11F5 : 79                  	mov	a,c					;boolean test
    2785/    11F6 : 17                  	ral
    2786/    11F7 : D2 09 12            	jnc	L1209				;done if FALSE
    2787/    11FA :                     ; boolean == TRUE	
    2788/    11FA : 2A 26 81            	lhld V_pWFTbl_7
    2789/    11FD : 23                  	inx	h					;A = *(p + 4)
    2790/    11FE : 23                  	inx	h
    2791/    11FF : 23                  	inx	h
    2792/    1200 : 23                  	inx	h
    2793/    1201 : 7E                  	mov	a,m
    2794/    1202 : E6 80               	ani	80h					;10000000
    2795/    1204 : FE 00               	cpi	00h
    2796/    1206 : CA 0C 12            	jz	L120C				;done if bit 7 == 0
    2797/    1209 :                     L1209:
    2798/    1209 : C3 FA 12            	jmp	L12FA				;done
    2799/    120C :                     L120C:
    2800/    120C : 2A 26 81            	lhld V_pWFTbl_7
    2801/    120F : 23                  	inx	h
    2802/    1210 : 23                  	inx	h
    2803/    1211 : 23                  	inx	h
    2804/    1212 : 23                  	inx	h
    2805/    1213 : 7E                  	mov	a,m					;A = *(p + S_CHANMODE)
    2806/    1214 : E6 03               	ani	03h					;00000011
    2807/    1216 : FE 02               	cpi	02h
    2808/    1218 : C2 24 12            	jnz	L1224
    2809/    121B : 3A 1B 80            	lda	V_CH2_Info
    2810/    121E : 32 24 81            	sta	V_Tmp_7	
    2811/    1221 : C3 2A 12            	jmp	L122A
    2812/    1224 :                     L1224:
    2813/    1224 : 3A 1A 80            	lda	V_CH1_Info
    2814/    1227 : 32 24 81            	sta	V_Tmp_7
    2815/    122A :                     L122A:
    2816/    122A : 2A 26 81            	lhld V_pWFTbl_7
    2817/    122D : EB                  	xchg					;move to DE
    2818/    122E : 21 05 00            	lxi	h,S_STATUS
    2819/    1231 : 19                  	dad	d
    2820/    1232 : 7E                  	mov	a,m					;A = *(p+S_STATUS)
    2821/    1233 : E6 03               	ani	03h					;00000011
    2822/    1235 : FE 03               	cpi	03h
    2823/    1237 : C2 58 12            	jnz	L1258
    2824/    123A :                     ; A == 3	
    2825/    123A : 21 07 00            	lxi	h,S_VOLTS		;DE still V_pWFTbl_7
    2826/    123D : 19                  	dad	d
    2827/    123E : 7E                  	mov	a,m					;A = *(p+S_VOLTS)
    2828/    123F : E6 1F               	ani	1Fh					;00011111	isolate Voltage
    2829/    1241 : FE 04               	cpi	04h
    2830/    1243 : D2 58 12            	jnc	L1258
    2831/    1246 : 47                  	mov	b,a					;save
    2832/    1247 : 3A 24 81            	lda	V_Tmp_7				;just set before from V_CH2_Info or V_CH1_Info
    2833/    124A : E6 1F               	ani	1Fh					;00011111	isolate Voltage
    2834/    124C : 4F                  	mov	c,a
    2835/    124D : 78                  	mov	a,b
    2836/    124E : 91                  	sub	c					;B - C
    2837/    124F : 6F                  	mov	l,a
    2838/    1250 : 3E C0               	mvi	a,0C0h				;11000000
    2839/    1252 : CD 8F 1E            	call ShiftR_A_L_times	;preserves DE result in A
    2840/    1255 : C3 63 12            	jmp	L1263
    2841/    1258 :                     L1258:
    2842/    1258 : 21 07 00            	lxi	h,S_VOLTS		;DE still V_pWFTbl_7			
    2843/    125B : 19                  	dad	d
    2844/    125C : 46                  	mov	b,m					;B = *(p+S_VOLTS)
    2845/    125D : 3A 24 81            	lda	V_Tmp_7
    2846/    1260 : CD 8D 14            	call ComputeVGAIN 		;result in A
    2847/    1263 :                     L1263:	
    2848/    1263 : 2A 26 81            	lhld V_pWFTbl_7
    2849/    1266 : 23                  	inx	h
    2850/    1267 : 23                  	inx	h
    2851/    1268 : 23                  	inx	h
    2852/    1269 : 77                  	mov	m,a					;*(p+S_VGAIN) = A
    2853/    126A : 3A 23 80            	lda	V_ATimebaseActive
    2854/    126D : 17                  	ral
    2855/    126E : D2 7A 12            	jnc	L127A
    2856/    1271 : 3A 18 80            	lda	V_ATIME
    2857/    1274 : 32 24 81            	sta	V_Tmp_7
    2858/    1277 : C3 80 12            	jmp	L1280
    2859/    127A : 3A 19 80            L127A:	lda	V_BTIME
    2860/    127D : 32 24 81            	sta	V_Tmp_7				;A or B TIME/DIV
    2861/    1280 : 11 06 00            L1280:	lxi	d,06H
    2862/    1283 : 2A 26 81            	lhld V_pWFTbl_7			;p
    2863/    1286 : 19                  	dad	d
    2864/    1287 : 7E                  	mov	a,m					;A = *(p+6)
    2865/    1288 : 2E 14               	mvi	l,TB20
    2866/    128A : CD B5 1E            	call Get_Minimum
    2867/    128D : 32 25 81            	sta	V_AcquiredTB_7		;store result
    2868/    1290 : 2A 26 81            	lhld V_pWFTbl_7			;p
    2869/    1293 : 23                  	inx	h
    2870/    1294 : 23                  	inx	h
    2871/    1295 : 23                  	inx	h
    2872/    1296 : 23                  	inx	h
    2873/    1297 : 23                  	inx	h
    2874/    1298 : 7E                  	mov	a,m					;A = *(p+5)
    2875/    1299 : E6 04               	ani	04h					;00000100
    2876/    129B : FE 00               	cpi	00h
    2877/    129D : C2 A8 12            	jnz	L12A8
    2878/    12A0 : 3E FF               	mvi	a,0FFh
    2879/    12A2 : 32 2B 80            	sta	V_fChopped	
    2880/    12A5 : C3 AC 12            	jmp	L12AC
    2881/    12A8 : AF                  L12A8:	xra	a
    2882/    12A9 : 32 2B 80            	sta	V_fChopped
    2883/    12AC :                     L12AC:
    2884/    12AC : 2A 23 81            	lhld V_Index_7			;current loop index 1..3
    2885/    12AF : 26 00               	mvi	h,00h
    2886/    12B1 : 11 56 80            	lxi	d,V_Jitter_Tbl-1
    2887/    12B4 : 19                  	dad	d
    2888/    12B5 : 7E                  	mov	a,m					;A = V_Jitter_Tbl[V_index]
    2889/    12B6 : 32 56 80            	sta	V_Jitter
    2890/    12B9 : 3A 25 81            	lda	V_AcquiredTB_7
    2891/    12BC : 47                  	mov	b,a
    2892/    12BD : 2A 26 81            	lhld V_pWFTbl_7			;p
    2893/    12C0 : 11 05 00            	lxi	d,05H
    2894/    12C3 : 19                  	dad	d
    2895/    12C4 : 7E                  	mov	a,m					;A = *(p+5)
    2896/    12C5 : E6 03               	ani	03h					;00000011
    2897/    12C7 : 4F                  	mov	c,a
    2898/    12C8 : 3A 23 81            	lda	V_Index_7
    2899/    12CB : 6F                  	mov	l,a
    2900/    12CC : 3A 24 81            	lda	V_Tmp_7
    2901/    12CF : CD 12 13            	call TimeExpandWF		;args A, B, C, L
    2902/    12D2 : 2A 26 81            	lhld V_pWFTbl_7			;p
    2903/    12D5 : 23                  	inx	h
    2904/    12D6 : 23                  	inx	h
    2905/    12D7 : 77                  	mov	m,a					;*(p+2) = A
    2906/    12D8 : 3A 25 81            	lda	V_AcquiredTB_7
    2907/    12DB : 21 24 81            	lxi	h,V_Tmp_7			;A or B TIME/DIV
    2908/    12DE : BE                  	cmp	m
    2909/    12DF : D2 EE 12            	jnc	L12EE
    2910/    12E2 : 3A 23 81            	lda	V_Index_7
    2911/    12E5 : 32 3E 80            	sta	V_CurrWF			;current WaveForm area
    2912/    12E8 : CD 62 20            	call Display_Action_5
    2913/    12EB : C3 FA 12            	jmp	L12FA
    2914/    12EE : 3A 23 81            L12EE:	lda	V_Index_7
    2915/    12F1 : 87                  	add	a					;x2
    2916/    12F2 : 87                  	add	a					;x4
    2917/    12F3 : 87                  	add	a					;x8
    2918/    12F4 : 87                  	add	a					;x16
    2919/    12F5 : F6 01               	ori	01h					;00000001
    2920/    12F7 : CD 35 20            	call AddDisplayAction
    2921/    12FA :                     L12FA:
    2922/    12FA : 21 23 81            	lxi	h,V_Index_7			;(V_Index_7)++
    2923/    12FD : 34                  	inr	m
    2924/    12FE : 11 08 00            	lxi	d,08h
    2925/    1301 : 2A 26 81            	lhld V_pWFTbl_7			;(V_pWFTbl_7) += 8
    2926/    1304 : 19                  	dad	d
    2927/    1305 : 22 26 81            	shld V_pWFTbl_7
    2928/    1308 : 3E 03               	mvi	a,03h
    2929/    130A : 21 23 81            	lxi	h,V_Index_7
    2930/    130D : BE                  	cmp	m					;3 - V_Index_7
    2931/    130E : D2 EB 11            	jnc	L11EB				;loop if V_Index_7 <= 3
    2932/    1311 : C9                  	ret
    2933/    1312 :                     ;
    2934/    1312 :                     ; Time Expand WFs if necessary
    2935/    1312 :                     ;
    2936/    1312 :                     ; in A,B,C,L
    2937/    1312 :                     ; out A
    2938/    1312 :                     ; V_RAM_Area, V_pDest_4, V_deltaTB_4, V_TargetTB_4, V_AcquiredTB_4 are local
    2939/    1312 :                     ; V_pSrc_4 local
    2940/    1312 :                     ;
    2941/    1312 :                     TimeExpandWF:
    2942/    1312 : 32 33 81            	sta	V_TargetTB_4		;save A
    2943/    1315 : 78                  	mov	a,b
    2944/    1316 : 32 34 81            	sta	V_AcquiredTB_4		;save B
    2945/    1319 : 79                  	mov	a,c
    2946/    131A : 32 37 81            	sta	V_DigitalMode_4		;save C
    2947/    131D : 7D                  	mov	a,l
    2948/    131E : 32 36 81            	sta	V_WF_4a				;save L
    2949/    1321 : 3A 34 81            	lda	V_AcquiredTB_4
    2950/    1324 : 21 33 81            	lxi	h,V_TargetTB_4
    2951/    1327 : BE                  	cmp	m					;V_AcquiredTB_4 - V_TargetTB_4. B - A
    2952/    1328 : D2 7D 14            	jnc	L147D				;exit if B >= A. Return 125 or 250
    2953/    132B : 3A 08 80            	lda	V_ACQ_Mode
    2954/    132E : E6 BF               	ani	0BFh				;10111111 Clr STORON
    2955/    1330 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    2956/    1333 : 3A 08 80            	lda	V_ACQ_Mode			;toggle STORON
    2957/    1336 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    2958/    1339 : 3A 36 81            	lda	V_WF_4a				;input arg L
    2959/    133C : 87                  	add	a					;x2
    2960/    133D : 47                  	mov	b,a					;save index*2
    2961/    133E : 68                  	mov	l,b					;compute p
    2962/    133F : 26 00               	mvi	h,00h
    2963/    1341 : 11 17 20            	lxi	d,ScratchRamTable-2
    2964/    1344 : 19                  	dad	d
    2965/    1345 : 5E                  	mov	e,m
    2966/    1346 : 23                  	inx	h
    2967/    1347 : 56                  	mov	d,m
    2968/    1348 : EB                  	xchg
    2969/    1349 : 22 28 81            	shld V_pSrc_4			;V_pSrc_4 = *(word *)p
    2970/    134C : 68                  	mov	l,b					;restore index*2
    2971/    134D : 26 00               	mvi	h,00h
    2972/    134F : 11 3E 00            	lxi	d,SYSRAM_Area-2		;Rom based Ram Areas table
    2973/    1352 : 19                  	dad	d
    2974/    1353 : 5E                  	mov	e,m					;get Ram area address
    2975/    1354 : 23                  	inx	h
    2976/    1355 : 56                  	mov	d,m
    2977/    1356 : EB                  	xchg
    2978/    1357 : 22 2C 81            	shld V_RAM_Area			;store Ram area address
    2979/    135A : 3A 33 81            	lda	V_TargetTB_4
    2980/    135D : 21 34 81            	lxi	h,V_AcquiredTB_4
    2981/    1360 : 96                  	sub	m					;V_TargetTB_4 - V_AcquiredTB_4
    2982/    1361 : 2E 06               	mvi	l,06h
    2983/    1363 : CD 9E 1E            	call Get_Smaller
    2984/    1366 : 47                  	mov	b,a					;smaller value to B
    2985/    1367 : 32 32 81            	sta	V_deltaTB_4
    2986/    136A : 78                  	mov	a,b	
    2987/    136B : 32 31 81            	sta	V_deltaTB_4_2
    2988/    136E : 3A 32 81            	lda	V_deltaTB_4
    2989/    1371 : E6 01               	ani	01h					;00000001
    2990/    1373 : 2E 00               	mvi	l,00h
    2991/    1375 : CD BF 1E            	call Test_Different		;returns boolean
    2992/    1378 : 32 38 81            	sta	V_oddFlg_4			;TRUE if V_deltaTB_4, bit 0 was 1
    2993/    137B : 3A 34 81            	lda	V_AcquiredTB_4
    2994/    137E : 3C                  	inr	a
    2995/    137F :                     ; A = remainder of (V_AcquiredTB_4+1)/3 + V_deltaTB_4
    2996/    137F :                     $$L:
    2997/    137F : D6 03               	sui	03h					;A - 3
    2998/    1381 : F2 7F 13            	jp	$$L
    2999/    1384 : C6 03               	adi	03h
    3000/    1386 : 21 32 81            	lxi	h,V_deltaTB_4		;p
    3001/    1389 : 86                  	add	m					;A += *p
    3002/    138A : 06 00               	mvi	b,00h
    3003/    138C :                     ; divide A by 3, result in B
    3004/    138C :                     $$L1:
    3005/    138C : 04                  	inr	b
    3006/    138D : D6 03               	sui	03h					;A - 3
    3007/    138F : D2 8C 13            	jnc	$$L1
    3008/    1392 : 78                  	mov	a,b					;result always >= 1
    3009/    1393 : 11 EE 1E            	lxi	d,HGAIN_Tbl1-1
    3010/    1396 : CF                  	rst	1					;Get *(DE + A)
    3011/    1397 : 32 35 81            	sta	V_LocalHGAIN_4		;save
    3012/    139A : 78                  	mov	a,b					;result again
    3013/    139B : 11 F1 1E            	lxi	d,Nr_Samples_Tbl-1
    3014/    139E : CF                  	rst	1					;Get *(DE + A)
    3015/    139F : 32 30 81            	sta	V_samplesCnt		;save. Used by Do_Interpolation and Do_Interpolation_2
    3016/    13A2 : 21 20 00            	lxi	h,020H
    3017/    13A5 : 22 2E 81            	shld V_Cnt2
    3018/    13A8 : 3A 2B 80            	lda	V_fChopped			;boolean test
    3019/    13AB : 17                  	ral
    3020/    13AC : D2 CC 13            	jnc	L13CC
    3021/    13AF : 3A 35 81            	lda	V_LocalHGAIN_4
    3022/    13B2 : 2E 01               	mvi	l,01h
    3023/    13B4 : CD 8F 1E            	call ShiftR_A_L_times
    3024/    13B7 : 32 35 81            	sta	V_LocalHGAIN_4
    3025/    13BA : 3A 30 81            	lda	V_samplesCnt
    3026/    13BD : A7                  	ana	a					;test
    3027/    13BE : C2 C2 13            	jnz	L13C2
    3028/    13C1 : 37                  	stc						;Results in 0x80
    3029/    13C2 : 1F                  L13C2:	rar					; A >> 1
    3030/    13C3 : 32 30 81            	sta	V_samplesCnt
    3031/    13C6 : 21 10 00            	lxi	h,010h
    3032/    13C9 : 22 2E 81            	shld V_Cnt2
    3033/    13CC :                     L13CC:
    3034/    13CC : 3A 38 81            	lda	V_oddFlg_4			;boolean test
    3035/    13CF : 17                  	ral
    3036/    13D0 : D2 DC 13            	jnc	L13DC
    3037/    13D3 : 2A 2C 81            	lhld V_RAM_Area
    3038/    13D6 : 22 2A 81            	shld V_pDest_4	
    3039/    13D9 : C3 E2 13            	jmp	L13E2
    3040/    13DC : 21 00 C0            L13DC:	lxi	h,RAM_ACQ
    3041/    13DF : 22 2A 81            	shld V_pDest_4
    3042/    13E2 : 2A 28 81            L13E2:	lhld V_pSrc_4
    3043/    13E5 : EB                  	xchg
    3044/    13E6 : 2A 2E 81            	lhld V_Cnt2
    3045/    13E9 : 2B                  	dcx	h
    3046/    13EA : 2B                  	dcx	h
    3047/    13EB : 2B                  	dcx	h
    3048/    13EC : 2B                  	dcx	h
    3049/    13ED : 19                  	dad	d
    3050/    13EE : EB                  	xchg
    3051/    13EF : 2A 2A 81            	lhld V_pDest_4
    3052/    13F2 : EB                  	xchg
    3053/    13F3 : 3A 37 81            	lda	V_DigitalMode_4
    3054/    13F6 : 47                  	mov	b,a
    3055/    13F7 : 3A 30 81            	lda	V_samplesCnt
    3056/    13FA : CD CF 06            	call Do_Interpolation
    3057/    13FD : 21 31 81            	lxi	h,V_deltaTB_4_2
    3058/    1400 : 35                  	dcr	m
    3059/    1401 : 3A 31 81            	lda	V_deltaTB_4_2
    3060/    1404 : FE 00               	cpi	00h
    3061/    1406 : CA 76 14            	jz	L1476
    3062/    1409 : 2A 2A 81            	lhld V_pDest_4
    3063/    140C : 22 28 81            	shld V_pSrc_4
    3064/    140F : 3A 38 81            	lda	V_oddFlg_4
    3065/    1412 : 17                  	ral
    3066/    1413 : D2 1F 14            	jnc	L141F
    3067/    1416 : 21 00 C0            	lxi	h,RAM_ACQ
    3068/    1419 : 22 2A 81            	shld V_pDest_4
    3069/    141C : C3 25 14            	jmp	L1425x
    3070/    141F : 2A 2C 81            L141F:	lhld V_RAM_Area
    3071/    1422 : 22 2A 81            	shld V_pDest_4
    3072/    1425 : 2A 28 81            L1425x:	lhld V_pSrc_4
    3073/    1428 : EB                  	xchg
    3074/    1429 : 2A 2E 81            	lhld V_Cnt2
    3075/    142C : 2B                  	dcx	h
    3076/    142D : 19                  	dad	d
    3077/    142E : EB                  	xchg
    3078/    142F : 2A 2A 81            	lhld V_pDest_4
    3079/    1432 : EB                  	xchg
    3080/    1433 : 3A 37 81            	lda	V_DigitalMode_4
    3081/    1436 : 47                  	mov	b,a
    3082/    1437 : 3A 30 81            	lda	V_samplesCnt
    3083/    143A : CD FA 06            	call Do_Interpolation_2
    3084/    143D : 21 31 81            	lxi	h,V_deltaTB_4_2
    3085/    1440 : 35                  	dcr	m
    3086/    1441 : 3A 31 81            Local1441:	lda	V_deltaTB_4_2
    3087/    1444 : FE 00               	cpi	00h		
    3088/    1446 : CA 76 14            	jz	L1476
    3089/    1449 : 2A 28 81            	lhld V_pSrc_4
    3090/    144C : EB                  	xchg
    3091/    144D : 2A 2A 81            	lhld V_pDest_4
    3092/    1450 : 22 28 81            	shld V_pSrc_4
    3093/    1453 : EB                  	xchg
    3094/    1454 : 22 2A 81            	shld V_pDest_4
    3095/    1457 : 2A 28 81            	lhld V_pSrc_4
    3096/    145A : EB                  	xchg
    3097/    145B : 2A 2E 81            	lhld V_Cnt2
    3098/    145E : 2B                  	dcx	h
    3099/    145F : 19                  	dad	d
    3100/    1460 : EB                  	xchg
    3101/    1461 : 2A 2A 81            	lhld V_pDest_4
    3102/    1464 : EB                  	xchg
    3103/    1465 : 3A 37 81            	lda	V_DigitalMode_4
    3104/    1468 : 47                  	mov	b,a
    3105/    1469 : 3A 30 81            	lda	V_samplesCnt
    3106/    146C : CD FA 06            	call Do_Interpolation_2
    3107/    146F : 21 31 81            	lxi	h,V_deltaTB_4_2
    3108/    1472 : 35                  	dcr	m
    3109/    1473 : C3 41 14            	jmp	Local1441
    3110/    1476 : 3A 35 81            L1476:	lda	V_LocalHGAIN_4
    3111/    1479 : C9                  	ret
    3112/    147A : C3 8D 14            	jmp	ComputeVGAIN
    3113/    147D : 3A 2B 80            L147D:	lda	V_fChopped
    3114/    1480 : 17                  	ral
    3115/    1481 : D2 8A 14            	jnc	L148A
    3116/    1484 : 3E 7D               	mvi	a,7Dh				;125
    3117/    1486 : C9                  	ret
    3118/    1487 : C3 8D 14            	jmp	ComputeVGAIN
    3119/    148A : 3E FA               L148A:	mvi	a,0FAh			;250
    3120/    148C : C9                  	ret
    3121/    148D :                     ;
    3122/    148D :                     ; in A, B
    3123/    148D :                     ; out A
    3124/    148D :                     ;	
    3125/    148D :                     ComputeVGAIN:
    3126/    148D : E6 1F               	ani	1Fh					;00011111 mod 32
    3127/    148F : 4F                  	mov	c,a					;save
    3128/    1490 : 78                  	mov	a,b
    3129/    1491 : E6 1F               	ani	1Fh					;00011111 mod 32
    3130/    1493 : 57                  	mov	d,a					;save
    3131/    1494 : FE 04               	cpi	04h
    3132/    1496 : D2 9B 14            	jnc	L149B
    3133/    1499 : 16 04               	mvi	d,04h				;if A > 4
    3134/    149B : 7A                  L149B:	mov	a,d				;A now <= 4
    3135/    149C : 91                  	sub	c
    3136/    149D : FA BC 14            	jm	L14BC
    3137/    14A0 : CA BC 14            	jz	L14BC
    3138/    14A3 : FE 03               	cpi	03h
    3139/    14A5 : DA AA 14            	jc	L14AA
    3140/    14A8 : 3E 03               	mvi	a,03h				;if A < 3
    3141/    14AA : 47                  L14AA:	mov	b,a				;B [Delta] now 1,2 or 3
    3142/    14AB : 7A                  	mov	a,d
    3143/    14AC : D6 03               L14AC:	sui	03h				;repeatedly subtract 3
    3144/    14AE : F2 AC 14            	jp	L14AC				;until A < 0
    3145/    14B1 : C6 03               	adi	03h					;now 0..2
    3146/    14B3 : 4F                  	mov	c,a
    3147/    14B4 : 87                  	add	a					;x2
    3148/    14B5 : 81                  	add	c					;x3
    3149/    14B6 : 80                  	add	b					;+B 
    3150/    14B7 : 11 F4 1E            	lxi	d,VGAIN_Tbl-1		;9 entries
    3151/    14BA : CF                  	rst	1					;Get *(DE + A)
    3152/    14BB : C9                  	ret
    3153/    14BC :                     L14BC:
    3154/    14BC : 3E F0               	mvi	a,0F0h				;11110000
    3155/    14BE : C9                  	ret
    3156/    14BF :                     ;
    3157/    14BF :                     ; in A. From AddMainAction: "add action A to action queue"
    3158/    14BF :                     ; this process cannot be interrupted while adding to the Action queue
    3159/    14BF :                     ; V_MainActionStart and V_MainActionEnd are initiallized to 1 (means nothing in table)
    3160/    14BF :                     ;
    3161/    14BF :                     AddMainAction_0:
    3162/    14BF : 4F                  	mov	c,a					;move action code to C
    3163/    14C0 : 20                  	rim						;read interrupt mask
    3164/    14C1 : F3                  	di
    3165/    14C2 : 32 3A 81            	sta	V_Saved_Int_Mask_2
    3166/    14C5 : 11 44 80            	lxi	d,V_MainActionTbl-1		;Action Table ptr. Index 1-16
    3167/    14C8 : 3A 43 80            	lda	V_MainActionEnd		;table end index
    3168/    14CB : 47                  	mov	b,a
    3169/    14CC : 3A 44 80            	lda	V_MainActionStart	;table start index.
    3170/    14CF : 32 3B 81            	sta	V_ActionLoopIdx		;loop index
    3171/    14D2 :                     $$L:
    3172/    14D2 : 3A 3B 81            	lda	V_ActionLoopIdx		;load loop index
    3173/    14D5 : B8                  	cmp	b					;compare to end index
    3174/    14D6 : CA E7 14            	jz	L14E7				;same. end of table reached
    3175/    14D9 : E6 0F               	ani	0Fh					;Circular buffer index
    3176/    14DB : 3C                  	inr	a					;range 1-16
    3177/    14DC : 32 3B 81            	sta	V_ActionLoopIdx		;save loop index
    3178/    14DF : CF                  	rst	1					;Get *(DE + A)
    3179/    14E0 : B9                  	cmp	c					;Compare with input action code
    3180/    14E1 : CA FB 14            	jz	L14FB				;done if match. C already in table
    3181/    14E4 : C3 D2 14            	jmp	$$L					;loop
    3182/    14E7 :                     L14E7:						;no match. Add action to table
    3183/    14E7 : 78                  	mov	a,b					;ring buffer end index.
    3184/    14E8 : E6 0F               	ani	0Fh
    3185/    14EA : 3C                  	inr	a
    3186/    14EB : 32 43 80            	sta	V_MainActionEnd		;update table end index
    3187/    14EE : 21 44 80            	lxi	h,V_MainActionStart	;table start index ptr
    3188/    14F1 : BE                  	cmp	m					;overflow if the same
    3189/    14F2 : C2 F6 14            	jnz	L14F6
    3190/    14F5 : F7                  	rst	6					;HALT
    3191/    14F6 : 6F                  L14F6:	mov	l,a				;compute ptr to new action entry
    3192/    14F7 : 26 00               	mvi	h,00h
    3193/    14F9 : 19                  	dad	d
    3194/    14FA : 71                  	mov	m,c					;add action to Action table
    3195/    14FB : 3A 3A 81            L14FB:	lda	V_Saved_Int_Mask_2
    3196/    14FE : E6 08               	ani	08h					;check if interrupts were enabled before (IE = bit 3)
    3197/    1500 : CA 04 15            	jz	L1504
    3198/    1503 : FB                  	ei
    3199/    1504 : C9                  L1504:	ret
    3200/    1505 :                     ;
    3201/    1505 :                     ; init Action Table
    3202/    1505 :                     ;
    3203/    1505 : 3E 01               Init_Action_Table:	mvi	a,01h
    3204/    1507 : 32 44 80            	sta	V_MainActionStart
    3205/    150A : 3E 01               	mvi	a,01h	
    3206/    150C : 32 43 80            	sta	V_MainActionEnd
    3207/    150F : C9                  	ret
    3208/    1510 :                     ;
    3209/    1510 :                     ; lots of WaveForm copying if SAVEREF pushed
    3210/    1510 :                     ;	
    3211/    1510 :                     Display_Action_6_0:
    3212/    1510 : 3A 0F 80            	lda	V_fSAVEREFPushed	;boolean test
    3213/    1513 : 17                  	ral
    3214/    1514 : D2 02 16            	jnc	L1602	
    3215/    1517 : CD DB 0F            	call GetWFArea		;returns 1 or 3 in A
    3216/    151A : 32 59 81            	sta	V_WF_6				;V_WF_6 is local
    3217/    151D : 3A 59 81            	lda	V_WF_6
    3218/    1520 : EE 02               	xri	02h					;^00000010: 1->3 3->1
    3219/    1522 : 32 5A 81            	sta	V_FlippedWF_6		;V_FlippedWF_6 is local
    3220/    1525 : 3A 59 81            	lda	V_WF_6				;1 or 3
    3221/    1528 : 11 1F 20            	lxi	d,DisplayRamTable-2	;A = base 1
    3222/    152B : CD 4F 00            	call Get_Word_From_Table
    3223/    152E : E5                  	push h
    3224/    152F : 3A 5A 81            	lda	V_FlippedWF_6		;flipped result
    3225/    1532 : 11 1F 20            	lxi	d,DisplayRamTable-2	;A = base 1
    3226/    1535 : CD 4F 00            	call Get_Word_From_Table
    3227/    1538 : D1                  	pop	d
    3228/    1539 : 01 00 04            	lxi	b,0400H				;copy 2 WaveForms
    3229/    153C : CD 6D 1E            	call Copy_Bytes 		; 1024 bytes *DE to *HL
    3230/    153F : 3A 59 81            	lda	V_WF_6				;1 or 3
    3231/    1542 : 11 17 20            	lxi	d,ScratchRamTable-2
    3232/    1545 : CD 4F 00            	call Get_Word_From_Table
    3233/    1548 : E5                  	push h
    3234/    1549 : 3A 5A 81            	lda	V_FlippedWF_6		;flipped result
    3235/    154C : 11 17 20            	lxi	d,ScratchRamTable-2
    3236/    154F : CD 4F 00            	call Get_Word_From_Table
    3237/    1552 : D1                  	pop	d
    3238/    1553 : 01 00 02            	lxi	b,0200H				;copy 1 waveform
    3239/    1556 : CD 6D 1E            	call Copy_Bytes  		; 512 bytes *DE to *HL
    3240/    1559 : 2A 59 81            	lhld V_WF_6				;LSB only 1 or 3. Ignore MSB
    3241/    155C : 2D                  	dcr	l					;base 0
    3242/    155D : 7D                  	mov	a,l
    3243/    155E : 2E 03               	mvi	l,03h
    3244/    1560 : CD 78 1E            	call ShiftL_A_L_times	;times 8
    3245/    1563 : 3C                  	inr	a					;+1
    3246/    1564 : 6F                  	mov	l,a					;compute table ptr
    3247/    1565 : 26 00               	mvi	h,00h
    3248/    1567 : 11 7E 80            	lxi	d,V_WFTable-1
    3249/    156A : 19                  	dad	d
    3250/    156B : 22 5D 81            	shld V_Ptr1_6			;V_Ptr1_6 is local: &V_WFTable[V_WF_6]
    3251/    156E : 2A 5A 81            	lhld V_FlippedWF_6		;flipped result
    3252/    1571 : 2D                  	dcr	l
    3253/    1572 : 7D                  	mov	a,l
    3254/    1573 : 2E 03               	mvi	l,03h
    3255/    1575 : CD 78 1E            	call ShiftL_A_L_times	;times 8
    3256/    1578 : 3C                  	inr	a					;+1
    3257/    1579 : 6F                  	mov	l,a					;compute table ptr
    3258/    157A : 26 00               	mvi	h,00h
    3259/    157C : 11 7E 80            	lxi	d,V_WFTable-1
    3260/    157F : 19                  	dad	d
    3261/    1580 : 22 5F 81            	shld V_Ptr2_6			;V_Ptr2_6 is local: &V_WFTable[V_FlippedWF_6]
    3262/    1583 : 2A 5D 81            	lhld V_Ptr1_6			;p
    3263/    1586 : 23                  	inx	h					;p += 5: S_STATUS
    3264/    1587 : 23                  	inx	h
    3265/    1588 : 23                  	inx	h
    3266/    1589 : 23                  	inx	h
    3267/    158A : 23                  	inx	h
    3268/    158B : 7E                  	mov	a,m					;V_WFTable[V_WF_6].S_STATUS
    3269/    158C : E6 04               	ani	04h					;00000100 LONGWFMASK
    3270/    158E : FE 04               	cpi	04h					;test bit 2
    3271/    1590 : C2 9F 15            	jnz	L159F
    3272/    1593 : 3E 08               	mvi	a,8
    3273/    1595 : 32 5B 81            	sta	V_CopySize_6		;V_CopySize_6 is local
    3274/    1598 : AF                  	xra	a
    3275/    1599 : 32 5C 81            	sta	V_Flg_6				;V_Flg_6 is local
    3276/    159C : C3 A9 15            	jmp	L15A9
    3277/    159F : 3E 10               L159F:	mvi	a,16
    3278/    15A1 : 32 5B 81            	sta	V_CopySize_6
    3279/    15A4 : 3E FF               	mvi	a,0FFh
    3280/    15A6 : 32 5C 81            	sta	V_Flg_6
    3281/    15A9 :                     L15A9:
    3282/    15A9 : 2A 5D 81            	lhld V_Ptr1_6
    3283/    15AC : EB                  	xchg
    3284/    15AD : 2A 5F 81            	lhld V_Ptr2_6
    3285/    15B0 : 3A 5B 81            	lda	V_CopySize_6
    3286/    15B3 : 4F                  	mov	c,a
    3287/    15B4 : 06 00               	mvi	b,00h
    3288/    15B6 : CD 6D 1E            	call Copy_Bytes 		;BC bytes *DE to *HL
    3289/    15B9 : 3E FF               	mvi	a,0FFh
    3290/    15BB : 32 A1 80            	sta	V_ValidWFs+2		;set to TRUE
    3291/    15BE : 3E FF               	mvi	a,0FFh	
    3292/    15C0 : 32 9F 80            	sta	V_ValidWFs			;set to TRUE
    3293/    15C3 : 3A 5C 81            	lda	V_Flg_6
    3294/    15C6 : 32 A2 80            	sta	V_ValidWFs+3
    3295/    15C9 : 3A 5C 81            	lda	V_Flg_6
    3296/    15CC : 32 A0 80            	sta	V_ValidWFs+1
    3297/    15CF :                     ; set bit 7 in V_WFTable+1[3].field
    3298/    15CF : 21 8F 80            	lxi	h,V_WFTable+2*WFENTRYSIZE
    3299/    15D2 : 23                  	inx	h					;p += 4
    3300/    15D3 : 23                  	inx	h
    3301/    15D4 : 23                  	inx	h
    3302/    15D5 : 23                  	inx	h
    3303/    15D6 : EB                  	xchg
    3304/    15D7 : 62                  	mov	h,d					;HL = DE
    3305/    15D8 : 6B                  	mov	l,e
    3306/    15D9 : 7E                  	mov	a,m					;*p
    3307/    15DA : F6 80               	ori	80h					;10000000	bit 7
    3308/    15DC : EB                  	xchg
    3309/    15DD : 77                  	mov	m,a					;update memory
    3310/    15DE : 3A 5C 81            	lda	V_Flg_6				;boolean test
    3311/    15E1 : 17                  	ral
    3312/    15E2 : D2 F4 15            	jnc	L15F4
    3313/    15E5 :                     ; set bit 7 in V_WFTable+1[4].field	
    3314/    15E5 : 21 97 80            	lxi	h,V_WFTable+3*WFENTRYSIZE ;ptr to first byte of fourth entry
    3315/    15E8 : 23                  	inx	h					;p += 4
    3316/    15E9 : 23                  	inx	h
    3317/    15EA : 23                  	inx	h
    3318/    15EB : 23                  	inx	h
    3319/    15EC : EB                  	xchg
    3320/    15ED : 62                  	mov	h,d					;HL = DE
    3321/    15EE : 6B                  	mov	l,e
    3322/    15EF : 7E                  	mov	a,m					;*p
    3323/    15F0 : F6 80               	ori	80h					;10000000 bit 7
    3324/    15F2 : EB                  	xchg					;HL,DE identical
    3325/    15F3 : 77                  	mov	m,a					;update memory
    3326/    15F4 :                     L15F4:
    3327/    15F4 : 3E 07               	mvi	a,MAIN_ACTION_7_ID
    3328/    15F6 : CD 49 00            	call AddMainAction
    3329/    15F9 : AF                  	xra	a
    3330/    15FA : 32 0F 80            	sta	V_fSAVEREFPushed	;clear V_fSAVEREFPushed Flag
    3331/    15FD : 3E FF               	mvi	a,0FFh
    3332/    15FF : 32 A6 80            	sta	V_fSAVEREFShowing	;set to TRUE
    3333/    1602 :                     L1602:
    3334/    1602 : C9                  	ret
    3335/    1603 :                     ;
    3336/    1603 :                     ; V_WFTable is a table of 4 entries, each entry 8 bytes, related to Displaying the WaveForm
    3337/    1603 :                     ; P1 not aligned with start of table
    3338/    1603 :                     ; Loop through table, test bit 7 field x, clear field y and corresponding WFBooleans if set
    3339/    1603 :                     ;	
    3340/    1603 :                     RemoveREFWFfromWFTbl:
    3341/    1603 : 06 04               	mvi	b,04h				;loop 4 times 4,3,2,1
    3342/    1605 : 21 83 80            	lxi	h,V_WFTable+4		;p1
    3343/    1608 : 11 9F 80            	lxi	d,V_ValidWFs 		;p2
    3344/    160B : 7E                  L160B:	mov	a,m				;*p1
    3345/    160C : A7                  	ana	a					;test bit 7
    3346/    160D : F2 22 16            	jp	L1622_0				;jmp if bit 7 clr
    3347/    1610 : E6 7F               	ani	7Fh					;01111111 Clear bit 7
    3348/    1612 : 77                  	mov	m,a					;V_WFTbl[x].S_CHANMODE
    3349/    1613 : 23                  	inx	h					;++p1
    3350/    1614 : 7E                  	mov	a,m					;update V_WFTbl[x].S_STATUS
    3351/    1615 : F6 80               	ori	80h					;10000000 Set bit 7
    3352/    1617 : 77                  	mov	m,a					;update *p1
    3353/    1618 : 2B                  	dcx	h
    3354/    1619 : 2B                  	dcx	h
    3355/    161A : 2B                  	dcx	h
    3356/    161B : 2B                  	dcx	h
    3357/    161C : AF                  	xra	a
    3358/    161D : 77                  	mov	m,a					;V_WFTable[x].S_GNDREF = 0
    3359/    161E : 23                  	inx	h					;--p1 (back to S_CHANMODE)
    3360/    161F : 23                  	inx	h
    3361/    1620 : 23                  	inx	h
    3362/    1621 : 12                  	stax d					;V_ValidWFs[x] = FALSE
    3363/    1622 :                     L1622_0:
    3364/    1622 : 13                  	inx	d					;++p2
    3365/    1623 : 78                  	mov	a,b					;save loop cntr
    3366/    1624 : 01 08 00            	lxi	b,08h
    3367/    1627 : 09                  	dad	b					;p1 += 8 next entry
    3368/    1628 : 47                  	mov	b,a					;restore
    3369/    1629 : 05                  	dcr	b
    3370/    162A : C2 0B 16            	jnz	L160B
    3371/    162D :                     ;	
    3372/    162D : 3A 20 80            	lda	V_fADD
    3373/    1630 : 67                  	mov	h,a
    3374/    1631 : 3A 1E 80            	lda	V_fCH1
    3375/    1634 : 47                  	mov	b,a
    3376/    1635 : 3A 1F 80            	lda	V_fCH2
    3377/    1638 : B0                  	ora	b
    3378/    1639 : A4                  	ana	h
    3379/    163A : CA 5C 16            	jz	L165C
    3380/    163D :                     ;
    3381/    163D :                     ; copy entry 3 to entry 1 (base 1)
    3382/    163D :                     ;
    3383/    163D : 21 8F 80            	lxi	h,V_WFTable+2*WFENTRYSIZE
    3384/    1640 : 11 7F 80            	lxi	d,V_WFTable
    3385/    1643 : 01 08 00            	lxi	b,WFENTRYSIZE
    3386/    1646 : CD 6D 1E            	call Copy_Bytes  		;8 bytes *DE to *HL
    3387/    1649 : AF                  	xra	a
    3388/    164A : 32 9F 80            	sta	V_ValidWFs			;V_ValidWFs = V_ValidWFs+1 = FALSE;
    3389/    164D : 32 A0 80            	sta	V_ValidWFs+1
    3390/    1650 :                     ;
    3391/    1650 :                     ; Clr Table[0] S_GNDREF and Table[1] S_GNDREF
    3392/    1650 :                     ;
    3393/    1650 :                     xxxx
    3394/    1650 : 21 80 80            	lxi	h,V_WFTable+S_GNDREF ;p = &V_WFTable+S_GNDREF
    3395/    1653 : 77                  	mov	m,a					;*p = 0
    3396/    1654 : 21 88 80            	lxi	h,V_WFTable+WFENTRYSIZE+S_GNDREF ;p = &V_WFTable+WFENTRYSIZE+S_GNDREF
    3397/    1657 : 77                  	mov	m,a					;*p = 0
    3398/    1658 : 2F                  	cma						;0->0xff
    3399/    1659 : 32 A1 80            	sta	V_ValidWFs+2		;V_ValidWFs+2 = TRUE
    3400/    165C :                     L165C:
    3401/    165C : 3E 07               	mvi	a,MAIN_ACTION_7_ID
    3402/    165E : CD 49 00            	call AddMainAction
    3403/    1661 : C9                  	ret
    3404/    1662 :                     ;
    3405/    1662 :                     ; Remove certain GPIB entries from the Action Buffer
    3406/    1662 :                     ;	
    3407/    1662 :                     Remove_GPIB_Actions_0:		;from ROM575	
    3408/    1662 : AF                  	xra	a
    3409/    1663 : 32 62 81            	sta	V_Lcl_fActionRemoved ;set to FALSE
    3410/    1666 : 3A 44 80            	lda	V_MainActionStart	;starts at 1
    3411/    1669 :                     L1669:
    3412/    1669 : 47                  	mov	b,a
    3413/    166A : 21 43 80            	lxi	h,V_MainActionEnd
    3414/    166D : BE                  	cmp	m					;end index
    3415/    166E : CA 97 16            	jz	L1697				;jump if reached
    3416/    1671 : 11 44 80            	lxi	d,V_MainActionTbl-1
    3417/    1674 : CF                  	rst	1					;Get *(DE + A). HL points to entry
    3418/    1675 : FE 80               	cpi	80h					;A-0x80
    3419/    1677 : DA 90 16            	jc	L1690				;skip if A < 0x80 (not GPIB)
    3420/    167A : 4F                  	mov	c,a					;A >= 0x80. Save
    3421/    167B : 3A 62 81            	lda	V_Lcl_fActionRemoved
    3422/    167E : A7                  	ana	a					;Boolean test
    3423/    167F : FA 8E 16            	jm	L168E
    3424/    1682 : 3E FF               	mvi	a,0FFh				;set to TRUE
    3425/    1684 : 32 0D 80            	sta	V_GPIB_ActionWasRemoved	;GPIB related
    3426/    1687 : 32 62 81            	sta	V_Lcl_fActionRemoved
    3427/    168A : 79                  	mov	a,c
    3428/    168B : 32 0E 80            	sta	VAR_800E
    3429/    168E : 36 00               L168E:	mvi	m,00h			;clear table entry
    3430/    1690 : 78                  L1690:	mov	a,b
    3431/    1691 : E6 0F               	ani	0Fh					;mod 16
    3432/    1693 : 3C                  	inr	a
    3433/    1694 : C3 69 16            	jmp	L1669				;loop
    3434/    1697 : C9                  L1697:	ret
    3435/    1698 :                     ;
    3436/    1698 :                     ; input A, DE. Output HL
    3437/    1698 :                     ;
    3438/    1698 :                     Get_Word_From_Table_0:
    3439/    1698 : 87                  	add	a					;x2
    3440/    1699 : 6F                  	mov	l,a
    3441/    169A : 26 00               	mvi	h,00h
    3442/    169C : 19                  	dad	d					;HL = DE + 2 * A
    3443/    169D : 5E                  	mov	e,m					;get word from table in DE
    3444/    169E : 23                  	inx	h
    3445/    169F : 56                  	mov	d,m
    3446/    16A0 : EB                  	xchg					;HL <-> DE
    3447/    16A1 : C9                  	ret
    3448/    16A2 :                     ;
    3449/    16A2 :                     ; Update Numeric Display Window. Called from Timer
    3450/    16A2 :                     ;	
    3451/    16A2 :                     RefreshNumWin:
    3452/    16A2 : 3A 81 81            	lda	V_LED_Digit			;range 1..4
    3453/    16A5 : E6 03               	ani	03h
    3454/    16A7 : 3C                  	inr	a
    3455/    16A8 : 32 81 81            	sta	V_LED_Digit
    3456/    16AB : 5F                  	mov	e,a					;save
    3457/    16AC : 21 32 80            	lxi	h,V_DecPntDigit
    3458/    16AF : BE                  	cmp	m
    3459/    16B0 : 3A 33 80            	lda	V_Curr_LEDRO
    3460/    16B3 : C2 B8 16            	jnz	L16B8
    3461/    16B6 : F6 10               	ori	10h					;00010000 set bit 4: Decimal Point
    3462/    16B8 : 47                  L16B8:	mov	b,a
    3463/    16B9 : 32 44 E0            	sta	DEV_LEDRO
    3464/    16BC : 16 00               	mvi	d,00h
    3465/    16BE : 21 2D 80            	lxi	h,V_NumWinBuf-1
    3466/    16C1 : 19                  	dad	d					;E is stil V_LED_Digit
    3467/    16C2 : 7E                  	mov	a,m					;get value
    3468/    16C3 : 32 45 E0            	sta	DEV_SVNSEG
    3469/    16C6 : 1D                  	dcr	e				
    3470/    16C7 : 3E 01               	mvi	a,01h
    3471/    16C9 : CA D1 16            	jz	L16D1
    3472/    16CC :                     ;loop E-1 times	
    3473/    16CC : 87                  L16CC:	add	a
    3474/    16CD : 1D                  	dcr	e
    3475/    16CE : C2 CC 16            	jnz	L16CC
    3476/    16D1 : B0                  L16D1:	ora	b
    3477/    16D2 : 32 44 E0            	sta	DEV_LEDRO
    3478/    16D5 : C9                  	ret
    3479/    16D6 :                     ;
    3480/    16D6 :                     ; init function. 
    3481/    16D6 :                     ;	
    3482/    16D6 :                     ClrNumWin:
    3483/    16D6 : 3E F0               	mvi	a,0F0h				;11110000
    3484/    16D8 : 32 44 E0            	sta	DEV_LEDRO
    3485/    16DB :                     ;
    3486/    16DB :                     ;     List of assignments for LEDRO
    3487/    16DB :                     ;             01 IS DIGIT 1 MSD
    3488/    16DB :                     ;             02 IS 2ND MSD
    3489/    16DB :                     ;             04 IS 3RD MSD
    3490/    16DB :                     ;             08 IS LSD
    3491/    16DB :                     ;             10 IS DECIMAL POINT
    3492/    16DB :                     ;             20 IS SCALE TOP
    3493/    16DB :                     ;             40 IS SCALE MIDDLE
    3494/    16DB :                     ;             80 IS SCALE BOTTOM
    3495/    16DB :                     ;
    3496/    16DB : 3E FF               	mvi	a,0FFh
    3497/    16DD : 32 31 80            	sta	V_NumWinBuf+3
    3498/    16E0 : 3E FF               	mvi	a,0FFh
    3499/    16E2 : 32 30 80            	sta	V_NumWinBuf+2
    3500/    16E5 : 3E FF               	mvi	a,0FFh
    3501/    16E7 : 32 2F 80            	sta	V_NumWinBuf+1
    3502/    16EA : 3E FF               	mvi	a,0FFh
    3503/    16EC : 32 2E 80            	sta	V_NumWinBuf
    3504/    16EF : 3E E0               	mvi	a,0E0h				;00001110
    3505/    16F1 : 32 33 80            	sta	V_Curr_LEDRO
    3506/    16F4 : 3E 05               	mvi	a,05h
    3507/    16F6 : 32 32 80            	sta	V_DecPntDigit
    3508/    16F9 : C9                  	ret
    3509/    16FA :                     ;
    3510/    16FA :                     ; Test for Acquisition Complete
    3511/    16FA :                     ;
    3512/    16FA :                     Main_Action_3:
    3513/    16FA : F3                  	di
    3514/    16FB : 3A 0F 80            	lda	V_fSAVEREFPushed	;boolean test
    3515/    16FE : 17                  	ral
    3516/    16FF : D2 12 17            	jnc	L1712	
    3517/    1702 : 3A A5 80            	lda	V_DigitalMode
    3518/    1705 : FE 02               	cpi	DIGITAL_ENV
    3519/    1707 : CA 12 17            	jz	L1712	
    3520/    170A : 3A A5 80            	lda	V_DigitalMode
    3521/    170D : FE 03               	cpi	DIGITAL_AVG
    3522/    170F : C2 15 17            	jnz	L1715
    3523/    1712 : C3 20 17            L1712:	jmp	L1720
    3524/    1715 :                     ;
    3525/    1715 :                     ; (V_DigitalMode != DIGITAL_ENV) && (V_DigitalMode != DIGITAL_AVG)
    3526/    1715 :                     ;
    3527/    1715 : 3A 07 E4            L1715:	lda	DEV_STOPDIS		;reading causes Display to stop
    3528/    1718 : 3E 06               	mvi	a,06h
    3529/    171A : CD 35 20            	call AddDisplayAction
    3530/    171D : CD 29 20            	call Display_Interrupt
    3531/    1720 : FB                  L1720:	ei
    3532/    1721 : 3A 01 80            	lda	V_fOK2ProcessAcq	;boolean test
    3533/    1724 : 17                  	ral
    3534/    1725 : D2 32 17            	jnc	L1732
    3535/    1728 : 3A 04 E2            	lda	DEV_RDSTAT			;Time Base Status Register
    3536/    172B : E6 01               	ani	01h					;00000001 ACQUIRE (Active Low)
    3537/    172D : FE 01               	cpi	01h
    3538/    172F : CA 35 17            	jz	L1735				;jmp if not active
    3539/    1732 : C3 4D 17            L1732:	jmp	L174D
    3540/    1735 : 3A 2B 80            L1735:	lda	V_fChopped		;boolean test
    3541/    1738 : 17                  	ral
    3542/    1739 : D2 45 17            	jnc	L1745
    3543/    173C : 3E FE               	mvi	a,0FEh				;11111110 Clr CH2
    3544/    173E : 21 08 80            	lxi	h,V_ACQ_Mode
    3545/    1741 : A6                  	ana	m
    3546/    1742 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    3547/    1745 :                     L1745:
    3548/    1745 : 3E 04               	mvi	a,MAIN_ACTION_4_ID
    3549/    1747 : CD 49 00            	call AddMainAction
    3550/    174A : C3 52 17            	jmp	L1752
    3551/    174D :                     L174D:
    3552/    174D : 3E 03               	mvi	a,MAIN_ACTION_3_ID
    3553/    174F : CD 49 00            	call AddMainAction
    3554/    1752 : C9                  L1752:	ret
    3555/    1753 :                     ;
    3556/    1753 :                     ; Program Start. No real stack yet.
    3557/    1753 :                     ;
    3558/    1753 :                     Start:
    3559/    1753 : 00                  	nop
    3560/    1754 : 00                  	nop
    3561/    1755 : 00                  	nop
    3562/    1756 : 21 FC 1F            	lxi	h,L1FFC				;end of ROM565
    3563/    1759 : 11 FF FF            	lxi	d,0FFFFh
    3564/    175C : 01 FF 1F            	lxi	b,01FFFh			;C = end byte address. B = MSB of ROM checksum address
    3565/    175F : 4A                  	mov	c,d
    3566/    1760 : 31 69 17            	lxi	sp,L1769			;continuation address
    3567/    1763 :                     ;
    3568/    1763 :                     ; validate check bytes. Entered twice, once for each ROM
    3569/    1763 :                     ; HL points to end of ROM to test
    3570/    1763 :                     ;	
    3571/    1763 :                     ROM_Signature:
    3572/    1763 : 7E                  	mov	a,m					;get check value 0x01
    3573/    1764 : 23                  	inx	h					;p++
    3574/    1765 : AE                  	xra	m					;xor with 0xfe -> 0xff
    3575/    1766 : 3C                  	inr	a					; -> 0
    3576/    1767 : C8                  	rz						;ok, continue
    3577/    1768 : 76                  	hlt						;fail
    3578/    1769 : 6B 17               L1769:	dw	L176B			;continuation address
    3579/    176B :                     ;
    3580/    176B :                     ; checksum
    3581/    176B :                     ;	HL = L1FFC+1 of L3FFC+1
    3582/    176B :                     ;	BC = 0x1fff or 0x3f1f
    3583/    176B :                     ;
    3584/    176B :                     L176B:
    3585/    176B : 31 93 17            	lxi	sp,L1793			;continuation address
    3586/    176E :                     ;
    3587/    176E :                     ; entered twice, once for each ROM
    3588/    176E :                     ; check 0x100 or 0xe0 bytes
    3589/    176E :                     ;
    3590/    176E :                     ROM_Checksum:
    3591/    176E : 11 00 00            	lxi	d,0000h				;running checksum
    3592/    1771 :                     L1771:
    3593/    1771 : 37                  	stc						;clr carry
    3594/    1772 : 3F                  	cmc
    3595/    1773 : EB                  	xchg
    3596/    1774 : 29                  	dad	h
    3597/    1775 : EB                  	xchg					;DE = 2 x DE
    3598/    1776 : 7E                  	mov	a,m
    3599/    1777 : 8B                  	adc	e
    3600/    1778 : 5F                  	mov	e,a
    3601/    1779 : D2 7D 17            	jnc	L177D
    3602/    177C : 14                  	inr	d
    3603/    177D : 2B                  L177D:	dcx	h				;p--
    3604/    177E : 7C                  	mov	a,h
    3605/    177F : B9                  	cmp	c
    3606/    1780 : C2 71 17            	jnz	L1771				;loop until H == C
    3607/    1783 : 60                  	mov	h,b					;0x1ffe or 0x3ffe
    3608/    1784 : 2E FE               	mvi	l,0FEh
    3609/    1786 : 7E                  	mov	a,m					;compare DE with *(word *)HL
    3610/    1787 : BB                  	cmp	e
    3611/    1788 : 23                  	inx	h
    3612/    1789 : C2 8F 17            	jnz	L178F
    3613/    178C : 7E                  	mov	a,m
    3614/    178D : BA                  	cmp	d
    3615/    178E : C8                  	rz						;continue
    3616/    178F :                     ;
    3617/    178F :                     ; FAIL
    3618/    178F :                     ;
    3619/    178F :                     L178F:
    3620/    178F : 72                  	mov	m,d					;store DE
    3621/    1790 : 2B                  	dcx	h
    3622/    1791 : 73                  	mov	m,e
    3623/    1792 : 76                  	hlt						;fail
    3624/    1793 : 95 17               L1793:	dw	L1795			;continuation address
    3625/    1795 :                     ;
    3626/    1795 :                     L1795:
    3627/    1795 : 21 FC 3F            	lxi	h,L3FFC				;end of ROM575
    3628/    1798 : 11 FF 1F            	lxi	d,01FFFh
    3629/    179B : 01 FF 3F            	lxi	b,03FFFh			;C = end byte address. B = MSB of ROM checksum address
    3630/    179E : 4A                  	mov	c,d	
    3631/    179F : 31 A5 17            	lxi	sp,L17A5			;continuation address
    3632/    17A2 : C3 63 17            	jmp	ROM_Signature		;check ROM575
    3633/    17A5 : A7 17               L17A5:	dw	L17A7			;continuation address
    3634/    17A7 :                     ;
    3635/    17A7 :                     L17A7:
    3636/    17A7 : 31 AD 17            	lxi	sp,L17AD			;continuation address
    3637/    17AA : C3 6E 17            	jmp	ROM_Checksum		;check ROM575
    3638/    17AD : AF 17               L17AD:	dw	L17AF			;continuation address
    3639/    17AF :                     ;
    3640/    17AF :                     L17AF:
    3641/    17AF : 3A 00 E4            	lda	DEV_DIPSW			;not complemented
    3642/    17B2 : E6 40               	ani	40h					;switch 7 (1-8). Ram Test
    3643/    17B4 : C2 74 06            	jnz	Main_Init			;skip Ram Test
    3644/    17B7 :                     	
    3645/    17B7 : 3E C0               	mvi	a,0C0h				;11000000
    3646/    17B9 : 32 40 E0            	sta	DEV_FPC
    3647/    17BC : AF                  	xra	a
    3648/    17BD : 32 05 E8            	sta	DEV_LIGHTS
    3649/    17C0 : 3E 08               	mvi	a,08h				;00001000
    3650/    17C2 : 32 45 E0            	sta	DEV_SVNSEG
    3651/    17C5 : 3E 1F               	mvi	a,1Fh				;00011111
    3652/    17C7 : 32 44 E0            	sta	DEV_LEDRO
    3653/    17CA : 3E 10               	mvi	a,10h				;00010000 set STOP128			
    3654/    17CC : 32 02 E4            	sta	DEV_DISREG
    3655/    17CF :                     ;
    3656/    17CF :                     ; ram test. First test without using the stack.
    3657/    17CF :                     ;	
    3658/    17CF : 0E 00               	mvi	c,00h				;test result
    3659/    17D1 : 06 00               	mvi	b,00h				;for first time through
    3660/    17D3 : 16 FF               	mvi	d,0FFh
    3661/    17D5 :                     Ram_Test_1:					;loop twice. Use value in B
    3662/    17D5 : 21 00 80            	lxi	h,RAM_SYSTEM		;fill RAM 0x8000-0x83ff with 0
    3663/    17D8 : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256		;MSB end of RAM_SYSTEM + 1
    3664/    17DA :                     $$L:						;L17DA:
    3665/    17DA : 70                  	mov	m,b					;set RAM
    3666/    17DB : 23                  	inx	h
    3667/    17DC : BC                  	cmp	h					;(RAM_SYSTEM_END+1) reached test
    3668/    17DD : C2 DA 17            	jnz	$$L					;loop
    3669/    17E0 : 21 00 80            	lxi	h,RAM_SYSTEM		;check for 0
    3670/    17E3 :                     $$L3:
    3671/    17E3 : 7E                  	mov	a,m
    3672/    17E4 : B8                  	cmp	b
    3673/    17E5 : C2 0B 18            	jnz	fail_ram_test
    3674/    17E8 : 2F                  	cma						;fill with complement of B
    3675/    17E9 : 77                  	mov	m,a
    3676/    17EA : 23                  	inx	h
    3677/    17EB : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256 ;end of RAM_SYSTEM + 1
    3678/    17ED : BC                  	cmp	h
    3679/    17EE : C2 E3 17            	jnz	$$L3				;loop
    3680/    17F1 : 21 FF 83            	lxi	h,RAM_SYSTEM_END	;083FFh			;check for 0xff
    3681/    17F4 :                     $$L2:						;L17F4:
    3682/    17F4 : 7E                  	mov	a,m
    3683/    17F5 : BA                  	cmp	d
    3684/    17F6 : C2 0B 18            	jnz	fail_ram_test
    3685/    17F9 : 2B                  	dcx	h
    3686/    17FA : 3E 7F               	mvi	a,7Fh				;beginning of RAM_SYSTEM - 1
    3687/    17FC : BC                  	cmp	h
    3688/    17FD : C2 F4 17            	jnz	$$L2				;loop
    3689/    1800 : AF                  	xra	a					;clr a
    3690/    1801 : B8                  	cmp	b					;was this the first time through
    3691/    1802 : C2 12 18            	jnz	Ram_Test_2			;no, out
    3692/    1805 : 57                  	mov	d,a					;d<-0
    3693/    1806 : 2F                  	cma
    3694/    1807 : 47                  	mov	b,a					;b<-0xff
    3695/    1808 : C3 D5 17            	jmp	Ram_Test_1			;second time through
    3696/    180B :                     fail_ram_test:
    3697/    180B : 3E 01               	mvi	a,01h				;error code
    3698/    180D : B1                  	ora	c
    3699/    180E : 4F                  	mov	c,a
    3700/    180F : C3 12 18            	jmp	Ram_Test_2	
    3701/    1812 : 06 00               Ram_Test_2:	mvi	b,00h
    3702/    1814 : 21 00 80            	lxi	h,RAM_SYSTEM
    3703/    1817 : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256	;end of RAM_SYSTEM + 1
    3704/    1819 :                     ;	
    3705/    1819 :                     L1819:
    3706/    1819 : 70                  	mov	m,b
    3707/    181A : 23                  	inx	h
    3708/    181B : BC                  	cmp	h
    3709/    181C : C2 19 18            	jnz	L1819
    3710/    181F : 21 00 80            	lxi	h,RAM_SYSTEM
    3711/    1822 : AF                  	xra	a
    3712/    1823 : B8                  	cmp	b
    3713/    1824 : C2 2E 18            	jnz	L182E
    3714/    1827 : 06 01               	mvi	b,01h
    3715/    1829 : 50                  	mov	d,b
    3716/    182A : 58                  	mov	e,b
    3717/    182B : C3 32 18            	jmp	L1832
    3718/    182E : 06 FE               L182E:	mvi	b,0FEh
    3719/    1830 : 50                  	mov	d,b
    3720/    1831 : 58                  	mov	e,b
    3721/    1832 : 70                  L1832:	mov	m,b
    3722/    1833 : 78                  	mov	a,b
    3723/    1834 : 07                  	rlc
    3724/    1835 : 47                  	mov	b,a
    3725/    1836 : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256
    3726/    1838 : 23                  	inx	h
    3727/    1839 : BC                  	cmp	h
    3728/    183A : C2 32 18            	jnz	L1832
    3729/    183D : 21 00 80            	lxi	h,RAM_SYSTEM
    3730/    1840 : 7A                  	mov	a,d
    3731/    1841 : 46                  L1841:	mov	b,m
    3732/    1842 : B8                  	cmp	b
    3733/    1843 : C2 6B 18            	jnz	L186B				;error if !=
    3734/    1846 : 07                  	rlc
    3735/    1847 : 23                  	inx	h
    3736/    1848 : 47                  	mov	b,a
    3737/    1849 : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256
    3738/    184B : BC                  	cmp	h
    3739/    184C : 78                  	mov	a,b
    3740/    184D : C2 41 18            	jnz	L1841
    3741/    1850 : 7A                  	mov	a,d
    3742/    1851 : 07                  	rlc
    3743/    1852 : 57                  	mov	d,a
    3744/    1853 : 47                  	mov	b,a
    3745/    1854 : 21 00 80            	lxi	h,RAM_SYSTEM
    3746/    1857 : BB                  	cmp	e
    3747/    1858 : C2 32 18            	jnz	L1832
    3748/    185B : 3E FE               	mvi	a,0FEh
    3749/    185D : BB                  	cmp	e
    3750/    185E : CA 72 18            	jz	L1872
    3751/    1861 : 06 FF               	mvi	b,0FFh
    3752/    1863 : 21 00 80            	lxi	h,RAM_SYSTEM
    3753/    1866 : 3E 84               	mvi	a,(RAM_SYSTEM_END+1) / 256
    3754/    1868 : C3 19 18            	jmp	L1819				;loop
    3755/    186B : 3E 02               L186B:	mvi	a,02h
    3756/    186D : B1                  	ora	c
    3757/    186E : 4F                  	mov	c,a
    3758/    186F : C3 77 18            	jmp	RAMTest_Error
    3759/    1872 : AF                  L1872:	xra	a				;check errors
    3760/    1873 : B9                  	cmp	c
    3761/    1874 : CA 83 18            	jz	L1883
    3762/    1877 :                     ;
    3763/    1877 :                     ; show error on panel
    3764/    1877 :                     ;	
    3765/    1877 :                     RAMTest_Error:
    3766/    1877 : 79                  	mov	a,c					;manual page 5-4
    3767/    1878 : 32 45 E0            	sta	DEV_SVNSEG
    3768/    187B : 3E E8               	mvi	a,0E8h				;11101000
    3769/    187D : 32 44 E0            	sta	DEV_LEDRO
    3770/    1880 : C3 77 18            	jmp	RAMTest_Error		;loop forever
    3771/    1883 :                     ;
    3772/    1883 :                     ; After testing System Ram, use the stack
    3773/    1883 :                     ;
    3774/    1883 :                     L1883:
    3775/    1883 : 31 00 82            	lxi	sp,RAM_MIDDLE
    3776/    1886 : 21 2E 80            	lxi	h,V_NumWinBuf
    3777/    1889 : AF                  	xra	a
    3778/    188A : 77                  	mov	m,a					;clear V_NumWinBuf
    3779/    188B : 3E 0F               	mvi	a,0Fh
    3780/    188D : 23                  	inx	h
    3781/    188E : 77                  	mov	m,a					;set V_NumWinBuf[1] to 0Fh
    3782/    188F : 23                  	inx	h
    3783/    1890 : 77                  	mov	m,a					;set V_NumWinBuf[2] to 0Fh
    3784/    1891 : 23                  	inx	h
    3785/    1892 : 77                  	mov	m,a					;set V_NumWinBuf[3] to 0Fh
    3786/    1893 : AF                  	xra	a
    3787/    1894 : 32 2F 80            	sta	V_NumWinBuf+1		;set V_NumWinBuf[1] to 0 again
    3788/    1897 : 32 86 81            	sta	V_RAM_Test_Status
    3789/    189A : 21 00 88            	lxi	h,RAM_SCRATCH
    3790/    189D : 22 82 81            	shld V_Range_Start
    3791/    18A0 : 21 00 8C            	lxi	h,RAM_SCRATCH_END+1
    3792/    18A3 : 22 84 81            	shld V_Range_End
    3793/    18A6 : CD 0D 19            	call RAM_Test1
    3794/    18A9 : CD 86 19            	call RAM_Test2
    3795/    18AC : 3A 86 81            	lda	V_RAM_Test_Status
    3796/    18AF : 32 2F 80            	sta	V_NumWinBuf+1
    3797/    18B2 : AF                  	xra	a
    3798/    18B3 : 32 30 80            	sta	V_NumWinBuf+2
    3799/    18B6 : 32 86 81            	sta	V_RAM_Test_Status
    3800/    18B9 : 21 00 A0            	lxi	h,RAM_DISPLAY
    3801/    18BC : 22 82 81            	shld V_Range_Start
    3802/    18BF : 21 00 A8            	lxi	h,RAM_DISPLAY_END+1
    3803/    18C2 : 22 84 81            	shld V_Range_End
    3804/    18C5 : CD 0D 19            	call RAM_Test1
    3805/    18C8 : CD 86 19            	call RAM_Test2
    3806/    18CB : 3A 86 81            	lda	V_RAM_Test_Status
    3807/    18CE : 32 30 80            	sta	V_NumWinBuf+2
    3808/    18D1 : AF                  	xra	a
    3809/    18D2 : 32 31 80            	sta	V_NumWinBuf+3
    3810/    18D5 : 32 86 81            	sta	V_RAM_Test_Status
    3811/    18D8 : 21 00 C0            	lxi	h,RAM_ACQ
    3812/    18DB : 22 82 81            	shld V_Range_Start
    3813/    18DE : 21 00 C2            	lxi	h,RAM_ACQ_END+1
    3814/    18E1 : 22 84 81            	shld V_Range_End
    3815/    18E4 : AF                  	xra	a
    3816/    18E5 : 32 01 E2            	sta	DEV_WRSR1			;Clr sampling bits
    3817/    18E8 : CD 0D 19            	call RAM_Test1
    3818/    18EB : CD 86 19            	call RAM_Test2
    3819/    18EE : 3A 86 81            	lda	V_RAM_Test_Status
    3820/    18F1 : 32 31 80            	sta	V_NumWinBuf+3
    3821/    18F4 : 21 2E 80            	lxi	h,V_NumWinBuf		;RAM test result table
    3822/    18F7 : 7E                  	mov	a,m
    3823/    18F8 : 23                  	inx	h
    3824/    18F9 : 46                  	mov	b,m
    3825/    18FA : B0                  	ora	b
    3826/    18FB : 23                  	inx	h
    3827/    18FC : 46                  	mov	b,m
    3828/    18FD : B0                  	ora	b
    3829/    18FE : 23                  	inx	h
    3830/    18FF : 46                  	mov	b,m
    3831/    1900 : B0                  	ora	b
    3832/    1901 : CA 0A 19            	jz	L190A				;all tests pass.
    3833/    1904 :                     ;
    3834/    1904 :                     ; Error
    3835/    1904 :                     ;
    3836/    1904 :                     $$L:						;L1904:
    3837/    1904 : CD 1C 1A            	call Update_FP_Display
    3838/    1907 : C3 04 19            	jmp	$$L					;L1904
    3839/    190A :                     	
    3840/    190A :                     L190A:
    3841/    190A : C3 74 06            	jmp	Main_Init			;RAM test done
    3842/    190D :                     ;
    3843/    190D :                     ; Ram TEST
    3844/    190D :                     ; input in V_Range_Start and V_Range_End
    3845/    190D :                     ;
    3846/    190D :                     RAM_Test1:
    3847/    190D : 3E 13               	mvi	a,13h				;00010011
    3848/    190F : 32 41 E0            	sta	DEV_CONTRL
    3849/    1912 : CD 1C 1A            	call Update_FP_Display	;front panel
    3850/    1915 : 06 00               	mvi	b,00h
    3851/    1917 : 16 FF               	mvi	d,0FFh
    3852/    1919 :                     L1919:
    3853/    1919 : 2A 82 81            	lhld V_Range_Start
    3854/    191C : 3A 85 81            	lda	V_Range_End+1
    3855/    191F : 70                  L191F:	mov	m,b
    3856/    1920 : 23                  	inx	h
    3857/    1921 : E6 F0               	ani	0F0h
    3858/    1923 : FE A0               	cpi	0A0h
    3859/    1925 : C2 29 19            	jnz	L1929
    3860/    1928 : 23                  	inx	h
    3861/    1929 :                     L1929:
    3862/    1929 : 3A 85 81            	lda	V_Range_End+1
    3863/    192C : BC                  	cmp	h
    3864/    192D : D2 1F 19            	jnc	L191F
    3865/    1930 : CD 1C 1A            	call Update_FP_Display	;front panel
    3866/    1933 : 2A 82 81            	lhld V_Range_Start
    3867/    1936 :                     ;	
    3868/    1936 : 7E                  L1936:	mov	a,m
    3869/    1937 : B8                  	cmp	b
    3870/    1938 : C2 7B 19            	jnz	L197B
    3871/    193B : 2F                  	cma
    3872/    193C : 77                  	mov	m,a
    3873/    193D : 23                  	inx	h
    3874/    193E : 3A 85 81            	lda	V_Range_End+1
    3875/    1941 : E6 F0               	ani	0F0h
    3876/    1943 : FE A0               	cpi	0A0h
    3877/    1945 : C2 49 19            	jnz	L1949
    3878/    1948 : 23                  	inx	h
    3879/    1949 : 3A 85 81            L1949:	lda	V_Range_End+1
    3880/    194C : BC                  	cmp	h
    3881/    194D : C2 36 19            	jnz	L1936
    3882/    1950 : CD 1C 1A            	call Update_FP_Display	;front panel
    3883/    1953 : 2A 84 81            	lhld V_Range_End
    3884/    1956 : 2B                  	dcx	h
    3885/    1957 : 7E                  L1957:	mov	a,m
    3886/    1958 : BA                  	cmp	d
    3887/    1959 : C2 7B 19            	jnz	L197B
    3888/    195C : 2B                  	dcx	h
    3889/    195D : 3A 83 81            	lda	V_Range_Start+1
    3890/    1960 : E6 F0               	ani	0F0h				;11110000
    3891/    1962 : FE A0               	cpi	0A0h				;10100000
    3892/    1964 : C2 68 19            	jnz	L1968
    3893/    1967 : 2B                  	dcx	h
    3894/    1968 : 3A 83 81            L1968:	lda	V_Range_Start+1
    3895/    196B : BC                  	cmp	h
    3896/    196C : DA 57 19            	jc	L1957
    3897/    196F : CD 1C 1A            	call Update_FP_Display	;front panel
    3898/    1972 : AF                  	xra	a
    3899/    1973 : B8                  	cmp	b
    3900/    1974 : C0                  	rnz
    3901/    1975 : 57                  	mov	d,a
    3902/    1976 : 2F                  	cma
    3903/    1977 : 47                  	mov	b,a
    3904/    1978 : C3 19 19            	jmp	L1919
    3905/    197B : 0E 01               L197B:	mvi	c,01h
    3906/    197D : 3A 86 81            	lda	V_RAM_Test_Status	;set bit 0
    3907/    1980 : B1                  	ora	c
    3908/    1981 : 32 86 81            	sta	V_RAM_Test_Status
    3909/    1984 : C9                  	ret
    3910/    1985 : C9                  	ret
    3911/    1986 :                     ;
    3912/    1986 :                     ; more RAM test
    3913/    1986 :                     ; input in V_Range_Start and V_Range_End
    3914/    1986 :                     ;	
    3915/    1986 :                     RAM_Test2:
    3916/    1986 : CD 1C 1A            	call Update_FP_Display ;front panel
    3917/    1989 : 06 00               	mvi	b,00h
    3918/    198B : 2A 82 81            	lhld V_Range_Start
    3919/    198E : 3A 85 81            	lda	V_Range_End+1
    3920/    1991 : 70                  L1991:	mov	m,b
    3921/    1992 : 23                  	inx	h
    3922/    1993 : E6 F0               	ani	0F0h
    3923/    1995 : FE A0               	cpi	0A0h
    3924/    1997 : C2 9B 19            	jnz	L199B
    3925/    199A : 23                  	inx	h
    3926/    199B : 3A 85 81            L199B:	lda	V_Range_End+1
    3927/    199E : BC                  	cmp	h
    3928/    199F : D2 91 19            	jnc	L1991
    3929/    19A2 : 2A 82 81            	lhld V_Range_Start
    3930/    19A5 : AF                  	xra	a
    3931/    19A6 : CD 1C 1A            	call Update_FP_Display	;front panel
    3932/    19A9 : B8                  	cmp	b
    3933/    19AA : C2 B4 19            	jnz	L19B4
    3934/    19AD : 06 01               	mvi	b,01h
    3935/    19AF : 50                  	mov	d,b
    3936/    19B0 : 58                  	mov	e,b
    3937/    19B1 : C3 B8 19            	jmp	L19B8
    3938/    19B4 : 06 FE               L19B4:	mvi	b,0FEh
    3939/    19B6 : 50                  	mov	d,b
    3940/    19B7 : 58                  	mov	e,b
    3941/    19B8 : 70                  L19B8:	mov	m,b
    3942/    19B9 : 78                  	mov	a,b
    3943/    19BA : 07                  	rlc
    3944/    19BB : 47                  	mov	b,a
    3945/    19BC : 3A 85 81            	lda	V_Range_End+1
    3946/    19BF : 23                  	inx	h
    3947/    19C0 : E6 F0               	ani	0F0h
    3948/    19C2 : FE A0               	cpi	0A0h
    3949/    19C4 : C2 C8 19            	jnz	L19C8
    3950/    19C7 : 23                  	inx	h
    3951/    19C8 : 3A 85 81            L19C8:	lda	V_Range_End+1
    3952/    19CB : BC                  	cmp	h
    3953/    19CC : D2 B8 19            	jnc	L19B8
    3954/    19CF : 2A 82 81            	lhld V_Range_Start
    3955/    19D2 : 7A                  	mov	a,d
    3956/    19D3 : CD 1C 1A            	call Update_FP_Display	;front panel
    3957/    19D6 : 46                  L19D6:	mov	b,m
    3958/    19D7 : B8                  	cmp	b
    3959/    19D8 : C2 11 1A            	jnz	L1A11
    3960/    19DB : 07                  	rlc
    3961/    19DC : 23                  	inx	h
    3962/    19DD : 47                  	mov	b,a
    3963/    19DE : 3A 85 81            	lda	V_Range_End+1
    3964/    19E1 : E6 F0               	ani	0F0h
    3965/    19E3 : FE A0               	cpi	0A0h
    3966/    19E5 : C2 E9 19            	jnz	L19E9
    3967/    19E8 : 23                  	inx	h
    3968/    19E9 : 3A 85 81            L19E9:	lda	V_Range_End+1
    3969/    19EC : BC                  	cmp	h
    3970/    19ED : 78                  	mov	a,b
    3971/    19EE : D2 D6 19            	jnc	L19D6
    3972/    19F1 : 7A                  	mov	a,d
    3973/    19F2 : 07                  	rlc
    3974/    19F3 : 57                  	mov	d,a
    3975/    19F4 : 47                  	mov	b,a
    3976/    19F5 : 2A 82 81            	lhld V_Range_Start
    3977/    19F8 : CD 1C 1A            	call Update_FP_Display	;front panel
    3978/    19FB : BB                  	cmp	e
    3979/    19FC : C2 B8 19            	jnz	L19B8
    3980/    19FF : 3E FE               	mvi	a,0FEh
    3981/    1A01 : BB                  	cmp	e
    3982/    1A02 : C8                  	rz
    3983/    1A03 : 06 FF               	mvi	b,0FFh
    3984/    1A05 : 2A 82 81            	lhld V_Range_Start
    3985/    1A08 : 3A 85 81            	lda	V_Range_End+1
    3986/    1A0B : CD 1C 1A            	call Update_FP_Display	;front panel
    3987/    1A0E : C3 91 19            	jmp	L1991
    3988/    1A11 : 0E 02               L1A11:	mvi	c,02h
    3989/    1A13 : 3A 86 81            	lda	V_RAM_Test_Status	;set bit 1
    3990/    1A16 : B1                  	ora	c
    3991/    1A17 : 32 86 81            	sta	V_RAM_Test_Status
    3992/    1A1A : C9                  	ret
    3993/    1A1B : C9                  	ret
    3994/    1A1C :                     ;
    3995/    1A1C :                     ; Front Panel display function during RAM tests
    3996/    1A1C :                     ; saves A, HL
    3997/    1A1C :                     ;
    3998/    1A1C :                     Update_FP_Display:
    3999/    1A1C : 32 88 81            	sta	V_Saved_Param1		;store in paramater variables.
    4000/    1A1F : 22 89 81            	shld V_Saved_Param2
    4001/    1A22 : 3E E0               	mvi	a,0E0h				;11100000 Scale LED
    4002/    1A24 : 32 44 E0            	sta	DEV_LEDRO			;stop numeric display
    4003/    1A27 : 21 2E 80            	lxi	h,V_NumWinBuf
    4004/    1A2A : 3A 87 81            	lda	V_FP_Display_Curr_Digit
    4005/    1A2D : 85                  	add	l
    4006/    1A2E : 6F                  	mov	l,a
    4007/    1A2F : 3E 00               	mvi	a,00h				;preserve carry
    4008/    1A31 : 8C                  	adc	h
    4009/    1A32 : 67                  	mov	h,a
    4010/    1A33 : 7E                  	mov	a,m
    4011/    1A34 : 32 45 E0            	sta	DEV_SVNSEG			;set digit to display
    4012/    1A37 : 21 FE 1E            	lxi	h,L1EFE				;compute value for DEV_LEDRO
    4013/    1A3A : 3A 87 81            	lda	V_FP_Display_Curr_Digit
    4014/    1A3D : 85                  	add	l
    4015/    1A3E : 6F                  	mov	l,a
    4016/    1A3F : 3E 00               	mvi	a,00h
    4017/    1A41 : 8C                  	adc	h
    4018/    1A42 : 67                  	mov	h,a
    4019/    1A43 : 7E                  	mov	a,m
    4020/    1A44 : 32 44 E0            	sta	DEV_LEDRO
    4021/    1A47 : 3A 87 81            	lda	V_FP_Display_Curr_Digit	;range 0..3
    4022/    1A4A : 3C                  	inr	a					;update
    4023/    1A4B : E6 03               	ani	03h					;mod 4
    4024/    1A4D : 32 87 81            	sta	V_FP_Display_Curr_Digit
    4025/    1A50 : 3A 88 81            	lda	V_Saved_Param1			;reload in paramaters
    4026/    1A53 : 2A 89 81            	lhld V_Saved_Param2
    4027/    1A56 : C9                  	ret
    4028/    1A57 :                     ;
    4029/    1A57 :                     ; Interrupt Handler for Position Rate Potentiometer
    4030/    1A57 :                     ; Interrupts disabled at this point
    4031/    1A57 :                     ;	
    4032/    1A57 :                     CursorPotInt:
    4033/    1A57 : F5                  	push	psw				;includes A
    4034/    1A58 : C5                  	push	b
    4035/    1A59 : D5                  	push d
    4036/    1A5A : E5                  	push	h
    4037/    1A5B : 3A 00 F2            	lda	DEV_PRICLR			;read. Value ignored
    4038/    1A5E : 21 40 E0            	lxi	h,DEV_FPC
    4039/    1A61 : 3A 70 80            	lda	V_FPC
    4040/    1A64 :                     ; Toggle	Latch bit
    4041/    1A64 : F6 04               	ori	04h					;00000100 set LATCH
    4042/    1A66 : 77                  	mov	m,a
    4043/    1A67 : EE 04               	xri	04h					;00000100 clear LATCH bit
    4044/    1A69 : 77                  	mov	m,a
    4045/    1A6A : 3A 03 E4            	lda	DEV_CURSOR
    4046/    1A6D : E6 0F               	ani	0Fh					;00001111 Position Rate Count
    4047/    1A6F : 47                  	mov	b,a					;save
    4048/    1A70 : 3A 70 80            	lda	V_FPC
    4049/    1A73 :                     ; Toggle ADVAN bit	
    4050/    1A73 : F6 02               	ori	02h					;00000010 set ADVAN
    4051/    1A75 : 77                  	mov	m,a
    4052/    1A76 : EE 02               	xri	02h					;00000010 clr ADVAN
    4053/    1A78 : 77                  	mov	m,a
    4054/    1A79 : 3A 03 E4            	lda	DEV_CURSOR
    4055/    1A7C : E6 0F               	ani	0Fh					;00001111 Position Rate Count
    4056/    1A7E : 07                  	rlc						;x 16 Move to upper nibble
    4057/    1A7F : 07                  	rlc
    4058/    1A80 : 07                  	rlc
    4059/    1A81 : 07                  	rlc
    4060/    1A82 : B0                  	ora	b					;merge with earlier Position Rate Count
    4061/    1A83 : 32 AB 80            	sta	V_PositionRateCount_Values
    4062/    1A86 : 3A 70 80            	lda	V_FPC
    4063/    1A89 :                     ; Toggle ADVAN bit	
    4064/    1A89 : F6 02               	ori	02h					;00000010 set ADVAN
    4065/    1A8B : 77                  	mov	m,a
    4066/    1A8C : EE 02               	xri	02h					;00000010 clr ADVAN
    4067/    1A8E : 77                  	mov	m,a
    4068/    1A8F : 3A 03 E4            	lda	DEV_CURSOR
    4069/    1A92 : E6 0F               	ani	0Fh					;00001111
    4070/    1A94 : 32 AC 80            	sta	V_PositionRateCount_Values+1 ;store another sample of Position Rate Count
    4071/    1A97 : 3A 70 80            	lda	V_FPC
    4072/    1A9A :                     ; Toggle RESET bit
    4073/    1A9A : F6 08               	ori	08h					;00000010 set RESET
    4074/    1A9C : 77                  	mov	m,a
    4075/    1A9D : EE 08               	xri	08h					;00000010 clr RESET
    4076/    1A9F : 77                  	mov	m,a
    4077/    1AA0 : 3A 3D 80            	lda	V_CursorPot_Delay	;was initialized to 2
    4078/    1AA3 : A7                  	ana	a					;test
    4079/    1AA4 : C2 B2 1A            	jnz	Local1AB2
    4080/    1AA7 :                     ; V_CursorPot_Delay now 0 Process Position Rate Interrupt
    4081/    1AA7 : 3E 06               	mvi	a,MAIN_ACTION_6_ID
    4082/    1AA9 : CD 49 00            	call AddMainAction
    4083/    1AAC : CD 6B 20            	call CursorPotInt2
    4084/    1AAF : C3 B6 1A            	jmp	Local1AB6
    4085/    1AB2 :                     Local1AB2:
    4086/    1AB2 : 3D                  	dcr	a					;V_CursorPot_Delay -= 1
    4087/    1AB3 : 32 3D 80            	sta	V_CursorPot_Delay
    4088/    1AB6 :                     Local1AB6:
    4089/    1AB6 : E1                  	pop	h
    4090/    1AB7 : D1                  	pop	d
    4091/    1AB8 : C1                  	pop	b
    4092/    1AB9 : F1                  	pop	psw
    4093/    1ABA : FB                  	ei
    4094/    1ABB : C9                  	ret
    4095/    1ABC :                     ;	
    4096/    1ABC :                     ReadJitter:
    4097/    1ABC : 3E 11               	mvi	a,11h
    4098/    1ABE : 21 0C 80            	lxi	h,V_ActualTB_2
    4099/    1AC1 : BE                  	cmp	m
    4100/    1AC2 : DA F3 1A            	jc	L1AF3
    4101/    1AC5 : 3A 07 E2            	lda	DEV_RDJC4			;4 bit jitter correction signal in bits 4-7
    4102/    1AC8 : 2E 04               	mvi	l,04h
    4103/    1ACA : CD 8F 1E            	call ShiftR_A_L_times	;move to bits 0-3
    4104/    1ACD : 32 91 81            	sta	V_RecorderJitter
    4105/    1AD0 : 3E 09               	mvi	a,09h
    4106/    1AD2 : 21 91 81            	lxi	h,V_RecorderJitter
    4107/    1AD5 : BE                  	cmp	m					;9 - V_RecorderJitter
    4108/    1AD6 : D2 DE 1A            	jnc	L1ADE				;jump if 9 <= V_RecorderJitter
    4109/    1AD9 : 3E 09               	mvi	a,09h				;set maximum value
    4110/    1ADB : 32 91 81            	sta	V_RecorderJitter
    4111/    1ADE : 3A 91 81            L1ADE:	lda	V_RecorderJitter
    4112/    1AE1 : 47                  	mov	b,a
    4113/    1AE2 : 1F                  	rar						;/2
    4114/    1AE3 : E6 7F               	ani	7Fh					;01111111
    4115/    1AE5 : 4F                  	mov	c,a
    4116/    1AE6 : 78                  	mov	a,b
    4117/    1AE7 : 87                  	add	a
    4118/    1AE8 : 87                  	add	a
    4119/    1AE9 : 47                  	mov	b,a
    4120/    1AEA : 87                  	add	a
    4121/    1AEB : 80                  	add	b
    4122/    1AEC : 81                  	add	c
    4123/    1AED : 32 91 81            	sta	V_RecorderJitter
    4124/    1AF0 : C3 52 1B            	jmp	L1B52
    4125/    1AF3 : 3A 0C 80            L1AF3:	lda	V_ActualTB_2
    4126/    1AF6 : FE 12               	cpi	12h
    4127/    1AF8 : C2 13 1B            	jnz	L1B13
    4128/    1AFB : 2A 92 81            	lhld V_Jitter_TB18
    4129/    1AFE : CD 69 1B            	call Update_Jitter_Vars
    4130/    1B01 : 22 92 81            	shld V_Jitter_TB18
    4131/    1B04 : 1F                  	rar
    4132/    1B05 : E6 7F               	ani	7Fh
    4133/    1B07 : 47                  	mov	b,a
    4134/    1B08 : 1F                  	rar
    4135/    1B09 : 1F                  	rar
    4136/    1B0A : E6 1F               	ani	1Fh
    4137/    1B0C : 80                  	add	b
    4138/    1B0D : 32 91 81            	sta	V_RecorderJitter
    4139/    1B10 : C3 52 1B            	jmp	L1B52
    4140/    1B13 : 3A 0C 80            L1B13:	lda	V_ActualTB_2
    4141/    1B16 : FE 13               	cpi	13h
    4142/    1B18 : C2 30 1B            	jnz	L1B30
    4143/    1B1B : 2A 94 81            	lhld	V_Jitter_TB19
    4144/    1B1E : CD 69 1B            	call Update_Jitter_Vars
    4145/    1B21 : 22 94 81            	shld	V_Jitter_TB19
    4146/    1B24 : 47                  	mov	b,a
    4147/    1B25 : 1F                  	rar
    4148/    1B26 : 1F                  	rar
    4149/    1B27 : E6 3F               	ani	3Fh
    4150/    1B29 : 80                  	add	b
    4151/    1B2A : 32 91 81            	sta	V_RecorderJitter
    4152/    1B2D : C3 52 1B            	jmp	L1B52
    4153/    1B30 :                     L1B30:
    4154/    1B30 : 3A 0C 80            	lda	V_ActualTB_2
    4155/    1B33 : FE 14               	cpi	TB20
    4156/    1B35 : C2 52 1B            	jnz	L1B52
    4157/    1B38 : 2A 96 81            	lhld	V_Jitter_TB20
    4158/    1B3B : CD 69 1B            	call Update_Jitter_Vars
    4159/    1B3E : 22 96 81            	shld	V_Jitter_TB20
    4160/    1B41 : 47                  	mov	b,a
    4161/    1B42 : 1F                  	rar
    4162/    1B43 : 1F                  	rar
    4163/    1B44 : 1F                  	rar
    4164/    1B45 : E6 1F               	ani	1Fh					;00011111
    4165/    1B47 : 4F                  	mov	c,a
    4166/    1B48 : 78                  	mov	a,b
    4167/    1B49 : 87                  	add	a
    4168/    1B4A : 80                  	add	b
    4169/    1B4B : 81                  	add	c
    4170/    1B4C : 32 91 81            	sta	V_RecorderJitter
    4171/    1B4F : C3 52 1B            	jmp	L1B52
    4172/    1B52 : 3A 04 E2            L1B52:	lda	DEV_RDSTAT
    4173/    1B55 : E6 02               	ani	02h					;00000010 Tst AOM
    4174/    1B57 : FE 00               	cpi	00h
    4175/    1B59 : CA 65 1B            	jz	L1B65
    4176/    1B5C : 3E 80               	mvi	a,80h				;10000000
    4177/    1B5E : 21 91 81            	lxi	h,V_RecorderJitter
    4178/    1B61 : B6                  	ora	m
    4179/    1B62 : 32 91 81            	sta	V_RecorderJitter
    4180/    1B65 :                     L1B65:
    4181/    1B65 : 3A 91 81            	lda	V_RecorderJitter
    4182/    1B68 : C9                  	ret
    4183/    1B69 :                     ;
    4184/    1B69 :                     ; in HL. Loaded from V_Jitter_TB18, V_Jitter_TB19, V_Jitter_TB20
    4185/    1B69 :                     ;	
    4186/    1B69 :                     Update_Jitter_Vars:
    4187/    1B69 : 3A 06 E2            	lda	DEV_RDJC8
    4188/    1B6C : 47                  	mov	b,a
    4189/    1B6D : BC                  	cmp	h
    4190/    1B6E : CA 7B 1B            	jz	$$L
    4191/    1B71 : DA 7B 1B            	jc	$$L
    4192/    1B74 : 94                  	sub	h
    4193/    1B75 : 85                  	add	l
    4194/    1B76 : 6F                  	mov	l,a
    4195/    1B77 : 60                  	mov	h,b
    4196/    1B78 : C3 87 1B            	jmp	$$L2
    4197/    1B7B :                     $$L:
    4198/    1B7B : BD                  	cmp	l
    4199/    1B7C : CA 87 1B            	jz	$$L2
    4200/    1B7F : D2 87 1B            	jnc	$$L2
    4201/    1B82 : 7C                  	mov	a,h
    4202/    1B83 : 95                  	sub	l
    4203/    1B84 : 80                  	add	b
    4204/    1B85 : 67                  	mov	h,a
    4205/    1B86 : 68                  	mov	l,b
    4206/    1B87 :                     $$L2:
    4207/    1B87 : 7C                  	mov	a,h
    4208/    1B88 : 90                  	sub	b
    4209/    1B89 : C9                  	ret
    4210/    1B8A :                     ;
    4211/    1B8A :                     ; init function. 
    4212/    1B8A :                     ;
    4213/    1B8A :                     InitJitterVars:
    4214/    1B8A : AF                  	xra	a
    4215/    1B8B : 32 96 81            	sta	V_Jitter_TB20
    4216/    1B8E : AF                  	xra	a
    4217/    1B8F : 32 94 81            	sta	V_Jitter_TB19
    4218/    1B92 : AF                  	xra	a
    4219/    1B93 : 32 92 81            	sta	V_Jitter_TB18
    4220/    1B96 : 3E C7               	mvi	a,0C7h				;11000111
    4221/    1B98 : 32 93 81            	sta	V_Jitter_TB18+1
    4222/    1B9B : 3E 63               	mvi	a,63h				;01100011
    4223/    1B9D : 32 95 81            	sta	V_Jitter_TB19+1
    4224/    1BA0 : 3E 27               	mvi	a,27h				;00100111
    4225/    1BA2 : 32 97 81            	sta	V_Jitter_TB20+1
    4226/    1BA5 : C9                  	ret
    4227/    1BA6 :                     ;
    4228/    1BA6 :                     ; Start WF Acquisition
    4229/    1BA6 :                     ;	
    4230/    1BA6 :                     Main_Action_2:	
    4231/    1BA6 : AF                  	xra	a
    4232/    1BA7 : 32 03 80            	sta	V_fSkipAcquiredWF
    4233/    1BAA : 3A A5 80            	lda	V_DigitalMode
    4234/    1BAD : FE 00               	cpi	DIGITAL_OFF
    4235/    1BAF : CA BA 1B            	jz	L1BBA				;exit
    4236/    1BB2 : 3A A5 80            	lda	V_DigitalMode
    4237/    1BB5 : FE 04               	cpi	DIGITAL_SAVE
    4238/    1BB7 : C2 BD 1B            	jnz	L1BBD				;exit
    4239/    1BBA : C3 65 1D            L1BBA:	jmp	L1D65
    4240/    1BBD :                     ;
    4241/    1BBD :                     ; V_DigitalMode != 0, != 4
    4242/    1BBD :                     ;
    4243/    1BBD : 3A 02 80            L1BBD:	lda	V_fOK2UpdateDispWF
    4244/    1BC0 : 17                  	ral
    4245/    1BC1 : D2 59 1D            	jnc	L1D59
    4246/    1BC4 : AF                  	xra	a
    4247/    1BC5 : 32 02 80            	sta	V_fOK2UpdateDispWF
    4248/    1BC8 : 3A 08 80            	lda	V_ACQ_Mode
    4249/    1BCB : E6 47               	ani	47h					;01000111 Clr
    4250/    1BCD : 32 08 80            	sta	V_ACQ_Mode
    4251/    1BD0 : 3A A5 80            	lda	V_DigitalMode
    4252/    1BD3 : FE 02               	cpi	DIGITAL_ENV
    4253/    1BD5 : C2 E0 1B            	jnz	$$L					;L1BE0
    4254/    1BD8 : 3A 0C 80            	lda	V_ActualTB_2
    4255/    1BDB : FE 12               	cpi	12h
    4256/    1BDD : DA E3 1B            	jc	L1BE3
    4257/    1BE0 :                     $$L:						;L1BE0:
    4258/    1BE0 : C3 EB 1B            	jmp	L1BEB
    4259/    1BE3 :                     L1BE3:
    4260/    1BE3 : 3A 08 80            	lda	V_ACQ_Mode
    4261/    1BE6 : F6 20               	ori	20h					;00100000 Set ENVL
    4262/    1BE8 : 32 08 80            	sta	V_ACQ_Mode
    4263/    1BEB :                     L1BEB:
    4264/    1BEB : 3A 23 80            	lda	V_ATimebaseActive
    4265/    1BEE : 17                  	ral
    4266/    1BEF : D2 03 1C            	jnc	L1C03
    4267/    1BF2 : 3A 08 80            	lda	V_ACQ_Mode
    4268/    1BF5 : F6 08               	ori	08h					;00001000 Set AGTSEL
    4269/    1BF7 : 32 08 80            	sta	V_ACQ_Mode
    4270/    1BFA : 3A 18 80            	lda	V_ATIME
    4271/    1BFD : 32 0C 80            	sta	V_ActualTB_2
    4272/    1C00 : C3 09 1C            	jmp	L1C09
    4273/    1C03 : 3A 19 80            L1C03:	lda	V_BTIME
    4274/    1C06 : 32 0C 80            	sta	V_ActualTB_2
    4275/    1C09 :                     L1C09:
    4276/    1C09 : 3A A7 80            	lda	V_fPostPreTrigger	;boolean test POST/PRETRIGGER
    4277/    1C0C : 17                  	ral
    4278/    1C0D : D2 21 1C            	jnc	L1C21
    4279/    1C10 : 3A 08 80            	lda	V_ACQ_Mode
    4280/    1C13 : F6 10               	ori	10h					;00010000 Set PRETRG
    4281/    1C15 : 32 08 80            	sta	V_ACQ_Mode
    4282/    1C18 : 21 00 E2            	lxi	h,DEV_RSTACQ		;save ptr to DEV_RSTACQ in V_pDEVICE
    4283/    1C1B : 22 0A 80            	shld V_pDEVICE
    4284/    1C1E : C3 27 1C            	jmp	L1C27
    4285/    1C21 :                     L1C21:
    4286/    1C21 : 21 80 E3            	lxi	h,DEV_RSTACQ2		;Save address DEV_RSTACQ2. Tricky move. See page 3-41
    4287/    1C24 : 22 0A 80            	shld V_pDEVICE
    4288/    1C27 :                     L1C27:
    4289/    1C27 : 3E 14               	mvi	a,TB20				;00010100
    4290/    1C29 : 21 0C 80            	lxi	h,V_ActualTB_2
    4291/    1C2C : BE                  	cmp	m
    4292/    1C2D : D2 35 1C            	jnc	$$L
    4293/    1C30 : 3E 14               	mvi	a,TB20				;00010100
    4294/    1C32 : 32 0C 80            	sta	V_ActualTB_2
    4295/    1C35 :                     $$L:
    4296/    1C35 : 3A 0C 80            	lda	V_ActualTB_2
    4297/    1C38 : FE 12               	cpi	12h					;00010010
    4298/    1C3A : D2 45 1C            	jnc	$$L2
    4299/    1C3D : 3A 08 80            	lda	V_ACQ_Mode
    4300/    1C40 : F6 80               	ori	80h					;10000000 Set LT2
    4301/    1C42 : 32 08 80            	sta	V_ACQ_Mode
    4302/    1C45 :                     $$L2:
    4303/    1C45 : 2A 0C 80            	lhld V_ActualTB_2		;load a whole word shorter than loading just a byte to L
    4304/    1C48 : 26 00               	mvi	h,00h
    4305/    1C4A : 11 25 1F            	lxi	d,Sample_Rate_Table-1				;Table
    4306/    1C4D : 19                  	dad	d					;index
    4307/    1C4E : 7E                  	mov	a,m
    4308/    1C4F : 32 02 E2            	sta	DEV_WRSR2			;sampling rate to Divide Chain
    4309/    1C52 : 3A A5 80            	lda	V_DigitalMode
    4310/    1C55 : FE 01               	cpi	DIGITAL_NORM
    4311/    1C57 : C2 74 1C            	jnz	$$L3				;L1C74
    4312/    1C5A : 3A 1E 80            	lda	V_fCH1
    4313/    1C5D : 17                  	ral
    4314/    1C5E : D2 74 1C            	jnc	$$L3				;L1C74
    4315/    1C61 : 3A 1F 80            	lda	V_fCH2
    4316/    1C64 : 17                  	ral
    4317/    1C65 : D2 74 1C            	jnc	$$L3				;L1C74
    4318/    1C68 : 3A 22 80            	lda	V_fALT
    4319/    1C6B : 2F                  	cma
    4320/    1C6C : 21 20 80            	lxi	h,V_fADD
    4321/    1C6F : B6                  	ora	m
    4322/    1C70 : 17                  	ral
    4323/    1C71 : DA 77 1C            	jc	L1C77
    4324/    1C74 :                     $$L3:						;L1C74:
    4325/    1C74 : C3 7F 1C            	jmp	L1C7F
    4326/    1C77 :                     L1C77:
    4327/    1C77 : 3E FF               	mvi	a,0FFh
    4328/    1C79 : 32 2A 80            	sta	V_fAlternating
    4329/    1C7C : C3 83 1C            	jmp	L1C83
    4330/    1C7F :                     L1C7F:
    4331/    1C7F : AF                  	xra	a
    4332/    1C80 : 32 2A 80            	sta	V_fAlternating
    4333/    1C83 :                     L1C83:
    4334/    1C83 : 3A 08 80            	lda	V_ACQ_Mode
    4335/    1C86 : E6 F8               	ani	0F8h				;11111000 Clr ADD|CH1|CH2
    4336/    1C88 : 32 08 80            	sta	V_ACQ_Mode
    4337/    1C8B : 3A A6 80            	lda	V_fSAVEREFShowing	;boolean test
    4338/    1C8E : 17                  	ral
    4339/    1C8F : D2 D6 1C            	jnc	L1CD6
    4340/    1C92 : 3A 20 80            	lda	V_fADD
    4341/    1C95 : 17                  	ral
    4342/    1C96 : D2 A1 1C            	jnc	L1CA1
    4343/    1C99 : 3E 03               	mvi	a,03h
    4344/    1C9B : 32 29 80            	sta	V_ChannelMode
    4345/    1C9E : C3 D3 1C            	jmp	L1CD3
    4346/    1CA1 : 3A 2A 80            L1CA1:	lda	V_fAlternating
    4347/    1CA4 : 17                  	ral
    4348/    1CA5 : D2 B0 1C            	jnc	L1CB0
    4349/    1CA8 : 3E 04               	mvi	a,04h
    4350/    1CAA : 32 29 80            	sta	V_ChannelMode
    4351/    1CAD : C3 D3 1C            	jmp	L1CD3
    4352/    1CB0 : 3A 1E 80            L1CB0:	lda	V_fCH1
    4353/    1CB3 : 17                  	ral
    4354/    1CB4 : D2 BF 1C            	jnc	L1CBF
    4355/    1CB7 : 3E 01               	mvi	a,01h
    4356/    1CB9 : 32 29 80            	sta	V_ChannelMode
    4357/    1CBC : C3 D3 1C            	jmp	L1CD3
    4358/    1CBF : 3A 1F 80            L1CBF:	lda	V_fCH2
    4359/    1CC2 : 17                  	ral
    4360/    1CC3 : D2 CE 1C            	jnc	L1CCE
    4361/    1CC6 : 3E 02               	mvi	a,02h
    4362/    1CC8 : 32 29 80            	sta	V_ChannelMode
    4363/    1CCB : C3 D3 1C            	jmp	L1CD3
    4364/    1CCE : 3E 01               L1CCE:	mvi	a,01h
    4365/    1CD0 : 32 29 80            	sta	V_ChannelMode
    4366/    1CD3 : C3 37 1D            L1CD3:	jmp	L1D37
    4367/    1CD6 : 3A 2A 80            L1CD6:	lda	V_fAlternating
    4368/    1CD9 : 17                  	ral
    4369/    1CDA : D2 FE 1C            	jnc	L1CFE
    4370/    1CDD : 3A 20 80            	lda	V_fADD
    4371/    1CE0 : 17                  	ral
    4372/    1CE1 : D2 EB 1C            	jnc	L1CEB
    4373/    1CE4 : 3A 2B 80            	lda	V_fChopped
    4374/    1CE7 : 17                  	ral
    4375/    1CE8 : DA EE 1C            	jc	L1CEE
    4376/    1CEB : C3 F6 1C            L1CEB:	jmp	L1CF6
    4377/    1CEE : 3E 03               L1CEE:	mvi	a,03h
    4378/    1CF0 : 32 29 80            	sta	V_ChannelMode
    4379/    1CF3 : C3 FB 1C            	jmp	L1CFB
    4380/    1CF6 : 3E 04               L1CF6:	mvi	a,04h
    4381/    1CF8 : 32 29 80            	sta	V_ChannelMode
    4382/    1CFB : C3 37 1D            L1CFB:	jmp	L1D37
    4383/    1CFE : 06 01               L1CFE:	mvi	b,01h
    4384/    1D00 : 3A 1E 80            	lda	V_fCH1
    4385/    1D03 : A7                  	ana	a
    4386/    1D04 : F2 08 1D            	jp	L1D08
    4387/    1D07 : 04                  	inr	b
    4388/    1D08 : 3A 1F 80            L1D08:	lda	V_fCH2
    4389/    1D0B : A7                  	ana	a
    4390/    1D0C : F2 11 1D            	jp	L1D11
    4391/    1D0F : 04                  	inr	b
    4392/    1D10 : 04                  	inr	b
    4393/    1D11 : 3A 20 80            L1D11:	lda	V_fADD
    4394/    1D14 : A7                  	ana	a
    4395/    1D15 : 78                  	mov	a,b
    4396/    1D16 : F2 1B 1D            	jp	L1D1B
    4397/    1D19 : C6 04               	adi	04h
    4398/    1D1B :                     L1D1B:
    4399/    1D1B : 32 98 81            	sta	VAR_8198
    4400/    1D1E : 2A 29 80            	lhld V_ChannelMode
    4401/    1D21 : 2D                  	dcr	l
    4402/    1D22 : 7D                  	mov	a,l
    4403/    1D23 : 2E 03               	mvi	l,03h
    4404/    1D25 : CD 78 1E            	call ShiftL_A_L_times
    4405/    1D28 : 21 98 81            	lxi	h,VAR_8198
    4406/    1D2B : 86                  	add	m
    4407/    1D2C : 6F                  	mov	l,a
    4408/    1D2D : 26 00               	mvi	h,00h
    4409/    1D2F : 11 01 1F            	lxi	d,ChannelMode_Map-1
    4410/    1D32 : 19                  	dad	d
    4411/    1D33 : 7E                  	mov	a,m
    4412/    1D34 : 32 29 80            	sta	V_ChannelMode
    4413/    1D37 :                     L1D37:
    4414/    1D37 : 3A 29 80            	lda	V_ChannelMode
    4415/    1D3A : FE 04               	cpi	04h
    4416/    1D3C : 3E FF               	mvi	a,0FFh
    4417/    1D3E : CA 42 1D            	jz	L1D42
    4418/    1D41 : 2F                  	cma
    4419/    1D42 :                     L1D42:
    4420/    1D42 : 32 2B 80            	sta	V_fChopped
    4421/    1D45 : 2A 29 80            	lhld V_ChannelMode
    4422/    1D48 : 26 00               	mvi	h,00h
    4423/    1D4A : 11 21 1F            	lxi	d,ChannelSwitch_Map-1
    4424/    1D4D : 19                  	dad	d
    4425/    1D4E : 7E                  	mov	a,m
    4426/    1D4F : 21 08 80            	lxi	h,V_ACQ_Mode
    4427/    1D52 : B6                  	ora	m
    4428/    1D53 : 32 08 80            	sta	V_ACQ_Mode
    4429/    1D56 : 32 01 E2            	sta	DEV_WRSR1			;set sampling bits
    4430/    1D59 : 2A 0A 80            L1D59:	lhld V_pDEVICE
    4431/    1D5C : 7E                  	mov	a,m
    4432/    1D5D : 32 09 80            	sta	VAR_8009
    4433/    1D60 : 3E 03               	mvi	a,MAIN_ACTION_3_ID
    4434/    1D62 : CD 49 00            	call AddMainAction
    4435/    1D65 : C9                  L1D65:	ret
    4436/    1D66 :                     ;
    4437/    1D66 :                     ; Main loop: scan action table. May be interrupted so table may change.
    4438/    1D66 :                     ; Next entry, if any, is actually V_MainActionStart+1
    4439/    1D66 :                     ;
    4440/    1D66 :                     Main:
    4441/    1D66 : 3A 44 80            	lda	V_MainActionStart	;circular buffer current index 1-16 range
    4442/    1D69 : 6F                  	mov	l,a					;compute ptr into circular buffer
    4443/    1D6A : 26 00               	mvi	h,00h
    4444/    1D6C : 11 44 80            	lxi	d,V_MainActionTbl-1
    4445/    1D6F : 19                  	dad	d
    4446/    1D70 : 36 00               	mvi	m,00h				;clr state table index
    4447/    1D72 : FB                  	ei
    4448/    1D73 : 21 43 80            	lxi	h,V_MainActionEnd 	;ptr to circular buffer end index
    4449/    1D76 : BE                  	cmp	m					;A still start index
    4450/    1D77 : CA A0 1D            	jz	L1DA0
    4451/    1D7A : E6 0F               	ani	0Fh
    4452/    1D7C : 3C                  	inr	a
    4453/    1D7D : 32 44 80            	sta	V_MainActionStart	;update start index
    4454/    1D80 : 11 44 80            	lxi	d,V_MainActionTbl-1		;get action
    4455/    1D83 : CF                  	rst	1					;Get *(DE + A)
    4456/    1D84 : A7                  	ana	a					;test
    4457/    1D85 : CA A0 1D            	jz	L1DA0				;no action
    4458/    1D88 : FE 78               	cpi	78h					;A - 0x78
    4459/    1D8A : D2 97 1D            	jnc	L1D97				;jump if A >= 0x78
    4460/    1D8D : 11 38 1F            	lxi	d,Action_Table1-2
    4461/    1D90 : CD 4F 00            	call Get_Word_From_Table
    4462/    1D93 : E7                  	rst	4					; Jump to HL
    4463/    1D94 : C3 A0 1D            	jmp	L1DA0
    4464/    1D97 :                     L1D97:
    4465/    1D97 : D6 78               	sui	78h					;rebase
    4466/    1D99 : 11 FF 1F            	lxi	d,Action_Table2-2
    4467/    1D9C : CD 4F 00            	call Get_Word_From_Table
    4468/    1D9F : E7                  	rst	4					; Jump to HL
    4469/    1DA0 : C3 66 1D            L1DA0:	jmp	Main
    4470/    1DA3 :                     ;
    4471/    1DA3 :                     ; Called every 2 mSec (500 Hz)
    4472/    1DA3 :                     ;
    4473/    1DA3 :                     Timer_Interrupt:			;process RST75
    4474/    1DA3 : C5                  	push	b
    4475/    1DA4 : D5                  	push d
    4476/    1DA5 : E5                  	push	h
    4477/    1DA6 : F5                  	push	psw
    4478/    1DA7 : 3E 01               	mvi	a,01h
    4479/    1DA9 : 21 9A 81            	lxi	h,V_TimerCntr		;increment timer counter
    4480/    1DAC : 86                  	add	m
    4481/    1DAD : 32 9A 81            	sta	V_TimerCntr
    4482/    1DB0 : 3A 9B 81            	lda	V_TimerCntr2
    4483/    1DB3 : 21 9A 81            	lxi	h,V_TimerCntr
    4484/    1DB6 : BE                  	cmp	m
    4485/    1DB7 : C2 CE 1D            	jnz	L1DCE
    4486/    1DBA : 3E 02               	mvi	a,02h
    4487/    1DBC : 21 9A 81            	lxi	h,V_TimerCntr
    4488/    1DBF : 86                  	add	m
    4489/    1DC0 : 32 9B 81            	sta	V_TimerCntr2
    4490/    1DC3 : 3A AA 80            	lda	V_CursorMode
    4491/    1DC6 : FE 00               	cpi	00h
    4492/    1DC8 : CA CE 1D            	jz	L1DCE
    4493/    1DCB : CD A2 16            	call RefreshNumWin		;Front Panel
    4494/    1DCE : 3A 9C 81            L1DCE:	lda	V_TimerCntr3
    4495/    1DD1 : 21 9A 81            	lxi	h,V_TimerCntr
    4496/    1DD4 : BE                  	cmp	m
    4497/    1DD5 : C2 E4 1D            	jnz	L1DE4
    4498/    1DD8 : 3E 32               	mvi	a,32h
    4499/    1DDA : 21 9A 81            	lxi	h,V_TimerCntr
    4500/    1DDD : 86                  	add	m
    4501/    1DDE : 32 9C 81            	sta	V_TimerCntr3
    4502/    1DE1 : CD B8 00            	call ReadDeviceControls	;Front Panel
    4503/    1DE4 :                     L1DE4:
    4504/    1DE4 : 3A 9D 81            	lda	V_TimerCntr4
    4505/    1DE7 : 21 9A 81            	lxi	h,V_TimerCntr
    4506/    1DEA : BE                  	cmp	m
    4507/    1DEB : C2 FC 1D            	jnz	L1DFC
    4508/    1DEE : 3E 64               	mvi	a,64h
    4509/    1DF0 : 21 9A 81            	lxi	h,V_TimerCntr
    4510/    1DF3 : 86                  	add	m
    4511/    1DF4 : 32 9D 81            	sta	V_TimerCntr4		;V_TimerCntr = V_TimerCntr + 100
    4512/    1DF7 : 3E 01               	mvi	a,MAIN_ACTION_1_ID
    4513/    1DF9 : CD 49 00            	call AddMainAction
    4514/    1DFC : 3A 03 E4            L1DFC:	lda	DEV_CURSOR
    4515/    1DFF : E6 40               	ani	40h					;01000000 Test RATE/POS
    4516/    1E01 : FE 40               	cpi	40h					;01000000
    4517/    1E03 : C2 61 1E            	jnz	L1E61
    4518/    1E06 :                     ;
    4519/    1E06 :                     ; RATE active
    4520/    1E06 :                     ;	
    4521/    1E06 : 3A AA 80            	lda	V_CursorMode
    4522/    1E09 : FE 04               	cpi	04h
    4523/    1E0B : C2 2A 1E            	jnz	L1E2A
    4524/    1E0E : 3A 9F 81            	lda	V_TimerCntrSweepsStop
    4525/    1E11 : 21 9A 81            	lxi	h,V_TimerCntr
    4526/    1E14 : BE                  	cmp	m
    4527/    1E15 : C2 27 1E            	jnz	L1E27
    4528/    1E18 : 3E 04               	mvi	a,04h
    4529/    1E1A : CD 35 20            	call AddDisplayAction
    4530/    1E1D : 3A C1 80            	lda	V_TimerCntrSweepsIncrement
    4531/    1E20 : 21 9A 81            	lxi	h,V_TimerCntr
    4532/    1E23 : 86                  	add	m
    4533/    1E24 : 32 9F 81            	sta	V_TimerCntrSweepsStop
    4534/    1E27 : C3 5E 1E            L1E27:	jmp	L1E5E
    4535/    1E2A : 3A 9E 81            L1E2A:	lda	V_TimerCntr_Rate_Stop2
    4536/    1E2D : 21 9A 81            	lxi	h,V_TimerCntr
    4537/    1E30 : BE                  	cmp	m
    4538/    1E31 : C2 43 1E            	jnz	L1E43
    4539/    1E34 : 3E 03               	mvi	a,03h
    4540/    1E36 : CD 35 20            	call AddDisplayAction
    4541/    1E39 : 3A 9A 81            	lda	V_TimerCntr
    4542/    1E3C : 21 35 80            	lxi	h,V_TimerCntrRateInc2
    4543/    1E3F : 86                  	add	m
    4544/    1E40 : 32 9E 81            	sta	V_TimerCntr_Rate_Stop2
    4545/    1E43 :                     L1E43:
    4546/    1E43 : 3A 13 80            	lda	V_fCursorEdgeTracking ;boolean
    4547/    1E46 : 17                  	ral						;carry if TRUE
    4548/    1E47 : D2 5B 1E            	jnc	L1E5B				;HL is &V_TimerCntrRateInc2 now
    4549/    1E4A : 2A 10 80            	lhld V_CursorEdgeTimeCnt
    4550/    1E4D : 3A 12 80            	lda	V_fAtCursorEdge	;boolean test
    4551/    1E50 : 17                  	ral
    4552/    1E51 : D2 58 1E            	jnc	L1E58				;jump if FALSE
    4553/    1E54 : 23                  	inx	h
    4554/    1E55 : C3 5B 1E            	jmp	L1E5B
    4555/    1E58 : AF                  L1E58:	xra	a				;clear
    4556/    1E59 : 67                  	mov	h,a
    4557/    1E5A : 6F                  	mov	l,a
    4558/    1E5B :                     L1E5B:
    4559/    1E5B : 22 10 80            	shld V_CursorEdgeTimeCnt
    4560/    1E5E : C3 67 1E            L1E5E:	jmp	L1E67
    4561/    1E61 :                     ;
    4562/    1E61 : AF                  L1E61:	xra	a
    4563/    1E62 : 67                  	mov	h,a
    4564/    1E63 : 6F                  	mov	l,a
    4565/    1E64 : 22 10 80            	shld V_CursorEdgeTimeCnt	;clear
    4566/    1E67 : F1                  L1E67:	pop	psw
    4567/    1E68 : E1                  	pop	h
    4568/    1E69 : D1                  	pop	d
    4569/    1E6A : C1                  	pop	b
    4570/    1E6B : FB                  	ei
    4571/    1E6C : C9                  	ret
    4572/    1E6D :                     ;
    4573/    1E6D :                     ; copy BC bytes from p1(DE) to p2(HL)
    4574/    1E6D :                     ;	
    4575/    1E6D :                     Copy_Bytes:
    4576/    1E6D : 1A                  	ldax d
    4577/    1E6E : 77                  	mov	m,a					;*p2++ = *p1++
    4578/    1E6F : 23                  	inx	h
    4579/    1E70 : 13                  	inx	d
    4580/    1E71 : 0B                  	dcx	b					;BC--
    4581/    1E72 : 79                  	mov	a,c
    4582/    1E73 : B0                  	ora	b
    4583/    1E74 : C2 6D 1E            	jnz	Copy_Bytes
    4584/    1E77 : C9                  	ret
    4585/    1E78 :                     ;
    4586/    1E78 :                     ; in A, L. if L > 0 shift left A L times,
    4587/    1E78 :                     ; double or shift left
    4588/    1E78 :                     ; only ever called with l==3
    4589/    1E78 :                     ;
    4590/    1E78 :                     ShiftL_A_L_times:
    4591/    1E78 : 4F                  	mov	c,a
    4592/    1E79 : 7D                  	mov	a,l
    4593/    1E7A : FE 00               	cpi	00h
    4594/    1E7C : 79                  	mov	a,c
    4595/    1E7D : F8                  	rm
    4596/    1E7E : C8                  	rz
    4597/    1E7F :                     $$L:
    4598/    1E7F : 87                  	add	a
    4599/    1E80 : 2D                  	dcr	l
    4600/    1E81 : C2 7F 1E            	jnz	$$L
    4601/    1E84 : C9                  	ret
    4602/    1E85 :                     ;
    4603/    1E85 :                     ; in A, L. Return T if A >= L
    4604/    1E85 :                     ;
    4605/    1E85 :                     Is_A_LE_L:
    4606/    1E85 : BD                  	cmp	l					;A - L
    4607/    1E86 : DA 8C 1E            	jc	$$L1_				;jmp if A < L
    4608/    1E89 : 3E FF               	mvi	a,0FFh				;return TRUE
    4609/    1E8B : C9                  	ret
    4610/    1E8C :                     $$L1_:
    4611/    1E8C : 3E 00               	mvi	a,00h				;return FALSE xra	a!
    4612/    1E8E : C9                  	ret
    4613/    1E8F :                     ;
    4614/    1E8F :                     ; input A, L. if L > 0, shift right A L times
    4615/    1E8F :                     ;	
    4616/    1E8F :                     ShiftR_A_L_times:
    4617/    1E8F : 4F                  	mov	c,a
    4618/    1E90 : 7D                  	mov	a,l
    4619/    1E91 : FE 00               	cpi	00h
    4620/    1E93 : 79                  	mov	a,c
    4621/    1E94 : F8                  	rm
    4622/    1E95 : C8                  	rz
    4623/    1E96 :                     $$L:
    4624/    1E96 : 37                  	stc						;clear carry
    4625/    1E97 : 3F                  	cmc
    4626/    1E98 : 1F                  	rar
    4627/    1E99 : 2D                  	dcr	l
    4628/    1E9A : C2 96 1E            	jnz	$$L
    4629/    1E9D : C9                  	ret
    4630/    1E9E :                     ;
    4631/    1E9E :                     ; input A, L
    4632/    1E9E :                     ; Called ONCE only with L == 6
    4633/    1E9E :                     ; find smaller
    4634/    1E9E :                     ;	
    4635/    1E9E :                     Get_Smaller:
    4636/    1E9E : 47                  	mov	b,a					;save
    4637/    1E9F : AD                  	xra	l					;combine unique bits
    4638/    1EA0 : 07                  	rlc						;<< 1. Carry if (A^L) >= 0x80
    4639/    1EA1 : 78                  	mov	a,b					;restore input
    4640/    1EA2 : DA AE 1E            	jc	L1EAE
    4641/    1EA5 : BD                  	cmp	l					;A - L
    4642/    1EA6 : FA B4 1E            	jm	L1EB4				;A <= L
    4643/    1EA9 : CA B4 1E            	jz	L1EB4
    4644/    1EAC : 7D                  	mov	a,l					;L < A
    4645/    1EAD : C9                  	ret
    4646/    1EAE :                     ; A restored to input value here
    4647/    1EAE : 07                  L1EAE:	rlc					;<< 1. Carry if (A << 1) >= 0x80
    4648/    1EAF : DA B4 1E            	jc	L1EB4
    4649/    1EB2 : 7D                  	mov	a,l					;return L
    4650/    1EB3 : C9                  	ret
    4651/    1EB4 : C9                  L1EB4:	ret
    4652/    1EB5 :                     ;
    4653/    1EB5 :                     ; Return minimum in A
    4654/    1EB5 :                     ; in A, L
    4655/    1EB5 :                     ;
    4656/    1EB5 :                     Get_Minimum:
    4657/    1EB5 : BD                  	cmp	l					;A-L
    4658/    1EB6 : D2 BD 1E            	jnc	$$L					;jump if A >= L
    4659/    1EB9 : C9                  	ret
    4660/    1EBA : C3 BF 1E            	jmp	Test_Different		;unreachable
    4661/    1EBD :                     $$L:
    4662/    1EBD : 7D                  	mov	a,l
    4663/    1EBE : C9                  	ret
    4664/    1EBF :                     ;
    4665/    1EBF :                     ; Check if A & L are different
    4666/    1EBF :                     ; in A, L. Out A (TRUE or FALSE), Carry
    4667/    1EBF :                     ;	
    4668/    1EBF :                     Test_Different:
    4669/    1EBF : 95                  	sub	l					;A -= L. Carry if L > A
    4670/    1EC0 : 3E FF               	mvi	a,0FFh
    4671/    1EC2 : 07                  	rlc						;rotate does NOT affect Z. Carry set
    4672/    1EC3 : C0                  	rnz
    4673/    1EC4 : 3E 00               	mvi	a,00h
    4674/    1EC6 : 07                  	rlc						;carry not set
    4675/    1EC7 : C9                  	ret
    4676/    1EC8 :                     ;
    4677/    1EC8 :                     ; Front Panel Push Buttons table
    4678/    1EC8 :                     ; Each entry maps to Active Low bit set in FP1
    4679/    1EC8 :                     ; V_DigitalMode is the index into this table 1..5
    4680/    1EC8 :                     ; 0: OFF 1:NORM 2:ENV 3:AVG 4:SAVE
    4681/    1EC8 :                     ;	
    4682/    1EC8 :                     DIGITAL_Tbl:
    4683/    1EC8 : 00 E8 EC EA 38      	db	00h,0e8h,0ech,0eah,038h
    4684/    1ECD : 20 00 84 82 08      	db	020h,00h,084h,082h,08h
    4685/    1ED2 : 20 80 00 82 08      	db	020h,080h,00h,082h,08h
    4686/    1ED7 : 22 80 84 00 08      	db	022h,080h,084h,00h,08h
    4687/    1EDC : 20 D8 DC DA 00      	db	020h,0d8h,0dch,0dah,00h
    4688/    1EE1 :                     DIGITAL_Actions_Tbl:	
    4689/    1EE1 : 20 03 26 03 2C 03   	dw	Set_Action5_Flg, Add_Action_2, L032C, L0337, L033D, L0344, L034B
                    37 03 3D 03 44 03 
                    4B 03 
    4690/    1EEF :                     HGAIN_Tbl1:
    4691/    1EEF : FA C8 A0            	db	0fah,0c8h,0a0h
    4692/    1EF2 :                     Nr_Samples_Tbl:
    4693/    1EF2 : 00 CE A4            	db	00h,0ceh,0a4h
    4694/    1EF5 :                     VGAIN_Tbl:
    4695/    1EF5 : 78 3C 18 60 30 18   	db	078h,03ch,018h,060h,030h,018h,078h,030h,018h
                    78 30 18 
    4696/    1EFE :                     L1EFE:		;front panel display table
    4697/    1EFE : E8 E4 E2 E1         	db	0e8h,0e4h,0e2h,0e1h
    4698/    1F02 :                     ChannelMode_Map:	
    4699/    1F02 : 01 01 02 02         	db	01h,01h,02h,02h
    4700/    1F06 : 03 03 03 03         	db	03h,03h,03h,03h
    4701/    1F0A : 01 01 02 01         	db	01h,01h,02h,01h
    4702/    1F0E : 03 03 03 03         	db	03h,03h,03h,03h
    4703/    1F12 : 01 01 02 01         	db	01h,01h,02h,01h
    4704/    1F16 : 03 01 02 01         	db	03h,01h,02h,01h
    4705/    1F1A : 01 01 02 01         	db	01h,01h,02h,01h
    4706/    1F1E : 03 03 03 03         	db	03h,03h,03h,03h
    4707/    1F22 :                     ChannelSwitch_Map:
    4708/    1F22 : 02 01 06 03         	db	02h,01h,06h,03h
    4709/    1F26 :                     ;
    4710/    1F26 :                     ; sampling period table.
    4711/    1F26 :                     ;	
    4712/    1F26 :                     Sample_Rate_Table:
    4713/    1F26 : C1 C2 E0 E1 E2 F0   	db	0c1h,0c2h,0e0h,0e1h,0e2h,0f0h
    4714/    1F2C : F1 F2 F8 F9 FA FC   	db	0f1h,0f2h,0f8h,0f9h,0fah,0fch,0fdh
                    FD 
    4715/    1F33 : FE BF 7F 3F BF 7F   	db	0feh,0bfh,07fh,03fh,0bfh,07Fh,03Fh
                    3F 
    4716/    1F3A :                     ;	
    4717/    1F3A :                     Action_Table1:	
    4718/    1F3A : 3B 20 A6 1B FA 16   	dw	Main_Action_1, Main_Action_2, Main_Action_3, Main_Action_4, Main_Action_5
                    F6 08 5E 00 
    4719/    1F44 : 38 20 E4 04 95 0F   	dw	Main_Action_6, Main_Action_7, Main_Action_8, Main_Action_9, Main_Action_10
                    05 06 6C 0F 
    4720/    1F4E :                     
    4721/    1F4E :                     	rept 172
    4722/    1F4E :                     	hlt
    4723/    1F4E :                     	endm
    4722/    1F4E : 76                  	hlt
    4722/    1F4F : 76                  	hlt
    4722/    1F50 : 76                  	hlt
    4722/    1F51 : 76                  	hlt
    4722/    1F52 : 76                  	hlt
    4722/    1F53 : 76                  	hlt
    4722/    1F54 : 76                  	hlt
    4722/    1F55 : 76                  	hlt
    4722/    1F56 : 76                  	hlt
    4722/    1F57 : 76                  	hlt
    4722/    1F58 : 76                  	hlt
    4722/    1F59 : 76                  	hlt
    4722/    1F5A : 76                  	hlt
    4722/    1F5B : 76                  	hlt
    4722/    1F5C : 76                  	hlt
    4722/    1F5D : 76                  	hlt
    4722/    1F5E : 76                  	hlt
    4722/    1F5F : 76                  	hlt
    4722/    1F60 : 76                  	hlt
    4722/    1F61 : 76                  	hlt
    4722/    1F62 : 76                  	hlt
    4722/    1F63 : 76                  	hlt
    4722/    1F64 : 76                  	hlt
    4722/    1F65 : 76                  	hlt
    4722/    1F66 : 76                  	hlt
    4722/    1F67 : 76                  	hlt
    4722/    1F68 : 76                  	hlt
    4722/    1F69 : 76                  	hlt
    4722/    1F6A : 76                  	hlt
    4722/    1F6B : 76                  	hlt
    4722/    1F6C : 76                  	hlt
    4722/    1F6D : 76                  	hlt
    4722/    1F6E : 76                  	hlt
    4722/    1F6F : 76                  	hlt
    4722/    1F70 : 76                  	hlt
    4722/    1F71 : 76                  	hlt
    4722/    1F72 : 76                  	hlt
    4722/    1F73 : 76                  	hlt
    4722/    1F74 : 76                  	hlt
    4722/    1F75 : 76                  	hlt
    4722/    1F76 : 76                  	hlt
    4722/    1F77 : 76                  	hlt
    4722/    1F78 : 76                  	hlt
    4722/    1F79 : 76                  	hlt
    4722/    1F7A : 76                  	hlt
    4722/    1F7B : 76                  	hlt
    4722/    1F7C : 76                  	hlt
    4722/    1F7D : 76                  	hlt
    4722/    1F7E : 76                  	hlt
    4722/    1F7F : 76                  	hlt
    4722/    1F80 : 76                  	hlt
    4722/    1F81 : 76                  	hlt
    4722/    1F82 : 76                  	hlt
    4722/    1F83 : 76                  	hlt
    4722/    1F84 : 76                  	hlt
    4722/    1F85 : 76                  	hlt
    4722/    1F86 : 76                  	hlt
    4722/    1F87 : 76                  	hlt
    4722/    1F88 : 76                  	hlt
    4722/    1F89 : 76                  	hlt
    4722/    1F8A : 76                  	hlt
    4722/    1F8B : 76                  	hlt
    4722/    1F8C : 76                  	hlt
    4722/    1F8D : 76                  	hlt
    4722/    1F8E : 76                  	hlt
    4722/    1F8F : 76                  	hlt
    4722/    1F90 : 76                  	hlt
    4722/    1F91 : 76                  	hlt
    4722/    1F92 : 76                  	hlt
    4722/    1F93 : 76                  	hlt
    4722/    1F94 : 76                  	hlt
    4722/    1F95 : 76                  	hlt
    4722/    1F96 : 76                  	hlt
    4722/    1F97 : 76                  	hlt
    4722/    1F98 : 76                  	hlt
    4722/    1F99 : 76                  	hlt
    4722/    1F9A : 76                  	hlt
    4722/    1F9B : 76                  	hlt
    4722/    1F9C : 76                  	hlt
    4722/    1F9D : 76                  	hlt
    4722/    1F9E : 76                  	hlt
    4722/    1F9F : 76                  	hlt
    4722/    1FA0 : 76                  	hlt
    4722/    1FA1 : 76                  	hlt
    4722/    1FA2 : 76                  	hlt
    4722/    1FA3 : 76                  	hlt
    4722/    1FA4 : 76                  	hlt
    4722/    1FA5 : 76                  	hlt
    4722/    1FA6 : 76                  	hlt
    4722/    1FA7 : 76                  	hlt
    4722/    1FA8 : 76                  	hlt
    4722/    1FA9 : 76                  	hlt
    4722/    1FAA : 76                  	hlt
    4722/    1FAB : 76                  	hlt
    4722/    1FAC : 76                  	hlt
    4722/    1FAD : 76                  	hlt
    4722/    1FAE : 76                  	hlt
    4722/    1FAF : 76                  	hlt
    4722/    1FB0 : 76                  	hlt
    4722/    1FB1 : 76                  	hlt
    4722/    1FB2 : 76                  	hlt
    4722/    1FB3 : 76                  	hlt
    4722/    1FB4 : 76                  	hlt
    4722/    1FB5 : 76                  	hlt
    4722/    1FB6 : 76                  	hlt
    4722/    1FB7 : 76                  	hlt
    4722/    1FB8 : 76                  	hlt
    4722/    1FB9 : 76                  	hlt
    4722/    1FBA : 76                  	hlt
    4722/    1FBB : 76                  	hlt
    4722/    1FBC : 76                  	hlt
    4722/    1FBD : 76                  	hlt
    4722/    1FBE : 76                  	hlt
    4722/    1FBF : 76                  	hlt
    4722/    1FC0 : 76                  	hlt
    4722/    1FC1 : 76                  	hlt
    4722/    1FC2 : 76                  	hlt
    4722/    1FC3 : 76                  	hlt
    4722/    1FC4 : 76                  	hlt
    4722/    1FC5 : 76                  	hlt
    4722/    1FC6 : 76                  	hlt
    4722/    1FC7 : 76                  	hlt
    4722/    1FC8 : 76                  	hlt
    4722/    1FC9 : 76                  	hlt
    4722/    1FCA : 76                  	hlt
    4722/    1FCB : 76                  	hlt
    4722/    1FCC : 76                  	hlt
    4722/    1FCD : 76                  	hlt
    4722/    1FCE : 76                  	hlt
    4722/    1FCF : 76                  	hlt
    4722/    1FD0 : 76                  	hlt
    4722/    1FD1 : 76                  	hlt
    4722/    1FD2 : 76                  	hlt
    4722/    1FD3 : 76                  	hlt
    4722/    1FD4 : 76                  	hlt
    4722/    1FD5 : 76                  	hlt
    4722/    1FD6 : 76                  	hlt
    4722/    1FD7 : 76                  	hlt
    4722/    1FD8 : 76                  	hlt
    4722/    1FD9 : 76                  	hlt
    4722/    1FDA : 76                  	hlt
    4722/    1FDB : 76                  	hlt
    4722/    1FDC : 76                  	hlt
    4722/    1FDD : 76                  	hlt
    4722/    1FDE : 76                  	hlt
    4722/    1FDF : 76                  	hlt
    4722/    1FE0 : 76                  	hlt
    4722/    1FE1 : 76                  	hlt
    4722/    1FE2 : 76                  	hlt
    4722/    1FE3 : 76                  	hlt
    4722/    1FE4 : 76                  	hlt
    4722/    1FE5 : 76                  	hlt
    4722/    1FE6 : 76                  	hlt
    4722/    1FE7 : 76                  	hlt
    4722/    1FE8 : 76                  	hlt
    4722/    1FE9 : 76                  	hlt
    4722/    1FEA : 76                  	hlt
    4722/    1FEB : 76                  	hlt
    4722/    1FEC : 76                  	hlt
    4722/    1FED : 76                  	hlt
    4722/    1FEE : 76                  	hlt
    4722/    1FEF : 76                  	hlt
    4722/    1FF0 : 76                  	hlt
    4722/    1FF1 : 76                  	hlt
    4722/    1FF2 : 76                  	hlt
    4722/    1FF3 : 76                  	hlt
    4722/    1FF4 : 76                  	hlt
    4722/    1FF5 : 76                  	hlt
    4722/    1FF6 : 76                  	hlt
    4722/    1FF7 : 76                  	hlt
    4722/    1FF8 : 76                  	hlt
    4722/    1FF9 : 76                  	hlt
    4724/    1FFA :                     
    4725/    1FFA : 04                  	db	04H
    4726/    1FFB : 59                  	db	059H
    4727/    1FFC :                     L1FFC:
    4728/    1FFC : 01                  	db	01H
    4729/    1FFD : FE                  	db	0FEH
    4730/    1FFE : 75 02               	dw	0275H				;checksum
    4731/    2000 :                     	
    4732/    2000 : =>FALSE             	if 0
    4733/    2000 :                     ;
    4734/    2000 :                     ; Necessary when assembling code for ROM2 separately
    4735/    2000 :                     ;
    4736/    2000 :                     	ORG	02000H
    4737/    2000 :                     	INCLUDE Tek468DeviceInfo.inc
    4738/    2000 :                     	INCLUDE Tek468Variables.inc
    4739/    2000 :                     ;
    4740/    2000 :                     ; Rom565 entry points
    4741/    2000 :                     ;
    4742/    2000 :                     AddMainAction		equ	0049H
    4743/    2000 :                     Get_Word_From_Table equ	004FH
    4744/    2000 :                     SYSRAM_Area			equ	0040H
    4745/    2000 :                     Display_Action_7	equ	0046H
    4746/    2000 :                     Display_Action_6	equ	004CH
    4747/    2000 :                     RenderCursorLine	equ	0052H
    4748/    2000 :                     StrobeDisplayRAM	equ	0055H
    4749/    2000 :                     SetUpLineCursor		equ	0058H
    4750/    2000 :                     EnableLineCursor	equ	005BH
    4751/    2000 :                     
    4752/    2000 : [4732]              	endif
    4753/    2000 :                     
    4754/    2000 : 76                  	db	076h
    4755/    2001 :                     ;
    4756/    2001 :                     ; this Action Table used for action codes >= 0x78
    4757/    2001 :                     ; for GPIB support.
    4758/    2001 :                     ;
    4759/    2001 :                     Action_Table2:	
    4760/    2001 : 59 20 44 20 41 20   	dw	Action_0x79,Action_0x7A,Action_0x7B,Action_0x7C,Action_0x7D,Action_0x7E
                    3E 20 53 20 4D 20 
    4761/    200D : 30 00 56 20 30 00   	dw 	RST6,Action_0x80,RST6,Action_0x82,Action_0x83,Action_0x84
                    5C 20 4A 20 50 20 
    4762/    2019 :                     	
    4763/    2019 :                     ScratchRamTable:	
    4764/    2019 : 00 88 00 89 00 8A   	dw	RAM_SCRATCH,RAM_SCRATCH+0100h,RAM_SCRATCH+0200h,RAM_SCRATCH+0300h
                    00 8B 
    4765/    2021 :                     DisplayRamTable:	
    4766/    2021 : 00 A0 00 A2 00 A4   	dw	RAM_DISPLAY,RAM_DISPLAY+0200h,RAM_DISPLAY+0400h,RAM_DISPLAY+0600h
                    00 A6 
    4767/    2029 :                     
    4768/    2029 :                     Display_Interrupt:
    4769/    2029 : C3 4C 25            	jmp	Display_Interrupt_0
    4770/    202C :                     Init_Display:						;init
    4771/    202C : C3 B1 24            	jmp	Init_Display_0
    4772/    202F :                     InitDisplayRB:						;init
    4773/    202F : C3 57 28            	jmp	InitDisplayRB_0
    4774/    2032 :                     	
    4775/    2032 :                     Init_GPIB:	
    4776/    2032 : C3 62 28            	jmp	Init_GPIB_0
    4777/    2035 :                     	
    4778/    2035 :                     AddDisplayAction:
    4779/    2035 : C3 EB 27            	jmp	AddDisplayAction_0
    4780/    2038 :                     Main_Action_6:
    4781/    2038 : C3 D5 28            	jmp	Main_Action_6_0
    4782/    203B :                     Main_Action_1:	
    4783/    203B : C3 E5 30            	jmp	Main_Action_1_0
    4784/    203E :                     	
    4785/    203E :                     Action_0x7C:	
    4786/    203E : C3 E9 32            	jmp	Action_0x7C_0
    4787/    2041 :                     Action_0x7B:	
    4788/    2041 : C3 59 33            	jmp	Action_0x7B_0
    4789/    2044 :                     Action_0x7A:	
    4790/    2044 : C3 3D 34            	jmp	Action_0x7A_0
    4791/    2047 :                     Remove_GPIB_Actions:
    4792/    2047 : C3 62 16            	jmp	Remove_GPIB_Actions_0
    4793/    204A :                     Action_0x83:	
    4794/    204A : C3 55 34            	jmp	Action_0x83_0
    4795/    204D :                     Action_0x7E:	
    4796/    204D : C3 C3 34            	jmp	Action_0x7E_0
    4797/    2050 :                     Action_0x84:	
    4798/    2050 : C3 DE 34            	jmp	Action_0x84_0
    4799/    2053 :                     Action_0x7D:	
    4800/    2053 : C3 F9 34            	jmp	Action_0x7D_0
    4801/    2056 :                     Action_0x80:	
    4802/    2056 : C3 39 35            	jmp	Action_0x80_0
    4803/    2059 :                     Action_0x79:
    4804/    2059 : C3 9B 3C            	jmp	Action_0x79_0
    4805/    205C :                     Action_0x82:	
    4806/    205C : C3 12 3D            	jmp	Action_0x82_0
    4807/    205F :                     
    4808/    205F :                     Set_IE:
    4809/    205F : C3 E4 25            	jmp	EnableDisplayInterrupt
    4810/    2062 :                     Display_Action_5:
    4811/    2062 : C3 B4 20            	jmp	Display_Action_5_0
    4812/    2065 :                     Update_DEV_WIFCTL_and:
    4813/    2065 : C3 7A 20            	jmp	Update_DEV_WIFCTL_and_0
    4814/    2068 :                     Update_DEV_FPC_and:
    4815/    2068 : C3 83 20            	jmp	Update_DEV_FPC_and_0
    4816/    206B :                     CursorPotInt2:
    4817/    206B : C3 FB 28            	jmp	CursorPotInt2_0
    4818/    206E :                     	
    4819/    206E :                     Get_GPIB_Status:
    4820/    206E : C3 A2 28            	jmp	Get_GPIB_Status_0
    4821/    2071 :                     	
    4822/    2071 :                     ClrCursorSnap:
    4823/    2071 : C3 31 27            	jmp	ClrCursorSnap_0
    4824/    2074 :                     AdjustCursorTime:
    4825/    2074 : C3 A4 23            	jmp	AdjustCursorTime_0
    4826/    2077 :                     GetWFExpandVal:
    4827/    2077 : C3 D9 23            	jmp	GetWFExpandVal_0
    4828/    207A :                     ;
    4829/    207A :                     ; in A
    4830/    207A :                     ;
    4831/    207A :                     Update_DEV_WIFCTL_and_0:
    4832/    207A : 21 17 80            	lxi	h,V_WIFCTL
    4833/    207D : A6                  	ana	m
    4834/    207E : 77                  	mov	m,a
    4835/    207F : 32 06 F0            	sta	DEV_WIFCTL			;GPIB
    4836/    2082 : C9                  	ret
    4837/    2083 :                     ;
    4838/    2083 :                     ; in A
    4839/    2083 :                     ; DEV_FPC = V_FPC = V_FPC & A
    4840/    2083 :                     ;
    4841/    2083 :                     Update_DEV_FPC_and_0:
    4842/    2083 : 21 70 80            	lxi	h,V_FPC
    4843/    2086 : A6                  	ana	m
    4844/    2087 : 77                  	mov	m,a
    4845/    2088 : 32 40 E0            	sta	DEV_FPC
    4846/    208B : C9                  	ret
    4847/    208C :                     ;
    4848/    208C :                     ; in A
    4849/    208C :                     ;
    4850/    208C :                     Update_DEV_FPC_or:
    4851/    208C : 21 70 80            	lxi	h,V_FPC
    4852/    208F : B6                  	ora	m
    4853/    2090 : 77                  	mov	m,a
    4854/    2091 : 32 40 E0            	sta	DEV_FPC
    4855/    2094 : C9                  	ret
    4856/    2095 :                     	
    4857/    2095 :                     L2095:
    4858/    2095 : 21 17 80            	lxi	h,V_WIFCTL
    4859/    2098 : B6                  	ora	m
    4860/    2099 : 77                  	mov	m,a
    4861/    209A : 32 06 F0            	sta	DEV_WIFCTL
    4862/    209D : C9                  	ret
    4863/    209E :                     ;
    4864/    209E :                     ; WF Display: submit new WFs
    4865/    209E :                     ;
    4866/    209E :                     Display_Action_1:	
    4867/    209E : 3A 3E 80            	lda	V_CurrWF 			;range 1..4 Current WaveForm area
    4868/    20A1 : 87                  	add	a					;x2
    4869/    20A2 : 6F                  	mov	l,a
    4870/    20A3 : 26 00               	mvi	h,00h
    4871/    20A5 : 11 17 20            	lxi	d,ScratchRamTable-2	;determine Memory Area. Index base 1
    4872/    20A8 : 19                  	dad	d
    4873/    20A9 : 5E                  	mov	e,m					;get Display Memory Area in DE
    4874/    20AA : 23                  	inx	h
    4875/    20AB : 56                  	mov	d,m
    4876/    20AC : EB                  	xchg					;to HL
    4877/    20AD : 22 DE 80            	shld V_pWF_Source		;store Display Memory Area
    4878/    20B0 : CD CA 20            	call Copy_WF			;V_pWF_Source
    4879/    20B3 : C9                  	ret
    4880/    20B4 :                     	
    4881/    20B4 :                     Display_Action_5_0:
    4882/    20B4 : 3A 3E 80            	lda	V_CurrWF 			;range 1..10 Current WF area
    4883/    20B7 : 87                  	add	a					;x2
    4884/    20B8 : 6F                  	mov	l,a
    4885/    20B9 : 26 00               	mvi	h,00h
    4886/    20BB : 11 3E 00            	lxi	d,SYSRAM_Area-2		;determine Memory Area
    4887/    20BE : 19                  	dad	d
    4888/    20BF : 5E                  	mov	e,m					;get Display Data in DE
    4889/    20C0 : 23                  	inx	h
    4890/    20C1 : 56                  	mov	d,m
    4891/    20C2 : EB                  	xchg
    4892/    20C3 : 22 DE 80            	shld V_pWF_Source		;store
    4893/    20C6 : CD CA 20            	call Copy_WF			;V_pWF_Source
    4894/    20C9 : C9                  	ret
    4895/    20CA :                     ;
    4896/    20CA :                     ; Display related: copy a WaveForm
    4897/    20CA :                     ;	
    4898/    20CA :                     Copy_WF:
    4899/    20CA : 3A 3E 80            	lda	V_CurrWF 			;current WaveForm area. Range 1..4
    4900/    20CD : 21 7F 80            	lxi	h,V_WFTable			;p = &Table[1].field
    4901/    20D0 : 11 08 00            	lxi	d,0008H
    4902/    20D3 :                     $$L:
    4903/    20D3 : 3D                  	dcr	a
    4904/    20D4 : CA DB 20            	jz	L20DB
    4905/    20D7 : 19                  	dad	d
    4906/    20D8 : C3 D3 20            	jmp	$$L
    4907/    20DB :                     L20DB:
    4908/    20DB : 22 7D 80            	shld V_pDispWF			;store p
    4909/    20DE : 3A BF 80            	lda	V_CONTRL
    4910/    20E1 : F6 03               	ori	03h					;00000011 BOTH|ODD
    4911/    20E3 : 32 41 E0            	sta	DEV_CONTRL
    4912/    20E6 : 3A 3E 80            	lda	V_CurrWF 			;current WaveForm area. Base 1	
    4913/    20E9 : 87                  	add	a					;times 2
    4914/    20EA : 6F                  	mov	l,a					;to HL
    4915/    20EB : 26 00               	mvi	h,00h
    4916/    20ED : 11 1F 20            	lxi	d,DisplayRamTable-2	;WaveForm area
    4917/    20F0 : 19                  	dad	d
    4918/    20F1 : 5E                  	mov	e,m
    4919/    20F2 : 23                  	inx	h
    4920/    20F3 : 56                  	mov	d,m
    4921/    20F4 : EB                  	xchg					;HL now new WaveForm area
    4922/    20F5 : 22 DC 80            	shld V_pWF_Destination	;store
    4923/    20F8 : 2A 7D 80            	lhld V_pDispWF			;restore p
    4924/    20FB : 23                  	inx	h					;p += 5
    4925/    20FC : 23                  	inx	h
    4926/    20FD : 23                  	inx	h
    4927/    20FE : 23                  	inx	h
    4928/    20FF : 23                  	inx	h
    4929/    2100 : 7E                  	mov	a,m					;get data
    4930/    2101 : E6 04               	ani	04h					;LONGWFMASK
    4931/    2103 : 32 E0 80            	sta	VAR_80E0			;save
    4932/    2106 : FE 04               	cpi	04h					;was bit 2 set
    4933/    2108 : C2 13 21            	jnz	L2113
    4934/    210B : 3E 04               	mvi	a,04h
    4935/    210D : 32 DB 80            	sta	VAR_80DB
    4936/    2110 : C3 23 21            	jmp	L2123
    4937/    2113 :                     L2113:
    4938/    2113 : 3A E0 80            	lda	VAR_80E0
    4939/    2116 : FE 00               	cpi	00h
    4940/    2118 : C2 23 21            	jnz	L2123
    4941/    211B : 3E 02               	mvi	a,02h
    4942/    211D : 32 DB 80            	sta	VAR_80DB
    4943/    2120 : C3 23 21            	jmp	L2123
    4944/    2123 : 3A DB 80            L2123:	lda	VAR_80DB
    4945/    2126 : 47                  	mov	b,a
    4946/    2127 : 2A DC 80            	lhld V_pWF_Destination
    4947/    212A : EB                  	xchg
    4948/    212B : 2A DE 80            	lhld V_pWF_Source
    4949/    212E :                     ;
    4950/    212E :                     ; copy B times
    4951/    212E :                     ;
    4952/    212E :                     $$L2:
    4953/    212E :                     ;
    4954/    212E :                     ; copy 128 bytes from (HL) to (DE) skipping each destination byte one
    4955/    212E :                     ;
    4956/    212E : 0E 80               	mvi	c,80h
    4957/    2130 :                     $$L:						;L2130:
    4958/    2130 : 7E                  	mov	a,m
    4959/    2131 : 23                  	inx	h					;HL += 1
    4960/    2132 : 12                  	stax	d
    4961/    2133 : 13                  	inx	d					;DE += 2
    4962/    2134 : 13                  	inx	d
    4963/    2135 : 0D                  	dcr	c
    4964/    2136 : C2 30 21            	jnz	$$L
    4965/    2139 : 05                  	dcr	b
    4966/    213A : C2 2E 21            	jnz	$$L2
    4967/    213D :                     ;	
    4968/    213D : 2A 3E 80            	lhld V_CurrWF 			;current WaveForm area base 1
    4969/    2140 : 26 00               	mvi	h,00h
    4970/    2142 : 11 9E 80            	lxi	d,V_ValidWFs-1
    4971/    2145 : 19                  	dad	d
    4972/    2146 : 3E FF               	mvi	a,0FFh
    4973/    2148 : 77                  	mov	m,a
    4974/    2149 : 3A A6 80            	lda	V_fSAVEREFShowing	;boolean
    4975/    214C : 2F                  	cma
    4976/    214D : 4F                  	mov	c,a
    4977/    214E : 3A 20 80            	lda	V_fADD
    4978/    2151 : A1                  	ana	c
    4979/    2152 : 4F                  	mov	c,a
    4980/    2153 : 3A 1E 80            	lda	V_fCH1
    4981/    2156 : 47                  	mov	b,a
    4982/    2157 : 3A 1F 80            	lda	V_fCH2
    4983/    215A : B0                  	ora	b
    4984/    215B : A1                  	ana	c
    4985/    215C : F2 6B 21            	jp	L216B
    4986/    215F :                     ;	
    4987/    215F :                     L215F:
    4988/    215F : 3A A1 80            	lda	V_ValidWFs+2		;boolean test
    4989/    2162 : 17                  	ral
    4990/    2163 : D2 72 21            	jnc	L2172
    4991/    2166 : 3E 03               	mvi	a,03h
    4992/    2168 : C3 74 21            	jmp	L2174
    4993/    216B : 3A 9F 80            L216B:	lda	V_ValidWFs		;boolean test
    4994/    216E : 17                  	ral
    4995/    216F : D2 5F 21            	jnc	L215F
    4996/    2172 : 3E 01               L2172:	mvi	a,01h
    4997/    2174 : 32 A3 80            L2174:	sta	V_PrimaryWF
    4998/    2177 : 3E FF               	mvi	a,0FFh
    4999/    2179 : 32 01 80            	sta	V_fOK2ProcessAcq
    5000/    217C : C9                  	ret
    5001/    217D :                     ;
    5002/    217D :                     ; Display related
    5003/    217D :                     ;
    5004/    217D :                     ; Local V_BOTHODD
    5005/    217D :                     ;	
    5006/    217D :                     RenderWF:
    5007/    217D : 3A 40 80            	lda	V_DispWF			;base 1
    5008/    2180 : 3D                  	dcr	a					;base 0
    5009/    2181 : 07                  	rlc						;x8
    5010/    2182 : 07                  	rlc
    5011/    2183 : 07                  	rlc
    5012/    2184 : 21 7F 80            	lxi	h,V_WFTable			;p = V_WFTable[V_DispWF-1]
    5013/    2187 : 5F                  	mov	e,a
    5014/    2188 : 16 00               	mvi	d,00h
    5015/    218A : 19                  	dad	d
    5016/    218B : 22 7D 80            	shld V_pDispWF			;ptr to WF being rendered
    5017/    218E : 2A E1 80            	lhld V_pRAM_DOT
    5018/    2191 : EB                  	xchg
    5019/    2192 : 2A E3 80            	lhld V_pRAM_DOT2
    5020/    2195 : 7A                  	mov	a,d
    5021/    2196 : B3                  	ora	e
    5022/    2197 : B4                  	ora	h
    5023/    2198 : B5                  	ora	l
    5024/    2199 : CA AF 21            	jz	L21AF				;both V_pRAM_DOT & V_pRAM_DOT2 are NIL
    5025/    219C : 2A E1 80            	lhld V_pRAM_DOT
    5026/    219F : 36 01               	mvi	m,01h
    5027/    21A1 : 2A E3 80            	lhld V_pRAM_DOT2
    5028/    21A4 : 36 01               	mvi	m,01h
    5029/    21A6 : 21 00 00            	lxi	h,0000H
    5030/    21A9 : 22 E1 80            	shld V_pRAM_DOT		;set both to 0
    5031/    21AC : 22 E3 80            	shld V_pRAM_DOT2
    5032/    21AF : 3A AA 80            L21AF:	lda	V_CursorMode
    5033/    21B2 : FE 02               	cpi	02h
    5034/    21B4 : CA BC 21            	jz	L21BC
    5035/    21B7 : FE 03               	cpi	03h
    5036/    21B9 : C2 50 22            	jnz	L2250
    5037/    21BC :                     L21BC:
    5038/    21BC :                     ;
    5039/    21BC :                     ; Feature: If SAVE mode, time cursor dot shows on BOTH WFs, not just the primary
    5040/    21BC :                     ; See Operators Manual Page 71	
    5041/    21BC :                     ;
    5042/    21BC : 3A A5 80            	lda	V_DigitalMode
    5043/    21BF : FE 04               	cpi	DIGITAL_SAVE
    5044/    21C1 : C2 D4 21            	jnz	L21D4
    5045/    21C4 : 2A 7D 80            	lhld V_pDispWF
    5046/    21C7 : 23                  	inx	h
    5047/    21C8 : 23                  	inx	h
    5048/    21C9 : 23                  	inx	h
    5049/    21CA : 23                  	inx	h
    5050/    21CB : 7E                  	mov	a,m
    5051/    21CC : E6 80               	ani	80h					;10000000
    5052/    21CE : C2 50 22            	jnz	L2250
    5053/    21D1 : C3 DF 21            	jmp	L21DF
    5054/    21D4 :                     ; V_DigitalMode != 4
    5055/    21D4 :                     L21D4:
    5056/    21D4 : 3A 40 80            	lda	V_DispWF
    5057/    21D7 : 47                  	mov	b,a
    5058/    21D8 : 3A A3 80            	lda	V_PrimaryWF
    5059/    21DB : B8                  	cmp	b
    5060/    21DC : C2 50 22            	jnz	L2250
    5061/    21DF :                     ;
    5062/    21DF :                     L21DF:
    5063/    21DF : 2A B3 80            	lhld V_TimeCursorPos
    5064/    21E2 : 22 BB 80            	shld V_TmpCursorPos
    5065/    21E5 : 2A B5 80            	lhld V_TimeCursorPos+2
    5066/    21E8 : 22 BD 80            	shld V_TmpCursorPos+2
    5067/    21EB : CD D9 23            	call GetWFExpandVal_0
    5068/    21EE : CD A4 23            	call AdjustCursorTime_0
    5069/    21F1 : 2A 7D 80            	lhld V_pDispWF
    5070/    21F4 : 11 05 00            	lxi	d,0005H
    5071/    21F7 : 19                  	dad	d
    5072/    21F8 : 7E                  	mov	a,m
    5073/    21F9 : E6 04               	ani	04h					;LONGWFMASK
    5074/    21FB : FE 04               	cpi	04h
    5075/    21FD : CA 1F 22            	jz	L221F
    5076/    2200 : 2A BB 80            	lhld V_TmpCursorPos		;Cursor1
    5077/    2203 : CD 5C 24            	call ShiftR_HL
    5078/    2206 : EB                  	xchg					;DE=Cursor1
    5079/    2207 : 2A BD 80            	lhld V_TmpCursorPos+2	;Cursor2
    5080/    220A : CD 5C 24            	call ShiftR_HL			;HL=Cursor2
    5081/    220D : 3A 40 80            	lda	V_DispWF
    5082/    2210 : E6 01               	ani	01h
    5083/    2212 : C2 26 22            	jnz	L2226
    5084/    2215 : 01 00 02            	lxi	b,0200H
    5085/    2218 : 09                  	dad	b
    5086/    2219 : EB                  	xchg
    5087/    221A : 09                  	dad	b
    5088/    221B : EB                  	xchg
    5089/    221C : C3 26 22            	jmp	L2226
    5090/    221F :                     L221F:
    5091/    221F : 2A BB 80            	lhld V_TmpCursorPos
    5092/    2222 : EB                  	xchg					;DE=Cursor1
    5093/    2223 : 2A BD 80            	lhld V_TmpCursorPos+2	;HL=Cursor2
    5094/    2226 :                     L2226:
    5095/    2226 : 3A 14 80            	lda	V_fSnappedCursor		;test boolean
    5096/    2229 : 17                  	ral
    5097/    222A : D2 3D 22            	jnc	L223D
    5098/    222D : 3A 15 80            	lda	V_fCursor1Snapped
    5099/    2230 : 17                  	ral
    5100/    2231 : D2 3A 22            	jnc	L223A
    5101/    2234 : 11 01 00            	lxi	d,0001H
    5102/    2237 : C3 3D 22            	jmp	L223D
    5103/    223A : 21 01 00            L223A:	lxi	h,0001H
    5104/    223D : 01 00 B0            L223D:	lxi	b,RAM_DOT
    5105/    2240 : 09                  	dad	b
    5106/    2241 : 36 00               	mvi	m,00h
    5107/    2243 : 22 E3 80            	shld V_pRAM_DOT2		;ptr to RAM_DOT memory
    5108/    2246 : 01 00 B0            	lxi	b,RAM_DOT
    5109/    2249 : EB                  	xchg
    5110/    224A : 09                  	dad	b
    5111/    224B : 36 00               	mvi	m,00h
    5112/    224D : 22 E1 80            	shld V_pRAM_DOT			;ptr to RAM_DOT memory
    5113/    2250 :                     L2250:
    5114/    2250 : 2A 7D 80            	lhld V_pDispWF
    5115/    2253 : 23                  	inx	h
    5116/    2254 : 23                  	inx	h
    5117/    2255 : 23                  	inx	h
    5118/    2256 : 23                  	inx	h
    5119/    2257 : 23                  	inx	h
    5120/    2258 : 7E                  	mov	a,m
    5121/    2259 : E6 03               	ani	03h
    5122/    225B : FE 02               	cpi	02h
    5123/    225D : C2 82 22            	jnz	L2282
    5124/    2260 : 3A E5 80            	lda	V_BOTHODD
    5125/    2263 : FE 02               	cpi	02h
    5126/    2265 : C2 82 22            	jnz	L2282
    5127/    2268 : 3A AA 80            	lda	V_CursorMode
    5128/    226B : FE 02               	cpi	02h
    5129/    226D : CA 78 22            	jz	L2278
    5130/    2270 : 3A AA 80            	lda	V_CursorMode
    5131/    2273 : FE 03               	cpi	03h
    5132/    2275 : C2 82 22            	jnz	L2282
    5133/    2278 : 2A E1 80            L2278:	lhld V_pRAM_DOT
    5134/    227B : 36 01               	mvi	m,01h
    5135/    227D : 2A E3 80            	lhld V_pRAM_DOT2
    5136/    2280 : 36 01               	mvi	m,01h
    5137/    2282 :                     L2282:
    5138/    2282 : 3A 40 80            	lda	V_DispWF			;base 1
    5139/    2285 : 3D                  	dcr	a					;base 0
    5140/    2286 : 87                  	add	a					;x2
    5141/    2287 : 5F                  	mov	e,a
    5142/    2288 : 16 00               	mvi	d,00h
    5143/    228A : 21 21 20            	lxi	h,DisplayRamTable	;p = &DisplayRamTable[V_DispWF-1]
    5144/    228D : 19                  	dad	d
    5145/    228E : 5E                  	mov	e,m					;DE = *(word *)p
    5146/    228F : 23                  	inx	h
    5147/    2290 : 56                  	mov	d,m
    5148/    2291 : 13                  	inx	d
    5149/    2292 : 1A                  	ldax d					;A = *(DE+1)
    5150/    2293 : 2A 7D 80            	lhld V_pDispWF			;p
    5151/    2296 : 11 02 00            	lxi	d,0002H
    5152/    2299 : 19                  	dad	d					;p+2
    5153/    229A : 7E                  	mov	a,m					;*(p+2)
    5154/    229B : 32 06 E4            	sta	DEV_HGAIN
    5155/    229E : 23                  	inx	h					;p+3
    5156/    229F : 3A A4 80            	lda	V_DISREG
    5157/    22A2 : E6 F7               	ani	0F7h				;11110111 Clr VERT10X
    5158/    22A4 : 32 A4 80            	sta	V_DISREG
    5159/    22A7 : 7E                  	mov	a,m					;*(p+3)
    5160/    22A8 : 32 05 E4            	sta	DEV_VGAIN
    5161/    22AB : FE 18               	cpi	18h					;24
    5162/    22AD : C2 B8 22            	jnz	L22B8
    5163/    22B0 :                     ;  DEV_VGAIN == 0x18
    5164/    22B0 : 3A A4 80            	lda	V_DISREG
    5165/    22B3 : F6 08               	ori	08h					;00001000 Set VERT10X
    5166/    22B5 : 32 A4 80            	sta	V_DISREG
    5167/    22B8 :                     L22B8:
    5168/    22B8 : 2A 7D 80            	lhld V_pDispWF
    5169/    22BB : 0E 01               	mvi	c,01h
    5170/    22BD : 06 00               	mvi	b,00h
    5171/    22BF : 09                  	dad	b
    5172/    22C0 : 7E                  	mov	a,m
    5173/    22C1 : A7                  	ana	a
    5174/    22C2 : CA F3 22            	jz	L22F3
    5175/    22C5 : 32 01 E4            	sta	DEV_LINER
    5176/    22C8 : AF                  	xra	a
    5177/    22C9 : 32 04 E4            	sta	DEV_JITTER
    5178/    22CC : CD 65 24            	call SetVertPositioning
    5179/    22CF : 3A BF 80            	lda	V_CONTRL
    5180/    22D2 : E6 EF               	ani	0EFh				;11101111 set LINECUR (Active Low)
    5181/    22D4 : 32 41 E0            	sta	DEV_CONTRL
    5182/    22D7 : CD DD 22            	call L22DD				;delay
    5183/    22DA : C3 DE 22            	jmp	L22DE
    5184/    22DD :                     L22DD:
    5185/    22DD : C9                  	ret
    5186/    22DE :                     L22DE:
    5187/    22DE : E6 BF               	ani	0BFh				;10111111 Set ZAXON (Active Low)
    5188/    22E0 : F3                  	di
    5189/    22E1 : 32 41 E0            	sta	DEV_CONTRL
    5190/    22E4 : 3A BF 80            	lda	V_CONTRL
    5191/    22E7 : E6 EF               	ani	0EFh				;11101111 Toggle LINECUR (Active Low)
    5192/    22E9 : 32 41 E0            	sta	DEV_CONTRL
    5193/    22EC : F6 10               	ori	10h
    5194/    22EE : 00                  	nop
    5195/    22EF : 32 41 E0            	sta	DEV_CONTRL
    5196/    22F2 : FB                  	ei
    5197/    22F3 :                     L22F3:
    5198/    22F3 : 2A 7D 80            	lhld V_pDispWF
    5199/    22F6 : 23                  	inx	h
    5200/    22F7 : 23                  	inx	h
    5201/    22F8 : 23                  	inx	h
    5202/    22F9 : 23                  	inx	h
    5203/    22FA : 23                  	inx	h
    5204/    22FB : 7E                  	mov	a,m
    5205/    22FC : E6 03               	ani	03h
    5206/    22FE : FE 02               	cpi	02h
    5207/    2300 : C2 0B 23            	jnz	L230B
    5208/    2303 : 3A E5 80            	lda	V_BOTHODD
    5209/    2306 : FE 02               	cpi	02h
    5210/    2308 : C2 0E 23            	jnz	L230E
    5211/    230B : C3 1E 23            L230B:	jmp	L231E
    5212/    230E : 2A 7D 80            L230E:	lhld V_pDispWF
    5213/    2311 : 11 02 00            	lxi	d,0002H
    5214/    2314 : 19                  	dad	d
    5215/    2315 : 7E                  	mov	a,m
    5216/    2316 : 1F                  	rar
    5217/    2317 : D2 1B 23            	jnc	L231B
    5218/    231A : 3C                  	inr	a
    5219/    231B : 32 06 E4            L231B:	sta	DEV_HGAIN
    5220/    231E : 2A 7D 80            L231E:	lhld V_pDispWF
    5221/    2321 : 23                  	inx	h
    5222/    2322 : 23                  	inx	h
    5223/    2323 : 23                  	inx	h
    5224/    2324 : 23                  	inx	h
    5225/    2325 : 23                  	inx	h
    5226/    2326 : 7E                  	mov	a,m
    5227/    2327 : E6 03               	ani	03h
    5228/    2329 : FE 02               	cpi	02h
    5229/    232B : C2 60 23            	jnz	L2360
    5230/    232E : 3A E5 80            	lda	V_BOTHODD
    5231/    2331 : E6 03               	ani	03h
    5232/    2333 : 32 E5 80            	sta	V_BOTHODD
    5233/    2336 : 3E 02               	mvi	a,02h				;0x02 | 0x01 = 0x03 -> 0xFC
    5234/    2338 : F6 01               	ori	01h
    5235/    233A : 2F                  	cma
    5236/    233B : 21 BF 80            	lxi	h,V_CONTRL
    5237/    233E : A6                  	ana	m					;Clr BOTH ODD
    5238/    233F : 21 E5 80            	lxi	h,V_BOTHODD
    5239/    2342 : B6                  	ora	m
    5240/    2343 : 32 BF 80            	sta	V_CONTRL
    5241/    2346 : 3A E5 80            	lda	V_BOTHODD
    5242/    2349 : FE 02               	cpi	02h
    5243/    234B : C2 55 23            	jnz	L2355
    5244/    234E : AF                  	xra	a
    5245/    234F : 32 E5 80            	sta	V_BOTHODD
    5246/    2352 : C3 5D 23            	jmp	L235D
    5247/    2355 : 21 E5 80            L2355:	lxi	h,V_BOTHODD
    5248/    2358 : 34                  	inr	m
    5249/    2359 : 21 40 80            	lxi	h,V_DispWF
    5250/    235C : 35                  	dcr	m
    5251/    235D : C3 6C 23            L235D:	jmp	L236C
    5252/    2360 : 3A BF 80            L2360:	lda	V_CONTRL
    5253/    2363 : F6 02               	ori	02h					;00000010 BOTH
    5254/    2365 : 32 BF 80            	sta	V_CONTRL
    5255/    2368 : AF                  	xra	a
    5256/    2369 : 32 E5 80            	sta	V_BOTHODD
    5257/    236C :                     L236C:
    5258/    236C : CD 65 24            	call SetVertPositioning
    5259/    236F : 2A 7D 80            	lhld V_pDispWF
    5260/    2372 : 7E                  	mov	a,m
    5261/    2373 : 32 04 E4            	sta	DEV_JITTER
    5262/    2376 : 11 05 00            	lxi	d,0005H
    5263/    2379 : 19                  	dad	d
    5264/    237A : 7E                  	mov	a,m
    5265/    237B : E6 04               	ani	04h
    5266/    237D : FE 04               	cpi	04h
    5267/    237F : C2 91 23            	jnz	L2391
    5268/    2382 : 21 A4 80            	lxi	h,V_DISREG
    5269/    2385 : 3E 20               	mvi	a,20h				;0x20 | 0x10 = 0x30 ->11001111 0xCF
    5270/    2387 : F6 10               	ori	10h
    5271/    2389 : 2F                  	cma
    5272/    238A : A6                  	ana	m
    5273/    238B : F6 40               	ori	40h					;01000000 STOP512
    5274/    238D : 77                  	mov	m,a					;update V_DISREG
    5275/    238E : C3 9D 23            	jmp	L239D
    5276/    2391 : 21 A4 80            L2391:	lxi	h,V_DISREG
    5277/    2394 : 3E 40               	mvi	a,40h				;0x40 | 0x10 = 0x50 ->10101111 0xAF
    5278/    2396 : F6 10               	ori	10h
    5279/    2398 : 2F                  	cma
    5280/    2399 : A6                  	ana	m
    5281/    239A : F6 20               	ori	20h					;00100000 STOP256
    5282/    239C : 77                  	mov	m,a					;update V_DISREG
    5283/    239D : 3A BF 80            L239D:	lda	V_CONTRL
    5284/    23A0 : 32 41 E0            	sta	DEV_CONTRL
    5285/    23A3 : C9                  	ret
    5286/    23A4 :                     ;
    5287/    23A4 :                     ; in V_CNT
    5288/    23A4 :                     ; updates V_TmpCursorPos, V_TmpCursorPos+2
    5289/    23A4 :                     ;
    5290/    23A4 :                     AdjustCursorTime_0:
    5291/    23A4 : 3A E8 80            	lda	V_CNT
    5292/    23A7 : A7                  	ana	a
    5293/    23A8 : C8                  	rz							;done if 0
    5294/    23A9 : 32 E9 80            	sta	V_Cnt_2
    5295/    23AC : 2A BB 80            	lhld V_TmpCursorPos
    5296/    23AF :                     Loop23AF:
    5297/    23AF : CD AD 2C            	call Take80Percent
    5298/    23B2 : 3A E9 80            	lda	V_Cnt_2
    5299/    23B5 : 3D                  	dcr	a
    5300/    23B6 : 32 E9 80            	sta	V_Cnt_2
    5301/    23B9 : C2 AF 23            	jnz	Loop23AF				;loop
    5302/    23BC : 22 BB 80            	shld V_TmpCursorPos
    5303/    23BF : 3A E8 80            	lda	V_CNT
    5304/    23C2 : 32 E9 80            	sta	V_Cnt_2
    5305/    23C5 : 2A BD 80            	lhld V_TmpCursorPos+2
    5306/    23C8 :                     Loop23C8:
    5307/    23C8 : CD AD 2C            	call Take80Percent
    5308/    23CB : 3A E9 80            	lda	V_Cnt_2
    5309/    23CE : 3D                  	dcr	a
    5310/    23CF : 32 E9 80            	sta	V_Cnt_2
    5311/    23D2 : C2 C8 23            	jnz	Loop23C8				;loop
    5312/    23D5 : 22 BD 80            	shld V_TmpCursorPos+2
    5313/    23D8 : C9                  	ret
    5314/    23D9 :                     ;
    5315/    23D9 :                     ; V_TargetTB2 is TIME value for current Time Base
    5316/    23D9 :                     ; Sets V_CNT
    5317/    23D9 :                     ;
    5318/    23D9 :                     ; Always called from Display Interrupt with interrupts running so UIState may suddenly change.
    5319/    23D9 :                     ;
    5320/    23D9 :                     ; More unnecessary verbose code.
    5321/    23D9 :                     ;
    5322/    23D9 :                     GetWFExpandVal_0:
    5323/    23D9 : AF                  	xra	a
    5324/    23DA : 32 E8 80            	sta	V_CNT				;reset
    5325/    23DD : 3A 23 80            	lda	V_ATimebaseActive	;determine UIState TB
    5326/    23E0 : 17                  	ral
    5327/    23E1 : D2 ED 23            	jnc	Local23ED
    5328/    23E4 : 3A 18 80            	lda	V_ATIME
    5329/    23E7 : 32 EA 80            	sta	V_TargetTB2
    5330/    23EA : C3 F3 23            	jmp	Local23F3
    5331/    23ED :                     Local23ED:
    5332/    23ED : 3A 19 80            	lda	V_BTIME
    5333/    23F0 : 32 EA 80            	sta	V_TargetTB2
    5334/    23F3 :                     Local23F3:
    5335/    23F3 :                     ;
    5336/    23F3 :                     ; Note: V_TargetTB2 is not the actually acquired TB which is max TB20
    5337/    23F3 :                     ;
    5338/    23F3 : 3A A5 80            	lda	V_DigitalMode		;UIState may change
    5339/    23F6 : FE 04               	cpi	DIGITAL_SAVE
    5340/    23F8 : C2 4D 24            	jnz	Local244D
    5341/    23FB :                     ;
    5342/    23FB :                     ; V_DigitalMode == DIGITAL_SAVE
    5343/    23FB :                     ;
    5344/    23FB :                     ; Tektronix bug:
    5345/    23FB :                     ; V_pDispWF and V_PrimaryWF are not always in sync here when called from RenderCursorLine()
    5346/    23FB :                     ; GetWFExpandVal() is looking at the last Rendered WF. Investigated with SAVEREF and Chopped Ch1/Ch2
    5347/    23FB :                     ; Turns out the timebase field in the WFTbl is not updated, even when "interpolated" in SAVE mode.
    5348/    23FB :                     ; so acquiredTB below may be way off (SAVEREF TB != target TB),
    5349/    23FB :                     ; For example, select 2 WFs at say timebase 9 (ch1, ch2), then SAVEREF. Copies of these 2 WFs end up in AREA3 and AREA4.
    5350/    23FB :                     ; Then change the timebase to say 15 and select VTCoupling. Now the code below will look at the DisplayEntry AREA4 with
    5351/    23FB :                     ; timebase 9 (last rendered) while it should look at the AREA1 and AREA2 WFs (unclear which one is "primary").
    5352/    23FB :                     ; Again, if GetWFExpandVal() is called from RenderCursorLine()
    5353/    23FB :                     ; 
    5354/    23FB :                     ; The return value of GetWFExpandVal(), which now may be wrong, is used to scale (Take80Percent)
    5355/    23FB :                     ; the Cursor Time values before being converted to a Line value
    5356/    23FB :                     ;
    5357/    23FB : 2A 7D 80            	lhld V_pDispWF 			;ptr to WF being rendered
    5358/    23FE : 11 06 00            	lxi	d,S_TB				;offset to WF TB
    5359/    2401 : 19                  	dad	d
    5360/    2402 : 46                  	mov	b,m					;B = *(p+S_TB) 
    5361/    2403 : 3A EA 80            	lda	V_TargetTB2			;value for current UIState TB
    5362/    2406 : B8                  	cmp	b					;V_TargetTB2 - *(p+S_TB)
    5363/    2407 : CA 4D 24            	jz	Local244D			;same
    5364/    240A : DA 4D 24            	jc	Local244D			;jmp if V_TargetTB2 < *(p+S_TB)
    5365/    240D :                     ; V_TargetTB2 >= *(p+6)	
    5366/    240D : 78                  	mov	a,b
    5367/    240E : FE 14               	cpi	TB20				;*(p+S_TB) - TB20 
    5368/    2410 : DA 16 24            	jc	Local2416
    5369/    2413 : 06 14               	mvi	b,TB20				;if (B > 0x14) B = TB20;
    5370/    2415 : 78                  	mov	a,b
    5371/    2416 :                     Local2416:					;A is new TIME value
    5372/    2416 :                     ; A, B = min(*(p+S_TB),TB20)
    5373/    2416 : CD 9C 2C            	call A_mod_3_plus_1		;result in A
    5374/    2419 : 21 E8 80            	lxi	h,V_CNT				;p = &V_CNT
    5375/    241C : FE 01               	cpi	01h
    5376/    241E : C2 2E 24            	jnz	Local242E
    5377/    2421 :                     ; A_mod_3_plus_1 == 1	
    5378/    2421 : 3A EA 80            	lda	V_TargetTB2			;TIME value for current Time Base
    5379/    2424 : 90                  	sub	b					;V_TargetTB2 - B
    5380/    2425 : FE 01               	cpi	01h
    5381/    2427 : C8                  	rz
    5382/    2428 : 34                  	inr	m					;(*p) += 1
    5383/    2429 : FE 05               	cpi	05h
    5384/    242B : D8                  	rc
    5385/    242C : 34                  	inr	m					;(*p) += 1
    5386/    242D : C9                  	ret
    5387/    242E :                     Local242E:
    5388/    242E : FE 02               	cpi	02h					;A_mod_3_plus_1 - 2
    5389/    2430 : C2 3D 24            	jnz	Local243D
    5390/    2433 :                     ; A_mod_3_plus_1 == 2	
    5391/    2433 : 3A EA 80            	lda	V_TargetTB2			;TIME value for current Time Base
    5392/    2436 : 90                  	sub	b					;V_TargetTB2 - B
    5393/    2437 : 34                  	inr	m					;(*p) += 1
    5394/    2438 : FE 04               	cpi	04h
    5395/    243A : D8                  	rc
    5396/    243B : 34                  	inr	m					;(*p) += 1
    5397/    243C : C9                  	ret
    5398/    243D :                     Local243D:
    5399/    243D : 3A EA 80            	lda	V_TargetTB2			;TIME value for current Time Base
    5400/    2440 : 90                  	sub	b					;V_TargetTB2 - B
    5401/    2441 : FE 03               	cpi	03h
    5402/    2443 : D8                  	rc
    5403/    2444 : 34                  	inr	m					;(*p) += 1
    5404/    2445 : FE 06               	cpi	06h
    5405/    2447 : D8                  	rc
    5406/    2448 : 34                  	inr	m					;(*p) += 1
    5407/    2449 : C9                  	ret
    5408/    244A : C3 5C 24            	jmp	ShiftR_HL			;unreachable
    5409/    244D :                     ; V_DigitalMode != DIGITAL_SAVE	
    5410/    244D :                     Local244D:
    5411/    244D : 3A EA 80            	lda	V_TargetTB2			;TIME value for current Time Base
    5412/    2450 : FE 17               	cpi	17h					;V_TargetTB2 - 0x17
    5413/    2452 : D8                  	rc						;done if V_TargetTB2 < TIMEBASE23
    5414/    2453 : 21 E8 80            	lxi	h,V_CNT				;p
    5415/    2456 : 34                  	inr	m					;*p += 1
    5416/    2457 : FE 1A               	cpi	1Ah					;V_TargetTB2 - 0x1A
    5417/    2459 : D8                  	rc						;return if V_TargetTB2 < TIMEBASE26
    5418/    245A : 34                  	inr	m					;*p += 1
    5419/    245B : C9                  	ret
    5420/    245C :                     ;
    5421/    245C :                     ; Shift Right H & L by 1
    5422/    245C :                     ;
    5423/    245C :                     ShiftR_HL:
    5424/    245C : A7                  	ana	a					;Clear Carry
    5425/    245D : 7C                  	mov	a,h
    5426/    245E : 1F                  	rar						;divide by 2
    5427/    245F : 67                  	mov	h,a
    5428/    2460 : 7D                  	mov	a,l
    5429/    2461 : 1F                  	rar
    5430/    2462 : 6F                  	mov	l,a
    5431/    2463 : A7                  	ana	a					;set flags
    5432/    2464 : C9                  	ret
    5433/    2465 :                     
    5434/    2465 :                     SetVertPositioning:
    5435/    2465 : 21 70 80            	lxi	h,V_FPC
    5436/    2468 : 3E 20               	mvi	a,20h				;0x20 | 0x10 = 0x30
    5437/    246A : F6 10               	ori	10h
    5438/    246C : 2F                  	cma
    5439/    246D : A6                  	ana	m
    5440/    246E : 77                  	mov	m,a
    5441/    246F : 3A A5 80            	lda	V_DigitalMode
    5442/    2472 : FE 04               	cpi	DIGITAL_SAVE
    5443/    2474 : C2 AA 24            	jnz	L24AA
    5444/    2477 : 2A 7D 80            	lhld V_pDispWF
    5445/    247A : 01 04 00            	lxi	b,S_CHANMODE
    5446/    247D : 09                  	dad	b
    5447/    247E : 7E                  	mov	a,m
    5448/    247F : E6 80               	ani	80h
    5449/    2481 : C2 AA 24            	jnz	L24AA
    5450/    2484 : 7E                  	mov	a,m
    5451/    2485 : E6 01               	ani	01h
    5452/    2487 : FE 01               	cpi	01h
    5453/    2489 : C2 94 24            	jnz	L2494
    5454/    248C : 3A 70 80            	lda	V_FPC
    5455/    248F : F6 20               	ori	20h
    5456/    2491 : 32 70 80            	sta	V_FPC
    5457/    2494 : 7E                  L2494:	mov	a,m
    5458/    2495 : E6 80               	ani	80h
    5459/    2497 : C2 AA 24            	jnz	L24AA
    5460/    249A : 7E                  	mov	a,m
    5461/    249B : E6 02               	ani	02h
    5462/    249D : FE 02               	cpi	02h
    5463/    249F : C2 AA 24            	jnz	L24AA
    5464/    24A2 : 3A 70 80            	lda	V_FPC
    5465/    24A5 : F6 10               	ori	10h
    5466/    24A7 : 32 70 80            	sta	V_FPC
    5467/    24AA : 3A 70 80            L24AA:	lda	V_FPC
    5468/    24AD : 32 40 E0            	sta	DEV_FPC
    5469/    24B0 : C9                  	ret
    5470/    24B1 :                     ;
    5471/    24B1 :                     ; init function
    5472/    24B1 :                     ;
    5473/    24B1 :                     Init_Display_0:
    5474/    24B1 : 21 20 00            	lxi	h,0020H
    5475/    24B4 : 22 C2 80            	shld V_AVG_Sweeps
    5476/    24B7 : 21 20 00            	lxi	h,0020H
    5477/    24BA : 22 C4 80            	shld V_ENV_Sweeps
    5478/    24BD : AF                  	xra	a
    5479/    24BE : 32 33 80            	sta	V_Curr_LEDRO
    5480/    24C1 : 3E 05               	mvi	a,05h
    5481/    24C3 : 32 32 80            	sta	V_DecPntDigit
    5482/    24C6 : 21 00 01            	lxi	h,0100H
    5483/    24C9 : 22 B3 80            	shld V_TimeCursorPos
    5484/    24CC : 21 F0 00            	lxi	h,00F0H
    5485/    24CF : 22 B5 80            	shld V_TimeCursorPos+2
    5486/    24D2 : 21 FF 01            	lxi	h,01FFh
    5487/    24D5 : 22 AF 80            	shld V_VoltsCursorPos
    5488/    24D8 : 21 DF 01            	lxi	h,01DFh
    5489/    24DB : 22 B1 80            	shld V_VoltsCursorPos+2
    5490/    24DE : 21 00 00            	lxi	h,0000H
    5491/    24E1 : 22 E1 80            	shld V_pRAM_DOT
    5492/    24E4 : 22 E3 80            	shld V_pRAM_DOT2
    5493/    24E7 : 3E 02               	mvi	a,02h
    5494/    24E9 : 32 3D 80            	sta	V_CursorPot_Delay
    5495/    24EC : 21 FF FF            	lxi	h,0FFFFH
    5496/    24EF : 22 3B 80            	shld V_PreviousPRCount
    5497/    24F2 : 3E 40               	mvi	a,40h
    5498/    24F4 : 2F                  	cma
    5499/    24F5 : 32 36 80            	sta	V_PRFastMode
    5500/    24F8 : AF                  	xra	a
    5501/    24F9 : 32 34 80            	sta	V_CursorIncrementValue
    5502/    24FC : 2F                  	cma
    5503/    24FD : 32 35 80            	sta	V_TimerCntrRateInc2
    5504/    2500 : 21 D0 01            	lxi	h,01D0h
    5505/    2503 : 22 37 80            	shld V_CursorPos2
    5506/    2506 : 21 A0 00            	lxi	h,00A0H
    5507/    2509 : 22 39 80            	shld V_CursorPos1
    5508/    250C : 3E BF               	mvi	a,0BFh				;10111111 & 11101111 = 10101111 0xAF
    5509/    250E : E6 EF               	ani	0EFh
    5510/    2510 : 2F                  	cma						;0x01010000 Clr LINECUR, ZAXON (Active Low)
    5511/    2511 : 32 41 E0            	sta	DEV_CONTRL
    5512/    2514 : 32 BF 80            	sta	V_CONTRL
    5513/    2517 : CD 3C 25            	call Fill_RAM_DOT
    5514/    251A : AF                  	xra	a
    5515/    251B : 32 40 E0            	sta	DEV_FPC
    5516/    251E : 32 70 80            	sta	V_FPC
    5517/    2521 : 32 06 E4            	sta	DEV_HGAIN
    5518/    2524 : 32 05 E4            	sta	DEV_VGAIN
    5519/    2527 : 32 04 E4            	sta	DEV_JITTER
    5520/    252A : 32 40 80            	sta	V_DispWF
    5521/    252D : 32 41 80            	sta	V_CursorLine
    5522/    2530 : 32 42 80            	sta	VAR_8042
    5523/    2533 : 3E 40               	mvi	a,40h				;01000000 STOP512
    5524/    2535 : 32 02 E4            	sta	DEV_DISREG
    5525/    2538 : 32 A4 80            	sta	V_DISREG			;copy of DEV_DISREG
    5526/    253B : C9                  	ret
    5527/    253C :                     ;
    5528/    253C :                     ; Fill RAM_DOT memory with 1
    5529/    253C :                     ; Range RAM_DOT..RAM_DOT+179 (200 bytes)
    5530/    253C :                     ;
    5531/    253C :                     Fill_RAM_DOT:
    5532/    253C : 21 00 B0            	lxi	h,RAM_DOT
    5533/    253F : 3E 01               	mvi	a,01h
    5534/    2541 :                     $$L:						;L2541:
    5535/    2541 : 77                  	mov	m,a
    5536/    2542 : 23                  	inx	h
    5537/    2543 : 47                  	mov	b,a					;save A.
    5538/    2544 : 7C                  	mov	a,h
    5539/    2545 : FE B4               	cpi	0B4h
    5540/    2547 : 78                  	mov	a,b
    5541/    2548 : C2 41 25            	jnz	$$L
    5542/    254B : C9                  	ret
    5543/    254C :                     ;
    5544/    254C :                     ;
    5545/    254C :                     ;
    5546/    254C :                     Display_Interrupt_0:	
    5547/    254C : C5                  	push	b
    5548/    254D : D5                  	push d
    5549/    254E : E5                  	push	h
    5550/    254F : F5                  	push	psw
    5551/    2550 : 20                  	rim
    5552/    2551 : E6 0F               	ani	0Fh					;00001111
    5553/    2553 : F6 0A               	ori	0Ah					;00001010
    5554/    2555 : 30                  	sim
    5555/    2556 : FB                  	ei
    5556/    2557 : 21 BF 80            	lxi	h,V_CONTRL
    5557/    255A : 3E 7F               	mvi	a,7Fh				;01111111
    5558/    255C : A6                  	ana	m					;Clr ACTIVEL
    5559/    255D : F6 12               	ori	12h					;00010010 LINECUR off BOTH on
    5560/    255F : 77                  	mov	m,a					;update V_CONTRL
    5561/    2560 : 32 41 E0            	sta	DEV_CONTRL
    5562/    2563 : 21 A4 80            	lxi	h,V_DISREG			;copy of DEV_DISREG
    5563/    2566 : 3E 7F               	mvi	a,7Fh				;01111111
    5564/    2568 : A6                  	ana	m					;clr bit 7 CSEL
    5565/    2569 : E6 7C               	ani	7Ch					;01111100 zero Line Cursor Bits
    5566/    256B : 77                  	mov	m,a					;update
    5567/    256C : 32 02 E4            	sta	DEV_DISREG
    5568/    256F :                     ;
    5569/    256F :                     ; Execute actions in V_DisplayRB.
    5570/    256F :                     ; loop from (V_DisplayRB_Start + 1) to (V_DisplayRB_End) through ring buffer 1..10
    5571/    256F :                     ;	
    5572/    256F :                     Process_DisplayRB:
    5573/    256F : 21 72 80            	lxi	h,V_DisplayRB_Start
    5574/    2572 : 3A 71 80            	lda	V_DisplayRB_End
    5575/    2575 : BE                  	cmp	m					;V_DisplayRB_End - V_DisplayRB_Start
    5576/    2576 : CA A6 25            	jz	L25A6				;ring buffer empty
    5577/    2579 : 34                  	inr	m					;increment V_DisplayRB_Start
    5578/    257A : 3E 0A               	mvi	a,0Ah				;range 1..10
    5579/    257C : BE                  	cmp	m					;10 - (V_DisplayRB_Start + 1)
    5580/    257D : D2 83 25            	jnc	L2583
    5581/    2580 : 3E 01               	mvi	a,01h				;wrap around
    5582/    2582 : 77                  	mov	m,a					;V_DisplayRB_Start = 1
    5583/    2583 :                     L2583:
    5584/    2583 : 4E                  	mov	c,m					;index to process range 1..10
    5585/    2584 : 06 00               	mvi	b,00h				;MSB
    5586/    2586 : EB                  	xchg					;DE now &V_DisplayRB_Start
    5587/    2587 : 21 72 80            	lxi	h,V_DisplayRB-1		;table - 1, second byte
    5588/    258A : 09                  	dad	b					
    5589/    258B : 7E                  	mov	a,m					;table[C]. High nibble is current WaveForm area, low nibble is action index
    5590/    258C : 47                  	mov	b,a					;save
    5591/    258D : E6 F0               	ani	0F0h				;11110000 Look at upper 4 bits only
    5592/    258F : 1F                  	rar						;rotate to lower 4 bits
    5593/    2590 : 1F                  	rar
    5594/    2591 : 1F                  	rar
    5595/    2592 : 1F                  	rar
    5596/    2593 : 32 3E 80            	sta	V_CurrWF 			;save current WaveForm area
    5597/    2596 : 78                  	mov	a,b					;restore
    5598/    2597 : E6 0F               	ani	0Fh					;Lower nibble, range 1..15
    5599/    2599 : 4F                  	mov	c,a					;unnecessary since BC not input
    5600/    259A : 06 00               	mvi	b,00h
    5601/    259C : 11 4C 3E            	lxi	d,Display_Actions-2
    5602/    259F : CD 4F 00            	call Get_Word_From_Table ;action table
    5603/    25A2 : E7                  	rst	4					;call action
    5604/    25A3 : C3 6F 25            	jmp	Process_DisplayRB	;loop
    5605/    25A6 :                     L25A6:
    5606/    25A6 : CD 0E 26            	call ScheduleNextDisplay
    5607/    25A9 : CD 3F 3D            	call RestartDisplaySystem
    5608/    25AC : F3                  	di
    5609/    25AD : 3A A5 80            	lda	V_DigitalMode
    5610/    25B0 : FE 00               	cpi	DIGITAL_OFF
    5611/    25B2 : CA BB 25            	jz	L25BB
    5612/    25B5 : 20                  	rim
    5613/    25B6 : E6 0D               	ani	0Dh					;00001101
    5614/    25B8 : F6 08               	ori	08h					;00001000
    5615/    25BA : 30                  	sim
    5616/    25BB : F1                  L25BB:	pop	psw
    5617/    25BC : E1                  	pop	h
    5618/    25BD : D1                  	pop	d
    5619/    25BE : C1                  	pop	b
    5620/    25BF : FB                  	ei
    5621/    25C0 : C9                  	ret
    5622/    25C1 :                     	
    5623/    25C1 :                     SetDefaultDashedLine:
    5624/    25C1 : 3E 80               	mvi	a,80h
    5625/    25C3 : 32 01 E4            	sta	DEV_LINER
    5626/    25C6 : 3A 70 80            	lda	V_FPC
    5627/    25C9 : E6 CF               	ani	0CFh
    5628/    25CB : 32 70 80            	sta	V_FPC
    5629/    25CE : CD 55 00            	call StrobeDisplayRAM	;result A unused
    5630/    25D1 : 21 BF 80            	lxi	h,V_CONTRL
    5631/    25D4 : 3E 80               	mvi	a,80h				;10000000 Set ACTIVEL
    5632/    25D6 : B6                  	ora	m
    5633/    25D7 : 77                  	mov	m,a					;update V_CONTRL
    5634/    25D8 : CD 58 00            	call SetUpLineCursor
    5635/    25DB : 3E F0               	mvi	a,0F0h
    5636/    25DD : 32 05 E4            	sta	DEV_VGAIN
    5637/    25E0 : CD 5B 00            	call EnableLineCursor
    5638/    25E3 : C9                  	ret
    5639/    25E4 :                     
    5640/    25E4 :                     EnableDisplayInterrupt:
    5641/    25E4 : F3                  	di
    5642/    25E5 : 20                  	rim
    5643/    25E6 : E6 0D               	ani	0Dh					;00001101 	Clr Pending Status, M6.5
    5644/    25E8 : F6 08               	ori	08h					;00001000	Set IE, Mask RST 7.5, 5.5
    5645/    25EA : 30                  	sim
    5646/    25EB : FB                  	ei
    5647/    25EC : C9                  	ret
    5648/    25ED :                     	
    5649/    25ED :                     NextCursorLine:
    5650/    25ED : 3A AA 80            	lda	V_CursorMode
    5651/    25F0 : FE 01               	cpi	01h
    5652/    25F2 : CA FA 25            	jz	L25FA
    5653/    25F5 : FE 03               	cpi	03h
    5654/    25F7 : C2 FF 25            	jnz	L25FF
    5655/    25FA : 3E 02               L25FA:	mvi	a,02h
    5656/    25FC : C3 00 26            	jmp	L2600
    5657/    25FF : AF                  L25FF:	xra	a
    5658/    2600 : 32 42 80            L2600:	sta	VAR_8042
    5659/    2603 : 47                  	mov	b,a
    5660/    2604 : 21 41 80            	lxi	h,V_CursorLine
    5661/    2607 : 34                  	inr	m
    5662/    2608 : 78                  	mov	a,b
    5663/    2609 : BE                  	cmp	m
    5664/    260A : D0                  	rnc
    5665/    260B : AF                  	xra	a
    5666/    260C : 77                  	mov	m,a
    5667/    260D : C9                  	ret
    5668/    260E :                     
    5669/    260E :                     ScheduleNextDisplay:
    5670/    260E : CD 53 26            	call L2653
    5671/    2611 : 3A 40 80            	lda	V_DispWF
    5672/    2614 : A7                  	ana	a
    5673/    2615 : CA 1C 26            	jz	L261C
    5674/    2618 : CD 7D 21            	call RenderWF
    5675/    261B : C9                  	ret
    5676/    261C : 3A 41 80            L261C:	lda	V_CursorLine
    5677/    261F : A7                  	ana	a
    5678/    2620 : CA 27 26            	jz	L2627
    5679/    2623 : CD 52 00            	call RenderCursorLine
    5680/    2626 : C9                  	ret
    5681/    2627 :                     L2627:
    5682/    2627 : CD C1 25            	call SetDefaultDashedLine
    5683/    262A : C9                  	ret
    5684/    262B :                     ;
    5685/    262B :                     ; Update V_cnt1
    5686/    262B :                     ;
    5687/    262B :                     FindNextWF:
    5688/    262B : AF                  	xra	a
    5689/    262C : 32 13 81            	sta	V_cnt01
    5690/    262F :                     ; loop
    5691/    262F : 3A 40 80            L262F:	lda	V_DispWF
    5692/    2632 : FE 04               	cpi	04h					;V_DispWF - 4
    5693/    2634 : D2 4E 26            	jnc	L264E				;exit if >= 4
    5694/    2637 : 3C                  	inr	a					;V_DispWF++
    5695/    2638 : 32 40 80            	sta	V_DispWF
    5696/    263B : 5F                  	mov	e,a					;base 1
    5697/    263C : 16 00               	mvi	d,00h
    5698/    263E : 21 9E 80            	lxi	h,V_ValidWFs-1		;table of 4 booleans.
    5699/    2641 : 19                  	dad	d
    5700/    2642 : 7E                  	mov	a,m					;get boolean
    5701/    2643 : A7                  	ana	a
    5702/    2644 : FA 52 26            	jm	L2652
    5703/    2647 : 21 13 81            	lxi	h,V_cnt01
    5704/    264A : 34                  	inr	m
    5705/    264B : C3 2F 26            	jmp	L262F
    5706/    264E :                     L264E:
    5707/    264E : AF                  	xra	a					;clr V_DispWF
    5708/    264F : 32 40 80            	sta	V_DispWF
    5709/    2652 : C9                  L2652:	ret
    5710/    2653 :                     ;
    5711/    2653 :                     L2653:
    5712/    2653 : 3A 41 80            	lda	V_CursorLine
    5713/    2656 : A7                  	ana	a					;test
    5714/    2657 : C2 65 26            	jnz	L2665x
    5715/    265A :                     ; V_CursorLine == 0	
    5716/    265A : CD 2B 26            	call FindNextWF
    5717/    265D : 3A 13 81            	lda	V_cnt01
    5718/    2660 : FE 04               	cpi	04h
    5719/    2662 : CA 7B 26            	jz	L267B
    5720/    2665 :                     ; (V_CursorLine != 0) || (V_cnt01 != 4	)
    5721/    2665 :                     L2665x:
    5722/    2665 : 3A 40 80            	lda	V_DispWF
    5723/    2668 : A7                  	ana	a					;test
    5724/    2669 : C2 6F 26            	jnz	L266F
    5725/    266C :                     ; V_DispWF == 0	
    5726/    266C : CD ED 25            	call NextCursorLine
    5727/    266F : 3A 40 80            L266F:	lda	V_DispWF
    5728/    2672 : A7                  	ana	a					;test
    5729/    2673 : C0                  	rnz
    5730/    2674 : 3A 41 80            	lda	V_CursorLine
    5731/    2677 : A7                  	ana	a
    5732/    2678 : CA 53 26            	jz	L2653				;loop.
    5733/    267B : C9                  L267B:	ret
    5734/    267C :                     ;
    5735/    267C :                     ; Display related
    5736/    267C :                     ;
    5737/    267C :                     Display_Action_3:
    5738/    267C : 3A AA 80            	lda	V_CursorMode
    5739/    267F : FE 03               	cpi	03h					;NUMWINCPLVT
    5740/    2681 : CA 8C 26            	jz	L268C
    5741/    2684 : FE 02               	cpi	02h					;NUMWINTIME
    5742/    2686 : C2 B8 26            	jnz	L26B8
    5743/    2689 : CD 31 27            	call ClrCursorSnap_0
    5744/    268C :                     L268C:
    5745/    268C : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    5746/    268F : 17                  	ral
    5747/    2690 : D2 99 26            	jnc	L26991
    5748/    2693 : 21 B3 80            	lxi	h,V_TimeCursorPos
    5749/    2696 : C3 9C 26            	jmp	L269C
    5750/    2699 :                     L26991:
    5751/    2699 : 21 B5 80            	lxi	h,V_TimeCursorPos+2
    5752/    269C :                     ; p (HL) can be V_VoltsCursorPos, V_VoltsCursorPos+2, V_TimeCursorPos
    5753/    269C :                     ; Add sign-extended V_CursorIncrementValue to *(word *)p
    5754/    269C :                     L269C:
    5755/    269C : 3A 34 80            	lda	V_CursorIncrementValue			;V_CursorIncrementValue
    5756/    269F : A7                  	ana	a					;test
    5757/    26A0 : 4F                  	mov	c,a					;move and sign extend A to BC
    5758/    26A1 : FA A9 26            	jm	L26A9
    5759/    26A4 : 06 00               	mvi	b,00h
    5760/    26A6 : C3 AB 26            	jmp	L26AB
    5761/    26A9 : 06 FF               L26A9:	mvi	b,0FFh
    5762/    26AB : 5E                  L26AB:	mov	e,m				;DE = *(word *)p
    5763/    26AC : 23                  	inx	h
    5764/    26AD : 56                  	mov	d,m
    5765/    26AE : 2B                  	dcx	h
    5766/    26AF : EB                  	xchg					;p now in DE
    5767/    26B0 : 09                  	dad	b					;Old DE+BC
    5768/    26B1 : EB                  	xchg					;restore
    5769/    26B2 : 73                  	mov	m,e					;*(word *)(p) = DE+BC
    5770/    26B3 : 23                  	inx	h
    5771/    26B4 : 72                  	mov	m,d
    5772/    26B5 : C3 D0 26            	jmp	L26D0
    5773/    26B8 :                     ;
    5774/    26B8 : FE 01               L26B8:	cpi	01h
    5775/    26BA : C2 D0 26            	jnz	L26D0
    5776/    26BD : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    5777/    26C0 : 17                  	ral
    5778/    26C1 : D2 CA 26            	jnc	L26CA
    5779/    26C4 : 21 AF 80            	lxi	h,V_VoltsCursorPos
    5780/    26C7 : C3 9C 26            	jmp	L269C
    5781/    26CA : 21 B1 80            L26CA:	lxi	h,V_VoltsCursorPos+2
    5782/    26CD : C3 9C 26            	jmp	L269C
    5783/    26D0 : CD 96 30            L26D0:	call ConstrainVoltsTimeCursor
    5784/    26D3 : 3A AA 80            	lda	V_CursorMode
    5785/    26D6 : FE 03               	cpi	03h
    5786/    26D8 : C2 30 27            	jnz	L2730x
    5787/    26DB :                     ; V_CursorMode == 3
    5788/    26DB : 2A 10 80            	lhld V_CursorEdgeTimeCnt
    5789/    26DE : 7C                  	mov	a,h
    5790/    26DF : FE 01               	cpi	01h
    5791/    26E1 : D2 02 27            	jnc	L2702x
    5792/    26E4 : 3A 16 80            	lda	VAR_8016
    5793/    26E7 : 4F                  	mov	c,a
    5794/    26E8 : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    5795/    26EB : 17                  	ral
    5796/    26EC : 3A B3 80            	lda	V_TimeCursorPos
    5797/    26EF : DA F5 26            	jc	L26F5
    5798/    26F2 : 3A B5 80            	lda	V_TimeCursorPos+2
    5799/    26F5 : B9                  L26F5:	cmp	c
    5800/    26F6 : 3E FF               	mvi	a,0FFh
    5801/    26F8 : CA FC 26            	jz	L26FC
    5802/    26FB : AF                  	xra	a
    5803/    26FC : 32 12 80            L26FC:	sta	V_fAtCursorEdge ;set boolean
    5804/    26FF : C3 30 27            	jmp	L2730x	
    5805/    2702 :                     L2702x:
    5806/    2702 : 3A A3 80            	lda	V_PrimaryWF		;base 1
    5807/    2705 : 3D                  	dcr	a					;base 0
    5808/    2706 : 07                  	rlc						;times 8
    5809/    2707 : 07                  	rlc
    5810/    2708 : 07                  	rlc
    5811/    2709 : 21 80 80            	lxi	h,V_WFTable+S_GNDREF ;WF table
    5812/    270C : 5F                  	mov	e,a
    5813/    270D : 16 00               	mvi	d,00h
    5814/    270F : 19                  	dad	d
    5815/    2710 : 7E                  	mov	a,m					;test memory
    5816/    2711 : A7                  	ana	a
    5817/    2712 : CA 2D 27            	jz	L272D
    5818/    2715 : 3A 13 80            	lda	V_fCursorEdgeTracking ;test boolean
    5819/    2718 : 17                  	ral						;carry if TRUE
    5820/    2719 : D2 2A 27            	jnc	L272A
    5821/    271C : 3A AD 80            	lda	V_fFirstCursorActive
    5822/    271F : 32 15 80            	sta	V_fCursor1Snapped
    5823/    2722 : AF                  	xra	a
    5824/    2723 : 32 13 80            	sta	V_fCursorEdgeTracking ;V_fCursorEdgeTracking = FALSE
    5825/    2726 : 2F                  	cma
    5826/    2727 : 32 14 80            	sta	V_fSnappedCursor			;V_fSnappedCursor = TRUE
    5827/    272A :                     L272A:
    5828/    272A : C3 30 27            	jmp	L2730x
    5829/    272D :                     L272D:
    5830/    272D : CD 31 27            	call ClrCursorSnap_0
    5831/    2730 : C9                  L2730x:	ret
    5832/    2731 :                     ;
    5833/    2731 :                     ClrCursorSnap_0:
    5834/    2731 : AF                  	xra	a
    5835/    2732 : 32 14 80            	sta	V_fSnappedCursor			;V_fSnappedCursor = FALSE
    5836/    2735 : 32 12 80            	sta	V_fAtCursorEdge ;V_fAtCursorEdge = FALSE
    5837/    2738 : 67                  	mov	h,a
    5838/    2739 : 6F                  	mov	l,a
    5839/    273A : 22 10 80            	shld V_CursorEdgeTimeCnt	;clear (word *)V_CursorEdgeTimeCnt
    5840/    273D : 2F                  	cma
    5841/    273E : 32 13 80            	sta	V_fCursorEdgeTracking ;V_fCursorEdgeTracking = TRUE
    5842/    2741 : C9                  	ret
    5843/    2742 :                     ;
    5844/    2742 :                     ; Display related
    5845/    2742 :                     ;
    5846/    2742 :                     Display_Action_4:
    5847/    2742 : 3A A5 80            	lda	V_DigitalMode
    5848/    2745 : FE 03               	cpi	DIGITAL_AVG
    5849/    2747 : C2 68 27            	jnz	L2768x
    5850/    274A : 21 02 00            	lxi	h,0002H
    5851/    274D : 22 14 81            	shld V_LocalMinSweeps
    5852/    2750 : 21 00 01            	lxi	h,0100H
    5853/    2753 : 22 16 81            	shld V_LocalMaxSweeps
    5854/    2756 : 2A C2 80            	lhld V_AVG_Sweeps
    5855/    2759 : 22 18 81            	shld V_CurrentSweeps
    5856/    275C : CD 89 27            	call Update_NR_Sweeps
    5857/    275F : 2A 18 81            	lhld V_CurrentSweeps
    5858/    2762 : 22 C2 80            	shld V_AVG_Sweeps
    5859/    2765 : C3 83 27            	jmp	L2783
    5860/    2768 : 21 01 00            L2768x:	lxi	h,0001H
    5861/    276B : 22 14 81            	shld V_LocalMinSweeps
    5862/    276E : 21 0F 27            	lxi	h,9999
    5863/    2771 : 22 16 81            	shld V_LocalMaxSweeps
    5864/    2774 : 2A C4 80            	lhld V_ENV_Sweeps
    5865/    2777 : 22 18 81            	shld V_CurrentSweeps
    5866/    277A : CD 89 27            	call Update_NR_Sweeps
    5867/    277D : 2A 18 81            	lhld V_CurrentSweeps
    5868/    2780 : 22 C4 80            	shld V_ENV_Sweeps
    5869/    2783 :                     L2783:
    5870/    2783 : 3E 05               	mvi	a,MAIN_ACTION_5_ID
    5871/    2785 : CD 49 00            	call AddMainAction
    5872/    2788 : C9                  	ret
    5873/    2789 :                     ;	
    5874/    2789 :                     ;
    5875/    2789 :                     Update_NR_Sweeps:
    5876/    2789 : 3A C0 80            	lda	V_Rate_Direction
    5877/    278C : 2E 00               	mvi	l,00h
    5878/    278E : CD 66 3D            	call Signed_Compare_A_L ;return TRUE/CY set if A > L (signed)
    5879/    2791 : D2 BF 27            	jnc	L27BF
    5880/    2794 :                     ; A > 0
    5881/    2794 : 2A 18 81            	lhld V_CurrentSweeps	;jmp if [V_CurrentSweeps] >= [V_LocalMaxSweeps]
    5882/    2797 : EB                  	xchg
    5883/    2798 : 2A 16 81            	lhld V_LocalMaxSweeps
    5884/    279B : 7B                  	mov	a,e					;E - L
    5885/    279C : 95                  	sub	l					;relevant result in CY
    5886/    279D : 7A                  	mov	a,d					;D - H
    5887/    279E : 9C                  	sbb	h
    5888/    279F : D2 A9 27            	jnc	L27A9				;
    5889/    27A2 : 2A 18 81            	lhld V_CurrentSweeps	;V_CurrentSweeps *= 2;
    5890/    27A5 : 29                  	dad	h
    5891/    27A6 : 22 18 81            	shld V_CurrentSweeps
    5892/    27A9 :                     L27A9:
    5893/    27A9 : 2A 18 81            	lhld V_CurrentSweeps	;to DE
    5894/    27AC : EB                  	xchg
    5895/    27AD : 21 00 01            	lxi	h,0100H				;256
    5896/    27B0 : CD EE 3D            	call Signed_Compare_DE_HL ;returns CY if [V_CurrentSweeps] > 256
    5897/    27B3 : D2 BC 27            	jnc	L27BC
    5898/    27B6 : 2A 16 81            	lhld V_LocalMaxSweeps	;[V_CurrentSweeps] = [V_LocalMaxSweeps]
    5899/    27B9 : 22 18 81            	shld V_CurrentSweeps
    5900/    27BC : C3 EA 27            L27BC:	jmp	L27EA
    5901/    27BF :                     
    5902/    27BF :                     L27BF:
    5903/    27BF : 2A 14 81            	lhld V_LocalMinSweeps	;jmp if [V_LocalMinSweeps] >= [V_CurrentSweeps]
    5904/    27C2 : EB                  	xchg
    5905/    27C3 : 2A 18 81            	lhld V_CurrentSweeps
    5906/    27C6 : 7B                  	mov	a,e					;E - L
    5907/    27C7 : 95                  	sub	l					;CY result
    5908/    27C8 : 7A                  	mov	a,d					;D - H
    5909/    27C9 : 9C                  	sbb	h
    5910/    27CA : D2 EA 27            	jnc	L27EA
    5911/    27CD :                     ;	[V_LocalMinSweeps] < [V_CurrentSweeps]
    5912/    27CD : 2A 18 81            	lhld V_CurrentSweeps	;[V_CurrentSweeps] >>= 1
    5913/    27D0 : EB                  	xchg
    5914/    27D1 : 21 01 00            	lxi	h,0001H
    5915/    27D4 : CD 0D 3E            	call ShiftR_DE_L_times
    5916/    27D7 : 22 18 81            	shld V_CurrentSweeps	
    5917/    27DA : EB                  	xchg					;to DE
    5918/    27DB : 21 00 01            	lxi	h,0100H				;256
    5919/    27DE : CD EE 3D            	call Signed_Compare_DE_HL ;returns CY if [V_CurrentSweeps] > 256
    5920/    27E1 : D2 EA 27            	jnc	L27EA
    5921/    27E4 : 21 00 01            	lxi	h,0100H
    5922/    27E7 : 22 18 81            	shld V_CurrentSweeps	;[V_CurrentSweeps] = 0x0100
    5923/    27EA : C9                  L27EA:	ret
    5924/    27EB :                     ;
    5925/    27EB :                     ; in A
    5926/    27EB :                     ;
    5927/    27EB :                     AddDisplayAction_0:
    5928/    27EB : F5                  	push	psw
    5929/    27EC : 20                  	rim
    5930/    27ED : F3                  	di
    5931/    27EE : 32 21 81            	sta	V_SAVED_INT_Mask	;save interrupt mask
    5932/    27F1 : F1                  	pop	psw
    5933/    27F2 : 32 20 81            	sta	V_Saved_Arg			;input
    5934/    27F5 : 3A 72 80            	lda	V_DisplayRB_Start
    5935/    27F8 : 32 22 81            	sta	V_DisplayRB_Index
    5936/    27FB : 3A 71 80            L27FB:	lda	V_DisplayRB_End
    5937/    27FE : 21 22 81            	lxi	h,V_DisplayRB_Index
    5938/    2801 : BE                  	cmp	m
    5939/    2802 : CA 2E 28            	jz	L282E
    5940/    2805 : 21 22 81            	lxi	h,V_DisplayRB_Index
    5941/    2808 : 34                  	inr	m
    5942/    2809 : 3E 0A               	mvi	a,0Ah
    5943/    280B : 21 22 81            	lxi	h,V_DisplayRB_Index
    5944/    280E : BE                  	cmp	m
    5945/    280F : D2 17 28            	jnc	L2817A
    5946/    2812 : 3E 01               	mvi	a,01h
    5947/    2814 : 32 22 81            	sta	V_DisplayRB_Index
    5948/    2817 : 2A 22 81            L2817A:	lhld V_DisplayRB_Index
    5949/    281A : 26 00               	mvi	h,00h
    5950/    281C : 11 72 80            	lxi	d,V_DisplayRB_Start
    5951/    281F : 19                  	dad	d
    5952/    2820 : 7E                  	mov	a,m
    5953/    2821 : 21 20 81            	lxi	h,V_Saved_Arg		;input
    5954/    2824 : BE                  	cmp	m
    5955/    2825 : C2 2B 28            	jnz	L282B
    5956/    2828 : C3 4D 28            	jmp	L284D				;exit
    5957/    282B : C3 FB 27            L282B:	jmp	L27FB
    5958/    282E : 21 71 80            L282E:	lxi	h,V_DisplayRB_End ;update V_DisplayRB_End range 1..10
    5959/    2831 : 34                  	inr	m
    5960/    2832 : 3E 0A               	mvi	a,0Ah
    5961/    2834 : 21 71 80            	lxi	h,V_DisplayRB_End
    5962/    2837 : BE                  	cmp	m					;10 - (m). Carry if (m) > 10
    5963/    2838 : D2 40 28            	jnc	L2840
    5964/    283B : 3E 01               	mvi	a,01h				;reset to 1
    5965/    283D : 32 71 80            	sta	V_DisplayRB_End
    5966/    2840 :                     L2840:
    5967/    2840 : 2A 71 80            	lhld V_DisplayRB_End	;L <- V_DisplayRB_End
    5968/    2843 : 26 00               	mvi	h,00h
    5969/    2845 : 11 72 80            	lxi	d,V_DisplayRB_Start	;table ptr
    5970/    2848 : 19                  	dad	d
    5971/    2849 : 3A 20 81            	lda	V_Saved_Arg			;input arg
    5972/    284C : 77                  	mov	m,a					;update table
    5973/    284D : 3A 21 81            L284D:	lda	V_SAVED_INT_Mask ;saved interrupt mask
    5974/    2850 : E6 08               	ani	08h					;00001000 test Interrupts masked
    5975/    2852 : CA 56 28            	jz	L2856				;jump if not masked
    5976/    2855 : FB                  	ei
    5977/    2856 : C9                  L2856:	ret
    5978/    2857 :                     ;
    5979/    2857 :                     ; init function
    5980/    2857 :                     ;
    5981/    2857 :                     InitDisplayRB_0:
    5982/    2857 : 3E 01               	mvi	a,01h
    5983/    2859 : 32 72 80            	sta	V_DisplayRB_Start
    5984/    285C : 3E 01               	mvi	a,01h
    5985/    285E : 32 71 80            	sta	V_DisplayRB_End
    5986/    2861 : C9                  	ret
    5987/    2862 :                     ;
    5988/    2862 :                     ; Called if V_GPIB_803F is TRUE
    5989/    2862 :                     ;	
    5990/    2862 :                     Init_GPIB_0:
    5991/    2862 : AF                  	xra	a
    5992/    2863 : 32 55 80            	sta	V_GPIB_MTAReceived
    5993/    2866 : 32 64 80            	sta	V_TALKREG
    5994/    2869 : 32 07 80            	sta	V_GPIB_XmitWFRQSFActive
    5995/    286C : 32 0D 80            	sta	V_GPIB_ActionWasRemoved
    5996/    286F : 32 67 80            	sta	V_GPIB_EndOfMessage
    5997/    2872 : 32 6E 80            	sta	V_GPIB_Bool4
    5998/    2875 : 32 6D 80            	sta	V_GPIB_Bool3
    5999/    2878 : 32 6F 80            	sta	V_GPIB_Bool5
    6000/    287B : 32 17 80            	sta	V_WIFCTL
    6001/    287E : 32 06 F0            	sta	DEV_WIFCTL
    6002/    2881 : 2F                  	cma
    6003/    2882 : 32 06 80            	sta	VAR_8006
    6004/    2885 : 32 02 F0            	sta	DEV_DATACC
    6005/    2888 : 32 5B 80            	sta	V_GPIB_Bool9
    6006/    288B : 3E 81               	mvi	a,81h				;10000001 -> 01111110 TIDS LED and SRQLED
    6007/    288D : 2F                  	cma
    6008/    288E : CD 68 20            	call Update_DEV_FPC_and
    6009/    2891 : 20                  	rim
    6010/    2892 : F6 08               	ori	08h
    6011/    2894 : E6 0E               	ani	0Eh
    6012/    2896 : 30                  	sim
    6013/    2897 : 3E 01               	mvi	a,01h
    6014/    2899 : 32 A9 80            	sta	V_GPIBOut
    6015/    289C : 3E 79               	mvi	a,79h
    6016/    289E : CD 49 00            	call AddMainAction
    6017/    28A1 : C9                  	ret
    6018/    28A2 :                     ;
    6019/    28A2 :                     ; called from GPIB interrupt handler
    6020/    28A2 :                     ; called from action handlers
    6021/    28A2 :                     ;	
    6022/    28A2 :                     Get_GPIB_Status_0:
    6023/    28A2 : F3                  	di
    6024/    28A3 : 3A 07 F0            	lda	DEV_RIFSTAT			;GPIB status bits
    6025/    28A6 : 32 5C 80            	sta	V_GPIB_Bool8
    6026/    28A9 : 17                  	ral
    6027/    28AA : 32 5D 80            	sta	V_GPIB_Bool7
    6028/    28AD : 17                  	ral
    6029/    28AE : 32 5E 80            	sta	V_GPIB_NRFD
    6030/    28B1 : 17                  	ral
    6031/    28B2 : 32 63 80            	sta	V_GPIB_NDAC
    6032/    28B5 : 17                  	ral
    6033/    28B6 : 32 5F 80            	sta	V_GPIB_ATNDAV
    6034/    28B9 : 17                  	ral
    6035/    28BA : 32 60 80            	sta	V_GPIB_60
    6036/    28BD : 17                  	ral
    6037/    28BE : 32 61 80            	sta	V_GPIB_RATN
    6038/    28C1 : 17                  	ral
    6039/    28C2 : 2F                  	cma
    6040/    28C3 : 32 62 80            	sta	V_GPIB_Bool6
    6041/    28C6 : 3A 00 F0            	lda	DEV_TALKREG
    6042/    28C9 : 32 64 80            	sta	V_TALKREG
    6043/    28CC : E6 1F               	ani	1Fh					;mod 32
    6044/    28CE : F6 40               	ori	40h					;01000000 Set bit 6
    6045/    28D0 : 32 65 80            	sta	V_TALKADDR
    6046/    28D3 : FB                  	ei
    6047/    28D4 : C9                  	ret
    6048/    28D5 :                     ;
    6049/    28D5 :                     ; Action added by CursorPotInt
    6050/    28D5 :                     ; See CursorPotInt2_0 for similarity
    6051/    28D5 :                     ;	
    6052/    28D5 :                     Main_Action_6_0:
    6053/    28D5 : 3A AA 80            	lda	V_CursorMode
    6054/    28D8 : FE 01               	cpi	01h					;NUMWINVOLTS
    6055/    28DA : CA E7 28            	jz	L28E7
    6056/    28DD : FE 02               	cpi	02h					;NUMWINTIME
    6057/    28DF : CA E7 28            	jz	L28E7
    6058/    28E2 : FE 03               	cpi	03h					;NUMWINCPLVT
    6059/    28E4 : C2 EB 28            	jnz	L28EB
    6060/    28E7 :                     ; (V_CursorMode == NUMWINVOLTS) || (V_CursorMode == NUMWINTIME) || (V_CursorMode == NUMWINCPLVT) 
    6061/    28E7 : CD A8 2A            L28E7:	call L2AA8
    6062/    28EA : C9                  	ret
    6063/    28EB :                     L28EB:
    6064/    28EB : FE 00               	cpi	00h					;NUMWINNONE
    6065/    28ED : C8                  	rz						;done
    6066/    28EE :                     ; (V_CursorMode == NUMWINSWEEPS) || (V_CursorMode == NUMWINCNTDOWN)
    6067/    28EE : 2A AB 80            	lhld V_PositionRateCount_Values
    6068/    28F1 : 22 44 81            	shld V_PRCount
    6069/    28F4 : CD 63 30            	call U788_BCD_2_Binary
    6070/    28F7 : CD 30 30            	call Set_Rate_Direction
    6071/    28FA : C9                  	ret
    6072/    28FB :                     ;
    6073/    28FB :                     ; Only called from CursorPotInt.
    6074/    28FB :                     ; Interrupts still OFF
    6075/    28FB :                     ;	
    6076/    28FB :                     CursorPotInt2_0:
    6077/    28FB : 3A AA 80            	lda	V_CursorMode
    6078/    28FE : FE 01               	cpi	01h
    6079/    2900 : CA 0B 29            	jz	L290B
    6080/    2903 : FE 02               	cpi	02h
    6081/    2905 : CA 0B 29            	jz	L290B
    6082/    2908 : FE 03               	cpi	03h
    6083/    290A : C0                  	rnz						;done
    6084/    290B :                     ; (V_CursorMode == 1) || (V_CursorMode == 2) || (V_CursorMode == 3) 
    6085/    290B : 2A AB 80            L290B:	lhld V_PositionRateCount_Values
    6086/    290E : 22 44 81            	shld V_PRCount
    6087/    2911 : CD 63 30            	call U788_BCD_2_Binary
    6088/    2914 : CD 18 29            	call CursorPotIntS881A
    6089/    2917 : C9                  	ret
    6090/    2918 :                     ;
    6091/    2918 :                     ; only called from above
    6092/    2918 :                     ;	
    6093/    2918 :                     CursorPotIntS881A:
    6094/    2918 : 2A 3B 80            	lhld V_PreviousPRCount
    6095/    291B : EB                  	xchg
    6096/    291C : 21 FF FF            	lxi	h,0FFFFH
    6097/    291F : 7B                  	mov	a,e
    6098/    2920 : 95                  	sub	l
    6099/    2921 : 6F                  	mov	l,a
    6100/    2922 : 7A                  	mov	a,d
    6101/    2923 : 9C                  	sbb	h
    6102/    2924 : B5                  	ora	l
    6103/    2925 : C2 31 29            	jnz	L2931
    6104/    2928 : 2A 44 81            	lhld V_PRCount
    6105/    292B : 22 3B 80            	shld V_PreviousPRCount
    6106/    292E : C3 37 29            	jmp	Local2937
    6107/    2931 :                     L2931:
    6108/    2931 : 2A 3C 81            	lhld V_LastPRCount
    6109/    2934 : 22 3B 80            	shld V_PreviousPRCount	;word
    6110/    2937 :                     Local2937:
    6111/    2937 : 2A 44 81            	lhld V_PRCount
    6112/    293A : 22 3C 81            	shld V_LastPRCount
    6113/    293D : 3A 03 E4            	lda	DEV_CURSOR
    6114/    2940 : E6 40               	ani	40h					;01000000 RATE/POS
    6115/    2942 : FE 40               	cpi	40h
    6116/    2944 : C2 32 2A            	jnz	L2A32
    6117/    2947 :                     ; POS active	
    6118/    2947 : 3A 36 80            	lda	V_PRFastMode
    6119/    294A : FE 40               	cpi	40h
    6120/    294C : CA A1 29            	jz	L29A1
    6121/    294F : 3E 40               	mvi	a,40h
    6122/    2951 : 32 36 80            	sta	V_PRFastMode
    6123/    2954 : 2A 3C 81            	lhld V_LastPRCount
    6124/    2957 : EB                  	xchg					;to DE
    6125/    2958 : 21 38 01            	lxi	h,0138h				;312
    6126/    295B : 7B                  	mov	a,e					;DE - 312
    6127/    295C : 95                  	sub	l
    6128/    295D : 7A                  	mov	a,d
    6129/    295E : 9C                  	sbb	h
    6130/    295F : DA 83 29            	jc	Local2983
    6131/    2962 : 2A 9C 3E            	lhld Number5			;compiler madness?
    6132/    2965 : 26 00               	mvi	h,00h
    6133/    2967 : EB                  	xchg
    6134/    2968 : 2A 37 80            	lhld V_CursorPos2
    6135/    296B : CD 3A 3E            	call Multiply_HL_DE
    6136/    296E : EB                  	xchg
    6137/    296F : 2A 3C 81            	lhld V_LastPRCount
    6138/    2972 : 19                  	dad	d
    6139/    2973 : EB                  	xchg
    6140/    2974 : 2A 9C 3E            	lhld Number5			;more compiler madness?
    6141/    2977 : 2C                  	inr	l
    6142/    2978 : 26 00               	mvi	h,00h
    6143/    297A : CD B3 3D            	call Divide_DE_by_HL_2
    6144/    297D : 22 37 80            	shld V_CursorPos2
    6145/    2980 : C3 A1 29            	jmp	L29A1
    6146/    2983 :                     Local2983:
    6147/    2983 : 2A 9C 3E            	lhld Number5			;compiler madness?
    6148/    2986 : 26 00               	mvi	h,00h
    6149/    2988 : EB                  	xchg
    6150/    2989 : 2A 39 80            	lhld V_CursorPos1
    6151/    298C : CD 3A 3E            	call Multiply_HL_DE
    6152/    298F : EB                  	xchg
    6153/    2990 : 2A 3C 81            	lhld V_LastPRCount
    6154/    2993 : 19                  	dad	d
    6155/    2994 : EB                  	xchg
    6156/    2995 : 2A 9C 3E            	lhld Number5			;more compiler madness?
    6157/    2998 : 2C                  	inr	l
    6158/    2999 : 26 00               	mvi	h,00h
    6159/    299B : CD B3 3D            	call Divide_DE_by_HL_2
    6160/    299E : 22 39 80            	shld V_CursorPos1
    6161/    29A1 :                     L29A1:
    6162/    29A1 : 2A 3C 81            	lhld V_LastPRCount
    6163/    29A4 : EB                  	xchg
    6164/    29A5 : 21 38 01            	lxi	h,0138h
    6165/    29A8 : 7B                  	mov	a,e					;V_LastPRCount - 0x0138
    6166/    29A9 : 95                  	sub	l
    6167/    29AA : 7A                  	mov	a,d
    6168/    29AB : 9C                  	sbb	h
    6169/    29AC : D2 BF 29            	jnc	$$L
    6170/    29AF :                     ; V_LastPRCount < 0x0138
    6171/    29AF : 2A 39 80            	lhld V_CursorPos1		;V_TMP8142 = MAX(V_CursorPos1, V_LastPRCount)
    6172/    29B2 : EB                  	xchg
    6173/    29B3 : 2A 3C 81            	lhld V_LastPRCount
    6174/    29B6 : CD 20 3E            	call MAX_DE_HL
    6175/    29B9 : 22 42 81            	shld V_TMP8142
    6176/    29BC : C3 E1 29            	jmp	$$L291
    6177/    29BF :                     $$L:
    6178/    29BF : 2A 37 80            	lhld V_CursorPos2		;V_TMP8142 = MIN(V_CursorPos2, V_LastPRCount)
    6179/    29C2 : EB                  	xchg
    6180/    29C3 : 2A 3C 81            	lhld V_LastPRCount
    6181/    29C6 : CD 2D 3E            	call MIN_DE_HL			;return smaller value in HL
    6182/    29C9 : 22 42 81            	shld V_TMP8142
    6183/    29CC : 3A 14 80            	lda	V_fSnappedCursor	;boolean test
    6184/    29CF : 17                  	ral
    6185/    29D0 : D2 E1 29            	jnc	$$L291
    6186/    29D3 : 3A AD 80            	lda	V_fFirstCursorActive
    6187/    29D6 : 47                  	mov	b,a
    6188/    29D7 : 3A 15 80            	lda	V_fCursor1Snapped
    6189/    29DA : B8                  	cmp	b
    6190/    29DB : C2 E1 29            	jnz	$$L291
    6191/    29DE : CD 71 20            	call ClrCursorSnap
    6192/    29E1 :                     $$L291:
    6193/    29E1 : 2A 3C 81            	lhld V_LastPRCount		;DE = ABS(V_LastPRCount - V_TMP8142)
    6194/    29E4 : EB                  	xchg
    6195/    29E5 : 2A 42 81            	lhld V_TMP8142
    6196/    29E8 : 7B                  	mov	a,e
    6197/    29E9 : 95                  	sub	l
    6198/    29EA : 6F                  	mov	l,a
    6199/    29EB : 7A                  	mov	a,d
    6200/    29EC : 9C                  	sbb	h
    6201/    29ED : 67                  	mov	h,a
    6202/    29EE : CD A6 3D            	call AbsoluteValue_HL
    6203/    29F1 : EB                  	xchg					;result to DE
    6204/    29F2 : 21 7F 00            	lxi	h,007FH
    6205/    29F5 : CD 2D 3E            	call MIN_DE_HL			;return smaller value in HL
    6206/    29F8 : EB                  	xchg					;now in DE
    6207/    29F9 : 21 03 00            	lxi	h,3
    6208/    29FC : CD 0D 3E            	call ShiftR_DE_L_times	;>>= 3 /8
    6209/    29FF : 23                  	inx	h
    6210/    2A00 : 22 40 81            	shld VAR_8140
    6211/    2A03 : 11 7B 3E            	lxi	d,V_CursorScaleTbl-1 ;multiplication factors
    6212/    2A06 : 2A 40 81            	lhld VAR_8140
    6213/    2A09 : 19                  	dad	d
    6214/    2A0A : 7E                  	mov	a,m
    6215/    2A0B : 32 34 80            	sta	V_CursorIncrementValue
    6216/    2A0E : 2A 3C 81            	lhld V_LastPRCount		;V_LastPRCount - 0x0138
    6217/    2A11 : EB                  	xchg
    6218/    2A12 : 21 38 01            	lxi	h,0138h
    6219/    2A15 : 7B                  	mov	a,e
    6220/    2A16 : 95                  	sub	l
    6221/    2A17 : 7A                  	mov	a,d
    6222/    2A18 : 9C                  	sbb	h
    6223/    2A19 : D2 24 2A            	jnc	L2A24
    6224/    2A1C : 3A 34 80            	lda	V_CursorIncrementValue
    6225/    2A1F : 3D                  	dcr	a
    6226/    2A20 : 2F                  	cma
    6227/    2A21 : 32 34 80            	sta	V_CursorIncrementValue
    6228/    2A24 :                     L2A24:
    6229/    2A24 : 11 8B 3E            	lxi	d,V_TimerCntr_Rate_Tbl
    6230/    2A27 : 2A 40 81            	lhld VAR_8140
    6231/    2A2A : 19                  	dad	d
    6232/    2A2B : 7E                  	mov	a,m
    6233/    2A2C : 32 35 80            	sta	V_TimerCntrRateInc2
    6234/    2A2F : C3 65 2A            	jmp	L2A65
    6235/    2A32 :                     ; RATE active	
    6236/    2A32 : 2A 3C 81            L2A32:	lhld V_LastPRCount
    6237/    2A35 : CD 5C 24            	call ShiftR_HL			;divide HL by 2
    6238/    2A38 : 22 3C 81            	shld V_LastPRCount
    6239/    2A3B : 3A 36 80            	lda	V_PRFastMode
    6240/    2A3E : FE 40               	cpi	40h
    6241/    2A40 : C2 4F 2A            	jnz	L2A4F
    6242/    2A43 : 3E 40               	mvi	a,40h
    6243/    2A45 : 2F                  	cma
    6244/    2A46 : 32 36 80            	sta	V_PRFastMode
    6245/    2A49 : 2A 3C 81            	lhld V_LastPRCount
    6246/    2A4C : 22 3B 80            	shld V_PreviousPRCount
    6247/    2A4F :                     L2A4F:
    6248/    2A4F : 2A 3C 81            	lhld V_LastPRCount
    6249/    2A52 : EB                  	xchg
    6250/    2A53 : 2A 3B 80            	lhld V_PreviousPRCount
    6251/    2A56 : 7B                  	mov	a,e					;DE - HL
    6252/    2A57 : 95                  	sub	l
    6253/    2A58 : 6F                  	mov	l,a
    6254/    2A59 : 7A                  	mov	a,d
    6255/    2A5A : 9C                  	sbb	h
    6256/    2A5B : 67                  	mov	h,a
    6257/    2A5C : 22 3E 81            	shld VAR_813E			;VAR_813E = V_LastPRCount - V_PreviousPRCount
    6258/    2A5F : CD 66 2A            	call CursorPotIntS881A_2
    6259/    2A62 : CD 96 30            	call ConstrainVoltsTimeCursor
    6260/    2A65 : C9                  L2A65:	ret
    6261/    2A66 :                     ;
    6262/    2A66 :                     ; Only called from above
    6263/    2A66 :                     ;
    6264/    2A66 :                     CursorPotIntS881A_2:
    6265/    2A66 : 2A 3E 81            	lhld VAR_813E
    6266/    2A69 : EB                  	xchg					;DE = VAR_813E
    6267/    2A6A : 3A AA 80            	lda	V_CursorMode
    6268/    2A6D : FE 03               	cpi	03h					;NUMWINCPLVT
    6269/    2A6F : CA 7A 2A            	jz	L2A7A
    6270/    2A72 : FE 02               	cpi	02h					;NUMWINTIME
    6271/    2A74 : C2 91 2A            	jnz	L2A91
    6272/    2A77 :                     ;	V_CursorMode == NUMWINTIME
    6273/    2A77 : CD 71 20            	call ClrCursorSnap
    6274/    2A7A :                     ;	V_CursorMode == NUMWINCPLVT || V_CursorMode == NUMWINTIME
    6275/    2A7A :                     L2A7A:
    6276/    2A7A : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    6277/    2A7D : 17                  	ral
    6278/    2A7E : D2 89 2A            	jnc	L2A89
    6279/    2A81 : 2A B3 80            	lhld V_TimeCursorPos
    6280/    2A84 : 19                  	dad	d
    6281/    2A85 : 22 B3 80            	shld V_TimeCursorPos	;V_TimeCursorPos += VAR_813E
    6282/    2A88 : C9                  	ret
    6283/    2A89 :                     L2A89:
    6284/    2A89 : 2A B5 80            	lhld V_TimeCursorPos+2
    6285/    2A8C : 19                  	dad	d
    6286/    2A8D : 22 B5 80            	shld V_TimeCursorPos+2	;V_TimeCursorPos+2 += VAR_813E
    6287/    2A90 : C9                  	ret
    6288/    2A91 :                     	
    6289/    2A91 :                     ;	(V_CursorMode != NUMWINCPLVT) && (V_CursorMode != NUMWINTIME)
    6290/    2A91 :                     L2A91:
    6291/    2A91 : 3A AD 80            	lda	V_fFirstCursorActive ;boolean test
    6292/    2A94 : 17                  	ral
    6293/    2A95 : D2 A0 2A            	jnc	L2AA0
    6294/    2A98 : 2A AF 80            	lhld V_VoltsCursorPos
    6295/    2A9B : 19                  	dad	d
    6296/    2A9C : 22 AF 80            	shld V_VoltsCursorPos	;V_VoltsCursorPos += VAR_813E
    6297/    2A9F : C9                  	ret
    6298/    2AA0 :                     L2AA0:
    6299/    2AA0 : 2A B1 80            	lhld V_VoltsCursorPos+2
    6300/    2AA3 : 19                  	dad	d
    6301/    2AA4 : 22 B1 80            	shld V_VoltsCursorPos+2	;V_VoltsCursorPos+2 += VAR_813E
    6302/    2AA7 : C9                  	ret
    6303/    2AA8 :                     	
    6304/    2AA8 :                     L2AA8:
    6305/    2AA8 : CD AF 2A            	call SetNumWinDistance
    6306/    2AAB : CD E5 2A            	call CvtNumWinDistance
    6307/    2AAE : C9                  	ret
    6308/    2AAF :                     ;
    6309/    2AAF :                     ; Only called from above
    6310/    2AAF :                     ;
    6311/    2AAF :                     SetNumWinDistance:
    6312/    2AAF : 3A AA 80            	lda	V_CursorMode
    6313/    2AB2 : FE 02               	cpi	02h
    6314/    2AB4 : C2 C1 2A            	jnz	L2AC1
    6315/    2AB7 :                     ; (V_CursorMode == 2)
    6316/    2AB7 : 2A B3 80            	lhld V_TimeCursorPos	;load 2 words
    6317/    2ABA : EB                  	xchg
    6318/    2ABB : 2A B5 80            	lhld V_TimeCursorPos+2
    6319/    2ABE : C3 D7 2A            	jmp	L2AD7
    6320/    2AC1 :                     ; (V_CursorMode != 2)
    6321/    2AC1 : FE 01               L2AC1:	cpi	01h
    6322/    2AC3 : C2 D0 2A            	jnz	L2AD0
    6323/    2AC6 :                     ; (V_CursorMode == 1)
    6324/    2AC6 : 2A AF 80            	lhld V_VoltsCursorPos	;load 2 words
    6325/    2AC9 : EB                  	xchg
    6326/    2ACA : 2A B1 80            	lhld V_VoltsCursorPos+2
    6327/    2ACD : C3 D7 2A            	jmp	L2AD7
    6328/    2AD0 :                     ; (V_CursorMode != 1) && (V_CursorMode != 2)
    6329/    2AD0 :                     L2AD0:
    6330/    2AD0 : 2A B7 80            	lhld V_LineCursorPos	;load 2 words
    6331/    2AD3 : EB                  	xchg
    6332/    2AD4 : 2A B9 80            	lhld V_LineCursorPos+2
    6333/    2AD7 : 7B                  L2AD7:	mov	a,e				;DE = DE - HL
    6334/    2AD8 : 95                  	sub	l
    6335/    2AD9 : 5F                  	mov	e,a
    6336/    2ADA : 7A                  	mov	a,d
    6337/    2ADB : 9C                  	sbb	h
    6338/    2ADC : 57                  	mov	d,a
    6339/    2ADD : EB                  	xchg					;to HL
    6340/    2ADE : CD A6 3D            	call AbsoluteValue_HL
    6341/    2AE1 : 22 2C 80            	shld V_NumWinValue
    6342/    2AE4 : C9                  	ret
    6343/    2AE5 :                     ;
    6344/    2AE5 :                     ; Only called from above
    6345/    2AE5 :                     ;	
    6346/    2AE5 :                     CvtNumWinDistance:
    6347/    2AE5 : 3A AA 80            	lda	V_CursorMode
    6348/    2AE8 : FE 02               	cpi	02h
    6349/    2AEA : C2 F3 2A            	jnz	L2AF3
    6350/    2AED :                     ; V_CursorMode == 2
    6351/    2AED : CD F7 2A            	call TBNumWin
    6352/    2AF0 : C3 F6 2A            	jmp	L2AF6
    6353/    2AF3 :                     L2AF3:
    6354/    2AF3 : CD ED 2C            	call CvtNumWinDistanceVolts
    6355/    2AF6 :                     L2AF6:
    6356/    2AF6 : C9                  	ret
    6357/    2AF7 :                     ;
    6358/    2AF7 :                     ; Only called from above when V_CursorMode == TIME
    6359/    2AF7 :                     ; This is an incredible mumbo jumbo mess of spaghetti code
    6360/    2AF7 :                     ; TBNumWin and TBNumWin1 go on for 398 bytes of code.
    6361/    2AF7 :                     ; An algorithmic/formula based version is just 164 bytes
    6362/    2AF7 :                     ;
    6363/    2AF7 :                     TBNumWin:
    6364/    2AF7 : 3A 23 80            	lda	V_ATimebaseActive	;which time base
    6365/    2AFA : 17                  	ral
    6366/    2AFB : D2 07 2B            	jnc	L2B07
    6367/    2AFE : 3A 18 80            	lda	V_ATIME
    6368/    2B01 : 32 26 80            	sta	V_UIVolts
    6369/    2B04 : C3 0D 2B            	jmp	Local2B0D
    6370/    2B07 :                     L2B07:
    6371/    2B07 : 3A 19 80            	lda	V_BTIME
    6372/    2B0A : 32 26 80            	sta	V_UIVolts
    6373/    2B0D :                     Local2B0D:
    6374/    2B0D : 2A 7D 80            	lhld V_pDispWF			;p
    6375/    2B10 : 23                  	inx	h
    6376/    2B11 : 23                  	inx	h
    6377/    2B12 : 23                  	inx	h
    6378/    2B13 : 23                  	inx	h
    6379/    2B14 : 7E                  	mov	a,m					;A = p->S_CHANMODE)
    6380/    2B15 : E6 80               	ani	80h					;10000000 SAVEREF
    6381/    2B17 : 2A 7D 80            	lhld V_pDispWF			;reload.
    6382/    2B1A : CA 20 2B            	jz	L2B20				;brif !SAVEREF
    6383/    2B1D : 21 7F 80            	lxi	h,V_WFTable			;use V_WFTable[AREA1] if SAVEREF
    6384/    2B20 :                     L2B20:
    6385/    2B20 : 11 06 00            	lxi	d,S_TB				;B = p->S_TB
    6386/    2B23 : 19                  	dad	d
    6387/    2B24 : 46                  	mov	b,m					;WF targetTB
    6388/    2B25 : 3A 26 80            	lda	V_UIVolts			;UI targetTB
    6389/    2B28 : B8                  	cmp	b
    6390/    2B29 : DA 36 2B            	jc	L2B36				;brif UI targetTB < WF targetTB
    6391/    2B2C : CA 4E 2B            	jz	L2B4E				;brif UI targetTB == WF targetTB
    6392/    2B2F :                     ; UI targetTB > WF targetTB
    6393/    2B2F : CD B4 2B            	call TBNumWin1
    6394/    2B32 : 22 2C 80            	shld V_NumWinValue
    6395/    2B35 : C9                  	ret
    6396/    2B36 :                     ; UI targetTB (A) < WF targetTB (B)
    6397/    2B36 :                     L2B36:
    6398/    2B36 : 4F                  	mov	c,a
    6399/    2B37 : 78                  	mov	a,b
    6400/    2B38 : FE 14               	cpi	TB20
    6401/    2B3A : 79                  	mov	a,c
    6402/    2B3B : DA 4E 2B            	jc	L2B4E				;brif WF targetTB < TB20
    6403/    2B3E : 06 14               	mvi	b,TB20				;also argument to TBNumWin1
    6404/    2B40 : B8                  	cmp	b
    6405/    2B41 : DA 4E 2B            	jc	L2B4E				;brif UI targetTB < TB20
    6406/    2B44 : CA 4E 2B            	jz	L2B4E				;brif UI targetTB == TB20
    6407/    2B47 :                     ; (WF targetTB >= TB20) && (UI targetTB > TB20)
    6408/    2B47 : CD B4 2B            	call TBNumWin1
    6409/    2B4A : 22 2C 80            	shld V_NumWinValue
    6410/    2B4D : C9                  	ret
    6411/    2B4E :                     ; UI targetTB == WF targetTB
    6412/    2B4E :                     ; A = UI targetTB. B = min(WF targetTB, TB20)
    6413/    2B4E :                     L2B4E:
    6414/    2B4E : FE 17               	cpi	17h
    6415/    2B50 : DA 57 2B            	jc	Local2B57
    6416/    2B53 : CD 7D 2B            	call Set_FastTimeDiv
    6417/    2B56 : C9                  	ret
    6418/    2B57 :                     Local2B57:
    6419/    2B57 : CD 5B 2B            	call Set_SlowTimeDiv
    6420/    2B5A : C9                  	ret
    6421/    2B5B :                     ;
    6422/    2B5B :                     ; in B
    6423/    2B5B :                     ; set VAR_8027, update V_NumWinValue
    6424/    2B5B :                     ; Only called from above
    6425/    2B5B :                     ;
    6426/    2B5B :                     Set_SlowTimeDiv:
    6427/    2B5B :                     ; B = WF targetTB but max TB20 if (UI targetTB (A) < WF targetTB) && (WF targetTB >= TB20)
    6428/    2B5B : 78                  	mov	a,b
    6429/    2B5C : CD 9C 2C            	call A_mod_3_plus_1
    6430/    2B5F : 32 27 80            	sta	VAR_8027
    6431/    2B62 : CD 8B 2C            	call SetTimeScaleCode	;sets V_SCALECode
    6432/    2B65 : 2A 2C 80            	lhld V_NumWinValue
    6433/    2B68 : 3A 27 80            	lda	VAR_8027
    6434/    2B6B : FE 03               	cpi	03h
    6435/    2B6D : C2 71 2B            	jnz	Local2B71
    6436/    2B70 : 29                  	dad	h					;x2
    6437/    2B71 :                     Local2B71:
    6438/    2B71 : FE 02               	cpi	02h
    6439/    2B73 : C2 79 2B            	jnz	Local2B79
    6440/    2B76 : CD 85 2C            	call Multiply_HL_by_5
    6441/    2B79 :                     Local2B79:
    6442/    2B79 : 22 2C 80            	shld V_NumWinValue		;save HL
    6443/    2B7C : C9                  	ret
    6444/    2B7D :                     ;
    6445/    2B7D :                     ; set V_SCALECode, update V_NumWinValue
    6446/    2B7D :                     ;
    6447/    2B7D :                     Set_FastTimeDiv:
    6448/    2B7D : 3E F9               	mvi	a,0F9h
    6449/    2B7F : 32 28 80            	sta	V_SCALECode
    6450/    2B82 : 2A 2C 80            	lhld V_NumWinValue
    6451/    2B85 : CD AD 2C            	call Take80Percent
    6452/    2B88 : 22 2C 80            	shld V_NumWinValue
    6453/    2B8B : 3A 26 80            	lda	V_UIVolts
    6454/    2B8E : 47                  	mov	b,a
    6455/    2B8F : CD A4 2C            	call Multiply_HL_by_2.5
    6456/    2B92 : 78                  	mov	a,b
    6457/    2B93 : FE 17               	cpi	17h
    6458/    2B95 : CA B0 2B            	jz	L2BB0
    6459/    2B98 : CD 5C 24            	call ShiftR_HL
    6460/    2B9B : 78                  	mov	a,b
    6461/    2B9C : FE 18               	cpi	18h
    6462/    2B9E : CA B0 2B            	jz	L2BB0
    6463/    2BA1 : CD 5C 24            	call ShiftR_HL
    6464/    2BA4 : 78                  	mov	a,b
    6465/    2BA5 : FE 19               	cpi	19h
    6466/    2BA7 : CA B0 2B            	jz	L2BB0
    6467/    2BAA : CD AD 2C            	call Take80Percent
    6468/    2BAD : CD 5C 24            	call ShiftR_HL
    6469/    2BB0 :                     L2BB0:
    6470/    2BB0 : 22 2C 80            	shld V_NumWinValue
    6471/    2BB3 : C9                  	ret
    6472/    2BB4 :                     ;
    6473/    2BB4 :                     ; in A, B
    6474/    2BB4 :                     ; out HL
    6475/    2BB4 :                     ;
    6476/    2BB4 :                     TBNumWin1:
    6477/    2BB4 : 4F                  	mov	c,a
    6478/    2BB5 : 78                  	mov	a,b
    6479/    2BB6 : FE 14               	cpi	TB20
    6480/    2BB8 : DA BE 2B            	jc	Local2BBE
    6481/    2BBB : 3E 14               	mvi	a,TB20
    6482/    2BBD : 47                  	mov	b,a
    6483/    2BBE :                     Local2BBE:
    6484/    2BBE : CD 9C 2C            	call A_mod_3_plus_1
    6485/    2BC1 : 50                  	mov	d,b
    6486/    2BC2 : 5F                  	mov	e,a
    6487/    2BC3 : CD 8B 2C            	call SetTimeScaleCode	;sets V_SCALECode
    6488/    2BC6 : 42                  	mov	b,d
    6489/    2BC7 : 7B                  	mov	a,e
    6490/    2BC8 : FE 01               	cpi	01h
    6491/    2BCA : C2 05 2C            	jnz	L2C05
    6492/    2BCD : 3A 28 80            	lda	V_SCALECode
    6493/    2BD0 : 3D                  	dcr	a
    6494/    2BD1 : 32 28 80            	sta	V_SCALECode
    6495/    2BD4 : 79                  	mov	a,c
    6496/    2BD5 : 90                  	sub	b
    6497/    2BD6 : 2A 2C 80            	lhld V_NumWinValue
    6498/    2BD9 : CD 85 2C            	call Multiply_HL_by_5
    6499/    2BDC : FE 01               	cpi	01h
    6500/    2BDE : C8                  	rz
    6501/    2BDF : FE 04               	cpi	04h
    6502/    2BE1 : CA FD 2B            	jz	DecrementScaleCode
    6503/    2BE4 : 47                  	mov	b,a
    6504/    2BE5 : C5                  	push b
    6505/    2BE6 : CD AD 2C            	call Take80Percent
    6506/    2BE9 : C1                  	pop	b
    6507/    2BEA : CD 5C 24            	call ShiftR_HL
    6508/    2BED : 78                  	mov	a,b
    6509/    2BEE : FE 02               	cpi	02h
    6510/    2BF0 : C8                  	rz
    6511/    2BF1 : FE 05               	cpi	05h
    6512/    2BF3 : CA FD 2B            	jz	DecrementScaleCode
    6513/    2BF6 : CD 5C 24            	call ShiftR_HL
    6514/    2BF9 : 78                  	mov	a,b
    6515/    2BFA : FE 03               	cpi	03h
    6516/    2BFC : C8                  	rz
    6517/    2BFD :                     ;
    6518/    2BFD :                     ; Local label but also used as subroutine
    6519/    2BFD :                     ;
    6520/    2BFD :                     DecrementScaleCode:
    6521/    2BFD : 3A 28 80            	lda	V_SCALECode
    6522/    2C00 : 3D                  	dcr	a
    6523/    2C01 : 32 28 80            	sta	V_SCALECode
    6524/    2C04 : C9                  	ret
    6525/    2C05 :                     ;
    6526/    2C05 : FE 02               L2C05:	cpi	02h
    6527/    2C07 : C2 3A 2C            	jnz	L2C3A
    6528/    2C0A : 79                  	mov	a,c
    6529/    2C0B : 90                  	sub	b
    6530/    2C0C : 2A 2C 80            	lhld V_NumWinValue
    6531/    2C0F : 47                  	mov	b,a
    6532/    2C10 : C5                  	push b
    6533/    2C11 : CD AD 2C            	call Take80Percent
    6534/    2C14 : C1                  	pop	b
    6535/    2C15 : CD 85 2C            	call Multiply_HL_by_5
    6536/    2C18 : CD 5C 24            	call ShiftR_HL
    6537/    2C1B : 78                  	mov	a,b
    6538/    2C1C : FE 01               	cpi	01h
    6539/    2C1E : C8                  	rz
    6540/    2C1F : FE 04               	cpi	04h
    6541/    2C21 : CA FD 2B            	jz	DecrementScaleCode
    6542/    2C24 : CD 5C 24            	call ShiftR_HL
    6543/    2C27 : 78                  	mov	a,b
    6544/    2C28 : FE 02               	cpi	02h
    6545/    2C2A : C8                  	rz
    6546/    2C2B : FE 05               	cpi	05h
    6547/    2C2D : CA FD 2B            	jz	DecrementScaleCode
    6548/    2C30 : CD 5C 24            	call ShiftR_HL
    6549/    2C33 : 78                  	mov	a,b
    6550/    2C34 : FE 03               	cpi	03h
    6551/    2C36 : C8                  	rz
    6552/    2C37 : C3 FD 2B            	jmp	DecrementScaleCode
    6553/    2C3A :                     L2C3A:
    6554/    2C3A : 79                  	mov	a,c
    6555/    2C3B : 90                  	sub	b
    6556/    2C3C : 2A 2C 80            	lhld V_NumWinValue
    6557/    2C3F : 47                  	mov	b,a
    6558/    2C40 : FE 01               	cpi	01h
    6559/    2C42 : C8                  	rz
    6560/    2C43 : 79                  	mov	a,c
    6561/    2C44 : FE 19               	cpi	19h
    6562/    2C46 : CA 4E 2C            	jz	L2C4E
    6563/    2C49 : FE 1A               	cpi	1Ah
    6564/    2C4B : C2 5A 2C            	jnz	L2C5A
    6565/    2C4E :                     L2C4E:
    6566/    2C4E : CD 5C 24            	call ShiftR_HL
    6567/    2C51 : 79                  	mov	a,c
    6568/    2C52 : FE 19               	cpi	19h
    6569/    2C54 : CA FD 2B            	jz	DecrementScaleCode
    6570/    2C57 : C3 69 2C            	jmp	L2C69
    6571/    2C5A :                     L2C5A:
    6572/    2C5A : CD FD 2B            	call DecrementScaleCode
    6573/    2C5D : CD 85 2C            	call Multiply_HL_by_5
    6574/    2C60 : 78                  	mov	a,b
    6575/    2C61 : FE 02               	cpi	02h
    6576/    2C63 : C8                  	rz
    6577/    2C64 : FE 05               	cpi	05h
    6578/    2C66 : CA FD 2B            	jz	DecrementScaleCode
    6579/    2C69 :                     L2C69:
    6580/    2C69 : C5                  	push b				;save
    6581/    2C6A : CD AD 2C            	call Take80Percent
    6582/    2C6D : C1                  	pop	b
    6583/    2C6E : CD 5C 24            	call ShiftR_HL
    6584/    2C71 : 78                  	mov	a,b
    6585/    2C72 : FE 03               	cpi	03h
    6586/    2C74 : C8                  	rz
    6587/    2C75 : FE 04               	cpi	04h
    6588/    2C77 : CA 7D 2C            	jz	Local2C7D
    6589/    2C7A : C3 FD 2B            	jmp	DecrementScaleCode
    6590/    2C7D :                     Local2C7D:
    6591/    2C7D : CD 5C 24            	call ShiftR_HL
    6592/    2C80 : 78                  	mov	a,b
    6593/    2C81 : FE 04               	cpi	04h
    6594/    2C83 : C8                  	rz
    6595/    2C84 : C9                  	ret
    6596/    2C85 :                     ;
    6597/    2C85 :                     ; Multiply HL by 5. Preserves A
    6598/    2C85 :                     ;
    6599/    2C85 :                     Multiply_HL_by_5:
    6600/    2C85 : 5D                  	mov	e,l
    6601/    2C86 : 54                  	mov	d,h
    6602/    2C87 : 29                  	dad	h
    6603/    2C88 : 29                  	dad	h
    6604/    2C89 : 19                  	dad	d
    6605/    2C8A : C9                  	ret
    6606/    2C8B :                     ;
    6607/    2C8B :                     ; in B. Decrement. Divide by 3. Negate result. Increment
    6608/    2C8B :                     ; set V_SCALECode
    6609/    2C8B :                     ;
    6610/    2C8B :                     SetTimeScaleCode:
    6611/    2C8B : 78                  	mov	a,b					;save
    6612/    2C8C : 3D                  	dcr	a
    6613/    2C8D : 06 FF               	mvi	b,0FFh
    6614/    2C8F :                     L2C8F:
    6615/    2C8F : 04                  	inr	b
    6616/    2C90 : D6 03               	sui	03h
    6617/    2C92 : F2 8F 2C            	jp	L2C8F
    6618/    2C95 : 78                  	mov	a,b
    6619/    2C96 : 2F                  	cma					;two's complement
    6620/    2C97 : 3C                  	inr	a				;negate + 1
    6621/    2C98 : 32 28 80            	sta	V_SCALECode
    6622/    2C9B : C9                  	ret
    6623/    2C9C :                     ;
    6624/    2C9C :                     ; in A. (A modulo 3) plus 1. Result 1, 2 or 3
    6625/    2C9C :                     ;
    6626/    2C9C :                     A_mod_3_plus_1:
    6627/    2C9C : D6 03               	sui	03h
    6628/    2C9E : F2 9C 2C            	jp	A_mod_3_plus_1
    6629/    2CA1 : C6 04               	adi	04h
    6630/    2CA3 : C9                  	ret
    6631/    2CA4 :                     ;
    6632/    2CA4 :                     ; in HL. Multiply by 5, then divide by 2
    6633/    2CA4 :                     ;	
    6634/    2CA4 :                     Multiply_HL_by_2.5:
    6635/    2CA4 : 5D                  	mov	e,l					;HL * 5
    6636/    2CA5 : 54                  	mov	d,h
    6637/    2CA6 : 29                  	dad	h
    6638/    2CA7 : 29                  	dad	h
    6639/    2CA8 : 19                  	dad	d
    6640/    2CA9 : CD 5C 24            	call ShiftR_HL
    6641/    2CAC : C9                  	ret
    6642/    2CAD :                     ;
    6643/    2CAD :                     ; in HL, DE
    6644/    2CAD :                     ;	
    6645/    2CAD :                     Take80Percent:
    6646/    2CAD : 29                  	dad	h					;x2
    6647/    2CAE : 29                  	dad	h					;x4
    6648/    2CAF : EB                  	xchg					;DE <- HL
    6649/    2CB0 : 21 05 00            	lxi	h,0005H
    6650/    2CB3 : CD B7 2C            	call Divide_DE_by_HL
    6651/    2CB6 : C9                  	ret
    6652/    2CB7 :                     ;
    6653/    2CB7 :                     ; in DE, HL
    6654/    2CB7 :                     ; Only called from above (HL == 5)
    6655/    2CB7 :                     ; out DE, HL
    6656/    2CB7 :                     ; re-entrant version which can be called from mainline code.
    6657/    2CB7 :                     ;	
    6658/    2CB7 :                     Divide_DE_by_HL:
    6659/    2CB7 : 44                  	mov	b,h					;BC == HL (5)
    6660/    2CB8 : 4D                  	mov	c,l
    6661/    2CB9 : AF                  	xra	a
    6662/    2CBA : 6F                  	mov	l,a					;loop counter
    6663/    2CBB : E5                  	push	h				;save
    6664/    2CBC : 21 00 00            	lxi	h,0000H				;operand
    6665/    2CBF : E3                  	xthl					;exchange stack top with HL. HL now loop counter
    6666/    2CC0 : F5                  	push	psw
    6667/    2CC1 :                     ;
    6668/    2CC1 :                     ; loop 16 times. L is loop counter. Operand on stack. BC, DE in
    6669/    2CC1 :                     ;
    6670/    2CC1 :                     Local2CC1:
    6671/    2CC1 : F1                  	pop	psw
    6672/    2CC2 : E3                  	xthl					;exchange stack top with HL. HL now operand
    6673/    2CC3 : 7D                  	mov	a,l					;HL -= BC
    6674/    2CC4 : 91                  	sub	c
    6675/    2CC5 : 6F                  	mov	l,a
    6676/    2CC6 : 7C                  	mov	a,h
    6677/    2CC7 : 98                  	sbb	b
    6678/    2CC8 : 67                  	mov	h,a
    6679/    2CC9 : D2 CD 2C            	jnc	L2CCD
    6680/    2CCC : 09                  	dad	b					;HL += BC
    6681/    2CCD :                     L2CCD:
    6682/    2CCD :                     ; shift left DE and HL (operand)
    6683/    2CCD :                     ; HL always 0 coming in
    6684/    2CCD :                     ; Carry may be set
    6685/    2CCD : 7B                  	mov	a,e					;E << 1
    6686/    2CCE : 17                  	ral						;rotate through carry	
    6687/    2CCF : 5F                  	mov	e,a
    6688/    2CD0 : 7A                  	mov	a,d					;D << 1
    6689/    2CD1 : 17                  	ral
    6690/    2CD2 : 57                  	mov	d,a
    6691/    2CD3 : 7D                  	mov	a,l					;L << 1
    6692/    2CD4 : 17                  	ral
    6693/    2CD5 : 6F                  	mov	l,a
    6694/    2CD6 : 7C                  	mov	a,h					;H << 1
    6695/    2CD7 : 17                  	ral
    6696/    2CD8 : 67                  	mov	h,a
    6697/    2CD9 : E3                  	xthl					;exchange stack top with HL. HL now loop counter
    6698/    2CDA : F5                  	push	psw
    6699/    2CDB : 2C                  	inr	l					;loop counter
    6700/    2CDC : 7D                  	mov	a,l
    6701/    2CDD : FE 11               	cpi	11h
    6702/    2CDF : C2 C1 2C            	jnz	Local2CC1			;loop
    6703/    2CE2 :                     ;	
    6704/    2CE2 : F1                  	pop	psw
    6705/    2CE3 : E1                  	pop	h					;operand
    6706/    2CE4 : EB                  	xchg					;HL <- DE
    6707/    2CE5 : 7D                  	mov	a,l					;complement HL
    6708/    2CE6 : 2F                  	cma
    6709/    2CE7 : 6F                  	mov	l,a
    6710/    2CE8 : 7C                  	mov	a,h
    6711/    2CE9 : 2F                  	cma
    6712/    2CEA : 67                  	mov	h,a
    6713/    2CEB : FB                  	ei
    6714/    2CEC : C9                  	ret
    6715/    2CED :                     ;
    6716/    2CED :                     ; called when V_CursorMode != TIME
    6717/    2CED :                     ;
    6718/    2CED :                     CvtNumWinDistanceVolts:
    6719/    2CED : AF                  	xra	a
    6720/    2CEE : 32 4A 81            	sta	V_bit_6_cleared
    6721/    2CF1 : 32 4B 81            	sta	V_fUNCAL
    6722/    2CF4 : 32 4C 81            	sta	V_fAVGVolts
    6723/    2CF7 : 3A 1A 80            	lda	V_CH1_Info
    6724/    2CFA : 32 47 81            	sta	V_CH1_Info_Copy
    6725/    2CFD : 3A 1B 80            	lda	V_CH2_Info
    6726/    2D00 : 32 48 81            	sta	V_CH2_Info_Copy
    6727/    2D03 : CD 17 2F            	call LoadWFTableChanInfo ;get A from WFTable
    6728/    2D06 : CD 89 2E            	call Clr_bit_6_in_A
    6729/    2D09 : 47                  	mov	b,a					;save
    6730/    2D0A : 3A 4A 81            	lda	V_bit_6_cleared		;boolean test
    6731/    2D0D : 17                  	ral
    6732/    2D0E : 78                  	mov	a,b					;restore
    6733/    2D0F : D2 14 2D            	jnc	L2D14				;jmp if bit 6 not cleared
    6734/    2D12 : C6 03               	adi	03h					;A += 3
    6735/    2D14 : 32 49 81            L2D14:	sta	V_AcqVolts		;save
    6736/    2D17 : 2B                  	dcx	h					;HL still points to WFTable
    6737/    2D18 : 2B                  	dcx	h
    6738/    2D19 : 7E                  	mov	a,m					;V_WFTable[V_PrimaryWF].offset5
    6739/    2D1A : E6 03               	ani	03h					;00000011
    6740/    2D1C : FE 03               	cpi	03h					;A - 3
    6741/    2D1E : C2 26 2D            	jnz	$$L
    6742/    2D21 : 3E FF               	mvi	a,0FFh				;TRUE
    6743/    2D23 : 32 4C 81            	sta	V_fAVGVolts
    6744/    2D26 :                     $$L:
    6745/    2D26 : 3A AA 80            	lda	V_CursorMode
    6746/    2D29 : FE 03               	cpi	03h
    6747/    2D2B : C2 34 2D            	jnz	$$L11
    6748/    2D2E : CD 83 2D            	call UpdateCplVTDispVal
    6749/    2D31 : C3 37 2D            	jmp	Local2D37
    6750/    2D34 :                     $$L11:
    6751/    2D34 : CD 98 2E            	call UpdateVoltsDispVal
    6752/    2D37 : 3E 80               Local2D37:	mvi	a,80h		;128
    6753/    2D39 : 21 26 80            	lxi	h,V_UIVolts
    6754/    2D3C : A6                  	ana	m
    6755/    2D3D : FE 80               	cpi	80h					;(0x80 & V_UIVolts) - 0x80
    6756/    2D3F : C2 4F 2D            	jnz	$$L2
    6757/    2D42 :                     ; V_UIVolts bit 7 was 1	
    6758/    2D42 : 3E FA               	mvi	a,0FAh				;250
    6759/    2D44 : 32 28 80            	sta	V_SCALECode
    6760/    2D47 : 3E 01               	mvi	a,01h
    6761/    2D49 : 32 27 80            	sta	VAR_8027
    6762/    2D4C : C3 58 2D            	jmp	$$L3
    6763/    2D4F :                     ; V_UIVolts bit 7 was 0
    6764/    2D4F :                     $$L2:
    6765/    2D4F : 3A 26 80            	lda	V_UIVolts
    6766/    2D52 : CD 6F 2D            	call MappedModulo3
    6767/    2D55 : 32 27 80            	sta	VAR_8027
    6768/    2D58 :                     $$L3:
    6769/    2D58 : 2A 27 80            	lhld VAR_8027			;range 1..3
    6770/    2D5B : 26 00               	mvi	h,00h
    6771/    2D5D : 11 75 3E            	lxi	d,V_CvtFreq2Volts-1	;get multiplication factor from table
    6772/    2D60 : 19                  	dad	d
    6773/    2D61 : 7E                  	mov	a,m
    6774/    2D62 : 5F                  	mov	e,a
    6775/    2D63 : 16 00               	mvi	d,00h
    6776/    2D65 : 2A 2C 80            	lhld V_NumWinValue
    6777/    2D68 : CD 3A 3E            	call Multiply_HL_DE
    6778/    2D6B : 22 2C 80            	shld V_NumWinValue		;update
    6779/    2D6E : C9                  	ret
    6780/    2D6F :                     ;
    6781/    2D6F :                     ; in A
    6782/    2D6F :                     ; inc A, then repeatedly subtract 3
    6783/    2D6F :                     ; V_SCALECode updated
    6784/    2D6F :                     ; out A is range 1..3
    6785/    2D6F :                     ;
    6786/    2D6F :                     MappedModulo3:
    6787/    2D6F : 3C                  	inr	a
    6788/    2D70 : 0E FF               	mvi	c,0FFh				;loop count
    6789/    2D72 :                     $$L:
    6790/    2D72 : 0C                  	inr	c
    6791/    2D73 : D6 03               	sui	03h
    6792/    2D75 : F2 72 2D            	jp	$$L
    6793/    2D78 : 47                  	mov	b,a					;save negative result
    6794/    2D79 : 79                  	mov	a,c					;V_SCALECode = (A + 1) / 3 - 4
    6795/    2D7A : D6 04               	sui	04h
    6796/    2D7C : 32 28 80            	sta	V_SCALECode
    6797/    2D7F : 78                  	mov	a,b					;restore
    6798/    2D80 : C6 04               	adi	04h					;modulo 4
    6799/    2D82 : C9                  	ret
    6800/    2D83 :                     ;
    6801/    2D83 :                     UpdateCplVTDispVal:
    6802/    2D83 : CD 2C 2F            	call SetUIVolts
    6803/    2D86 : 3A 49 81            	lda	V_AcqVolts
    6804/    2D89 : 47                  	mov	b,a
    6805/    2D8A : E6 80               	ani	80h					;10000000 UNCAL_BIT
    6806/    2D8C : 78                  	mov	a,b
    6807/    2D8D : CA 99 2D            	jz	L2D99
    6808/    2D90 : 3E FF               	mvi	a,0FFh
    6809/    2D92 : 32 4B 81            	sta	V_fUNCAL
    6810/    2D95 : 78                  	mov	a,b
    6811/    2D96 : 06 7F               	mvi	b,7Fh				;remove UNCAL_BIT
    6812/    2D98 : A0                  	ana	b
    6813/    2D99 :                     L2D99:
    6814/    2D99 : 32 26 80            	sta	V_UIVolts
    6815/    2D9C : 3A 4C 81            	lda	V_fAVGVolts			;boolean test
    6816/    2D9F : 17                  	ral
    6817/    2DA0 : D2 CE 2D            	jnc	L2DCE				;brif !V_fAVGVolts
    6818/    2DA3 : 3A 26 80            	lda	V_UIVolts
    6819/    2DA6 : FE 04               	cpi	04h
    6820/    2DA8 : D2 B7 2D            	jnc	$$L					;brif V_UIVolts >= VOLTAGE4
    6821/    2DAB : 2A 2C 80            	lhld V_NumWinValue		;special VGAIN correction
    6822/    2DAE : CD A4 2C            	call Multiply_HL_by_2.5	;times 1.25. See Finalize_Average
    6823/    2DB1 : CD 5C 24            	call ShiftR_HL
    6824/    2DB4 : 22 2C 80            	shld V_NumWinValue
    6825/    2DB7 :                     $$L:
    6826/    2DB7 : 3A 4B 81            	lda	V_fUNCAL			;boolean test
    6827/    2DBA : 17                  	ral
    6828/    2DBB : D0                  	rnc						;done if !V_fUNCAL
    6829/    2DBC :                     ; V_fUNCAL TRUE
    6830/    2DBC : 3A A5 80            	lda	V_DigitalMode
    6831/    2DBF : FE 04               	cpi	DIGITAL_SAVE
    6832/    2DC1 : C2 C8 2D            	jnz	SetUIVoltsUNCAL
    6833/    2DC4 :                     ; V_DigitalMode == DIGITAL_SAVE
    6834/    2DC4 : CD 10 2E            	call UpdateChannelVolts
    6835/    2DC7 : C9                  	ret
    6836/    2DC8 :                     SetUIVoltsUNCAL:
    6837/    2DC8 : 3E 80               	mvi	a,80h				;128
    6838/    2DCA : 32 26 80            	sta	V_UIVolts
    6839/    2DCD : C9                  	ret
    6840/    2DCE :                     L2DCE:
    6841/    2DCE : 3A A5 80            	lda	V_DigitalMode
    6842/    2DD1 : FE 04               	cpi	DIGITAL_SAVE
    6843/    2DD3 : C2 F7 2D            	jnz	L2DF7
    6844/    2DD6 :                     ; V_DigitalMode == DIGITAL_SAVE
    6845/    2DD6 : 3A 4B 81            	lda	V_fUNCAL			;boolean test
    6846/    2DD9 : 17                  	ral
    6847/    2DDA : D2 EB 2D            	jnc	$$L					;brif !V_fUNCAL
    6848/    2DDD :                     ;
    6849/    2DDD :                     ; UNCAL setting causes this UpdateChannelVolts() call because
    6850/    2DDD :                     ; the 468 wants to show # divisions in UNCAL
    6851/    2DDD :                     ;
    6852/    2DDD : CD 10 2E            	call UpdateChannelVolts
    6853/    2DE0 : 3A 4B 81            	lda	V_fUNCAL
    6854/    2DE3 : A7                  	ana	a					;test
    6855/    2DE4 : C8                  	rz						;done if FALSE
    6856/    2DE5 : 3E 80               	mvi	a,80h				;128
    6857/    2DE7 : 32 26 80            	sta	V_UIVolts
    6858/    2DEA : C9                  	ret
    6859/    2DEB :                     $$L:
    6860/    2DEB : 3A 26 80            	lda	V_UIVolts		;Max(V_UIVolts, 4)
    6861/    2DEE : FE 04               	cpi	04h
    6862/    2DF0 : D0                  	rnc
    6863/    2DF1 : 3E 04               	mvi	a,04h
    6864/    2DF3 : 32 26 80            	sta	V_UIVolts
    6865/    2DF6 : C9                  	ret
    6866/    2DF7 :                     ; V_DigitalMode != DIGITAL_SAVE
    6867/    2DF7 :                     L2DF7:
    6868/    2DF7 : 3A 26 80            	lda	V_UIVolts
    6869/    2DFA : FE 04               	cpi	04h
    6870/    2DFC : D2 02 2E            	jnc	L2E02				;brif V_UIVolts >= VOLTAGE4			
    6871/    2DFF : CD 65 2E            	call MultiplyNumWinValue
    6872/    2E02 :                     L2E02:
    6873/    2E02 : 3A 4B 81            	lda	V_fUNCAL			;boolean test
    6874/    2E05 : 17                  	ral
    6875/    2E06 : D0                  	rnc						;done if !V_fUNCAL
    6876/    2E07 : 3A 26 80            	lda	V_UIVolts
    6877/    2E0A : F6 80               	ori	80h					;set UNCAL_BIT
    6878/    2E0C : 32 26 80            	sta	V_UIVolts
    6879/    2E0F : C9                  	ret
    6880/    2E10 :                     ;
    6881/    2E10 :                     ; update V_NumWinValue
    6882/    2E10 :                     ;
    6883/    2E10 :                     ; Very esoteric case:
    6884/    2E10 :                     ;	CursorMode==CPLVT && DigitalMode==SAVE && Channel is uncalibrated.
    6885/    2E10 :                     ;
    6886/    2E10 :                     UpdateChannelVolts:
    6887/    2E10 : 3A 26 80            	lda	V_UIVolts
    6888/    2E13 : FE 04               	cpi	VOLTAGE4
    6889/    2E15 : D2 24 2E            	jnc	$$L 				;brif V_UIVolts >= 4
    6890/    2E18 :                     ; V_UIVolts < VOLTAGE4
    6891/    2E18 : 3A 4C 81            	lda	V_fAVGVolts			;boolean test
    6892/    2E1B : 17                  	ral
    6893/    2E1C : 3A 26 80            	lda	V_UIVolts			;preload
    6894/    2E1F : DA 24 2E            	jc	$$L					;brif V_fAVGVolts
    6895/    2E22 :                     ; V_fAVGVolts == FALSE
    6896/    2E22 : 3E 04               	mvi	a,VOLTAGE4			;set minimum VOLTAGE4
    6897/    2E24 :                     $$L:
    6898/    2E24 : 57                  	mov	d,a					;save WF Volts
    6899/    2E25 : 3A 47 81            	lda	V_CH1_Info_Copy
    6900/    2E28 : 32 26 80            	sta	V_UIVolts
    6901/    2E2B : CD 19 30            	call NormalizeUIVolts2	;updates V_UIVolts
    6902/    2E2E : 3A 26 80            	lda	V_UIVolts
    6903/    2E31 : E6 3F               	ani	3Fh					;00111111 remove properties
    6904/    2E33 : 5F                  	mov	e,a					;save UI Volts
    6905/    2E34 : 7A                  	mov	a,d
    6906/    2E35 : 93                  	sub	e					;D - E
    6907/    2E36 : C8                  	rz						;return if E == D
    6908/    2E37 : DA 4B 2E            	jc	L2E4B				;brif D < E
    6909/    2E3A : FE 04               	cpi	4					;
    6910/    2E3C : F2 4F 2E            	jp	L2E4F				;brif (D - E) >= 4
    6911/    2E3F :                     L2E3F:
    6912/    2E3F : CD 56 2E            	call VoltsMultiply		;in D, E. Returns multiplied V_NumWinValue
    6913/    2E42 : 22 2C 80            	shld V_NumWinValue
    6914/    2E45 :                     L2E45:
    6915/    2E45 : 3E 80               	mvi	a,80h				;10000000
    6916/    2E47 : 32 26 80            	sta	V_UIVolts
    6917/    2E4A : C9                  	ret
    6918/    2E4B :                     L2E4B:
    6919/    2E4B : 5A                  	mov	e,d					;E == D
    6920/    2E4C : C3 45 2E            	jmp	L2E45
    6921/    2E4F :                     L2E4F:
    6922/    2E4F : 7A                  	mov	a,d					;E = D + 3
    6923/    2E50 : C6 03               	adi	03h
    6924/    2E52 : 5F                  	mov	e,a
    6925/    2E53 : C3 3F 2E            	jmp	L2E3F				;jmp to VoltsMultiply
    6926/    2E56 :                     ;
    6927/    2E56 :                     ; in D,E
    6928/    2E56 :                     ; out HL
    6929/    2E56 :                     ;
    6930/    2E56 :                     VoltsMultiply:
    6931/    2E56 : 7B                  	mov	a,e
    6932/    2E57 : CD 6F 2D            	call MappedModulo3
    6933/    2E5A : 5F                  	mov	e,a					;save arg2
    6934/    2E5B : 7A                  	mov	a,d
    6935/    2E5C : CD 6F 2D            	call MappedModulo3
    6936/    2E5F : 47                  	mov	b,a					;arg1
    6937/    2E60 : 4B                  	mov	c,e					;arg2
    6938/    2E61 : CD E1 2E            	call ChannelMultiply2	;Multiply V_NumWinValue by 2, 4, 5, 10
    6939/    2E64 : C9                  	ret
    6940/    2E65 :                     ;
    6941/    2E65 :                     MultiplyNumWinValue:
    6942/    2E65 : 2A 2C 80            	lhld V_NumWinValue
    6943/    2E68 : CD A4 2C            	call Multiply_HL_by_2.5
    6944/    2E6B : 22 2C 80            	shld V_NumWinValue
    6945/    2E6E : 3A 26 80            	lda	V_UIVolts
    6946/    2E71 : FE 03               	cpi	03h
    6947/    2E73 : C8                  	rz
    6948/    2E74 : FE 06               	cpi	06h
    6949/    2E76 : C8                  	rz
    6950/    2E77 : 29                  	dad	h					;x2
    6951/    2E78 : 22 2C 80            	shld V_NumWinValue
    6952/    2E7B : 3A 26 80            	lda	V_UIVolts
    6953/    2E7E : FE 02               	cpi	02h
    6954/    2E80 : C8                  	rz
    6955/    2E81 : FE 05               	cpi	05h
    6956/    2E83 : C8                  	rz
    6957/    2E84 : 29                  	dad	h					;x2
    6958/    2E85 : 22 2C 80            	shld V_NumWinValue
    6959/    2E88 : C9                  	ret
    6960/    2E89 :                     ;
    6961/    2E89 :                     ; in A
    6962/    2E89 :                     ; test bit 6. If != 0, clr bit 6
    6963/    2E89 :                     ; sets boolean V_bit_6_cleared if bit 6 was cleared
    6964/    2E89 :                     ;
    6965/    2E89 :                     Clr_bit_6_in_A:
    6966/    2E89 : 47                  	mov	b,a					;save
    6967/    2E8A : E6 40               	ani	40h					;01000000
    6968/    2E8C : 78                  	mov	a,b					;restore
    6969/    2E8D : C8                  	rz						;done if not set
    6970/    2E8E : 3E FF               	mvi	a,0FFh				;TRUE
    6971/    2E90 : 32 4A 81            	sta	V_bit_6_cleared
    6972/    2E93 : 3E 40               	mvi	a,40h				;01000000
    6973/    2E95 : 2F                  	cma						;10111111
    6974/    2E96 : A0                  	ana	b					;original in B: clr bit 6
    6975/    2E97 : C9                  	ret
    6976/    2E98 :                     ;
    6977/    2E98 :                     ; Only called once
    6978/    2E98 :                     ;
    6979/    2E98 :                     UpdateVoltsDispVal:
    6980/    2E98 : CD 2C 2F            	call SetUIVolts
    6981/    2E9B : 3A A5 80            	lda	V_DigitalMode
    6982/    2E9E : FE 04               	cpi	DIGITAL_SAVE
    6983/    2EA0 : C0                  	rnz
    6984/    2EA1 :                     ; V_DigitalMode == DIGITAL_SAVE
    6985/    2EA1 : 3A 26 80            	lda	V_UIVolts
    6986/    2EA4 : 47                  	mov	b,a					;save V_UIVolts
    6987/    2EA5 : E6 80               	ani	80h					;10000000
    6988/    2EA7 : C0                  	rnz
    6989/    2EA8 : 3A 49 81            	lda	V_AcqVolts
    6990/    2EAB : E6 3F               	ani	3Fh					;00111111 isolate Volts
    6991/    2EAD : 4F                  	mov	c,a					;save uncorrected AcqVolts value
    6992/    2EAE : FE 04               	cpi	04h
    6993/    2EB0 : D2 B5 2E            	jnc	L2EB5				;brif V_AcqVolts >= 4
    6994/    2EB3 : 3E 04               	mvi	a,04h				;V_AcqVolts = VOLTAGE4: max hardware value
    6995/    2EB5 :                     L2EB5:
    6996/    2EB5 : B8                  	cmp	b					;V_AcqVolts - V_UIVolts
    6997/    2EB6 : DA DB 2E            	jc	L2EDB				;brif V_UIVolts > V_AcqVolts: no amplification but set DIV LED
    6998/    2EB9 : D6 03               	sui	03h					;V_AcqVolts -= 3
    6999/    2EBB : B8                  	cmp	b					;V_UIVolts
    7000/    2EBC : DA C3 2E            	jc	L2EC3				;brif V_UIVolts >= (V_AcqVolts - 3) 
    7001/    2EBF : CA C3 2E            	jz	L2EC3
    7002/    2EC2 :                     ; V_UIVolts < (V_AcqVolts - 3) 
    7003/    2EC2 : 47                  	mov	b,a					;update cached V_UIVolts to (V_AcqVolts - 3)
    7004/    2EC3 :                     L2EC3:
    7005/    2EC3 : 3A 4C 81            	lda	V_fAVGVolts			;AVG mode?
    7006/    2EC6 : 17                  	ral
    7007/    2EC7 : 78                  	mov	a,b					;A = new V_UIVolts
    7008/    2EC8 : D2 DD 2E            	jnc	L2EDD				;brif !AVG mode
    7009/    2ECB : FE 04               	cpi	04h					;new V_UIVolts - VOLTAGE4
    7010/    2ECD : D2 DD 2E            	jnc	L2EDD				;brif new V_UIVolts >= VOLTAGE4. BUG sb > VOLTAGE4
    7011/    2ED0 : B9                  	cmp	c					;V_AcqVolts
    7012/    2ED1 : DA DD 2E            	jc	L2EDD				;brif V_AcqVolts >= new V_UIVolts
    7013/    2ED4 : CA DD 2E            	jz	L2EDD
    7014/    2ED7 : 79                  	mov	a,c					;new V_UIVolts = V_AcqVolts
    7015/    2ED8 : C3 DD 2E            	jmp	L2EDD
    7016/    2EDB :                     L2EDB:
    7017/    2EDB : 3E 80               	mvi	a,80h				;UNCAL_BIT
    7018/    2EDD :                     L2EDD:
    7019/    2EDD : 32 26 80            	sta	V_UIVolts
    7020/    2EE0 : C9                  	ret
    7021/    2EE1 :                     ;
    7022/    2EE1 :                     ; in B (arg1), C (arg2)
    7023/    2EE1 :                     ;	Arg1	Arg2
    7024/    2EE1 :                     ;	2		
    7025/    2EE1 :                     ; out HL Multiply V_NumWinValue by 2, 2.5, 4, 5, 10
    7026/    2EE1 :                     ;
    7027/    2EE1 :                     ChannelMultiply2:
    7028/    2EE1 : 2A 2C 80            	lhld V_NumWinValue
    7029/    2EE4 : 78                  	mov	a,b
    7030/    2EE5 : FE 02               	cpi	02h
    7031/    2EE7 : C2 F7 2E            	jnz	L2EF7
    7032/    2EEA :                     ; arg1 == 2	
    7033/    2EEA : 29                  	dad	h					;x2
    7034/    2EEB : 79                  	mov	a,c
    7035/    2EEC : FE 01               	cpi	01h
    7036/    2EEE : C8                  	rz
    7037/    2EEF :                     ; arg2 != 1	
    7038/    2EEF : 29                  	dad	h					;x2 total x4
    7039/    2EF0 : FE 03               	cpi	03h
    7040/    2EF2 : C8                  	rz
    7041/    2EF3 :                     ; arg2 != 3
    7042/    2EF3 : CD A4 2C            	call Multiply_HL_by_2.5	;total x10
    7043/    2EF6 : C9                  	ret
    7044/    2EF7 :                     ; arg1 != 2
    7045/    2EF7 : FE 01               L2EF7:	cpi	01h
    7046/    2EF9 : C2 0A 2F            	jnz	L2F0A
    7047/    2EFC :                     ; arg1 == 1	
    7048/    2EFC : 29                  	dad	h					;x2
    7049/    2EFD : 79                  	mov	a,c
    7050/    2EFE : FE 03               	cpi	03h
    7051/    2F00 : C8                  	rz
    7052/    2F01 :                     ; arg2 != 3	
    7053/    2F01 : CD A4 2C            	call Multiply_HL_by_2.5 ;preserves C total x5
    7054/    2F04 : 79                  	mov	a,c
    7055/    2F05 : FE 02               	cpi	02h
    7056/    2F07 : C8                  	rz
    7057/    2F08 :                     ; arg2 != 2	
    7058/    2F08 : 29                  	dad	h					;x2 total x10
    7059/    2F09 : C9                  	ret
    7060/    2F0A :                     ; arg1 != 1	
    7061/    2F0A :                     L2F0A:
    7062/    2F0A : CD A4 2C            	call Multiply_HL_by_2.5
    7063/    2F0D : 79                  	mov	a,c
    7064/    2F0E : FE 02               	cpi	02h
    7065/    2F10 : C8                  	rz
    7066/    2F11 :                     ; arg2 != 2	
    7067/    2F11 : 29                  	dad	h					;x2 total x5
    7068/    2F12 : FE 01               	cpi	01h
    7069/    2F14 : C8                  	rz
    7070/    2F15 :                     ; arg2 != 1	
    7071/    2F15 : 29                  	dad	h					;x2 total x10
    7072/    2F16 : C9                  	ret
    7073/    2F17 :                     ;
    7074/    2F17 :                     ; out HL points to V_WFTable[V_PrimaryWF].offset7
    7075/    2F17 :                     ;
    7076/    2F17 :                     LoadWFTableChanInfo:
    7077/    2F17 : 3A A3 80            	lda	V_PrimaryWF			;base 1
    7078/    2F1A : 3D                  	dcr	a					;base 0
    7079/    2F1B : 87                  	add	a					;x8
    7080/    2F1C : 87                  	add	a
    7081/    2F1D : 87                  	add	a
    7082/    2F1E : 3C                  	inr	a					;+1
    7083/    2F1F : 6F                  	mov	l,a
    7084/    2F20 : 26 00               	mvi	h,00h
    7085/    2F22 : 11 7E 80            	lxi	d,V_WFTable-1
    7086/    2F25 : 19                  	dad	d
    7087/    2F26 : 11 07 00            	lxi	d,0007H
    7088/    2F29 : 19                  	dad	d
    7089/    2F2A : 7E                  	mov	a,m
    7090/    2F2B : C9                  	ret
    7091/    2F2C :                     ;
    7092/    2F2C :                     ;	
    7093/    2F2C :                     SetUIVolts:
    7094/    2F2C : 3A 20 80            	lda	V_fADD				;boolean test
    7095/    2F2F : 17                  	ral
    7096/    2F30 : DA 3E 2F            	jc	L2F3E
    7097/    2F33 : 3A 1E 80            	lda	V_fCH1
    7098/    2F36 : 21 1F 80            	lxi	h,V_fCH2
    7099/    2F39 : A6                  	ana	m
    7100/    2F3A : 17                  	ral
    7101/    2F3B : D2 DD 2F            	jnc	L2FDD
    7102/    2F3E :                     L2F3E:
    7103/    2F3E : 3A AA 80            	lda	V_CursorMode
    7104/    2F41 : FE 03               	cpi	03h
    7105/    2F43 : C2 4E 2F            	jnz	L2F4E
    7106/    2F46 : 3A 20 80            	lda	V_fADD				;boolean test
    7107/    2F49 : 2F                  	cma
    7108/    2F4A : 17                  	ral
    7109/    2F4B : DA 51 2F            	jc	L2F51
    7110/    2F4E :                     L2F4E:
    7111/    2F4E : C3 5A 2F            	jmp	L2F5A
    7112/    2F51 :                     L2F51:
    7113/    2F51 : 3A 47 81            	lda	V_CH1_Info_Copy
    7114/    2F54 : 32 26 80            	sta	V_UIVolts
    7115/    2F57 : C3 DA 2F            	jmp	L2FDA
    7116/    2F5A :                     L2F5A:
    7117/    2F5A : 3A 48 81            	lda	V_CH2_Info_Copy
    7118/    2F5D : 21 47 81            	lxi	h,V_CH1_Info_Copy
    7119/    2F60 : BE                  	cmp	m
    7120/    2F61 : C2 6D 2F            	jnz	L2F6D
    7121/    2F64 : 3A 47 81            	lda	V_CH1_Info_Copy
    7122/    2F67 : 32 26 80            	sta	V_UIVolts
    7123/    2F6A : C3 DA 2F            	jmp	L2FDA
    7124/    2F6D :                     L2F6D:
    7125/    2F6D : 3E 40               	mvi	a,40h				;01000000
    7126/    2F6F : 21 47 81            	lxi	h,V_CH1_Info_Copy
    7127/    2F72 : A6                  	ana	m
    7128/    2F73 : FE 40               	cpi	40h					;test bit 6
    7129/    2F75 : C2 A8 2F            	jnz	L2FA8
    7130/    2F78 :                     ; V_CH1_Info_Copy bit 6 was 0
    7131/    2F78 : 3E 40               	mvi	a,40h				;10111111
    7132/    2F7A : 2F                  	cma
    7133/    2F7B : 21 47 81            	lxi	h,V_CH1_Info_Copy
    7134/    2F7E : A6                  	ana	m					;get all but bit 6.
    7135/    2F7F : C6 03               	adi	03h					;A += 3
    7136/    2F81 : 32 47 81            	sta	V_CH1_Info_Copy		;update.
    7137/    2F84 : 3E FF               	mvi	a,0FFh
    7138/    2F86 : 32 4A 81            	sta	V_bit_6_cleared		;unused
    7139/    2F89 : 3A 48 81            	lda	V_CH2_Info_Copy
    7140/    2F8C : 21 47 81            	lxi	h,V_CH1_Info_Copy
    7141/    2F8F : BE                  	cmp	m
    7142/    2F90 : C2 9C 2F            	jnz	L2F9C
    7143/    2F93 : 3A 47 81            	lda	V_CH1_Info_Copy
    7144/    2F96 : 32 26 80            	sta	V_UIVolts
    7145/    2F99 : C3 A5 2F            	jmp	L2FA5
    7146/    2F9C :                     L2F9C:
    7147/    2F9C : 3E 80               	mvi	a,80h				;10000000
    7148/    2F9E : 32 26 80            	sta	V_UIVolts
    7149/    2FA1 : AF                  	xra	a
    7150/    2FA2 : 32 4A 81            	sta	V_bit_6_cleared
    7151/    2FA5 : C3 DA 2F            L2FA5:	jmp	L2FDA
    7152/    2FA8 :                     ; V_CH1_Info_Copy bit 6 was 1
    7153/    2FA8 :                     L2FA8:
    7154/    2FA8 : 3A 48 81            	lda	V_CH2_Info_Copy
    7155/    2FAB : E6 40               	ani	40h					;01000000
    7156/    2FAD : FE 40               	cpi	40h
    7157/    2FAF : C2 D5 2F            	jnz	L2FD5
    7158/    2FB2 :                     ; V_CH2_Info_Copy bit 6 was 0
    7159/    2FB2 : 3E 40               	mvi	a,40h				;10111111
    7160/    2FB4 : 2F                  	cma
    7161/    2FB5 : 21 48 81            	lxi	h,V_CH2_Info_Copy
    7162/    2FB8 : A6                  	ana	m					;get all but bit 6.
    7163/    2FB9 : C6 03               	adi	03h					;A += 3
    7164/    2FBB : 2A 47 81            	lhld V_CH1_Info_Copy
    7165/    2FBE : CD 5D 3D            	call Test_Equal_A_L
    7166/    2FC1 : D2 CD 2F            	jnc	L2FCD				;jmp if not equal
    7167/    2FC4 : 3A 47 81            	lda	V_CH1_Info_Copy
    7168/    2FC7 : 32 26 80            	sta	V_UIVolts
    7169/    2FCA : C3 D2 2F            	jmp	L2FD2
    7170/    2FCD :                     L2FCD:
    7171/    2FCD : 3E 80               	mvi	a,80h				;128
    7172/    2FCF : 32 26 80            	sta	V_UIVolts
    7173/    2FD2 : C3 DA 2F            L2FD2:	jmp	L2FDA
    7174/    2FD5 :                     L2FD5:
    7175/    2FD5 : 3E 80               	mvi	a,80h				;128
    7176/    2FD7 : 32 26 80            	sta	V_UIVolts
    7177/    2FDA : C3 02 30            L2FDA:	jmp	L3002
    7178/    2FDD :                     L2FDD:
    7179/    2FDD : 3A 1E 80            	lda	V_fCH1
    7180/    2FE0 : 17                  	ral
    7181/    2FE1 : D2 ED 2F            	jnc	L2FED
    7182/    2FE4 : 3A 47 81            	lda	V_CH1_Info_Copy
    7183/    2FE7 : 32 26 80            	sta	V_UIVolts
    7184/    2FEA : C3 02 30            	jmp	L3002
    7185/    2FED :                     L2FED:
    7186/    2FED : 3A 1F 80            	lda	V_fCH2				;boolean test
    7187/    2FF0 : 17                  	ral
    7188/    2FF1 : D2 FD 2F            	jnc	L2FFD
    7189/    2FF4 : 3A 48 81            	lda	V_CH2_Info_Copy
    7190/    2FF7 : 32 26 80            	sta	V_UIVolts
    7191/    2FFA : C3 02 30            	jmp	L3002
    7192/    2FFD :                     L2FFD:
    7193/    2FFD : 3E 80               	mvi	a,80h				;10000000
    7194/    2FFF : 32 26 80            	sta	V_UIVolts
    7195/    3002 :                     L3002:						;see NormalizeUIVolts2
    7196/    3002 : 3A 26 80            	lda	V_UIVolts
    7197/    3005 : E6 40               	ani	40h					;01000000
    7198/    3007 : FE 40               	cpi	40h
    7199/    3009 : C2 18 30            	jnz	L3018
    7200/    300C : 3E 40               	mvi	a,40h				;10111111
    7201/    300E : 2F                  	cma
    7202/    300F : 21 26 80            	lxi	h,V_UIVolts
    7203/    3012 : A6                  	ana	m					;get all but bit 6.
    7204/    3013 : C6 03               	adi	03h					;A += 3
    7205/    3015 : 32 26 80            	sta	V_UIVolts
    7206/    3018 : C9                  L3018:	ret
    7207/    3019 :                     ;
    7208/    3019 :                     NormalizeUIVolts2:
    7209/    3019 : 3A 26 80            	lda	V_UIVolts
    7210/    301C : E6 40               	ani	40h					;01000000 PROBEBIT
    7211/    301E : FE 40               	cpi	40h
    7212/    3020 : C2 2F 30            	jnz	L302F
    7213/    3023 :                     ; V_UIVolts PROBEBIT was 1	
    7214/    3023 : 3E 40               	mvi	a,40h				;10111111
    7215/    3025 : 2F                  	cma						;~PROBEBIT
    7216/    3026 : 21 26 80            	lxi	h,V_UIVolts
    7217/    3029 : A6                  	ana	m					;clr V_UIVolts PROBEBIT 
    7218/    302A : C6 03               	adi	03h					;A += 3
    7219/    302C : 32 26 80            	sta	V_UIVolts
    7220/    302F : C9                  L302F:	ret
    7221/    3030 :                     ;
    7222/    3030 :                     ; part of Action 6
    7223/    3030 :                     ;
    7224/    3030 :                     Set_Rate_Direction:
    7225/    3030 : 3A AA 80            	lda	V_CursorMode
    7226/    3033 : FE 04               	cpi	04h					;NUMWINSWEEPS
    7227/    3035 : C2 62 30            	jnz	L3062
    7228/    3038 : 3A 03 E4            	lda	DEV_CURSOR
    7229/    303B : E6 40               	ani	40h					;01000000 RATE/POS
    7230/    303D : FE 40               	cpi	40h
    7231/    303F : C2 62 30            	jnz	L3062
    7232/    3042 :                     ;
    7233/    3042 :                     ; RATE Active
    7234/    3042 :                     ;	
    7235/    3042 : 2A 44 81            	lhld V_PRCount
    7236/    3045 : EB                  	xchg					;V_PRCount -> DE
    7237/    3046 : 21 38 01            	lxi	h,0138h				;312d
    7238/    3049 : 7B                  	mov	a,e					;V_PRCount - 0138h
    7239/    304A : 95                  	sub	l
    7240/    304B : 7A                  	mov	a,d
    7241/    304C : 9C                  	sbb	h
    7242/    304D : DA 58 30            	jc	L3058
    7243/    3050 : 3E 01               	mvi	a,01h
    7244/    3052 : 32 C0 80            	sta	V_Rate_Direction
    7245/    3055 : C3 5D 30            	jmp	L305D
    7246/    3058 : 3E FF               L3058:	mvi	a,0FFh
    7247/    305A : 32 C0 80            	sta	V_Rate_Direction
    7248/    305D : 3E FF               L305D:	mvi	a,0FFh
    7249/    305F : 32 C1 80            	sta	V_TimerCntrSweepsIncrement
    7250/    3062 : C9                  L3062:	ret
    7251/    3063 :                     ;
    7252/    3063 :                     ; Convert V_PRCount (word)
    7253/    3063 :                     ;
    7254/    3063 :                     U788_BCD_2_Binary:
    7255/    3063 : 3A 45 81            	lda	V_PRCount+1
    7256/    3066 : 07                  	rlc						;x2
    7257/    3067 : 47                  	mov	b,a					;save
    7258/    3068 : 07                  	rlc						;x4
    7259/    3069 : 07                  	rlc
    7260/    306A : 80                  	add	b					;V_PRCount+1 x 6
    7261/    306B : 4F                  	mov	c,a					;save
    7262/    306C : 3A 44 81            	lda	V_PRCount
    7263/    306F : 0F                  	rrc						;move upper 4 bits to low nibble
    7264/    3070 : 0F                  	rrc
    7265/    3071 : 0F                  	rrc
    7266/    3072 : 0F                  	rrc
    7267/    3073 : E6 0F               	ani	0Fh					;00001111
    7268/    3075 : 81                  	add	c					;V_PRCount+1 x 6
    7269/    3076 : 07                  	rlc						;x2
    7270/    3077 : 5F                  	mov	e,a					;DE
    7271/    3078 : AF                  	xra	a
    7272/    3079 : 57                  	mov	d,a
    7273/    307A : 67                  	mov	h,a					;H = 0
    7274/    307B : 7B                  	mov	a,e					;x2
    7275/    307C : 17                  	ral
    7276/    307D : D2 83 30            	jnc	Local3083
    7277/    3080 : 3F                  	cmc
    7278/    3081 : 24                  	inr	h					;H += 2
    7279/    3082 : 24                  	inr	h
    7280/    3083 : 17                  Local3083:	ral
    7281/    3084 : D2 89 30            	jnc	L3089
    7282/    3087 : 3F                  	cmc
    7283/    3088 : 24                  	inr	h
    7284/    3089 : 6F                  L3089:	mov	l,a
    7285/    308A : 19                  	dad	d
    7286/    308B : 3A 44 81            	lda	V_PRCount			;reload
    7287/    308E : E6 0F               	ani	0Fh					;00001111 lower nibble
    7288/    3090 : 5F                  	mov	e,a					;to E
    7289/    3091 : 19                  	dad	d
    7290/    3092 : 22 44 81            	shld V_PRCount			;update V_PRCount (word)
    7291/    3095 : C9                  	ret
    7292/    3096 :                     ;
    7293/    3096 :                     ; update V_TimeCursorPos+2 .. V_VoltsCursorPos
    7294/    3096 :                     ;
    7295/    3096 :                     ConstrainVoltsTimeCursor:
    7296/    3096 : 21 84 80            	lxi	h,V_WFTable+S_STATUS ;p
    7297/    3099 : 3A A3 80            	lda	V_PrimaryWF			;base 1
    7298/    309C : 3D                  	dcr	a					;base 0
    7299/    309D : 07                  	rlc						;x8
    7300/    309E : 07                  	rlc
    7301/    309F : 07                  	rlc
    7302/    30A0 : 5F                  	mov	e,a
    7303/    30A1 : 16 00               	mvi	d,00h
    7304/    30A3 : 19                  	dad	d					;p = V_WFTable[V_PrimaryWF]+S_STATUS
    7305/    30A4 : 7E                  	mov	a,m					;get byte *p
    7306/    30A5 : E6 04               	ani	LONGWFMASK			;01000000 test bit 6
    7307/    30A7 : FE 04               	cpi	LONGWFMASK
    7308/    30A9 : 3E 03               	mvi	a,03h
    7309/    30AB : CA B0 30            	jz	$$L
    7310/    30AE : 3E 06               	mvi	a,06h
    7311/    30B0 :                     $$L:
    7312/    30B0 : 32 16 80            	sta	VAR_8016			;3 or 6
    7313/    30B3 : 4F                  	mov	c,a					;save
    7314/    30B4 : 21 B6 80            	lxi	h,V_TimeCursorPos+2+1 ;p points to MSB
    7315/    30B7 : 06 04               	mvi	b,04h				;loop counter
    7316/    30B9 :                     ;loop	
    7317/    30B9 :                     Loop30B9:
    7318/    30B9 : 56                  	mov	d,m					;DE = *(word *)(p-1)
    7319/    30BA : 2B                  	dcx	h
    7320/    30BB : 5E                  	mov	e,m
    7321/    30BC : 23                  	inx	h
    7322/    30BD : 7A                  	mov	a,d					;test D (MSB)
    7323/    30BE : A7                  	ana	a
    7324/    30BF : FA CA 30            	jm	$$L 				;L30CA
    7325/    30C2 : C2 D2 30            	jnz	$$L1 				;L30D2
    7326/    30C5 :                     ; D == 0	
    7327/    30C5 : 7B                  	mov	a,e
    7328/    30C6 : B9                  	cmp	c					;3 or 6
    7329/    30C7 : D2 DE 30            	jnc	$$L2				;done
    7330/    30CA :                     $$L:
    7331/    30CA : 36 00               	mvi	m,00h				;*(word *)(p-1) = (word)C
    7332/    30CC : 2B                  	dcx	h
    7333/    30CD : 71                  	mov	m,c
    7334/    30CE : 23                  	inx	h
    7335/    30CF : C3 DE 30            	jmp	$$L2				;done
    7336/    30D2 :                     $$L1:
    7337/    30D2 : 7A                  	mov	a,d
    7338/    30D3 : FE 04               	cpi	04h
    7339/    30D5 : DA DE 30            	jc	$$L2				;done
    7340/    30D8 : 36 03               	mvi	m,03h				;*(word *)(p-1) = 0x03ff
    7341/    30DA : 2B                  	dcx	h
    7342/    30DB : 36 FF               	mvi	m,0FFh
    7343/    30DD : 23                  	inx	h
    7344/    30DE :                     $$L2:
    7345/    30DE : 2B                  	dcx	h					;p -= 2
    7346/    30DF : 2B                  	dcx	h
    7347/    30E0 : 05                  	dcr	b					;loop 4 times
    7348/    30E1 : C2 B9 30            	jnz	Loop30B9
    7349/    30E4 : C9                  	ret
    7350/    30E5 :                     ;
    7351/    30E5 :                     ;
    7352/    30E5 :                     ;
    7353/    30E5 :                     Main_Action_1_0:
    7354/    30E5 : 3A AA 80            	lda	V_CursorMode
    7355/    30E8 : FE 04               	cpi	04h
    7356/    30EA : C2 14 31            	jnz	L3114
    7357/    30ED :                     ; V_CursorMode == 4	
    7358/    30ED : 3A A5 80            	lda	V_DigitalMode
    7359/    30F0 : FE 03               	cpi	DIGITAL_AVG
    7360/    30F2 : C2 FB 30            	jnz	L30FB
    7361/    30F5 : 2A C2 80            	lhld V_AVG_Sweeps
    7362/    30F8 : C3 01 31            	jmp	L3101
    7363/    30FB :                     ; V_DigitalMode != 3
    7364/    30FB : FE 02               L30FB:	cpi	DIGITAL_ENV
    7365/    30FD : C0                  	rnz						;V_DigitalMode != 2
    7366/    30FE : 2A C4 80            	lhld V_ENV_Sweeps
    7367/    3101 :                     L3101:
    7368/    3101 : 22 4E 81            	shld V_BCD_Input
    7369/    3104 : CD DF 31            	call Convert_2_BCD
    7370/    3107 :                     ;
    7371/    3107 :                     L3107:
    7372/    3107 : 3E E0               	mvi	a,0E0h
    7373/    3109 : 32 58 81            	sta	V_LedCode			;V_LedCode = 0xe0
    7374/    310C : 3E 05               	mvi	a,05h
    7375/    310E : 32 57 81            	sta	V_DecPoint			;V_DecPoint = 0x05
    7376/    3111 : C3 2B 31            	jmp	L312B
    7377/    3114 :                     ; V_CursorMode != 4	
    7378/    3114 : FE 05               L3114:	cpi	05h				;A = V_CursorMode
    7379/    3116 : C2 25 31            	jnz	L3125
    7380/    3119 :                     ; V_CursorMode == 5
    7381/    3119 : 2A C6 80            	lhld V_Sweep_Cnt1
    7382/    311C : 22 4E 81            	shld V_BCD_Input
    7383/    311F : CD DF 31            	call Convert_2_BCD
    7384/    3122 : C3 07 31            	jmp	L3107
    7385/    3125 :                     ; V_CursorMode != 5	
    7386/    3125 :                     L3125:
    7387/    3125 : FE 00               	cpi	00h					;A = V_CursorMode
    7388/    3127 : C8                  	rz						;V_CursorMode == 0 done
    7389/    3128 : CD 2E 32            	call PrepNumWin			;update V_SCALECode2, V_DecPoint, V_LedCode
    7390/    312B : 3E 01               L312B:	mvi	a,01h
    7391/    312D : 32 54 81            	sta	V_TMP8154
    7392/    3130 : 21 00 F0            	lxi	h,0F000H			;nibble bit pattern
    7393/    3133 : 22 55 81            	shld VAR_8155
    7394/    3136 :                     ; loop
    7395/    3136 : 3A 54 81            L3136:	lda	V_TMP8154
    7396/    3139 : 2E 04               	mvi	l,04h
    7397/    313B : CD 82 3D            	call Compare_A_L		;return FALSE/CY Clr if A >= L (signed)
    7398/    313E :                     ; A <= L
    7399/    313E : D2 8A 31            	jnc	L318A
    7400/    3141 : 2A 55 81            	lhld VAR_8155
    7401/    3144 : EB                  	xchg
    7402/    3145 : 2A 4E 81            	lhld V_BCD_Input
    7403/    3148 : 7B                  	mov	a,e					;V_BCD_Input = VAR_8155 & V_BCD_Input
    7404/    3149 : A5                  	ana	l
    7405/    314A : 6F                  	mov	l,a
    7406/    314B : 7A                  	mov	a,d
    7407/    314C : A4                  	ana	h
    7408/    314D : 67                  	mov	h,a
    7409/    314E : 7D                  	mov	a,l					;test HL
    7410/    314F : B4                  	ora	h
    7411/    3150 : C2 5D 31            	jnz	L315D
    7412/    3153 :                     ; HL == 0	
    7413/    3153 : 3A 54 81            	lda	V_TMP8154
    7414/    3156 : 21 57 81            	lxi	h,V_DecPoint
    7415/    3159 : BE                  	cmp	m
    7416/    315A : DA 60 31            	jc	L3160
    7417/    315D : C3 73 31            L315D:	jmp	L3173			;exit loop
    7418/    3160 : 2A 55 81            L3160:	lhld VAR_8155
    7419/    3163 : EB                  	xchg
    7420/    3164 : 2A 4E 81            	lhld V_BCD_Input
    7421/    3167 : 7B                  	mov	a,e					;V_BCD_Input = VAR_8155 | V_BCD_Input
    7422/    3168 : B5                  	ora	l
    7423/    3169 : 6F                  	mov	l,a
    7424/    316A : 7A                  	mov	a,d
    7425/    316B : B4                  	ora	h
    7426/    316C : 67                  	mov	h,a
    7427/    316D : 22 4E 81            	shld V_BCD_Input
    7428/    3170 : C3 76 31            	jmp	L3176
    7429/    3173 : C3 8A 31            L3173:	jmp	L318A			;exit loop
    7430/    3176 : 2A 55 81            L3176:	lhld VAR_8155		;[VAR_8155] >>= 4. Next 4 bits
    7431/    3179 : EB                  	xchg
    7432/    317A : 21 04 00            	lxi	h,0004H
    7433/    317D : CD 0D 3E            	call ShiftR_DE_L_times
    7434/    3180 : 22 55 81            	shld VAR_8155
    7435/    3183 : 21 54 81            	lxi	h,V_TMP8154			;[V_TMP8154]++
    7436/    3186 : 34                  	inr	m
    7437/    3187 : C3 36 31            	jmp	L3136
    7438/    318A : 3E 04               L318A:	mvi	a,04h			;loop count
    7439/    318C : 32 4D 81            	sta	V_TMP814D
    7440/    318F :                     ;
    7441/    318F :                     ; critical region
    7442/    318F :                     ;	
    7443/    318F : F3                  	di
    7444/    3190 : 3A AA 80            	lda	V_CursorMode
    7445/    3193 : FE 00               	cpi	00h
    7446/    3195 : CA DD 31            	jz	L31DD				;nothing to display
    7447/    3198 : 3A 58 81            	lda	V_LedCode			;V_Curr_LEDRO = V_LedCode
    7448/    319B : 32 33 80            	sta	V_Curr_LEDRO
    7449/    319E : 3A 57 81            	lda	V_DecPoint			;V_DecPntDigit = V_DecPoint
    7450/    31A1 : 32 32 80            	sta	V_DecPntDigit
    7451/    31A4 :                     ;loop 4 times
    7452/    31A4 : 3A 4D 81            L31A4:	lda	V_TMP814D
    7453/    31A7 : 2E 00               	mvi	l,00h
    7454/    31A9 : CD 66 3D            	call Signed_Compare_A_L	;return TRUE/CY set if A > L (signed)
    7455/    31AC : D2 DD 31            	jnc	L31DD				;done
    7456/    31AF :                     ; A > 0
    7457/    31AF : 11 0F 00            	lxi	d,000FH				;lowest 4 bits
    7458/    31B2 : 2A 4E 81            	lhld V_BCD_Input		;V_BCD_Input & 000FH
    7459/    31B5 : 7B                  	mov	a,e
    7460/    31B6 : A5                  	ana	l
    7461/    31B7 : 6F                  	mov	l,a					;L = L & 0xff
    7462/    31B8 : 7A                  	mov	a,d
    7463/    31B9 : A4                  	ana	h
    7464/    31BA : 67                  	mov	h,a					;H = H & 0
    7465/    31BB : 44                  	mov	b,h					;BC = HL. H = 0
    7466/    31BC : 4D                  	mov	c,l					;2 BCD values
    7467/    31BD : 2A 4D 81            	lhld V_TMP814D			;only want L
    7468/    31C0 : CD 9C 3D            	call SignExtend_L_in_H	;sign extend L into H.
    7469/    31C3 : 11 2D 80            	lxi	d,V_NumWinBuf-1
    7470/    31C6 : 19                  	dad	d
    7471/    31C7 : 79                  	mov	a,c
    7472/    31C8 : 77                  	mov	m,a
    7473/    31C9 : 21 4D 81            	lxi	h,V_TMP814D			;[V_TMP814D]--
    7474/    31CC : 35                  	dcr	m
    7475/    31CD : 2A 4E 81            	lhld V_BCD_Input		;V_BCD_Input >>=, next 4 bits
    7476/    31D0 : EB                  	xchg
    7477/    31D1 : 21 04 00            	lxi	h,0004H
    7478/    31D4 : CD 0D 3E            	call ShiftR_DE_L_times
    7479/    31D7 : 22 4E 81            	shld V_BCD_Input
    7480/    31DA : C3 A4 31            	jmp	L31A4				;loop
    7481/    31DD :                     ;
    7482/    31DD :                     ; end critical region
    7483/    31DD :                     ;	
    7484/    31DD : FB                  L31DD:	ei
    7485/    31DE : C9                  	ret
    7486/    31DF :                     ;
    7487/    31DF :                     ; in V_BCD_Input
    7488/    31DF :                     ; updates V_BCD_Input (word), V_SCALECode2 (byte)
    7489/    31DF :                     ;
    7490/    31DF :                     Convert_2_BCD:
    7491/    31DF : CD 09 32            	call Convert_2_BCD_0	;sets variable V_BCD_Result (3 bytes, 2 BCD each byte)
    7492/    31E2 : 2A 51 81            	lhld V_BCD_Result		;first 2 results (byte 0, 1)
    7493/    31E5 : 3A 53 81            	lda	V_BCD_Result+2		;3rd result, byte 2
    7494/    31E8 : A7                  	ana	a					;test A
    7495/    31E9 : CA 05 32            	jz	L3205
    7496/    31EC :                     ;
    7497/    31EC :                     ; BCD result doesn't fit in 4 BCD digits
    7498/    31EC :                     ;	
    7499/    31EC : 06 04               	mvi	b,04h				;loop 4 times -> divide V_BCD_Result by 16
    7500/    31EE :                     $$L:
    7501/    31EE : CD 5C 24            	call ShiftR_HL			;V_BCD_Result >> 4. Forget lowest BCD result
    7502/    31F1 :                     							;make room for new highest BCD digit
    7503/    31F1 : 05                  	dcr	b
    7504/    31F2 : C2 EE 31            	jnz	$$L
    7505/    31F5 : 3A 53 81            	lda	V_BCD_Result+2		;V_BCD_Result+2 << 4.
    7506/    31F8 : 87                  	add	a
    7507/    31F9 : 87                  	add	a
    7508/    31FA : 87                  	add	a
    7509/    31FB : 87                  	add	a
    7510/    31FC : B4                  	ora	h					;Make this highest BCD digit in V_BCD_Result
    7511/    31FD : 67                  	mov	h,a				
    7512/    31FE : 3A 50 81            	lda	V_SCALECode2		;increment decimal point position
    7513/    3201 : 3C                  	inr	a
    7514/    3202 : 32 50 81            	sta	V_SCALECode2
    7515/    3205 :                     L3205:
    7516/    3205 : 22 4E 81            	shld V_BCD_Input		;store HL in V_BCD_Input, V_BCD_Input+1
    7517/    3208 : C9                  	ret
    7518/    3209 :                     ;
    7519/    3209 :                     ; computes V_BCD_Result (word) and V_BCD_OVERFLOW (byte)
    7520/    3209 :                     ; Loaded from V_BCD_Input (external)
    7521/    3209 :                     ;
    7522/    3209 :                     Convert_2_BCD_0:
    7523/    3209 : AF                  	xra	a
    7524/    320A : 32 53 81            	sta	V_BCD_Result+2		;MSB
    7525/    320D : AF                  	xra	a
    7526/    320E : 32 52 81            	sta	V_BCD_Result+1
    7527/    3211 : AF                  	xra	a
    7528/    3212 : 32 51 81            	sta	V_BCD_Result		;LSB
    7529/    3215 : 2A 4E 81            	lhld V_BCD_Input
    7530/    3218 : 0E 10               	mvi	c,10h				;for every bit in V_BCD_Input
    7531/    321A :                     ; outer loop. Shift most significant bit of HL in CY
    7532/    321A :                     ; and shift it to the corresponding position in V_BCD_Result,
    7533/    321A :                     ; correcting for BCD result.
    7534/    321A :                     $$L1:
    7535/    321A : 29                  	dad	h					;<< 1. bit 15 to CY
    7536/    321B : 11 51 81            	lxi	d,V_BCD_Result		;reset
    7537/    321E : 06 03               	mvi	b,03h				;for every digit in V_BCD_Result
    7538/    3220 :                     ; inner loop doubles 3 V_BCD_Result digits and adds CY from "dad h"
    7539/    3220 : 1A                  $$L: ldax d
    7540/    3221 : 8F                  	adc	a					;include CY from "dad h".
    7541/    3222 :                     ; if adc causes an overflow from bit 3 to bit 4 (lower BCD overflow), add 06h
    7542/    3222 :                     ; if adc sets carry	(overflow from bit 7, higher BCD overflow), add 60h
    7543/    3222 : 27                  	daa						;may set CY which is then carried forward to adc in next loop
    7544/    3223 : 12                  	stax d
    7545/    3224 : 13                  	inx	d
    7546/    3225 : 05                  	dcr	b
    7547/    3226 : C2 20 32            	jnz	$$L
    7548/    3229 : 0D                  	dcr	c
    7549/    322A : C2 1A 32            	jnz	$$L1
    7550/    322D : C9                  	ret
    7551/    322E :                     ;
    7552/    322E :                     ; update V_SCALECode2, V_DecPoint, V_LedCode
    7553/    322E :                     ;
    7554/    322E :                     PrepNumWin:
    7555/    322E : 2A 2C 80            	lhld V_NumWinValue
    7556/    3231 : 22 4E 81            	shld V_BCD_Input
    7557/    3234 : 3A 28 80            	lda	V_SCALECode
    7558/    3237 : 32 50 81            	sta	V_SCALECode2
    7559/    323A : CD DF 31            	call Convert_2_BCD
    7560/    323D : 3A 50 81            	lda	V_SCALECode2
    7561/    3240 : 2E FC               	mvi	l,0FCh
    7562/    3242 : CD 82 3D            	call Compare_A_L		;return FALSE/CY Clr if A >= L (signed)
    7563/    3245 : D2 50 32            	jnc	L3250				;jmp if V_SCALECode2 >= 0xfc
    7564/    3248 : 3E 60               	mvi	a,60h				;SCALE_TOP|SCALE_MID off -> SCALE_BOT
    7565/    324A : 32 58 81            	sta	V_LedCode			;V_LedCode = 0x60
    7566/    324D : C3 68 32            	jmp	L3268
    7567/    3250 : 3A 50 81            L3250:	lda	V_SCALECode2
    7568/    3253 : 2E FF               	mvi	l,0FFh
    7569/    3255 : CD 82 3D            	call Compare_A_L		;return FALSE/CY Clr if A >= L (signed)
    7570/    3258 : D2 63 32            	jnc	L3263				;jmp if V_SCALECode2 >= 0xff
    7571/    325B : 3E A0               	mvi	a,0A0h				;SCALE_TOP|SCALE_BOT off -> SCALE_MID
    7572/    325D : 32 58 81            	sta	V_LedCode			;V_LedCode = 0xa0
    7573/    3260 : C3 68 32            	jmp	L3268
    7574/    3263 : 3E C0               L3263:	mvi	a,0C0h			;SCALE_BOT|SCALE_MID off -> SCALE_TOP
    7575/    3265 : 32 58 81            	sta	V_LedCode			;V_LedCode = 0xc0
    7576/    3268 : 3A 50 81            L3268:	lda	V_SCALECode2
    7577/    326B : 2E FF               	mvi	l,0FFh
    7578/    326D : CD 5D 3D            	call Test_Equal_A_L
    7579/    3270 : DA 89 32            	jc	L3289				;jmp if V_SCALECode2 == 0xff
    7580/    3273 : 3A 50 81            	lda	V_SCALECode2
    7581/    3276 : 2E FC               	mvi	l,0FCh
    7582/    3278 : CD 5D 3D            	call Test_Equal_A_L
    7583/    327B : DA 89 32            	jc	L3289				;jmp if V_SCALECode2 == 0xfc
    7584/    327E : 3A 50 81            	lda	V_SCALECode2
    7585/    3281 : 2E F9               	mvi	l,0F9h
    7586/    3283 : CD 5D 3D            	call Test_Equal_A_L
    7587/    3286 : D2 91 32            	jnc	L3291				;jmp if V_SCALECode2 != 0xf9
    7588/    3289 : 3E 01               L3289:	mvi	a,01h			;V_DecPoint = 1
    7589/    328B : 32 57 81            	sta	V_DecPoint
    7590/    328E : C3 E8 32            	jmp	L32E8
    7591/    3291 : 3A 50 81            L3291:	lda	V_SCALECode2
    7592/    3294 : 2E 00               	mvi	l,00h
    7593/    3296 : CD 5D 3D            	call Test_Equal_A_L
    7594/    3299 : DA B2 32            	jc	L32B2				;jmp if V_SCALECode2 == 0
    7595/    329C : 3A 50 81            	lda	V_SCALECode2
    7596/    329F : 2E FD               	mvi	l,0FDh
    7597/    32A1 : CD 5D 3D            	call Test_Equal_A_L
    7598/    32A4 : DA B2 32            	jc	L32B2				;jmp if V_SCALECode2 == 0xfd
    7599/    32A7 : 3A 50 81            	lda	V_SCALECode2
    7600/    32AA : 2E FA               	mvi	l,0FAh
    7601/    32AC : CD 5D 3D            	call Test_Equal_A_L
    7602/    32AF : D2 BA 32            	jnc	L32BA				;jmp if V_SCALECode2 != 0xfa
    7603/    32B2 : 3E 02               L32B2:	mvi	a,02h
    7604/    32B4 : 32 57 81            	sta	V_DecPoint
    7605/    32B7 : C3 E8 32            	jmp	L32E8
    7606/    32BA : 3A 50 81            L32BA:	lda	V_SCALECode2
    7607/    32BD : 2E 01               	mvi	l,01h
    7608/    32BF : CD 5D 3D            	call Test_Equal_A_L
    7609/    32C2 : DA DB 32            	jc	L32DB				;jmp if V_SCALECode2 == 1
    7610/    32C5 : 3A 50 81            	lda	V_SCALECode2
    7611/    32C8 : 2E FE               	mvi	l,0FEh
    7612/    32CA : CD 5D 3D            	call Test_Equal_A_L
    7613/    32CD : DA DB 32            	jc	L32DB				;jmp if V_SCALECode2 == 0xfe
    7614/    32D0 : 3A 50 81            	lda	V_SCALECode2
    7615/    32D3 : 2E FB               	mvi	l,0FBh
    7616/    32D5 : CD 5D 3D            	call Test_Equal_A_L
    7617/    32D8 : D2 E3 32            	jnc	L32E3				;jmp if V_SCALECode2 != 0xfb
    7618/    32DB :                     ;	
    7619/    32DB : 3E 03               L32DB:	mvi	a,03h			;V_DecPoint = 3
    7620/    32DD : 32 57 81            	sta	V_DecPoint
    7621/    32E0 : C3 E8 32            	jmp	L32E8
    7622/    32E3 : 3E 04               L32E3:	mvi	a,04h			;V_DecPoint = 4
    7623/    32E5 : 32 57 81            	sta	V_DecPoint
    7624/    32E8 : C9                  L32E8:	ret
    7625/    32E9 :                     ;
    7626/    32E9 :                     ;
    7627/    32E9 :                     Action_0x7C_0:
    7628/    32E9 : 3A 03 F0            	lda	DEV_ATNFLS
    7629/    32EC : CD 6E 20            	call Get_GPIB_Status
    7630/    32EF : 3A 5D 80            	lda	V_GPIB_Bool7
    7631/    32F2 : A7                  	ana	a					;boolean test
    7632/    32F3 : F2 4B 33            	jp	L334B
    7633/    32F6 : 3A 6F 80            	lda	V_GPIB_Bool5
    7634/    32F9 : A7                  	ana	a					;boolean test
    7635/    32FA : F2 14 33            	jp	L3314
    7636/    32FD : 3E FF               	mvi	a,0FFh
    7637/    32FF : 32 6E 80            	sta	V_GPIB_Bool4
    7638/    3302 : 3E FB               	mvi	a,0FBh
    7639/    3304 : CD 65 20            	call Update_DEV_WIFCTL_and
    7640/    3307 : 3E 7D               	mvi	a,7Dh
    7641/    3309 : CD 49 00            	call AddMainAction
    7642/    330C : 3E FE               	mvi	a,0FEh				;11111110	
    7643/    330E : CD 68 20            	call Update_DEV_FPC_and
    7644/    3311 : C3 4B 33            	jmp	L334B
    7645/    3314 : 3E FF               L3314:	mvi	a,0FFh
    7646/    3316 : 32 6D 80            	sta	V_GPIB_Bool3
    7647/    3319 : 47                  	mov	b,a
    7648/    331A : 3A 0D 80            	lda	V_GPIB_ActionWasRemoved
    7649/    331D : 4F                  	mov	c,a
    7650/    331E : 3A 66 80            	lda	V_GPIB_XmittingWF
    7651/    3321 : A1                  	ana	c
    7652/    3322 : F2 36 33            	jp	L3336
    7653/    3325 : 21 0E 80            	lxi	h,VAR_800E
    7654/    3328 : 3E 84               	mvi	a,84h				;of action 0x84, replace with 0x80
    7655/    332A : BE                  	cmp	m
    7656/    332B : C2 30 33            	jnz	L3330
    7657/    332E : 36 80               	mvi	m,80h
    7658/    3330 :                     L3330:
    7659/    3330 : 3A 0E 80            	lda	VAR_800E
    7660/    3333 : CD 49 00            	call AddMainAction
    7661/    3336 : AF                  L3336:	xra	a
    7662/    3337 : 32 0D 80            	sta	V_GPIB_ActionWasRemoved
    7663/    333A : 3A 66 80            	lda	V_GPIB_XmittingWF
    7664/    333D : 2F                  	cma
    7665/    333E : 47                  	mov	b,a
    7666/    333F : 3A 55 80            	lda	V_GPIB_MTAReceived
    7667/    3342 : A0                  	ana	b
    7668/    3343 : F2 4B 33            	jp	L334B
    7669/    3346 : 3E FF               	mvi	a,0FFh
    7670/    3348 : 32 68 80            	sta	V_GPIB_Bool2
    7671/    334B :                     L334B:
    7672/    334B : 3E FF               	mvi	a,0FFh
    7673/    334D : 32 5B 80            	sta	V_GPIB_Bool9
    7674/    3350 : F3                  	di
    7675/    3351 : 20                  	rim
    7676/    3352 : F6 08               	ori	08h
    7677/    3354 : E6 0E               	ani	0Eh
    7678/    3356 : 30                  	sim
    7679/    3357 : FB                  	ei
    7680/    3358 : C9                  	ret
    7681/    3359 :                     ;
    7682/    3359 :                     ;	
    7683/    3359 :                     Action_0x7B_0:
    7684/    3359 : CD 6E 20            	call Get_GPIB_Status
    7685/    335C : 3E F5               	mvi	a,0F5h
    7686/    335E : CD 65 20            	call Update_DEV_WIFCTL_and
    7687/    3361 : 3A 61 80            	lda	V_GPIB_RATN
    7688/    3364 : A7                  	ana	a
    7689/    3365 : FA 7E 33            	jm	L337E
    7690/    3368 : 3A 64 80            	lda	V_TALKREG
    7691/    336B : A7                  	ana	a
    7692/    336C : F2 79 33            	jp	L3379
    7693/    336F : 3E 21               	mvi	a,21h
    7694/    3371 : CD 95 20            	call L2095
    7695/    3374 : 3E 80               	mvi	a,80h
    7696/    3376 : CD 8C 20            	call Update_DEV_FPC_or
    7697/    3379 : 3E 7C               L3379:	mvi	a,7Ch
    7698/    337B : C3 39 34            	jmp	L3439
    7699/    337E : 3A 5F 80            L337E:	lda	V_GPIB_ATNDAV
    7700/    3381 : A7                  	ana	a
    7701/    3382 : F2 37 34            	jp	L3437
    7702/    3385 : 3A 05 F0            	lda	DEV_RIFDI
    7703/    3388 : E6 7F               	ani	7Fh
    7704/    338A : FE 14               	cpi	TB20
    7705/    338C : C2 BD 33            	jnz	L33BD
    7706/    338F : AF                  	xra	a
    7707/    3390 : 32 55 80            	sta	V_GPIB_MTAReceived
    7708/    3393 : 32 68 80            	sta	V_GPIB_Bool2
    7709/    3396 : 32 66 80            	sta	V_GPIB_XmittingWF
    7710/    3399 : 32 0D 80            	sta	V_GPIB_ActionWasRemoved
    7711/    339C : 32 07 80            	sta	V_GPIB_XmitWFRQSFActive
    7712/    339F : 3A 06 80            	lda	VAR_8006
    7713/    33A2 : A7                  	ana	a
    7714/    33A3 : FA B5 33            	jm	L33B5
    7715/    33A6 : 3E FB               	mvi	a,0FBh
    7716/    33A8 : CD 65 20            	call Update_DEV_WIFCTL_and
    7717/    33AB : 3E FE               	mvi	a,0FEh
    7718/    33AD : CD 68 20            	call Update_DEV_FPC_and
    7719/    33B0 : 3E 00               	mvi	a,00h
    7720/    33B2 : C3 B7 33            	jmp	L33B7
    7721/    33B5 : 3E 41               L33B5:	mvi	a,41h
    7722/    33B7 : 32 A9 80            L33B7:	sta	V_GPIBOut
    7723/    33BA : C3 1F 34            	jmp	L341F
    7724/    33BD : FE 18               L33BD:	cpi	18h
    7725/    33BF : C2 CF 33            	jnz	L33CF
    7726/    33C2 : 3E FF               	mvi	a,0FFh
    7727/    33C4 : 32 6F 80            	sta	V_GPIB_Bool5
    7728/    33C7 : 3E 20               	mvi	a,20h
    7729/    33C9 : CD 95 20            	call L2095
    7730/    33CC : C3 1F 34            	jmp	L341F
    7731/    33CF : FE 19               L33CF:	cpi	19h
    7732/    33D1 : C2 DB 33            	jnz	L33DB
    7733/    33D4 : AF                  	xra	a
    7734/    33D5 : 32 6F 80            	sta	V_GPIB_Bool5
    7735/    33D8 : C3 1F 34            	jmp	L341F
    7736/    33DB : FE 5F               L33DB:	cpi	5Fh
    7737/    33DD : C2 ED 33            	jnz	L33ED
    7738/    33E0 : 3E FE               	mvi	a,0FEh
    7739/    33E2 : CD 65 20            	call Update_DEV_WIFCTL_and
    7740/    33E5 : 3E 7F               	mvi	a,7Fh
    7741/    33E7 : CD 68 20            	call Update_DEV_FPC_and
    7742/    33EA : C3 1F 34            	jmp	L341F
    7743/    33ED : 47                  L33ED:	mov	b,a
    7744/    33EE : 3A 65 80            	lda	V_TALKADDR
    7745/    33F1 : B8                  	cmp	b
    7746/    33F2 : 78                  	mov	a,b
    7747/    33F3 : C2 08 34            	jnz	L3408
    7748/    33F6 : 3E 21               	mvi	a,21h
    7749/    33F8 : CD 95 20            	call L2095
    7750/    33FB : 3E 80               	mvi	a,80h
    7751/    33FD : CD 8C 20            	call Update_DEV_FPC_or
    7752/    3400 : 3E FF               	mvi	a,0FFh
    7753/    3402 : 32 55 80            	sta	V_GPIB_MTAReceived
    7754/    3405 : C3 1F 34            	jmp	L341F
    7755/    3408 : FE 5E               L3408:	cpi	5Eh
    7756/    340A : CA 10 34            	jz	L3410
    7757/    340D : D2 1F 34            	jnc	L341F
    7758/    3410 : FE 40               L3410:	cpi	40h
    7759/    3412 : DA 1F 34            	jc	L341F
    7760/    3415 : 3E FE               	mvi	a,0FEh
    7761/    3417 : CD 65 20            	call Update_DEV_WIFCTL_and
    7762/    341A : 3E 7F               	mvi	a,7Fh
    7763/    341C : CD 68 20            	call Update_DEV_FPC_and
    7764/    341F : 3E FF               L341F:	mvi	a,0FFh
    7765/    3421 : 32 02 F0            	sta	DEV_DATACC
    7766/    3424 : CD 6E 20            	call Get_GPIB_Status
    7767/    3427 : 3A 6F 80            	lda	V_GPIB_Bool5
    7768/    342A : 47                  	mov	b,a
    7769/    342B : 3A 5D 80            	lda	V_GPIB_Bool7
    7770/    342E : B0                  	ora	b
    7771/    342F : FA 37 34            	jm	L3437
    7772/    3432 :                     L3432:
    7773/    3432 : 3E DF               	mvi	a,0DFh
    7774/    3434 : CD 65 20            	call Update_DEV_WIFCTL_and
    7775/    3437 :                     L3437:
    7776/    3437 : 3E 7B               	mvi	a,7Bh
    7777/    3439 :                     L3439:
    7778/    3439 : CD 49 00            	call AddMainAction
    7779/    343C : C9                  	ret
    7780/    343D :                     ;
    7781/    343D :                     Action_0x7A_0:
    7782/    343D : CD 6E 20            	call Get_GPIB_Status
    7783/    3440 : 3A 62 80            	lda	V_GPIB_Bool6
    7784/    3443 : 17                  	ral
    7785/    3444 : D2 4F 34            	jnc	L344F
    7786/    3447 : 3E 7A               	mvi	a,7Ah
    7787/    3449 : CD 49 00            	call AddMainAction
    7788/    344C : C3 54 34            	jmp	L3454
    7789/    344F : 3E 7B               L344F:	mvi	a,7Bh
    7790/    3451 : CD 49 00            	call AddMainAction
    7791/    3454 : C9                  L3454:	ret
    7792/    3455 :                     ;
    7793/    3455 :                     Action_0x83_0:
    7794/    3455 : CD 6E 20            	call Get_GPIB_Status
    7795/    3458 : F3                  	di
    7796/    3459 : 3A 0D 80            	lda	V_GPIB_ActionWasRemoved
    7797/    345C : 17                  	ral
    7798/    345D : D8                  	rc
    7799/    345E : 3A 5E 80            	lda	V_GPIB_NRFD
    7800/    3461 : 47                  	mov	b,a
    7801/    3462 : 3A 63 80            	lda	V_GPIB_NDAC
    7802/    3465 : A0                  	ana	b
    7803/    3466 : F2 BD 34            	jp	L34BD
    7804/    3469 : 3A 69 80            	lda	V_WIFDO
    7805/    346C : 32 04 F0            	sta	DEV_WIFDO
    7806/    346F : 3A 67 80            	lda	V_GPIB_EndOfMessage
    7807/    3472 : 17                  	ral
    7808/    3473 : 21 17 80            	lxi	h,V_WIFCTL
    7809/    3476 : D2 A3 34            	jnc	L34A3
    7810/    3479 : 3E 08               	mvi	a,08h
    7811/    347B : B6                  	ora	m
    7812/    347C : 77                  	mov	m,a
    7813/    347D : AF                  	xra	a
    7814/    347E : 32 66 80            	sta	V_GPIB_XmittingWF
    7815/    3481 : 32 07 80            	sta	V_GPIB_XmitWFRQSFActive
    7816/    3484 : 3A 64 80            	lda	V_TALKREG
    7817/    3487 : 32 55 80            	sta	V_GPIB_MTAReceived
    7818/    348A : 3E 00               	mvi	a,00h
    7819/    348C : 32 A9 80            	sta	V_GPIBOut
    7820/    348F : 3A 06 80            	lda	VAR_8006
    7821/    3492 : 17                  	ral
    7822/    3493 : DA A0 34            	jc	L34A0
    7823/    3496 : 3E FB               	mvi	a,0FBh
    7824/    3498 : CD 65 20            	call Update_DEV_WIFCTL_and
    7825/    349B : 3E FE               	mvi	a,0FEh
    7826/    349D : CD 68 20            	call Update_DEV_FPC_and
    7827/    34A0 : C3 AD 34            L34A0:	jmp	L34AD
    7828/    34A3 : 3E 08               L34A3:	mvi	a,08h
    7829/    34A5 : 2F                  	cma
    7830/    34A6 : A6                  	ana	m
    7831/    34A7 : 77                  	mov	m,a
    7832/    34A8 : 3E 84               	mvi	a,84h
    7833/    34AA : CD 49 00            	call AddMainAction
    7834/    34AD : 3E FD               L34AD:	mvi	a,0FDh
    7835/    34AF : CD 65 20            	call Update_DEV_WIFCTL_and
    7836/    34B2 : 3E FF               	mvi	a,0FFh
    7837/    34B4 : 32 01 F0            	sta	DEV_SNTACK
    7838/    34B7 : 3E 02               	mvi	a,02h
    7839/    34B9 : CD 95 20            	call L2095
    7840/    34BC : C9                  	ret
    7841/    34BD : 3E 83               L34BD:	mvi	a,83h
    7842/    34BF : CD 49 00            	call AddMainAction
    7843/    34C2 : C9                  	ret
    7844/    34C3 :                     ;	
    7845/    34C3 :                     Action_0x7E_0:
    7846/    34C3 : F3                  	di
    7847/    34C4 : 3A 5B 80            	lda	V_GPIB_Bool9
    7848/    34C7 : A7                  	ana	a					;boolean test
    7849/    34C8 : F2 D8 34            	jp	L34D8
    7850/    34CB : 32 07 80            	sta	V_GPIB_XmitWFRQSFActive
    7851/    34CE : 3E 79               	mvi	a,79h
    7852/    34D0 : CD 49 00            	call AddMainAction
    7853/    34D3 : 3E 82               	mvi	a,82h
    7854/    34D5 : C3 DA 34            	jmp	L34DA
    7855/    34D8 : 3E 7E               L34D8:	mvi	a,7Eh
    7856/    34DA :                     L34DA:
    7857/    34DA : CD 49 00            	call AddMainAction
    7858/    34DD : C9                  	ret
    7859/    34DE :                     ;	
    7860/    34DE :                     Action_0x84_0:
    7861/    34DE : CD 6E 20            	call Get_GPIB_Status
    7862/    34E1 : F3                  	di
    7863/    34E2 : 3A 0D 80            	lda	V_GPIB_ActionWasRemoved
    7864/    34E5 : 17                  	ral
    7865/    34E6 : D8                  	rc
    7866/    34E7 : 3A 5C 80            	lda	V_GPIB_Bool8
    7867/    34EA : 17                  	ral
    7868/    34EB : DA F3 34            	jc	L34F3
    7869/    34EE : 3E 84               	mvi	a,84h
    7870/    34F0 : C3 F5 34            	jmp	L34F5
    7871/    34F3 : 3E 80               L34F3:	mvi	a,80h
    7872/    34F5 : CD 49 00            L34F5:	call AddMainAction
    7873/    34F8 : C9                  	ret
    7874/    34F9 :                     ;
    7875/    34F9 :                     ;
    7876/    34F9 :                     Action_0x7D_0:
    7877/    34F9 : CD 6E 20            	call Get_GPIB_Status
    7878/    34FC : F3                  	di
    7879/    34FD : 3A 6E 80            	lda	V_GPIB_Bool4
    7880/    3500 : 47                  	mov	b,a
    7881/    3501 : 3A 5B 80            	lda	V_GPIB_Bool9
    7882/    3504 : A0                  	ana	b
    7883/    3505 : F0                  	rp
    7884/    3506 : 3A 5E 80            	lda	V_GPIB_NRFD
    7885/    3509 : 47                  	mov	b,a
    7886/    350A : 3A 63 80            	lda	V_GPIB_NDAC
    7887/    350D : A0                  	ana	b
    7888/    350E : F2 33 35            	jp	L3533
    7889/    3511 : 21 A9 80            	lxi	h,V_GPIBOut
    7890/    3514 : 7E                  	mov	a,m
    7891/    3515 : 32 04 F0            	sta	DEV_WIFDO
    7892/    3518 : E6 40               	ani	40h
    7893/    351A : CA 28 35            	jz	L3528
    7894/    351D : AF                  	xra	a
    7895/    351E : 32 07 80            	sta	V_GPIB_XmitWFRQSFActive
    7896/    3521 : 32 06 80            	sta	VAR_8006
    7897/    3524 : 7E                  	mov	a,m
    7898/    3525 : E6 BF               	ani	0BFh
    7899/    3527 : 77                  	mov	m,a
    7900/    3528 : 3E FF               L3528:	mvi	a,0FFh
    7901/    352A : 32 01 F0            	sta	DEV_SNTACK
    7902/    352D : 3E 02               	mvi	a,02h
    7903/    352F : CD 95 20            	call L2095
    7904/    3532 : C9                  	ret
    7905/    3533 : 3E 7D               L3533:	mvi	a,7Dh
    7906/    3535 : CD 49 00            	call AddMainAction
    7907/    3538 : C9                  	ret
    7908/    3539 :                     ;
    7909/    3539 :                     ; VAR_8168 is local
    7910/    3539 :                     ;
    7911/    3539 :                     Action_0x80_0:
    7912/    3539 : F3                  	di
    7913/    353A : 3A 0D 80            	lda	V_GPIB_ActionWasRemoved
    7914/    353D : 17                  	ral
    7915/    353E : D8                  	rc
    7916/    353F : 3A 6A 80            	lda	V_GPIBStage
    7917/    3542 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    7918/    3545 : FE 01               	cpi	01h
    7919/    3547 : C2 73 35            	jnz	L3573
    7920/    354A : 7E                  	mov	a,m
    7921/    354B : 23                  	inx	h
    7922/    354C : B6                  	ora	m
    7923/    354D : C2 5E 35            	jnz	L355E
    7924/    3550 : 32 68 81            	sta	VAR_8168
    7925/    3553 : 32 67 80            	sta	V_GPIB_EndOfMessage
    7926/    3556 : 2B                  	dcx	h
    7927/    3557 : 34                  	inr	m
    7928/    3558 : 21 A6 3E            	lxi	h,GPIB_txt_3
    7929/    355B : 22 04 80            	shld V_GPIB_txt
    7930/    355E :                     L355E:
    7931/    355E : CD 8F 3C            	call Update_V_WIFDO
    7932/    3561 : FE 3B               	cpi	3Bh
    7933/    3563 : C2 89 3C            	jnz	L3C89
    7934/    3566 : 21 6A 80            	lxi	h,V_GPIBStage
    7935/    3569 : 36 06               	mvi	m,06h
    7936/    356B : 23                  	inx	h
    7937/    356C : AF                  	xra	a
    7938/    356D : 77                  	mov	m,a
    7939/    356E : 23                  	inx	h
    7940/    356F : 77                  	mov	m,a
    7941/    3570 : C3 89 3C            	jmp	L3C89
    7942/    3573 : FE 06               L3573:	cpi	06h
    7943/    3575 : C2 FA 35            	jnz	L35FA
    7944/    3578 : 7E                  	mov	a,m
    7945/    3579 : 23                  	inx	h
    7946/    357A : B6                  	ora	m
    7947/    357B : C2 DA 35            	jnz	L35DA
    7948/    357E : 21 68 81            L357E:	lxi	h,VAR_8168
    7949/    3581 : 34                  	inr	m
    7950/    3582 : 3E 04               	mvi	a,04h
    7951/    3584 : BE                  	cmp	m
    7952/    3585 : DA 94 35            	jc	L3594
    7953/    3588 : 5E                  	mov	e,m
    7954/    3589 : 16 00               	mvi	d,00h
    7955/    358B : 21 9E 80            	lxi	h,V_ValidWFs-1
    7956/    358E : 19                  	dad	d
    7957/    358F : 7E                  	mov	a,m
    7958/    3590 : 17                  	ral
    7959/    3591 : D2 7E 35            	jnc	L357E
    7960/    3594 : 3A 68 81            L3594:	lda	VAR_8168
    7961/    3597 : FE 05               	cpi	05h
    7962/    3599 : DA A9 35            	jc	L35A9
    7963/    359C : 3E 0A               	mvi	a,0Ah
    7964/    359E : 32 69 80            	sta	V_WIFDO
    7965/    35A1 : 3E FF               	mvi	a,0FFh
    7966/    35A3 : 32 67 80            	sta	V_GPIB_EndOfMessage
    7967/    35A6 : C3 89 3C            	jmp	L3C89
    7968/    35A9 : 3E 3B               L35A9:	mvi	a,3Bh
    7969/    35AB : 32 69 80            	sta	V_WIFDO
    7970/    35AE : 21 7F 80            	lxi	h,V_WFTable
    7971/    35B1 : 3A 68 81            	lda	VAR_8168			;some Display Area index base 1
    7972/    35B4 : 3D                  	dcr	a					;base 0
    7973/    35B5 : 87                  	add	a					;x8
    7974/    35B6 : 87                  	add	a
    7975/    35B7 : 87                  	add	a
    7976/    35B8 : 5F                  	mov	e,a
    7977/    35B9 : 16 00               	mvi	d,00h
    7978/    35BB : 19                  	dad	d
    7979/    35BC : 22 76 81            	shld VAR_8176
    7980/    35BF : 21 BE 3E            	lxi	h,GPIB_txt_4
    7981/    35C2 : 22 04 80            	shld V_GPIB_txt
    7982/    35C5 : 3A 68 81            	lda	VAR_8168
    7983/    35C8 : FE 01               	cpi	01h
    7984/    35CA : C2 D0 35            	jnz	L35D0
    7985/    35CD : CD 8F 3C            	call Update_V_WIFDO
    7986/    35D0 : 2A 6B 80            L35D0:	lhld V_GPIB_cnt0
    7987/    35D3 : 23                  	inx	h
    7988/    35D4 : 22 6B 80            	shld V_GPIB_cnt0
    7989/    35D7 : C3 89 3C            	jmp	L3C89
    7990/    35DA : 2A 04 80            L35DA:	lhld V_GPIB_txt
    7991/    35DD : 7E                  	mov	a,m
    7992/    35DE : 32 69 80            	sta	V_WIFDO
    7993/    35E1 : FE 20               	cpi	20h
    7994/    35E3 : C2 F3 35            	jnz	L35F3
    7995/    35E6 : 21 6A 80            	lxi	h,V_GPIBStage
    7996/    35E9 : 36 07               	mvi	m,07h
    7997/    35EB : 23                  	inx	h
    7998/    35EC : AF                  	xra	a
    7999/    35ED : 77                  	mov	m,a
    8000/    35EE : 23                  	inx	h
    8001/    35EF : 77                  	mov	m,a
    8002/    35F0 : C3 89 3C            	jmp	L3C89
    8003/    35F3 : 23                  L35F3:	inx	h
    8004/    35F4 : 22 04 80            	shld V_GPIB_txt
    8005/    35F7 : C3 89 3C            	jmp	L3C89
    8006/    35FA : FE 07               L35FA:	cpi	07h
    8007/    35FC : C2 94 36            	jnz	L3694
    8008/    35FF : 7E                  	mov	a,m
    8009/    3600 : 23                  	inx	h
    8010/    3601 : B6                  	ora	m
    8011/    3602 : C2 59 36            	jnz	L3659
    8012/    3605 : 36 00               	mvi	m,00h
    8013/    3607 : 2B                  	dcx	h
    8014/    3608 : 36 01               	mvi	m,01h
    8015/    360A : 21 C5 3E            	lxi	h,GPIB_txt_5
    8016/    360D : 22 04 80            	shld V_GPIB_txt
    8017/    3610 : 2A 76 81            	lhld VAR_8176
    8018/    3613 : 23                  	inx	h
    8019/    3614 : 23                  	inx	h
    8020/    3615 : 23                  	inx	h
    8021/    3616 : 23                  	inx	h
    8022/    3617 : 23                  	inx	h
    8023/    3618 : 7E                  	mov	a,m
    8024/    3619 : E6 30               	ani	30h
    8025/    361B : 21 CB 3E            	lxi	h,GPIB_txt_6
    8026/    361E : FE 10               	cpi	10h
    8027/    3620 : C2 26 36            	jnz	L3626
    8028/    3623 : 21 CF 3E            	lxi	h,GPIB_txt_7
    8029/    3626 : FE 30               L3626:	cpi	30h
    8030/    3628 : C2 2E 36            	jnz	L362E
    8031/    362B : 21 D2 3E            	lxi	h,GPIB_txt_8
    8032/    362E : =362CH              L362C:	equ	362CH
    8033/    362E : FE 20               L362E:	cpi	20h
    8034/    3630 : C2 36 36            	jnz	L3636
    8035/    3633 : 21 D5 3E            	lxi	h,GPIB_txt_9
    8036/    3636 :                     L3636:
    8037/    3636 : 22 7A 81            	shld V_GPIB_Ptr2
    8038/    3639 : 2A 76 81            	lhld VAR_8176
    8039/    363C : 23                  	inx	h
    8040/    363D : 23                  	inx	h
    8041/    363E : 23                  	inx	h
    8042/    363F : 23                  	inx	h
    8043/    3640 : 7E                  	mov	a,m
    8044/    3641 : E6 03               	ani	03h
    8045/    3643 : 21 D9 3E            	lxi	h,GPIB_txt_10
    8046/    3646 : FE 02               	cpi	02h
    8047/    3648 : C2 4E 36            	jnz	L364E
    8048/    364B : 21 DD 3E            	lxi	h,GPIB_txt_11
    8049/    364E : FE 03               L364E:	cpi	03h
    8050/    3650 : C2 56 36            	jnz	L3656
    8051/    3653 : 21 E1 3E            	lxi	h,GPIB_txt_12
    8052/    3656 : 22 78 81            L3656:	shld V_GPIB_Ptr3
    8053/    3659 : CD 8F 3C            L3659:	call Update_V_WIFDO
    8054/    365C : FE 22               	cpi	22h
    8055/    365E : C2 7F 36            	jnz	L367F
    8056/    3661 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8057/    3664 : 34                  	inr	m
    8058/    3665 : 7E                  	mov	a,m
    8059/    3666 : FE 04               	cpi	04h
    8060/    3668 : DA 76 36            	jc	L3676x
    8061/    366B : 2B                  	dcx	h
    8062/    366C : 36 08               	mvi	m,08h
    8063/    366E : 23                  	inx	h
    8064/    366F : AF                  	xra	a
    8065/    3670 : 77                  	mov	m,a
    8066/    3671 : 23                  	inx	h
    8067/    3672 : 77                  	mov	m,a
    8068/    3673 : C3 89 3C            	jmp	L3C89
    8069/    3676 :                     L3676x:
    8070/    3676 : 2A 78 81            	lhld V_GPIB_Ptr3
    8071/    3679 : 22 04 80            	shld V_GPIB_txt
    8072/    367C : C3 89 3C            	jmp	L3C89
    8073/    367F : FE 20               L367F:	cpi	20h
    8074/    3681 : C2 89 3C            	jnz	L3C89
    8075/    3684 : 2A 6B 80            	lhld V_GPIB_cnt0
    8076/    3687 : 23                  	inx	h
    8077/    3688 : 22 6B 80            	shld V_GPIB_cnt0
    8078/    368B : 2A 7A 81            	lhld V_GPIB_Ptr2
    8079/    368E : 22 04 80            	shld V_GPIB_txt
    8080/    3691 : C3 89 3C            	jmp	L3C89
    8081/    3694 : FE 08               L3694:	cpi	08h
    8082/    3696 : C2 F8 36            	jnz	L36F8
    8083/    3699 : 7E                  	mov	a,m
    8084/    369A : 23                  	inx	h
    8085/    369B : B6                  	ora	m
    8086/    369C : C2 D5 36            	jnz	L36D5
    8087/    369F : 2B                  	dcx	h
    8088/    36A0 : 34                  	inr	m
    8089/    36A1 : 2A 76 81            	lhld VAR_8176
    8090/    36A4 : 23                  	inx	h
    8091/    36A5 : 23                  	inx	h
    8092/    36A6 : 23                  	inx	h
    8093/    36A7 : 23                  	inx	h
    8094/    36A8 : 23                  	inx	h
    8095/    36A9 : 7E                  	mov	a,m
    8096/    36AA : E6 04               	ani	04h
    8097/    36AC : FE 04               	cpi	04h
    8098/    36AE : C2 BA 36            	jnz	L36BA
    8099/    36B1 : 11 00 02            	lxi	d,0200H
    8100/    36B4 : 21 EB 3E            	lxi	h,GPIB_txt_14
    8101/    36B7 : C3 C0 36            	jmp	L36C0
    8102/    36BA : 11 00 01            L36BA:	lxi	d,0100H
    8103/    36BD : 21 EF 3E            	lxi	h,GPIB_txt_15
    8104/    36C0 : 22 7C 81            L36C0:	shld V_GPIB_Ptr1
    8105/    36C3 : EB                  	xchg
    8106/    36C4 : 22 74 81            	shld VAR_8174
    8107/    36C7 : 3E 2C               	mvi	a,2Ch
    8108/    36C9 : 32 69 80            	sta	V_WIFDO
    8109/    36CC : 21 E5 3E            	lxi	h,GPIB_txt_13
    8110/    36CF : 22 04 80            	shld V_GPIB_txt
    8111/    36D2 : C3 89 3C            	jmp	L3C89
    8112/    36D5 : CD 8F 3C            L36D5:	call Update_V_WIFDO
    8113/    36D8 : FE 3A               	cpi	3Ah
    8114/    36DA : C2 E6 36            	jnz	L36E6
    8115/    36DD : 2A 7C 81            	lhld V_GPIB_Ptr1
    8116/    36E0 : 22 04 80            	shld V_GPIB_txt
    8117/    36E3 : C3 F5 36            	jmp	L36F5
    8118/    36E6 : FE 2C               L36E6:	cpi	2Ch
    8119/    36E8 : C2 F5 36            	jnz	L36F5
    8120/    36EB : 21 6A 80            	lxi	h,V_GPIBStage
    8121/    36EE : 36 09               	mvi	m,09h
    8122/    36F0 : 23                  	inx	h
    8123/    36F1 : AF                  	xra	a
    8124/    36F2 : 77                  	mov	m,a
    8125/    36F3 : 23                  	inx	h
    8126/    36F4 : 77                  	mov	m,a
    8127/    36F5 : C3 89 3C            L36F5:	jmp	L3C89
    8128/    36F8 : FE 09               L36F8:	cpi	09h
    8129/    36FA : C2 20 37            	jnz	L3720x
    8130/    36FD : 7E                  	mov	a,m
    8131/    36FE : 23                  	inx	h
    8132/    36FF : B6                  	ora	m
    8133/    3700 : C2 0B 37            	jnz	L370B
    8134/    3703 : 2B                  	dcx	h
    8135/    3704 : 34                  	inr	m
    8136/    3705 : 21 F3 3E            	lxi	h,GPIB_txt_16
    8137/    3708 : 22 04 80            	shld V_GPIB_txt
    8138/    370B : CD 8F 3C            L370B:	call Update_V_WIFDO
    8139/    370E : FE 2C               	cpi	2Ch
    8140/    3710 : C2 89 3C            	jnz	L3C89
    8141/    3713 : 21 6A 80            	lxi	h,V_GPIBStage
    8142/    3716 : 36 0A               	mvi	m,0Ah
    8143/    3718 : 23                  	inx	h
    8144/    3719 : AF                  	xra	a
    8145/    371A : 77                  	mov	m,a
    8146/    371B : 23                  	inx	h
    8147/    371C : 77                  	mov	m,a
    8148/    371D : C3 89 3C            	jmp	L3C89
    8149/    3720 : FE 0A               L3720x:	cpi	0Ah
    8150/    3722 : C2 DD 37            	jnz	L37DD
    8151/    3725 : 7E                  	mov	a,m
    8152/    3726 : 23                  	inx	h
    8153/    3727 : B6                  	ora	m
    8154/    3728 : C2 96 37            	jnz	L3796
    8155/    372B : 2A 76 81            	lhld VAR_8176
    8156/    372E : 11 06 00            	lxi	d,0006H
    8157/    3731 : 19                  	dad	d
    8158/    3732 : 7E                  	mov	a,m
    8159/    3733 : FE 15               	cpi	15h
    8160/    3735 : DA 3A 37            	jc	L373A
    8161/    3738 : 3E 14               	mvi	a,TB20
    8162/    373A : 47                  L373A:	mov	b,a
    8163/    373B : D6 03               L373B:	sui	03h
    8164/    373D : F2 3B 37            	jp	L373B
    8165/    3740 : C6 04               	adi	04h
    8166/    3742 : 4F                  	mov	c,a
    8167/    3743 : 32 6A 81            	sta	VAR_816A
    8168/    3746 : 2A 76 81            	lhld VAR_8176
    8169/    3749 : 23                  	inx	h
    8170/    374A : 23                  	inx	h
    8171/    374B : 23                  	inx	h
    8172/    374C : 23                  	inx	h
    8173/    374D : 23                  	inx	h
    8174/    374E : 7E                  	mov	a,m
    8175/    374F : E6 04               	ani	04h
    8176/    3751 : FE 00               	cpi	00h
    8177/    3753 : C2 5C 37            	jnz	L375C
    8178/    3756 : 79                  	mov	a,c
    8179/    3757 : C6 03               	adi	03h
    8180/    3759 : 32 6A 81            	sta	VAR_816A
    8181/    375C : 78                  L375C:	mov	a,b
    8182/    375D : 3C                  	inr	a
    8183/    375E : 16 00               	mvi	d,00h
    8184/    3760 : 14                  L3760:	inr	d
    8185/    3761 : D6 03               	sui	03h
    8186/    3763 : F2 60 37            	jp	L3760
    8187/    3766 : 15                  	dcr	d
    8188/    3767 : 7A                  	mov	a,d
    8189/    3768 : D6 03               L3768:	sui	03h
    8190/    376A : F2 68 37            	jp	L3768
    8191/    376D : 3C                  	inr	a
    8192/    376E : F2 73 37            	jp	L3773
    8193/    3771 : 2F                  	cma
    8194/    3772 : 3C                  	inr	a
    8195/    3773 : 32 6B 81            L3773:	sta	VAR_816B
    8196/    3776 : 78                  	mov	a,b
    8197/    3777 : FE 08               	cpi	08h
    8198/    3779 : D2 81 37            	jnc	L3781
    8199/    377C : 3E 01               	mvi	a,01h
    8200/    377E : C3 8D 37            	jmp	L378D
    8201/    3781 : FE 11               L3781:	cpi	11h
    8202/    3783 : D2 8B 37            	jnc	L378B
    8203/    3786 : 3E 02               	mvi	a,02h
    8204/    3788 : C3 8D 37            	jmp	L378D
    8205/    378B : 3E 03               L378B:	mvi	a,03h
    8206/    378D : 32 6D 81            L378D:	sta	VAR_816D
    8207/    3790 : 21 FC 3E            	lxi	h,GPIB_txt_17
    8208/    3793 : 22 04 80            	shld V_GPIB_txt
    8209/    3796 : CD 8F 3C            L3796:	call Update_V_WIFDO
    8210/    3799 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8211/    379C : 34                  	inr	m
    8212/    379D : 7E                  	mov	a,m
    8213/    379E : FE 06               	cpi	06h
    8214/    37A0 : C2 B3 37            	jnz	L37B3
    8215/    37A3 : 21 9C 3E            	lxi	h,Number5
    8216/    37A6 : 3A 6A 81            	lda	VAR_816A
    8217/    37A9 : 5F                  	mov	e,a
    8218/    37AA : 16 00               	mvi	d,00h
    8219/    37AC : 19                  	dad	d
    8220/    37AD : 22 04 80            	shld V_GPIB_txt
    8221/    37B0 : C3 89 3C            	jmp	L3C89
    8222/    37B3 : FE 08               L37B3:	cpi	08h
    8223/    37B5 : DA 89 3C            	jc	L3C89
    8224/    37B8 : 3A 6B 81            	lda	VAR_816B
    8225/    37BB : A7                  	ana	a
    8226/    37BC : CA CB 37            	jz	L37CB
    8227/    37BF : 3D                  	dcr	a
    8228/    37C0 : 32 6B 81            	sta	VAR_816B
    8229/    37C3 : 3E 30               	mvi	a,30h
    8230/    37C5 : 32 69 80            	sta	V_WIFDO
    8231/    37C8 : C3 89 3C            	jmp	L3C89
    8232/    37CB : 3E 2C               L37CB:	mvi	a,2Ch
    8233/    37CD : 32 69 80            	sta	V_WIFDO
    8234/    37D0 : 21 6A 80            	lxi	h,V_GPIBStage
    8235/    37D3 : 36 0B               	mvi	m,0Bh
    8236/    37D5 : 23                  	inx	h
    8237/    37D6 : AF                  	xra	a
    8238/    37D7 : 77                  	mov	m,a
    8239/    37D8 : 23                  	inx	h
    8240/    37D9 : 77                  	mov	m,a
    8241/    37DA : C3 89 3C            	jmp	L3C89
    8242/    37DD : FE 0B               L37DD:	cpi	0Bh
    8243/    37DF : C2 07 38            	jnz	L3807
    8244/    37E2 : 7E                  	mov	a,m
    8245/    37E3 : 23                  	inx	h
    8246/    37E4 : B6                  	ora	m
    8247/    37E5 : C2 F2 37            	jnz	L37F2
    8248/    37E8 : 21 02 3F            	lxi	h,GPIB_txt_18
    8249/    37EB : 22 04 80            	shld V_GPIB_txt
    8250/    37EE : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8251/    37F1 : 34                  	inr	m
    8252/    37F2 : CD 8F 3C            L37F2:	call Update_V_WIFDO
    8253/    37F5 : FE 2C               	cpi	2Ch
    8254/    37F7 : C2 89 3C            	jnz	L3C89
    8255/    37FA : 21 6A 80            	lxi	h,V_GPIBStage
    8256/    37FD : 36 0C               	mvi	m,0Ch
    8257/    37FF : 23                  	inx	h
    8258/    3800 : AF                  	xra	a
    8259/    3801 : 77                  	mov	m,a
    8260/    3802 : 23                  	inx	h
    8261/    3803 : 77                  	mov	m,a
    8262/    3804 : C3 89 3C            	jmp	L3C89
    8263/    3807 : FE 0C               L3807:	cpi	0Ch
    8264/    3809 : C2 6D 38            	jnz	L386D
    8265/    380C : 7E                  	mov	a,m
    8266/    380D : 23                  	inx	h
    8267/    380E : B6                  	ora	m
    8268/    380F : C2 1A 38            	jnz	L381A
    8269/    3812 : 2B                  	dcx	h
    8270/    3813 : 34                  	inr	m
    8271/    3814 : 21 10 3F            	lxi	h,GPIB_txt_22
    8272/    3817 : 22 04 80            	shld V_GPIB_txt
    8273/    381A : CD 8F 3C            L381A:	call Update_V_WIFDO
    8274/    381D : FE 3A               	cpi	3Ah
    8275/    381F : C2 5B 38            	jnz	L385B
    8276/    3822 : 2A 76 81            	lhld VAR_8176
    8277/    3825 : 23                  	inx	h
    8278/    3826 : 23                  	inx	h
    8279/    3827 : 23                  	inx	h
    8280/    3828 : 23                  	inx	h
    8281/    3829 : 23                  	inx	h
    8282/    382A : 7E                  	mov	a,m
    8283/    382B : E6 08               	ani	08h
    8284/    382D : FE 08               	cpi	08h
    8285/    382F : 2A 74 81            	lhld VAR_8174
    8286/    3832 : 7C                  	mov	a,h
    8287/    3833 : C2 47 38            	jnz	L3847
    8288/    3836 : FE 01               	cpi	01h
    8289/    3838 : CA 41 38            	jz	L3841
    8290/    383B : 21 6C 3F            	lxi	h,GPIB_txt_37
    8291/    383E : C3 55 38            	jmp	L3855
    8292/    3841 : 21 68 3F            L3841:	lxi	h,GPIB_txt_36
    8293/    3844 : C3 55 38            	jmp	L3855
    8294/    3847 : FE 01               L3847:	cpi	01h
    8295/    3849 : CA 52 38            	jz	L3852
    8296/    384C : 21 73 3F            	lxi	h,GPIB_txt_39
    8297/    384F : C3 55 38            	jmp	L3855
    8298/    3852 : 21 70 3F            L3852:	lxi	h,GPIB_txt_38
    8299/    3855 : 22 04 80            L3855:	shld V_GPIB_txt
    8300/    3858 : C3 89 3C            	jmp	L3C89
    8301/    385B : FE 2C               L385B:	cpi	2Ch
    8302/    385D : C2 89 3C            	jnz	L3C89
    8303/    3860 : 21 6A 80            	lxi	h,V_GPIBStage
    8304/    3863 : 36 0D               	mvi	m,0Dh
    8305/    3865 : 23                  	inx	h
    8306/    3866 : AF                  	xra	a
    8307/    3867 : 77                  	mov	m,a
    8308/    3868 : 23                  	inx	h
    8309/    3869 : 77                  	mov	m,a
    8310/    386A : C3 89 3C            	jmp	L3C89
    8311/    386D : FE 0D               L386D:	cpi	0Dh
    8312/    386F : C2 C4 38            	jnz	L38C4
    8313/    3872 : 7E                  	mov	a,m
    8314/    3873 : 23                  	inx	h
    8315/    3874 : B6                  	ora	m
    8316/    3875 : C2 97 38            	jnz	L3897
    8317/    3878 : 3A 6D 81            	lda	VAR_816D
    8318/    387B : 21 0E 3F            	lxi	h,GPIB_txt_21
    8319/    387E : FE 01               	cpi	01h
    8320/    3880 : C2 86 38            	jnz	L3886
    8321/    3883 : 21 0A 3F            	lxi	h,GPIB_txt_19
    8322/    3886 : FE 02               L3886:	cpi	02h
    8323/    3888 : C2 8E 38            	jnz	L388E
    8324/    388B : 21 0C 3F            	lxi	h,GPIB_txt_20
    8325/    388E : 22 7C 81            L388E:	shld V_GPIB_Ptr1
    8326/    3891 : 21 17 3F            	lxi	h,GPIB_txt_23
    8327/    3894 : 22 04 80            	shld V_GPIB_txt
    8328/    3897 : CD 8F 3C            L3897:	call Update_V_WIFDO
    8329/    389A : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8330/    389D : 34                  	inr	m
    8331/    389E : FE 3A               	cpi	3Ah
    8332/    38A0 : C2 AC 38            	jnz	L38AC
    8333/    38A3 : 2A 7C 81            	lhld V_GPIB_Ptr1
    8334/    38A6 : 22 04 80            	shld V_GPIB_txt
    8335/    38A9 : C3 89 3C            	jmp	L3C89
    8336/    38AC : 3E 08               L38AC:	mvi	a,08h
    8337/    38AE : BE                  	cmp	m
    8338/    38AF : D2 89 3C            	jnc	L3C89
    8339/    38B2 : 3E 2C               	mvi	a,2Ch
    8340/    38B4 : 32 69 80            	sta	V_WIFDO
    8341/    38B7 : 21 6A 80            	lxi	h,V_GPIBStage
    8342/    38BA : 36 0E               	mvi	m,0Eh
    8343/    38BC : 23                  	inx	h
    8344/    38BD : AF                  	xra	a
    8345/    38BE : 77                  	mov	m,a
    8346/    38BF : 23                  	inx	h
    8347/    38C0 : 77                  	mov	m,a
    8348/    38C1 : C3 89 3C            	jmp	L3C89
    8349/    38C4 : FE 0E               L38C4:	cpi	0Eh
    8350/    38C6 : C2 2D 3A            	jnz	L3A2D
    8351/    38C9 : 7E                  	mov	a,m
    8352/    38CA : 23                  	inx	h
    8353/    38CB : B6                  	ora	m
    8354/    38CC : C2 7D 39            	jnz	L397D
    8355/    38CF : AF                  	xra	a
    8356/    38D0 : 32 7E 81            	sta	VAR_817E			;set to False
    8357/    38D3 : 32 7F 81            	sta	VAR_817F
    8358/    38D6 : 32 80 81            	sta	VAR_8180
    8359/    38D9 : 21 1D 3F            	lxi	h,GPIB_txt_24
    8360/    38DC : 22 04 80            	shld V_GPIB_txt
    8361/    38DF : 2A 76 81            	lhld VAR_8176
    8362/    38E2 : 11 07 00            	lxi	d,0007H
    8363/    38E5 : 19                  	dad	d
    8364/    38E6 : 7E                  	mov	a,m
    8365/    38E7 : 47                  	mov	b,a
    8366/    38E8 : E6 80               	ani	80h
    8367/    38EA : CA F2 38            	jz	L38F2
    8368/    38ED : 3E FF               	mvi	a,0FFh				;set to TRUE
    8369/    38EF : 32 7F 81            	sta	VAR_817F
    8370/    38F2 : 78                  L38F2:	mov	a,b
    8371/    38F3 : E6 40               	ani	40h
    8372/    38F5 : CA FD 38            	jz	L38FD
    8373/    38F8 : 3E FF               	mvi	a,0FFh
    8374/    38FA : 32 80 81            	sta	VAR_8180			;set to TRUE
    8375/    38FD : 78                  L38FD:	mov	a,b
    8376/    38FE : E6 3F               	ani	3Fh
    8377/    3900 : FE 04               	cpi	04h
    8378/    3902 : D2 1B 39            	jnc	L391B
    8379/    3905 : 47                  	mov	b,a
    8380/    3906 : 2B                  	dcx	h
    8381/    3907 : 2B                  	dcx	h
    8382/    3908 : 7E                  	mov	a,m
    8383/    3909 : E6 03               	ani	03h
    8384/    390B : FE 03               	cpi	03h
    8385/    390D : C2 19 39            	jnz	L3919
    8386/    3910 : 3E FF               	mvi	a,0FFh
    8387/    3912 : 32 7E 81            	sta	VAR_817E			;set to TRUE
    8388/    3915 : 78                  	mov	a,b
    8389/    3916 : C3 1B 39            	jmp	L391B
    8390/    3919 : 3E 04               L3919:	mvi	a,04h
    8391/    391B : 47                  L391B:	mov	b,a
    8392/    391C : 3A 7F 81            	lda	VAR_817F			;boolean test
    8393/    391F : 17                  	ral
    8394/    3920 : D2 28 39            	jnc	L3928
    8395/    3923 : 3E 01               	mvi	a,01h
    8396/    3925 : C3 3F 39            	jmp	L393F
    8397/    3928 : 3A 80 81            L3928:	lda	VAR_8180		;boolean test
    8398/    392B : 17                  	ral
    8399/    392C : D2 33 39            	jnc	L3933
    8400/    392F : 78                  	mov	a,b
    8401/    3930 : C6 03               	adi	03h
    8402/    3932 : 47                  	mov	b,a
    8403/    3933 : 78                  L3933:	mov	a,b
    8404/    3934 : 32 65 81            	sta	VAR_8165
    8405/    3937 : 3C                  	inr	a
    8406/    3938 : D6 03               L3938:	sui	03h
    8407/    393A : F2 38 39            	jp	L3938
    8408/    393D : C6 04               	adi	04h
    8409/    393F : 32 6A 81            L393F:	sta	VAR_816A
    8410/    3942 : 78                  	mov	a,b
    8411/    3943 : FE 07               	cpi	07h
    8412/    3945 : D2 4D 39            	jnc	L394D
    8413/    3948 : 3E 01               	mvi	a,01h
    8414/    394A : C3 63 39            	jmp	L3963
    8415/    394D : FE 10               L394D:	cpi	10h
    8416/    394F : D2 57 39            	jnc	L3957
    8417/    3952 : 3E 02               	mvi	a,02h
    8418/    3954 : C3 63 39            	jmp	L3963
    8419/    3957 : C2 5F 39            L3957:	jnz	L395F
    8420/    395A : 3E 03               	mvi	a,03h
    8421/    395C : C3 63 39            	jmp	L3963
    8422/    395F : 06 0B               L395F:	mvi	b,0Bh
    8423/    3961 : 3E 04               	mvi	a,04h
    8424/    3963 : 32 66 81            L3963:	sta	VAR_8166
    8425/    3966 : 3A 65 81            	lda	VAR_8165
    8426/    3969 : 3D                  	dcr	a
    8427/    396A : 0E 00               	mvi	c,00h
    8428/    396C : 0C                  L396C:	inr	c
    8429/    396D : D6 03               	sui	03h
    8430/    396F : F2 6C 39            	jp	L396C
    8431/    3972 : 79                  	mov	a,c
    8432/    3973 : D6 03               L3973x:	sui	03h
    8433/    3975 : F2 73 39            	jp	L3973x
    8434/    3978 : C6 03               	adi	03h
    8435/    397A : 32 6B 81            	sta	VAR_816B
    8436/    397D : CD 8F 3C            L397D:	call Update_V_WIFDO
    8437/    3980 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8438/    3983 : 34                  	inr	m
    8439/    3984 : FE 3A               	cpi	3Ah
    8440/    3986 : C2 ED 39            	jnz	L39ED
    8441/    3989 : 3A 7E 81            	lda	VAR_817E			;boolean test
    8442/    398C : 17                  	ral
    8443/    398D : D2 E0 39            	jnc	L39E0
    8444/    3990 : 3A 7F 81            	lda	VAR_817F			;boolean test
    8445/    3993 : 17                  	ral
    8446/    3994 : D2 9D 39            	jnc	L399D
    8447/    3997 : 21 76 3F            	lxi	h,GPIB_txt_40
    8448/    399A : C3 DA 39            	jmp	L39DA
    8449/    399D : 3A 65 81            L399D:	lda	VAR_8165
    8450/    39A0 : FE 01               	cpi	01h
    8451/    39A2 : C2 AB 39            	jnz	L39AB
    8452/    39A5 : 21 79 3F            	lxi	h,GPIB_txt_41
    8453/    39A8 : C3 DA 39            	jmp	L39DA
    8454/    39AB : FE 02               L39AB:	cpi	02h
    8455/    39AD : C2 B6 39            	jnz	L39B6
    8456/    39B0 : 21 7C 3F            	lxi	h,GPIB_txt_42
    8457/    39B3 : C3 DA 39            	jmp	L39DA
    8458/    39B6 : FE 03               L39B6:	cpi	03h
    8459/    39B8 : C2 C1 39            	jnz	L39C1
    8460/    39BB : 21 7F 3F            	lxi	h,GPIB_txt_43
    8461/    39BE : C3 DA 39            	jmp	L39DA
    8462/    39C1 : FE 04               L39C1:	cpi	04h
    8463/    39C3 : C2 CC 39            	jnz	L39CC
    8464/    39C6 : 21 83 3F            	lxi	h,GPIB_txt_44
    8465/    39C9 : C3 DA 39            	jmp	L39DA
    8466/    39CC : FE 05               L39CC:	cpi	05h
    8467/    39CE : C2 D7 39            	jnz	L39D7
    8468/    39D1 : 21 87 3F            	lxi	h,GPIB_txt_45
    8469/    39D4 : C3 DA 39            	jmp	L39DA
    8470/    39D7 :                     L39D7:
    8471/    39D7 : 21 8B 3F            	lxi	h,GPIB_txt_46
    8472/    39DA :                     L39DA:
    8473/    39DA : 22 04 80            	shld V_GPIB_txt
    8474/    39DD : C3 ED 39            	jmp	L39ED
    8475/    39E0 : 21 A2 3E            L39E0:	lxi	h,GPIB_txt_2
    8476/    39E3 : 3A 6A 81            	lda	VAR_816A
    8477/    39E6 : 5F                  	mov	e,a
    8478/    39E7 : 16 00               	mvi	d,00h
    8479/    39E9 : 19                  	dad	d
    8480/    39EA : 22 04 80            	shld V_GPIB_txt
    8481/    39ED : 21 6B 80            L39ED:	lxi	h,V_GPIB_cnt0
    8482/    39F0 : 7E                  	mov	a,m
    8483/    39F1 : FE 08               	cpi	08h
    8484/    39F3 : DA 89 3C            	jc	L3C89
    8485/    39F6 : 3A 7E 81            	lda	VAR_817E			;boolean test
    8486/    39F9 : 17                  	ral
    8487/    39FA : D2 08 3A            	jnc	L3A08
    8488/    39FD : 3A 69 80            	lda	V_WIFDO
    8489/    3A00 : FE 2C               	cpi	2Ch
    8490/    3A02 : CA 20 3A            	jz	L3A20
    8491/    3A05 : C3 89 3C            	jmp	L3C89
    8492/    3A08 : 3A 6B 81            L3A08:	lda	VAR_816B
    8493/    3A0B : A7                  	ana	a
    8494/    3A0C : CA 1B 3A            	jz	L3A1B
    8495/    3A0F : 3E 30               	mvi	a,30h
    8496/    3A11 : 32 69 80            	sta	V_WIFDO
    8497/    3A14 : 21 6B 81            	lxi	h,VAR_816B
    8498/    3A17 : 35                  	dcr	m
    8499/    3A18 : C3 89 3C            	jmp	L3C89
    8500/    3A1B : 3E 2C               L3A1B:	mvi	a,2Ch
    8501/    3A1D : 32 69 80            	sta	V_WIFDO
    8502/    3A20 : 21 6A 80            L3A20:	lxi	h,V_GPIBStage
    8503/    3A23 : 36 0F               	mvi	m,0Fh
    8504/    3A25 : 23                  	inx	h
    8505/    3A26 : AF                  	xra	a
    8506/    3A27 : 77                  	mov	m,a
    8507/    3A28 : 23                  	inx	h
    8508/    3A29 : 77                  	mov	m,a
    8509/    3A2A : C3 89 3C            	jmp	L3C89
    8510/    3A2D : FE 0F               L3A2D:	cpi	0Fh
    8511/    3A2F : C2 55 3A            	jnz	L3A55
    8512/    3A32 : 7E                  	mov	a,m
    8513/    3A33 : 23                  	inx	h
    8514/    3A34 : B6                  	ora	m
    8515/    3A35 : C2 40 3A            	jnz	L3A40
    8516/    3A38 : 2B                  	dcx	h
    8517/    3A39 : 34                  	inr	m
    8518/    3A3A : 21 23 3F            	lxi	h,GPIB_txt_25
    8519/    3A3D : 22 04 80            	shld V_GPIB_txt
    8520/    3A40 : CD 8F 3C            L3A40:	call Update_V_WIFDO
    8521/    3A43 : FE 2C               	cpi	2Ch
    8522/    3A45 : C2 89 3C            	jnz	L3C89
    8523/    3A48 : 21 6A 80            	lxi	h,V_GPIBStage
    8524/    3A4B : 36 10               	mvi	m,10h
    8525/    3A4D : 23                  	inx	h
    8526/    3A4E : AF                  	xra	a
    8527/    3A4F : 77                  	mov	m,a
    8528/    3A50 : 23                  	inx	h
    8529/    3A51 : 77                  	mov	m,a
    8530/    3A52 : C3 89 3C            	jmp	L3C89
    8531/    3A55 : FE 10               L3A55:	cpi	10h
    8532/    3A57 : C2 DD 3A            	jnz	L3ADD
    8533/    3A5A : 7E                  	mov	a,m
    8534/    3A5B : 23                  	inx	h
    8535/    3A5C : B6                  	ora	m
    8536/    3A5D : C2 B0 3A            	jnz	L3AB0
    8537/    3A60 : 21 6F 81            	lxi	h,VAR_816F
    8538/    3A63 : AF                  	xra	a
    8539/    3A64 : 77                  	mov	m,a
    8540/    3A65 : 23                  	inx	h
    8541/    3A66 : 77                  	mov	m,a
    8542/    3A67 : 2A 76 81            	lhld VAR_8176
    8543/    3A6A : 11 01 00            	lxi	d,0001H
    8544/    3A6D : 19                  	dad	d
    8545/    3A6E : 7E                  	mov	a,m
    8546/    3A6F : 0E 08               	mvi	c,08h
    8547/    3A71 : 67                  	mov	h,a
    8548/    3A72 : 2E 00               	mvi	l,00h
    8549/    3A74 : 29                  L3A74:	dad	h
    8550/    3A75 : 11 6F 81            	lxi	d,VAR_816F
    8551/    3A78 : 06 02               	mvi	b,02h
    8552/    3A7A : 1A                  L3A7A:	ldax d
    8553/    3A7B : 8F                  	adc	a
    8554/    3A7C : 27                  	daa
    8555/    3A7D : 12                  	stax	d
    8556/    3A7E : 13                  	inx	d
    8557/    3A7F : 05                  	dcr	b
    8558/    3A80 : C2 7A 3A            	jnz	L3A7A
    8559/    3A83 : 0D                  	dcr	c
    8560/    3A84 : C2 74 3A            	jnz	L3A74
    8561/    3A87 : 21 71 81            	lxi	h,VAR_8171
    8562/    3A8A : 3A 70 81            	lda	VAR_8170
    8563/    3A8D : C6 30               	adi	30h
    8564/    3A8F : 77                  	mov	m,a
    8565/    3A90 : 23                  	inx	h
    8566/    3A91 : 3A 6F 81            	lda	VAR_816F
    8567/    3A94 : E6 F0               	ani	0F0h
    8568/    3A96 : 0F                  	rrc
    8569/    3A97 : 0F                  	rrc
    8570/    3A98 : 0F                  	rrc
    8571/    3A99 : 0F                  	rrc
    8572/    3A9A : C6 30               	adi	30h
    8573/    3A9C : 77                  	mov	m,a
    8574/    3A9D : 23                  	inx	h
    8575/    3A9E : 3A 6F 81            	lda	VAR_816F
    8576/    3AA1 : E6 0F               	ani	0Fh
    8577/    3AA3 : C6 30               	adi	30h
    8578/    3AA5 : 77                  	mov	m,a
    8579/    3AA6 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8580/    3AA9 : 34                  	inr	m
    8581/    3AAA : 21 2B 3F            	lxi	h,GPIB_txt_26
    8582/    3AAD : 22 04 80            	shld V_GPIB_txt
    8583/    3AB0 : CD 8F 3C            L3AB0:	call Update_V_WIFDO
    8584/    3AB3 : 21 6B 80            	lxi	h,V_GPIB_cnt0
    8585/    3AB6 : 34                  	inr	m
    8586/    3AB7 : FE 3A               	cpi	3Ah
    8587/    3AB9 : C2 C5 3A            	jnz	L3AC5
    8588/    3ABC : 21 71 81            	lxi	h,VAR_8171
    8589/    3ABF : 22 04 80            	shld V_GPIB_txt
    8590/    3AC2 : C3 89 3C            	jmp	L3C89
    8591/    3AC5 : 7E                  L3AC5:	mov	a,m
    8592/    3AC6 : FE 0A               	cpi	0Ah
    8593/    3AC8 : DA 89 3C            	jc	L3C89
    8594/    3ACB : 3E 2C               	mvi	a,2Ch
    8595/    3ACD : 32 69 80            	sta	V_WIFDO
    8596/    3AD0 : 21 6A 80            	lxi	h,V_GPIBStage
    8597/    3AD3 : 36 11               	mvi	m,11h
    8598/    3AD5 : 23                  	inx	h
    8599/    3AD6 : AF                  	xra	a
    8600/    3AD7 : 77                  	mov	m,a
    8601/    3AD8 : 23                  	inx	h
    8602/    3AD9 : 77                  	mov	m,a
    8603/    3ADA : C3 89 3C            	jmp	L3C89
    8604/    3ADD : FE 11               L3ADD:	cpi	11h
    8605/    3ADF : C2 31 3B            	jnz	L3B31
    8606/    3AE2 : 7E                  	mov	a,m
    8607/    3AE3 : 23                  	inx	h
    8608/    3AE4 : B6                  	ora	m
    8609/    3AE5 : C2 11 3B            	jnz	L3B11
    8610/    3AE8 : 2B                  	dcx	h
    8611/    3AE9 : 34                  	inr	m
    8612/    3AEA : 21 30 3F            	lxi	h,GPIB_txt_27
    8613/    3AED : 22 04 80            	shld V_GPIB_txt
    8614/    3AF0 : 3A 66 81            	lda	VAR_8166
    8615/    3AF3 : 21 64 3F            	lxi	h,GPIB_txt_35
    8616/    3AF6 : FE 01               	cpi	01h
    8617/    3AF8 : C2 FE 3A            	jnz	L3AFE
    8618/    3AFB : 21 5C 3F            	lxi	h,GPIB_txt_32
    8619/    3AFE : FE 02               L3AFE:	cpi	02h
    8620/    3B00 : C2 06 3B            	jnz	L3B06
    8621/    3B03 : 21 5F 3F            	lxi	h,GPIB_txt_33
    8622/    3B06 : FE 03               L3B06:	cpi	03h
    8623/    3B08 : C2 0E 3B            	jnz	L3B0E
    8624/    3B0B : 21 62 3F            	lxi	h,GPIB_txt_34
    8625/    3B0E : 22 7C 81            L3B0E:	shld V_GPIB_Ptr1
    8626/    3B11 : CD 8F 3C            L3B11:	call Update_V_WIFDO
    8627/    3B14 : FE 3A               	cpi	3Ah
    8628/    3B16 : C2 1F 3B            	jnz	L3B1F
    8629/    3B19 : 2A 7C 81            	lhld V_GPIB_Ptr1
    8630/    3B1C : 22 04 80            	shld V_GPIB_txt
    8631/    3B1F : FE 2C               L3B1F:	cpi	2Ch
    8632/    3B21 : C2 89 3C            	jnz	L3C89
    8633/    3B24 : 21 6A 80            	lxi	h,V_GPIBStage
    8634/    3B27 : 36 12               	mvi	m,12h
    8635/    3B29 : 23                  	inx	h
    8636/    3B2A : AF                  	xra	a
    8637/    3B2B : 77                  	mov	m,a
    8638/    3B2C : 23                  	inx	h
    8639/    3B2D : 77                  	mov	m,a
    8640/    3B2E : C3 89 3C            	jmp	L3C89
    8641/    3B31 : FE 12               L3B31:	cpi	12h
    8642/    3B33 : C2 59 3B            	jnz	L3B59
    8643/    3B36 : 7E                  	mov	a,m
    8644/    3B37 : 23                  	inx	h
    8645/    3B38 : B6                  	ora	m
    8646/    3B39 : C2 44 3B            	jnz	L3B44
    8647/    3B3C : 2B                  	dcx	h
    8648/    3B3D : 34                  	inr	m
    8649/    3B3E : 21 36 3F            	lxi	h,GPIB_txt_28
    8650/    3B41 : 22 04 80            	shld V_GPIB_txt
    8651/    3B44 : CD 8F 3C            L3B44:	call Update_V_WIFDO
    8652/    3B47 : FE 2C               	cpi	2Ch
    8653/    3B49 : C2 89 3C            	jnz	L3C89
    8654/    3B4C : 21 6A 80            	lxi	h,V_GPIBStage
    8655/    3B4F : 36 13               	mvi	m,13h
    8656/    3B51 : 23                  	inx	h
    8657/    3B52 : AF                  	xra	a
    8658/    3B53 : 77                  	mov	m,a
    8659/    3B54 : 23                  	inx	h
    8660/    3B55 : 77                  	mov	m,a
    8661/    3B56 : C3 89 3C            	jmp	L3C89
    8662/    3B59 : FE 13               L3B59:	cpi	13h
    8663/    3B5B : C2 81 3B            	jnz	L3B81
    8664/    3B5E : 7E                  	mov	a,m
    8665/    3B5F : 23                  	inx	h
    8666/    3B60 : B6                  	ora	m
    8667/    3B61 : C2 6C 3B            	jnz	L3B6C
    8668/    3B64 : 2B                  	dcx	h
    8669/    3B65 : 34                  	inr	m
    8670/    3B66 : 21 40 3F            	lxi	h,GPIB_txt_29
    8671/    3B69 : 22 04 80            	shld V_GPIB_txt
    8672/    3B6C : CD 8F 3C            L3B6C:	call Update_V_WIFDO
    8673/    3B6F : FE 2C               	cpi	2Ch
    8674/    3B71 : C2 89 3C            	jnz	L3C89
    8675/    3B74 : 21 6A 80            	lxi	h,V_GPIBStage
    8676/    3B77 : 36 14               	mvi	m,14h
    8677/    3B79 : 23                  	inx	h
    8678/    3B7A : AF                  	xra	a
    8679/    3B7B : 77                  	mov	m,a
    8680/    3B7C : 23                  	inx	h
    8681/    3B7D : 77                  	mov	m,a
    8682/    3B7E : C3 89 3C            	jmp	L3C89
    8683/    3B81 : FE 14               L3B81:	cpi	14h
    8684/    3B83 : C2 A9 3B            	jnz	L3BA9
    8685/    3B86 : 7E                  	mov	a,m
    8686/    3B87 : 23                  	inx	h
    8687/    3B88 : B6                  	ora	m
    8688/    3B89 : C2 94 3B            	jnz	L3B94
    8689/    3B8C : 2B                  	dcx	h
    8690/    3B8D : 34                  	inr	m
    8691/    3B8E : 21 4A 3F            	lxi	h,GPIB_txt_30
    8692/    3B91 : 22 04 80            	shld V_GPIB_txt
    8693/    3B94 : CD 8F 3C            L3B94:	call Update_V_WIFDO
    8694/    3B97 : FE 2C               	cpi	2Ch
    8695/    3B99 : C2 89 3C            	jnz	L3C89
    8696/    3B9C : 21 6A 80            	lxi	h,V_GPIBStage
    8697/    3B9F : 36 15               	mvi	m,15h
    8698/    3BA1 : 23                  	inx	h
    8699/    3BA2 : AF                  	xra	a
    8700/    3BA3 : 77                  	mov	m,a
    8701/    3BA4 : 23                  	inx	h
    8702/    3BA5 : 77                  	mov	m,a
    8703/    3BA6 : C3 89 3C            	jmp	L3C89
    8704/    3BA9 : FE 15               L3BA9:	cpi	15h
    8705/    3BAB : C2 D1 3B            	jnz	L3BD1
    8706/    3BAE : 7E                  	mov	a,m
    8707/    3BAF : 23                  	inx	h
    8708/    3BB0 : B6                  	ora	m
    8709/    3BB1 : C2 BC 3B            	jnz	L3BBC
    8710/    3BB4 : 2B                  	dcx	h
    8711/    3BB5 : 34                  	inr	m
    8712/    3BB6 : 21 53 3F            	lxi	h,GPIB_txt_31
    8713/    3BB9 : 22 04 80            	shld V_GPIB_txt
    8714/    3BBC : CD 8F 3C            L3BBC:	call Update_V_WIFDO
    8715/    3BBF : FE 2C               	cpi	2Ch
    8716/    3BC1 : C2 89 3C            	jnz	L3C89
    8717/    3BC4 : 21 6A 80            	lxi	h,V_GPIBStage
    8718/    3BC7 : 36 05               	mvi	m,05h
    8719/    3BC9 : 23                  	inx	h
    8720/    3BCA : AF                  	xra	a
    8721/    3BCB : 77                  	mov	m,a
    8722/    3BCC : 23                  	inx	h
    8723/    3BCD : 77                  	mov	m,a
    8724/    3BCE : C3 89 3C            	jmp	L3C89
    8725/    3BD1 : FE 05               L3BD1:	cpi	05h
    8726/    3BD3 : C2 EF 3B            	jnz	L3BEF
    8727/    3BD6 : AF                  	xra	a
    8728/    3BD7 : 32 64 81            	sta	V_GPIB8164
    8729/    3BDA : 3E 25               	mvi	a,25h
    8730/    3BDC : 32 69 80            	sta	V_WIFDO
    8731/    3BDF : 21 6A 80            	lxi	h,V_GPIBStage
    8732/    3BE2 : 36 02               	mvi	m,02h
    8733/    3BE4 : 23                  	inx	h
    8734/    3BE5 : AF                  	xra	a
    8735/    3BE6 : 77                  	mov	m,a
    8736/    3BE7 : 23                  	inx	h
    8737/    3BE8 : 77                  	mov	m,a
    8738/    3BE9 : 32 67 80            	sta	V_GPIB_EndOfMessage
    8739/    3BEC : C3 89 3C            	jmp	L3C89
    8740/    3BEF : FE 02               L3BEF:	cpi	02h
    8741/    3BF1 : C2 2A 3C            	jnz	L3C2A
    8742/    3BF4 : 7E                  	mov	a,m
    8743/    3BF5 : 23                  	inx	h
    8744/    3BF6 : B6                  	ora	m
    8745/    3BF7 : C2 10 3C            	jnz	L3C10
    8746/    3BFA : 2A 74 81            	lhld VAR_8174
    8747/    3BFD : 7C                  	mov	a,h
    8748/    3BFE : FE 01               	cpi	01h
    8749/    3C00 : CA 05 3C            	jz	L3C05
    8750/    3C03 : 3E 02               	mvi	a,02h
    8751/    3C05 : 32 69 80            L3C05:	sta	V_WIFDO
    8752/    3C08 : 3E 01               	mvi	a,01h
    8753/    3C0A : 32 6B 80            	sta	V_GPIB_cnt0
    8754/    3C0D : C3 1F 3C            	jmp	L3C1F
    8755/    3C10 : 3E 01               L3C10:	mvi	a,01h
    8756/    3C12 : 32 69 80            	sta	V_WIFDO
    8757/    3C15 : 21 6A 80            	lxi	h,V_GPIBStage
    8758/    3C18 : 36 03               	mvi	m,03h
    8759/    3C1A : 23                  	inx	h
    8760/    3C1B : AF                  	xra	a
    8761/    3C1C : 77                  	mov	m,a
    8762/    3C1D : 23                  	inx	h
    8763/    3C1E : 77                  	mov	m,a
    8764/    3C1F : 21 64 81            L3C1F:	lxi	h,V_GPIB8164
    8765/    3C22 : 3A 69 80            	lda	V_WIFDO
    8766/    3C25 : 86                  	add	m
    8767/    3C26 : 77                  	mov	m,a
    8768/    3C27 : C3 89 3C            	jmp	L3C89
    8769/    3C2A : FE 03               L3C2A:	cpi	03h
    8770/    3C2C : C2 72 3C            	jnz	L3C72
    8771/    3C2F : 7E                  	mov	a,m
    8772/    3C30 : 23                  	inx	h
    8773/    3C31 : B6                  	ora	m
    8774/    3C32 : C2 48 3C            	jnz	L3C48
    8775/    3C35 : 21 19 20            	lxi	h,ScratchRamTable
    8776/    3C38 : 3A 68 81            	lda	VAR_8168
    8777/    3C3B : 3D                  	dcr	a
    8778/    3C3C : 87                  	add	a
    8779/    3C3D : 5F                  	mov	e,a
    8780/    3C3E : 16 00               	mvi	d,00h
    8781/    3C40 : 19                  	dad	d
    8782/    3C41 : 5E                  	mov	e,m
    8783/    3C42 : 23                  	inx	h
    8784/    3C43 : 56                  	mov	d,m
    8785/    3C44 : EB                  	xchg
    8786/    3C45 : 22 04 80            	shld V_GPIB_txt
    8787/    3C48 : CD 8F 3C            L3C48:	call Update_V_WIFDO
    8788/    3C4B : 21 64 81            	lxi	h,V_GPIB8164
    8789/    3C4E : 86                  	add	m
    8790/    3C4F : 77                  	mov	m,a
    8791/    3C50 : 2A 6B 80            	lhld V_GPIB_cnt0
    8792/    3C53 : 23                  	inx	h
    8793/    3C54 : 22 6B 80            	shld V_GPIB_cnt0
    8794/    3C57 : EB                  	xchg
    8795/    3C58 : 2A 74 81            	lhld VAR_8174
    8796/    3C5B : 7B                  	mov	a,e
    8797/    3C5C : BD                  	cmp	l
    8798/    3C5D : C2 89 3C            	jnz	L3C89
    8799/    3C60 : 7A                  	mov	a,d
    8800/    3C61 : BC                  	cmp	h
    8801/    3C62 : C2 89 3C            	jnz	L3C89
    8802/    3C65 : 21 6A 80            	lxi	h,V_GPIBStage
    8803/    3C68 : 36 04               	mvi	m,04h
    8804/    3C6A : 23                  	inx	h
    8805/    3C6B : AF                  	xra	a
    8806/    3C6C : 77                  	mov	m,a
    8807/    3C6D : 23                  	inx	h
    8808/    3C6E : 77                  	mov	m,a
    8809/    3C6F : C3 89 3C            	jmp	L3C89
    8810/    3C72 : FE 04               L3C72:	cpi	04h
    8811/    3C74 : C2 89 3C            	jnz	L3C89
    8812/    3C77 : 3A 64 81            	lda	V_GPIB8164
    8813/    3C7A : 3D                  	dcr	a
    8814/    3C7B : 2F                  	cma
    8815/    3C7C : 32 69 80            	sta	V_WIFDO
    8816/    3C7F : 21 6A 80            	lxi	h,V_GPIBStage
    8817/    3C82 : 36 06               	mvi	m,06h
    8818/    3C84 : 23                  	inx	h
    8819/    3C85 : AF                  	xra	a
    8820/    3C86 : 77                  	mov	m,a
    8821/    3C87 : 23                  	inx	h
    8822/    3C88 : 77                  	mov	m,a
    8823/    3C89 : 3E 83               L3C89:	mvi	a,83h
    8824/    3C8B : CD 49 00            	call AddMainAction
    8825/    3C8E : C9                  	ret
    8826/    3C8F : 2A 04 80            Update_V_WIFDO:	lhld V_GPIB_txt
    8827/    3C92 : 7E                  	mov	a,m
    8828/    3C93 : 32 69 80            	sta	V_WIFDO
    8829/    3C96 : 23                  	inx	h
    8830/    3C97 : 22 04 80            	shld V_GPIB_txt
    8831/    3C9A : C9                  	ret
    8832/    3C9B :                     ;
    8833/    3C9B :                     ;
    8834/    3C9B :                     Action_0x79_0:
    8835/    3C9B : CD 6E 20            	call Get_GPIB_Status
    8836/    3C9E : F3                  	di
    8837/    3C9F : 3A 6E 80            	lda	V_GPIB_Bool4
    8838/    3CA2 : 17                  	ral
    8839/    3CA3 : D2 AE 3C            	jnc	L3CAE
    8840/    3CA6 : 3E 79               	mvi	a,79h
    8841/    3CA8 : CD 49 00            	call AddMainAction
    8842/    3CAB : C3 11 3D            	jmp	L3D11
    8843/    3CAE : 3A 07 80            L3CAE:	lda	V_GPIB_XmitWFRQSFActive
    8844/    3CB1 : 17                  	ral
    8845/    3CB2 : DA BC 3C            	jc	L3CBC
    8846/    3CB5 : 3A 06 80            	lda	VAR_8006
    8847/    3CB8 : 17                  	ral
    8848/    3CB9 : D2 11 3D            	jnc	L3D11
    8849/    3CBC : 3E 01               L3CBC:	mvi	a,01h
    8850/    3CBE : 32 A9 80            	sta	V_GPIBOut
    8851/    3CC1 : 3A 07 80            	lda	V_GPIB_XmitWFRQSFActive
    8852/    3CC4 : 17                  	ral
    8853/    3CC5 : D2 F1 3C            	jnc	L3CF1
    8854/    3CC8 : 3E 83               	mvi	a,83h
    8855/    3CCA : 32 A9 80            	sta	V_GPIBOut
    8856/    3CCD : 3A 64 80            	lda	V_TALKREG
    8857/    3CD0 : 17                  	ral
    8858/    3CD1 : D2 F1 3C            	jnc	L3CF1
    8859/    3CD4 : 3E 84               	mvi	a,84h
    8860/    3CD6 : 32 A9 80            	sta	V_GPIBOut
    8861/    3CD9 : 3A 17 80            	lda	V_WIFCTL
    8862/    3CDC : F6 01               	ori	01h
    8863/    3CDE : F6 20               	ori	20h
    8864/    3CE0 : 32 17 80            	sta	V_WIFCTL
    8865/    3CE3 : 3E 80               	mvi	a,80h
    8866/    3CE5 : 21 70 80            	lxi	h,V_FPC
    8867/    3CE8 : B6                  	ora	m
    8868/    3CE9 : 32 70 80            	sta	V_FPC
    8869/    3CEC : 3E FF               	mvi	a,0FFh
    8870/    3CEE : 32 6D 80            	sta	V_GPIB_Bool3
    8871/    3CF1 : 3E 40               L3CF1:	mvi	a,40h
    8872/    3CF3 : 21 A9 80            	lxi	h,V_GPIBOut
    8873/    3CF6 : B6                  	ora	m
    8874/    3CF7 : 32 A9 80            	sta	V_GPIBOut
    8875/    3CFA : 3A 17 80            	lda	V_WIFCTL
    8876/    3CFD : F6 04               	ori	04h
    8877/    3CFF : 32 17 80            	sta	V_WIFCTL
    8878/    3D02 : 32 06 F0            	sta	DEV_WIFCTL
    8879/    3D05 : 3E 01               	mvi	a,01h
    8880/    3D07 : 21 70 80            	lxi	h,V_FPC
    8881/    3D0A : B6                  	ora	m
    8882/    3D0B : 32 70 80            	sta	V_FPC
    8883/    3D0E : 32 40 E0            	sta	DEV_FPC
    8884/    3D11 : C9                  L3D11:	ret
    8885/    3D12 :                     ;
    8886/    3D12 :                     ;
    8887/    3D12 :                     Action_0x82_0:
    8888/    3D12 : F3                  	di
    8889/    3D13 : 3A 0D 80            	lda	V_GPIB_ActionWasRemoved
    8890/    3D16 : 17                  	ral
    8891/    3D17 : D8                  	rc
    8892/    3D18 : 3A 55 80            	lda	V_GPIB_MTAReceived
    8893/    3D1B : 47                  	mov	b,a
    8894/    3D1C : 3A 64 80            	lda	V_TALKREG
    8895/    3D1F : B0                  	ora	b
    8896/    3D20 : F2 39 3D            	jp	L3D39
    8897/    3D23 : 3A 6D 80            	lda	V_GPIB_Bool3
    8898/    3D26 : 17                  	ral
    8899/    3D27 : D2 39 3D            	jnc	L3D39
    8900/    3D2A : 21 6A 80            	lxi	h,V_GPIBStage
    8901/    3D2D : 36 01               	mvi	m,01h
    8902/    3D2F : 23                  	inx	h
    8903/    3D30 : AF                  	xra	a
    8904/    3D31 : 77                  	mov	m,a
    8905/    3D32 : 23                  	inx	h
    8906/    3D33 : 77                  	mov	m,a
    8907/    3D34 : 3E 80               	mvi	a,80h
    8908/    3D36 : C3 3B 3D            	jmp	L3D3B
    8909/    3D39 : 3E 82               L3D39:	mvi	a,82h
    8910/    3D3B : CD 49 00            L3D3B:	call AddMainAction
    8911/    3D3E : C9                  	ret
    8912/    3D3F :                     ;
    8913/    3D3F :                     ;
    8914/    3D3F :                     RestartDisplaySystem:
    8915/    3D3F : F3                  	di
    8916/    3D40 : 3A A4 80            	lda	V_DISREG
    8917/    3D43 : F6 80               	ori	80h					;10000000	CSEL
    8918/    3D45 : 32 02 E4            	sta	DEV_DISREG
    8919/    3D48 : F5                  	push	psw
    8920/    3D49 : 3E 08               	mvi	a,08h
    8921/    3D4B :                     L3D4B:						;delay loop
    8922/    3D4B : 3D                  	dcr	a
    8923/    3D4C : C2 4B 3D            	jnz	L3D4B
    8924/    3D4F : F1                  	pop	psw
    8925/    3D50 : F6 04               	ori	04h					;00000100 toggle bit 2 "START"
    8926/    3D52 : 32 02 E4            	sta	DEV_DISREG
    8927/    3D55 : 00                  	nop
    8928/    3D56 : E6 FB               	ani	0FBh				;00001011
    8929/    3D58 : 32 02 E4            	sta	DEV_DISREG
    8930/    3D5B : FB                  	ei
    8931/    3D5C : C9                  	ret
    8932/    3D5D :                     ;
    8933/    3D5D :                     ; in A,L
    8934/    3D5D :                     ; out CY set, A==TRUE if equal, CY clr, A==FALSE if not equal
    8935/    3D5D :                     ;	
    8936/    3D5D :                     Test_Equal_A_L:
    8937/    3D5D : 95                  	sub	l					;A - L
    8938/    3D5E : 3E FF               	mvi	a,0FFh
    8939/    3D60 : 07                  	rlc						;does NOT affect Z, sets CY
    8940/    3D61 : C8                  	rz
    8941/    3D62 : 3E 00               	mvi	a,00h
    8942/    3D64 : 07                  	rlc						;clear CY
    8943/    3D65 : C9                  	ret
    8944/    3D66 :                     ;
    8945/    3D66 :                     ; in A,L
    8946/    3D66 :                     ; out A,carry. Destroys B
    8947/    3D66 :                     ; Only called with L == 0
    8948/    3D66 :                     ; Signed Compare A,L: return TRUE/CY set if A > L (signed)
    8949/    3D66 :                     ;
    8950/    3D66 :                     Signed_Compare_A_L:
    8951/    3D66 : 47                  	mov	b,a
    8952/    3D67 : AD                  	xra	l					;test if A or L (not both) have bit 7 set (negative)
    8953/    3D68 : 07                  	rlc
    8954/    3D69 : 78                  	mov	a,b					;restore
    8955/    3D6A : DA 77 3D            	jc	L3D77
    8956/    3D6D : BD                  	cmp	l					;A - L
    8957/    3D6E : 3E 00               	mvi	a,00h				;return FALSE/CY clr if A <= L
    8958/    3D70 : 07                  	rlc						;does NOT affect Z flag
    8959/    3D71 : F8                  	rm
    8960/    3D72 : C8                  	rz
    8961/    3D73 : 3E FF               	mvi	a,0FFh				;return TRUE/CY set if A > L
    8962/    3D75 : 07                  	rlc
    8963/    3D76 : C9                  	ret
    8964/    3D77 :                     ; A or L negative, not both	
    8965/    3D77 : 07                  L3D77:	rlc					;was A negative
    8966/    3D78 : DA 7F 3D            	jc	L3D7F
    8967/    3D7B :                     ; A positive so L negative	
    8968/    3D7B : 3E FF               	mvi	a,0FFh				;return TRUE/CY set if A was positive, implying A > L signed
    8969/    3D7D : 07                  	rlc
    8970/    3D7E : C9                  	ret
    8971/    3D7F :                     ; A negative so L positive	
    8972/    3D7F : AF                  L3D7F:	xra	a				;return FALSE/CY clr if A was negative. implying A < L signed
    8973/    3D80 : 07                  	rlc
    8974/    3D81 : C9                  	ret
    8975/    3D82 :                     ;
    8976/    3D82 :                     ; in A,L
    8977/    3D82 :                     ; out A, CY
    8978/    3D82 :                     ; Signed Compare A,L: return FALSE/CY Clr if A >= L (signed)
    8979/    3D82 :                     ; cf Signed_Compare_A_L
    8980/    3D82 :                     ;	
    8981/    3D82 :                     Compare_A_L:
    8982/    3D82 : 47                  	mov	b,a					;save arg1
    8983/    3D83 : AD                  	xra	l					;test if A or L (not both) have bit 7 set
    8984/    3D84 : 07                  	rlc						;bit 7 (sign) to CY
    8985/    3D85 : 78                  	mov	a,b					;restore
    8986/    3D86 : DA 91 3D            	jc	L3D91				;brif A or L negative (not both)
    8987/    3D89 :                     ;
    8988/    3D89 :                     ; A and L same sign. Could be equal.
    8989/    3D89 :                     ;
    8990/    3D89 : BD                  	cmp	l					;A - L
    8991/    3D8A : 3E FF               	mvi	a,0FFh				;return TRUE/CY set if 0
    8992/    3D8C : 07                  	rlc						;set carry, does not affect Z,P. A unchanged
    8993/    3D8D : F8                  	rm						;return TRUE/C set if A < L
    8994/    3D8E :                     ; A - L >= 0
    8995/    3D8E : AF                  	xra	a					;return FALSE/CY clr.
    8996/    3D8F : 07                  	rlc
    8997/    3D90 : C9                  	ret
    8998/    3D91 :                     L3D91:
    8999/    3D91 :                     ;
    9000/    3D91 :                     ; A and L opposite signs
    9001/    3D91 :                     ;
    9002/    3D91 : 07                  	rlc						;check sign A
    9003/    3D92 : D2 99 3D            	jnc	L3D99				;brif positive
    9004/    3D95 :                     ;
    9005/    3D95 :                     ; A negative so L zero or positive. A < L
    9006/    3D95 :                     ;
    9007/    3D95 : 3E FF               	mvi	a,0FFh				;return TRUE/CY set
    9008/    3D97 : 07                  	rlc
    9009/    3D98 : C9                  	ret
    9010/    3D99 :                     L3D99:
    9011/    3D99 :                     ;
    9012/    3D99 :                     ; A positive so L negative. A > L
    9013/    3D99 :                     ;
    9014/    3D99 : AF                  	xra	a					;return FALSE/CY clr
    9015/    3D9A : 07                  	rlc
    9016/    3D9B : C9                  	ret
    9017/    3D9C :                     ;
    9018/    3D9C :                     ;	in L
    9019/    3D9C :                     ;	out H 0xff or 0
    9020/    3D9C :                     ;	Sign extend L into H
    9021/    3D9C :                     ;
    9022/    3D9C :                     SignExtend_L_in_H:
    9023/    3D9C : 7D                  	mov	a,l
    9024/    3D9D : 17                  	ral
    9025/    3D9E : 3E 00               	mvi	a,00h
    9026/    3DA0 : D2 A4 3D            	jnc	L3DA4
    9027/    3DA3 : 2F                  	cma
    9028/    3DA4 : 67                  L3DA4:	mov	h,a
    9029/    3DA5 : C9                  	ret
    9030/    3DA6 :                     ;
    9031/    3DA6 :                     ; in HL. Two's complement if HL is negative. Absolute Value
    9032/    3DA6 :                     ;
    9033/    3DA6 :                     AbsoluteValue_HL:
    9034/    3DA6 : 7C                  	mov	a,h
    9035/    3DA7 : 17                  	ral						;test bit 7 HL
    9036/    3DA8 : D2 B2 3D            	jnc	L3DB2				;done if positive.
    9037/    3DAB : 2B                  	dcx	h					;two's complement.
    9038/    3DAC : 7D                  	mov	a,l
    9039/    3DAD : 2F                  	cma
    9040/    3DAE : 6F                  	mov	l,a
    9041/    3DAF : 7C                  	mov	a,h
    9042/    3DB0 : 2F                  	cma
    9043/    3DB1 : 67                  	mov	h,a
    9044/    3DB2 : C9                  L3DB2:	ret
    9045/    3DB3 :                     ;
    9046/    3DB3 :                     ; in DE, HL
    9047/    3DB3 :                     ; out HL
    9048/    3DB3 :                     ; non-reentrant version but only called from interrupt code so safe.
    9049/    3DB3 :                     ;
    9050/    3DB3 :                     Divide_DE_by_HL_2:
    9051/    3DB3 : AF                  	xra	a
    9052/    3DB4 : 32 00 80            	sta	DivLoopCntr
    9053/    3DB7 : 44                  	mov	b,h
    9054/    3DB8 : 4D                  	mov	c,l
    9055/    3DB9 : 21 00 00            	lxi	h,0000H
    9056/    3DBC : F5                  	push	psw
    9057/    3DBD : E5                  	push	h
    9058/    3DBE :                     ; loop 16 times	
    9059/    3DBE :                     L3DBE:
    9060/    3DBE : E1                  	pop	h
    9061/    3DBF : F1                  	pop	psw
    9062/    3DC0 : 7D                  	mov	a,l
    9063/    3DC1 : 91                  	sub	c
    9064/    3DC2 : 6F                  	mov	l,a
    9065/    3DC3 : 7C                  	mov	a,h
    9066/    3DC4 : 98                  	sbb	b
    9067/    3DC5 : 67                  	mov	h,a
    9068/    3DC6 : D2 CA 3D            	jnc	L3DCA
    9069/    3DC9 : 09                  	dad	b
    9070/    3DCA : 7B                  L3DCA:	mov	a,e			;shift left DE and HL
    9071/    3DCB : 17                  	ral
    9072/    3DCC : 5F                  	mov	e,a
    9073/    3DCD : 7A                  	mov	a,d
    9074/    3DCE : 17                  	ral
    9075/    3DCF : 57                  	mov	d,a
    9076/    3DD0 : 7D                  	mov	a,l
    9077/    3DD1 : 17                  	ral
    9078/    3DD2 : 6F                  	mov	l,a
    9079/    3DD3 : 7C                  	mov	a,h
    9080/    3DD4 : 17                  	ral
    9081/    3DD5 : 67                  	mov	h,a
    9082/    3DD6 : F5                  	push	psw
    9083/    3DD7 : E5                  	push	h
    9084/    3DD8 : 21 00 80            	lxi	h,DivLoopCntr		;loop counter
    9085/    3DDB : 34                  	inr	m
    9086/    3DDC : 7E                  	mov	a,m
    9087/    3DDD : FE 11               	cpi	11h
    9088/    3DDF : C2 BE 3D            	jnz	L3DBE
    9089/    3DE2 :                     ;	
    9090/    3DE2 : E1                  	pop	h
    9091/    3DE3 : F1                  	pop	psw
    9092/    3DE4 : 1F                  	rar
    9093/    3DE5 : 47                  	mov	b,a
    9094/    3DE6 : EB                  	xchg					;swap
    9095/    3DE7 : 7D                  	mov	a,l					;complement HL
    9096/    3DE8 : 2F                  	cma
    9097/    3DE9 : 6F                  	mov	l,a
    9098/    3DEA : 7C                  	mov	a,h
    9099/    3DEB : 2F                  	cma
    9100/    3DEC : 67                  	mov	h,a
    9101/    3DED : C9                  	ret
    9102/    3DEE :                     ;
    9103/    3DEE :                     ; in DE, HL.
    9104/    3DEE :                     ;	HL always 0x0100, DE always [V_CurrentSweeps]
    9105/    3DEE :                     ; returns carry
    9106/    3DEE :                     ; signed compare DE and HL
    9107/    3DEE :                     ; return CY if DE > (signed) HL
    9108/    3DEE :                     ; return No CY if DE <= HL;
    9109/    3DEE :                     Signed_Compare_DE_HL:
    9110/    3DEE : 7A                  	mov	a,d
    9111/    3DEF : AC                  	xra	h
    9112/    3DF0 : 07                  	rlc
    9113/    3DF1 : 7A                  	mov	a,d
    9114/    3DF2 : DA 02 3E            	jc	L3E02
    9115/    3DF5 : 7D                  	mov	a,l
    9116/    3DF6 : 93                  	sub	e
    9117/    3DF7 : 7C                  	mov	a,h
    9118/    3DF8 : 9A                  	sbb	d
    9119/    3DF9 : 07                  	rlc
    9120/    3DFA : 3E 00               	mvi	a,00h
    9121/    3DFC : D2 01 3E            	jnc	L3E01
    9122/    3DFF : 3E FF               	mvi	a,0FFh
    9123/    3E01 : C9                  L3E01:	ret
    9124/    3E02 : 07                  L3E02:	rlc
    9125/    3E03 : DA 0A 3E            	jc	L3E0A
    9126/    3E06 : 3E FF               	mvi	a,0FFh
    9127/    3E08 : 07                  	rlc
    9128/    3E09 : C9                  	ret
    9129/    3E0A : AF                  L3E0A:	xra	a
    9130/    3E0B : 07                  	rlc
    9131/    3E0C : C9                  	ret
    9132/    3E0D :                     ;
    9133/    3E0D :                     ; in DE, L
    9134/    3E0D :                     ; L is count. Shift Right DE count times.
    9135/    3E0D :                     ; result in HL
    9136/    3E0D :                     ;
    9137/    3E0D :                     ShiftR_DE_L_times:
    9138/    3E0D : EB                  	xchg					;count to DE
    9139/    3E0E : 7B                  	mov	a,e
    9140/    3E0F : FE 00               	cpi	00h					;done if count <= 0
    9141/    3E11 : F8                  	rm
    9142/    3E12 : C8                  	rz
    9143/    3E13 :                     $$L1111:
    9144/    3E13 : 7C                  	mov	a,h
    9145/    3E14 : 37                  	stc						;clear carry
    9146/    3E15 : 3F                  	cmc
    9147/    3E16 : 1F                  	rar
    9148/    3E17 : 67                  	mov	h,a
    9149/    3E18 : 7D                  	mov	a,l
    9150/    3E19 : 1F                  	rar
    9151/    3E1A : 6F                  	mov	l,a
    9152/    3E1B : 1D                  	dcr	e
    9153/    3E1C : C2 13 3E            	jnz	$$L1111
    9154/    3E1F : C9                  	ret
    9155/    3E20 :                     ;
    9156/    3E20 :                     ; in DE, HL
    9157/    3E20 :                     ; out HL
    9158/    3E20 :                     ; compare DE and HL unsigned.
    9159/    3E20 :                     ; return larger of DE and HL in HL
    9160/    3E20 :                     ; called once only
    9161/    3E20 :                     ;
    9162/    3E20 :                     MAX_DE_HL:
    9163/    3E20 : 7B                  	mov	a,e					;DE - HL
    9164/    3E21 : 95                  	sub	l
    9165/    3E22 : 7A                  	mov	a,d
    9166/    3E23 : 9C                  	sbb	h
    9167/    3E24 : D2 2B 3E            	jnc	L3E2B
    9168/    3E27 :                     ; HL > DE	
    9169/    3E27 : C9                  	ret
    9170/    3E28 : C3 2D 3E            	jmp	MIN_DE_HL			;unreachable
    9171/    3E2B :                     ; HL <= DE. Move DE to HL
    9172/    3E2B : EB                  L3E2B:	xchg
    9173/    3E2C : C9                  	ret
    9174/    3E2D :                     ;
    9175/    3E2D :                     ; in DE, HL
    9176/    3E2D :                     ; out HL
    9177/    3E2D :                     ; compare DE and HL unsigned.
    9178/    3E2D :                     ; return smaller of DE and HL in HL
    9179/    3E2D :                     ;
    9180/    3E2D :                     MIN_DE_HL:
    9181/    3E2D : 7B                  	mov	a,e					;E - L
    9182/    3E2E : 95                  	sub	l
    9183/    3E2F : 7A                  	mov	a,d					;D - H - carry
    9184/    3E30 : 9C                  	sbb	h
    9185/    3E31 : DA 38 3E            	jc	L3E38
    9186/    3E34 : C9                  	ret
    9187/    3E35 : C3 3A 3E            	jmp	Multiply_HL_DE		;unreachable
    9188/    3E38 : EB                  L3E38:	xchg
    9189/    3E39 : C9                  	ret
    9190/    3E3A :                     ;
    9191/    3E3A :                     ; in DE, HL. Multiply DE * HL
    9192/    3E3A :                     ; result in HL
    9193/    3E3A :                     ;	
    9194/    3E3A :                     Multiply_HL_DE:
    9195/    3E3A : 44                  	mov	b,h
    9196/    3E3B : 4D                  	mov	c,l
    9197/    3E3C : 21 00 00            	lxi	h,0000H
    9198/    3E3F : 3E 10               	mvi	a,10h
    9199/    3E41 :                     ; loop 16 times
    9200/    3E41 :                     L3E41:
    9201/    3E41 : 29                  	dad	h
    9202/    3E42 : EB                  	xchg
    9203/    3E43 : 29                  	dad	h
    9204/    3E44 : EB                  	xchg
    9205/    3E45 : D2 49 3E            	jnc	L3E49
    9206/    3E48 : 09                  	dad	b					;add input argument
    9207/    3E49 :                     L3E49:
    9208/    3E49 : 3D                  	dcr	a
    9209/    3E4A : C2 41 3E            	jnz	L3E41
    9210/    3E4D : C9                  	ret
    9211/    3E4E :                     ;
    9212/    3E4E :                     ; note: 2 copies of table
    9213/    3E4E :                     ; Table used in Display_Interrupt_0. Max index 15
    9214/    3E4E :                     ; 20 entries.
    9215/    3E4E :                     ;	
    9216/    3E4E :                     Display_Actions:
    9217/    3E4E : 9E 20 7D 21 7C 26   	dw	Display_Action_1,RenderWF,Display_Action_3,Display_Action_4,Display_Action_5,Display_Action_6,Display_Action_7
                    42 27 62 20 4C 00 
                    46 00 
    9218/    3E5C : 76 76 76 76 76 76   	db	076h,076h,076h,076h,076h,076h
    9219/    3E62 : 9E 20 7D 21 7C 26   	dw	Display_Action_1,RenderWF,Display_Action_3,Display_Action_4,Display_Action_5,Display_Action_6,Display_Action_7
                    42 27 62 20 4C 00 
                    46 00 
    9220/    3E70 : 76 76 76 76 76 76   	db	076h,076h,076h,076h,076h,076H
    9221/    3E76 :                     ;
    9222/    3E76 :                     ; multiplication factor table
    9223/    3E76 :                     ;
    9224/    3E76 :                     V_CvtFreq2Volts:
    9225/    3E76 : 01 02 05            	db	001h,002h,005h
    9226/    3E79 :                     ; unused
    9227/    3E79 : 01 05 02            	db	001h,005h,002h
    9228/    3E7C :                     ;
    9229/    3E7C :                     ; next tables have 16 entries
    9230/    3E7C :                     ;
    9231/    3E7C :                     V_CursorScaleTbl:
    9232/    3E7C : 01 01 01 01 01 02   	db	001h,001h,001h,001h,001h,002h,002h,002h,003h
                    02 02 03 
    9233/    3E85 : 03 04 05 06 07 09   	db	003h,004h,005h,006h,007h,009h
    9234/    3E8B :                     ;
    9235/    3E8B :                     V_TimerCntr_Rate_Tbl:
    9236/    3E8B : 0A 0A 08 04 02 01   	db	00Ah,00Ah,008h,004h,002h,001h,001h,001h,001h,001h
                    01 01 01 01 
    9237/    3E95 : 01 01 01 01 01 01   	db	001h,001h,001h,001h,001h,001h,001h
                    01 
    9238/    3E9C :                     Number5:
    9239/    3E9C : 05                  	db	005h
    9240/    3E9D :                     	
    9241/    3E9D :                     GPIB_txt_1:	
    9242/    3E9D : 32 31 34 34 32      	db	"21442"
    9243/    3EA2 :                     GPIB_txt_2:
    9244/    3EA2 : 38 34 38 32         	db	"8482"
    9245/    3EA6 :                     GPIB_txt_3:
    9246/    3EA6 : 49 44 20 54 45 4B   	db	"ID TEK/468,V79.1,FV:2.0;"
                    2F 34 36 38 2C 56 
                    37 39 2E 31 2C 46 
                    56 3A 32 2E 30 3B 
    9247/    3EBE :                     GPIB_txt_4:
    9248/    3EBE : 57 46 4D 50 52 45   	db	"WFMPRE "
                    20 
    9249/    3EC5 :                     GPIB_txt_5:
    9250/    3EC5 : 57 46 49 44 3A 22   	db	"WFID:",022h
    9251/    3ECB :                     GPIB_txt_6:
    9252/    3ECB : 55 4E 4B 22         	db	"UNK",022h
    9253/    3ECF :                     GPIB_txt_7:
    9254/    3ECF : 44 43 22            	db	"DC",022h
    9255/    3ED2 :                     GPIB_txt_8:
    9256/    3ED2 : 41 43 22            	db	"AC",022h
    9257/    3ED5 :                     GPIB_txt_9:
    9258/    3ED5 : 47 4E 44 22         	db	"GND",022h
    9259/    3ED9 :                     GPIB_txt_10:
    9260/    3ED9 : 43 48 31 20         	db	"CH1 "
    9261/    3EDD :                     GPIB_txt_11:
    9262/    3EDD : 43 48 32 20         	db	"CH2 "
    9263/    3EE1 :                     GPIB_txt_12:
    9264/    3EE1 : 41 44 44 20         	db	"ADD "
    9265/    3EE5 :                     GPIB_txt_13:
    9266/    3EE5 : 4E 52 2E 50 54 3A   	db	"NR.PT:"
    9267/    3EEB :                     GPIB_txt_14:
    9268/    3EEB : 35 31 32 2C         	db 	"512,"
    9269/    3EEF :                     GPIB_txt_15:
    9270/    3EEF : 32 35 36 2C         	db 	"256,"
    9271/    3EF3 :                     GPIB_txt_16:
    9272/    3EF3 : 50 54 2E 46 4D 54   	db 	"PT.FMT:Y,"
                    3A 59 2C 
    9273/    3EFC :                     GPIB_txt_17:
    9274/    3EFC : 58 49 4E 43 52 3A   	db	"XINCR:"
    9275/    3F02 :                     GPIB_txt_18:
    9276/    3F02 : 58 5A 45 52 4F 3A   	db 	"XZERO:0,"
                    30 2C 
    9277/    3F0A :                     GPIB_txt_19:
    9278/    3F0A : 4D 53               	db 	"MS"
    9279/    3F0C :                     GPIB_txt_20:
    9280/    3F0C : 55 53               	db 	"US"
    9281/    3F0E :                     GPIB_txt_21:
    9282/    3F0E : 4E 53               	db 	"NS"
    9283/    3F10 :                     GPIB_txt_22:
    9284/    3F10 : 50 54 2E 4F 46 46   	db 	"PT.OFF:"
                    3A 
    9285/    3F17 :                     GPIB_txt_23:
    9286/    3F17 : 58 55 4E 49 54 3A   	db 	"XUNIT:"
    9287/    3F1D :                     GPIB_txt_24:
    9288/    3F1D : 59 4D 55 4C 54 3A   	db	"YMULT:"
    9289/    3F23 :                     GPIB_txt_25:
    9290/    3F23 : 59 5A 45 52 4F 3A   	db	"YZERO:0,"
                    30 2C 
    9291/    3F2B :                     GPIB_txt_26:
    9292/    3F2B : 59 4F 46 46 3A      	db	"YOFF:"
    9293/    3F30 :                     GPIB_txt_27:
    9294/    3F30 : 59 55 4E 49 54 3A   	db	"YUNIT:"
    9295/    3F36 :                     GPIB_txt_28:
    9296/    3F36 : 45 4E 43 44 47 3A   	db	"ENCDG:BIN,"
                    42 49 4E 2C 
    9297/    3F40 :                     GPIB_txt_29:
    9298/    3F40 : 42 4E 2E 46 4D 54   	db	"BN.FMT:RP,"
                    3A 52 50 2C 
    9299/    3F4A :                     GPIB_txt_30:
    9300/    3F4A : 42 59 54 2F 4E 52   	db	"BYT/NR:1,"
                    3A 31 2C 
    9301/    3F53 :                     GPIB_txt_31:
    9302/    3F53 : 42 49 54 2F 4E 52   	db	"BIT/NR:8,"
                    3A 38 2C 
    9303/    3F5C :                     GPIB_txt_32:
    9304/    3F5C : 55 56 2C            	db	"UV,"
    9305/    3F5F :                     GPIB_txt_33:
    9306/    3F5F : 4D 56 2C            	db	"MV,"
    9307/    3F62 :                     GPIB_txt_34:
    9308/    3F62 : 56 2C               	db	"V,"
    9309/    3F64 :                     GPIB_txt_35:
    9310/    3F64 : 44 49 56 2C         	db	"DIV,"
    9311/    3F68 :                     GPIB_txt_36:
    9312/    3F68 : 32 32 34 2C         	db	"224,"
    9313/    3F6C :                     GPIB_txt_37:
    9314/    3F6C : 34 34 38 2C         	db	"448,"
    9315/    3F70 :                     GPIB_txt_38:
    9316/    3F70 : 33 32 2C            	db	"32,"
    9317/    3F73 :                     GPIB_txt_39:
    9318/    3F73 : 36 34 2C            	db	"64,"
    9319/    3F76 :                     GPIB_txt_40:
    9320/    3F76 : 35 30 2C            	db	"50,"
    9321/    3F79 :                     GPIB_txt_41:
    9322/    3F79 : 32 35 2C            	db	"25,"
    9323/    3F7C :                     GPIB_txt_42:
    9324/    3F7C : 35 30 2C            	db	"50,"
    9325/    3F7F :                     GPIB_txt_43:
    9326/    3F7F : 31 30 30 2C         	db	"100,"
    9327/    3F83 :                     GPIB_txt_44:
    9328/    3F83 : 32 35 30 2C         	db	"250,"
    9329/    3F87 :                     GPIB_txt_45:
    9330/    3F87 : 35 30 30 2C         	db	"500,"
    9331/    3F8B :                     GPIB_txt_46:
    9332/    3F8B : 31 30 30 30 2C      	db	"1000,"
    9333/    3F90 :                     
    9334/    3F90 :                     	rept 106
    9335/    3F90 :                     	hlt	
    9336/    3F90 :                     	endm
    9335/    3F90 : 76                  	hlt	
    9335/    3F91 : 76                  	hlt	
    9335/    3F92 : 76                  	hlt	
    9335/    3F93 : 76                  	hlt	
    9335/    3F94 : 76                  	hlt	
    9335/    3F95 : 76                  	hlt	
    9335/    3F96 : 76                  	hlt	
    9335/    3F97 : 76                  	hlt	
    9335/    3F98 : 76                  	hlt	
    9335/    3F99 : 76                  	hlt	
    9335/    3F9A : 76                  	hlt	
    9335/    3F9B : 76                  	hlt	
    9335/    3F9C : 76                  	hlt	
    9335/    3F9D : 76                  	hlt	
    9335/    3F9E : 76                  	hlt	
    9335/    3F9F : 76                  	hlt	
    9335/    3FA0 : 76                  	hlt	
    9335/    3FA1 : 76                  	hlt	
    9335/    3FA2 : 76                  	hlt	
    9335/    3FA3 : 76                  	hlt	
    9335/    3FA4 : 76                  	hlt	
    9335/    3FA5 : 76                  	hlt	
    9335/    3FA6 : 76                  	hlt	
    9335/    3FA7 : 76                  	hlt	
    9335/    3FA8 : 76                  	hlt	
    9335/    3FA9 : 76                  	hlt	
    9335/    3FAA : 76                  	hlt	
    9335/    3FAB : 76                  	hlt	
    9335/    3FAC : 76                  	hlt	
    9335/    3FAD : 76                  	hlt	
    9335/    3FAE : 76                  	hlt	
    9335/    3FAF : 76                  	hlt	
    9335/    3FB0 : 76                  	hlt	
    9335/    3FB1 : 76                  	hlt	
    9335/    3FB2 : 76                  	hlt	
    9335/    3FB3 : 76                  	hlt	
    9335/    3FB4 : 76                  	hlt	
    9335/    3FB5 : 76                  	hlt	
    9335/    3FB6 : 76                  	hlt	
    9335/    3FB7 : 76                  	hlt	
    9335/    3FB8 : 76                  	hlt	
    9335/    3FB9 : 76                  	hlt	
    9335/    3FBA : 76                  	hlt	
    9335/    3FBB : 76                  	hlt	
    9335/    3FBC : 76                  	hlt	
    9335/    3FBD : 76                  	hlt	
    9335/    3FBE : 76                  	hlt	
    9335/    3FBF : 76                  	hlt	
    9335/    3FC0 : 76                  	hlt	
    9335/    3FC1 : 76                  	hlt	
    9335/    3FC2 : 76                  	hlt	
    9335/    3FC3 : 76                  	hlt	
    9335/    3FC4 : 76                  	hlt	
    9335/    3FC5 : 76                  	hlt	
    9335/    3FC6 : 76                  	hlt	
    9335/    3FC7 : 76                  	hlt	
    9335/    3FC8 : 76                  	hlt	
    9335/    3FC9 : 76                  	hlt	
    9335/    3FCA : 76                  	hlt	
    9335/    3FCB : 76                  	hlt	
    9335/    3FCC : 76                  	hlt	
    9335/    3FCD : 76                  	hlt	
    9335/    3FCE : 76                  	hlt	
    9335/    3FCF : 76                  	hlt	
    9335/    3FD0 : 76                  	hlt	
    9335/    3FD1 : 76                  	hlt	
    9335/    3FD2 : 76                  	hlt	
    9335/    3FD3 : 76                  	hlt	
    9335/    3FD4 : 76                  	hlt	
    9335/    3FD5 : 76                  	hlt	
    9335/    3FD6 : 76                  	hlt	
    9335/    3FD7 : 76                  	hlt	
    9335/    3FD8 : 76                  	hlt	
    9335/    3FD9 : 76                  	hlt	
    9335/    3FDA : 76                  	hlt	
    9335/    3FDB : 76                  	hlt	
    9335/    3FDC : 76                  	hlt	
    9335/    3FDD : 76                  	hlt	
    9335/    3FDE : 76                  	hlt	
    9335/    3FDF : 76                  	hlt	
    9335/    3FE0 : 76                  	hlt	
    9335/    3FE1 : 76                  	hlt	
    9335/    3FE2 : 76                  	hlt	
    9335/    3FE3 : 76                  	hlt	
    9335/    3FE4 : 76                  	hlt	
    9335/    3FE5 : 76                  	hlt	
    9335/    3FE6 : 76                  	hlt	
    9335/    3FE7 : 76                  	hlt	
    9335/    3FE8 : 76                  	hlt	
    9335/    3FE9 : 76                  	hlt	
    9335/    3FEA : 76                  	hlt	
    9335/    3FEB : 76                  	hlt	
    9335/    3FEC : 76                  	hlt	
    9335/    3FED : 76                  	hlt	
    9335/    3FEE : 76                  	hlt	
    9335/    3FEF : 76                  	hlt	
    9335/    3FF0 : 76                  	hlt	
    9335/    3FF1 : 76                  	hlt	
    9335/    3FF2 : 76                  	hlt	
    9335/    3FF3 : 76                  	hlt	
    9335/    3FF4 : 76                  	hlt	
    9335/    3FF5 : 76                  	hlt	
    9335/    3FF6 : 76                  	hlt	
    9335/    3FF7 : 76                  	hlt	
    9335/    3FF8 : 76                  	hlt	
    9335/    3FF9 : 76                  	hlt	
    9337/    3FFA :                     
    9338/    3FFA : 07 59               	db	007h,059h
    9339/    3FFC :                     L3FFC:	
    9340/    3FFC : 01 FE               	db	001h,0FEh
    9341/    3FFE : 46 77               	dw	07746h				;rom575 checksum
    9342/    4000 :                     
 AS V1.42 Beta [Bld 37] - source file rom468combined.asm - page 2 - 5/16/2023 15:57:44


  symbol table (* = unused):
  ------------------------

 ABSOLUTEVALUE_HL :            3DA6 C |  ACTION_0X79 :                 2059 C |
 ACTION_0X79_0 :               3C9B C |  ACTION_0X7A :                 2044 C |
 ACTION_0X7A_0 :               343D C |  ACTION_0X7B :                 2041 C |
 ACTION_0X7B_0 :               3359 C |  ACTION_0X7C :                 203E C |
 ACTION_0X7C_0 :               32E9 C |  ACTION_0X7D :                 2053 C |
 ACTION_0X7D_0 :               34F9 C |  ACTION_0X7E :                 204D C |
 ACTION_0X7E_0 :               34C3 C |  ACTION_0X80 :                 2056 C |
 ACTION_0X80_0 :               3539 C |  ACTION_0X82 :                 205C C |
 ACTION_0X82_0 :               3D12 C |  ACTION_0X83 :                 204A C |
 ACTION_0X83_0 :               3455 C |  ACTION_0X84 :                 2050 C |
 ACTION_0X84_0 :               34DE C |  ACTION_TABLE1 :               1F3A C |
 ACTION_TABLE2 :               2001 C |  ADDDISPLAYACTION :            2035 C |
 ADDDISPLAYACTION_0 :          27EB C |  ADDMAINACTION :                 49 C |
 ADDMAINACTION_0 :             14BF C |  ADD_ACTION_2 :                 326 C |
 ADD_AVERAGE :                  E4B C |  ADD_ENVELOPE :                 DEE C |
 ADJUSTCURSORTIME :            2074 C |  ADJUSTCURSORTIME_0 :          23A4 C |
*ARCHITECTURE :  i386-unknown-win32 - |  A_MOD_3_PLUS_1 :              2C9C C |
*BIGENDIAN :                      0 - | *BRANCHEXT :                      0 - |
*CASESENSITIVE :                  0 - |  CHANNELMODE_MAP :             1F02 C |
 CHANNELMULTIPLY2 :            2EE1 C |  CHANNELSWITCH_MAP :           1F22 C |
 CHECK_AOM_BIT :                E6B C |  CLEAR_MEMORY_BLOCK :           8DA C |
 CLEAR_VALIDWFS :                9D C |  CLRCURSORSNAP :               2071 C |
 CLRCURSORSNAP_0 :             2731 C |  CLRNUMWIN :                   16D6 C |
 CLR_BIT_6_IN_A :              2E89 C |  COMPARE_A_L :                 3D82 C |
 COMPUTEGNDREF :                F14 C |  COMPUTEVGAIN :                148D C |
*CONSTPI :        3.141592653589793 - |  CONSTRAINVOLTSTIMECURSOR :    3096 C |
 CONVERTTIMEPOS2VOLTSPOS :     116B C |  CONVERT_2_BCD :               31DF C |
 CONVERT_2_BCD_0 :             3209 C |  COPYWFTABLEENTRY :             F88 C |
 COPY_ACQUIRED_WF :             DA5 C |  COPY_BYTES :                  1E6D C |
 COPY_WF :                     20CA C |  CURSORPOTINT :                1A57 C |
 CURSORPOTINT2 :               206B C |  CURSORPOTINT2_0 :             28FB C |
 CURSORPOTINTS881A :           2918 C |  CURSORPOTINTS881A_2 :         2A66 C |
 CVTNUMWINDISTANCE :           2AE5 C |  CVTNUMWINDISTANCEVOLTS :      2CED C |
*DATE :                   5/16/2023 - |  DECREMENTSCALECODE :          2BFD C |
 DEV_ATIME :                   E802 - |  DEV_ATNFLS :                  F003 - |
 DEV_BTIME :                   E803 - |  DEV_CH1 :                     E800 - |
 DEV_CH2 :                     E801 - |  DEV_CONTRL :                  E041 - |
 DEV_CURSOR :                  E403 - |  DEV_DATACC :                  F002 - |
 DEV_DIPSW :                   E400 - |  DEV_DISREG :                  E402 - |
 DEV_FP1 :                     E043 - |  DEV_FP2 :                     E042 - |
 DEV_FPC :                     E040 - |  DEV_HGAIN :                   E406 - |
 DEV_JITTER :                  E404 - |  DEV_LEDRO :                   E044 - |
 DEV_LIGHTS :                  E805 - |  DEV_LINER :                   E401 - |
 DEV_MODE :                    E804 - |  DEV_MTRIG :                   E203 - |
 DEV_PRICLR :                  F200 - |  DEV_RDJC4 :                   E207 - |
 DEV_RDJC8 :                   E206 - |  DEV_RDMAR :                   E205 - |
 DEV_RDSTAT :                  E204 - |  DEV_RIFDI :                   F005 - |
 DEV_RIFSTAT :                 F007 - |  DEV_RSTACQ :                  E200 - |
 DEV_RSTACQ2 :                 E380 - |  DEV_SNTACK :                  F001 - |
 DEV_STOPDIS :                 E407 - |  DEV_SVNSEG :                  E045 - |
 DEV_TALKREG :                 F000 - |  DEV_VGAIN :                   E405 - |
 DEV_VSM :                     E806 - |  DEV_WIFCTL :                  F006 - |
 DEV_WIFDO :                   F004 - |  DEV_WRSR1 :                   E201 - |
 DEV_WRSR2 :                   E202 - |  DIGITAL_ACTIONS_TBL :         1EE1 C |
 DIGITAL_AVG :                    3 - |  DIGITAL_ENV :                    2 - |
 DIGITAL_NORM :                   1 - |  DIGITAL_OFF :                    0 - |
 DIGITAL_SAVE :                   4 - |  DIGITAL_TBL :                 1EC8 C |
 DISPLAYRAMTABLE :             2021 C |  DISPLAY_ACTIONS :             3E4E C |
 DISPLAY_ACTION_1 :            209E C |  DISPLAY_ACTION_3 :            267C C |
 DISPLAY_ACTION_4 :            2742 C |  DISPLAY_ACTION_5 :            2062 C |
 DISPLAY_ACTION_5_0 :          20B4 C |  DISPLAY_ACTION_6 :              4C C |
 DISPLAY_ACTION_6_0 :          1510 C |  DISPLAY_ACTION_7 :              46 C |
 DISPLAY_ACTION_7_0 :          11E0 C |  DISPLAY_INTERRUPT :           2029 C |
 DISPLAY_INTERRUPT_0 :         254C C |  DIVIDE_DE_BY_HL :             2CB7 C |
 DIVIDE_DE_BY_HL_2 :           3DB3 C |  DIVLOOPCNTR :                 8000 - |
 DOUBLEJITTER :                 8CE C |  DO_INTERPOLATION :             6CF C |
 DO_INTERPOLATION_2 :           6FA C |  ENABLEDISPLAYINTERRUPT :      25E4 C |
 ENABLELINECURSOR :              5B C |  ENABLELINECURSOR_0 :          11CD C |
 ENV_INTERPOLATION :            734 C |  FAIL_RAM_TEST :               180B C |
*FALSE :                          0 - |  FILL_RAM_DOT :                253C C |
 FINALIZE_AVERAGE :             E7F C |  FINDNEXTWF :                  262B C |
*FULLPMMU :                       1 - |  GETWFAREA :                    FDB C |
 GETWFEXPANDVAL :              2077 C |  GETWFEXPANDVAL_0 :            23D9 C |
 GET_GPIB_STATUS :             206E C |  GET_GPIB_STATUS_0 :           28A2 C |
 GET_MINIMUM :                 1EB5 C |  GET_SMALLER :                 1E9E C |
 GET_WORD_FROM_TABLE :           4F C |  GET_WORD_FROM_TABLE_0 :       1698 C |
 GPIBINTERRUPT :                FF7 C |  GPIB_SENDWF :                  47C C |
*GPIB_TXT_1 :                  3E9D C |  GPIB_TXT_10 :                 3ED9 C |
 GPIB_TXT_11 :                 3EDD C |  GPIB_TXT_12 :                 3EE1 C |
 GPIB_TXT_13 :                 3EE5 C |  GPIB_TXT_14 :                 3EEB C |
 GPIB_TXT_15 :                 3EEF C |  GPIB_TXT_16 :                 3EF3 C |
 GPIB_TXT_17 :                 3EFC C |  GPIB_TXT_18 :                 3F02 C |
 GPIB_TXT_19 :                 3F0A C |  GPIB_TXT_2 :                  3EA2 C |
 GPIB_TXT_20 :                 3F0C C |  GPIB_TXT_21 :                 3F0E C |
 GPIB_TXT_22 :                 3F10 C |  GPIB_TXT_23 :                 3F17 C |
 GPIB_TXT_24 :                 3F1D C |  GPIB_TXT_25 :                 3F23 C |
 GPIB_TXT_26 :                 3F2B C |  GPIB_TXT_27 :                 3F30 C |
 GPIB_TXT_28 :                 3F36 C |  GPIB_TXT_29 :                 3F40 C |
 GPIB_TXT_3 :                  3EA6 C |  GPIB_TXT_30 :                 3F4A C |
 GPIB_TXT_31 :                 3F53 C |  GPIB_TXT_32 :                 3F5C C |
 GPIB_TXT_33 :                 3F5F C |  GPIB_TXT_34 :                 3F62 C |
 GPIB_TXT_35 :                 3F64 C |  GPIB_TXT_36 :                 3F68 C |
 GPIB_TXT_37 :                 3F6C C |  GPIB_TXT_38 :                 3F70 C |
 GPIB_TXT_39 :                 3F73 C |  GPIB_TXT_4 :                  3EBE C |
 GPIB_TXT_40 :                 3F76 C |  GPIB_TXT_41 :                 3F79 C |
 GPIB_TXT_42 :                 3F7C C |  GPIB_TXT_43 :                 3F7F C |
 GPIB_TXT_44 :                 3F83 C |  GPIB_TXT_45 :                 3F87 C |
 GPIB_TXT_46 :                 3F8B C |  GPIB_TXT_5 :                  3EC5 C |
 GPIB_TXT_6 :                  3ECB C |  GPIB_TXT_7 :                  3ECF C |
 GPIB_TXT_8 :                  3ED2 C |  GPIB_TXT_9 :                  3ED5 C |
*HAS64 :                          1 - | *HASDSP :                         0 - |
*HASFPU :                         0 - | *HASPMMU :                        0 - |
 HGAIN_TBL1 :                  1EEF C | *INEXTMODE :                      0 - |
 INITDISPLAYRB :               202F C |  INITDISPLAYRB_0 :             2857 C |
 INITJITTERVARS :              1B8A C |  INIT_5_VARIABLES :             4B8 C |
 INIT_ACTION_TABLE :           1505 C |  INIT_DISPLAY :                202C C |
 INIT_DISPLAY_0 :              24B1 C |  INIT_GPIB :                   2032 C |
 INIT_GPIB_0 :                 2862 C |  INIT_WFTABLE :                 FA8 C |
*INLWORDMODE :                    0 - | *INMAXMODE :                      0 - |
*INSRCMODE :                      0 - | *INSUPMODE :                      0 - |
 IS_A_LE_L :                   1E85 C |  L0070 :                         70 C |
 L00A5 :                         A5 C |  L00AC :                         AC C |
 L00F8 :                         F8 C |  L00FB :                         FB C |
 L0109 :                        109 C |  L010C :                        10C C |
 L0148 :                        148 C |  L014B :                        14B C |
 L014E :                        14E C |  L015A :                        15A C |
 L0166 :                        166 C |  L0172 :                        172 C |
 L017E :                        17E C |  L0194 :                        194 C |
 L0197 :                        197 C |  L019C :                        19C C |
 L01FF :                        1FF C |  L021A :                        21A C |
 L0224 :                        224 C |  L022E :                        22E C |
 L023C :                        23C C |  L0251 :                        251 C |
 L027C :                        27C C |  L0286 :                        286 C |
 L0290 :                        290 C |  L029E :                        29E C |
 L02B3 :                        2B3 C |  L02CF :                        2CF C |
 L02E2 :                        2E2 C |  L02FA :                        2FA C |
 L030D :                        30D C |  L031C :                        31C C |
 L031F :                        31F C |  L032C :                        32C C |
 L0337 :                        337 C |  L033D :                        33D C |
 L0344 :                        344 C |  L034B :                        34B C |
 L037E :                        37E C |  L0392 :                        392 C |
 L0395 :                        395 C |  L0399 :                        399 C |
 L03A8 :                        3A8 C |  L03AB :                        3AB C |
 L03B0 :                        3B0 C |  L03BB :                        3BB C |
 L03CB :                        3CB C |  L03E8 :                        3E8 C |
 L0406 :                        406 C |  L041A :                        41A C |
 L0424 :                        424 C |  L0435 :                        435 C |
 L0441 :                        441 C |  L0446 :                        446 C |
 L0449 :                        449 C |  L0453 :                        453 C |
 L0463 :                        463 C |  L0491 :                        491 C |
 L04A9 :                        4A9 C |  L04B0 :                        4B0 C |
 L04DB :                        4DB C |  L04DD :                        4DD C |
 L04FF :                        4FF C |  L050A :                        50A C |
 L0515 :                        515 C |  L052B :                        52B C |
 L0536 :                        536 C |  L0541 :                        541 C |
 L054C :                        54C C |  L0554 :                        554 C |
 L057B :                        57B C |  L057E :                        57E C |
 L0593 :                        593 C |  L059C :                        59C C |
 L05DF :                        5DF C |  L05F5 :                        5F5 C |
 L05FD :                        5FD C |  L0646 :                        646 C |
 L0673 :                        673 C |  L06E2 :                        6E2 C |
 L06F2 :                        6F2 C |  L06F9 :                        6F9 C |
 L070A :                        70A C |  L071A :                        71A C |
 L071E :                        71E C |  L0723 :                        723 C |
 L073E :                        73E C |  L0746 :                        746 C |
 L0748 :                        748 C |  L0767 :                        767 C |
 L077A :                        77A C |  L07FD :                        7FD C |
 L0807 :                        807 C |  L0813 :                        813 C |
 L081A :                        81A C |  L0826 :                        826 C |
 L084D :                        84D C |  L0883 :                        883 C |
 L0888 :                        888 C |  L0893 :                        893 C |
 L089F :                        89F C |  L08A6 :                        8A6 C |
 L08B2 :                        8B2 C |  L08E9 :                        8E9 C |
 L090D :                        90D C |  L0910 :                        910 C |
 L0934 :                        934 C |  L0938 :                        938 C |
 L095F :                        95F C |  L0987 :                        987 C |
 L09B0 :                        9B0 C |  L09B5 :                        9B5 C |
 L09B8 :                        9B8 C |  L09F3 :                        9F3 C |
 L09F6 :                        9F6 C |  L09FE :                        9FE C |
 L0A11 :                        A11 C |  L0A15 :                        A15 C |
 L0A1E :                        A1E C |  L0A34 :                        A34 C |
 L0A5A :                        A5A C |  L0A67 :                        A67 C |
 L0AB4 :                        AB4 C |  L0AC4 :                        AC4 C |
 L0ACA :                        ACA C |  L0AD8 :                        AD8 C |
 L0AE6 :                        AE6 C |  L0B04 :                        B04 C |
 L0B07 :                        B07 C |  L0B10 :                        B10 C |
 L0B38 :                        B38 C |  L0B5C :                        B5C C |
 L0B61 :                        B61 C |  L0B7A :                        B7A C |
 L0B96 :                        B96 C |  L0C16 :                        C16 C |
 L0C3E :                        C3E C |  L0C41 :                        C41 C |
 L0C52 :                        C52 C |  L0C70 :                        C70 C |
 L0C8F :                        C8F C |  L0C93 :                        C93 C |
 L0C98 :                        C98 C |  L0CA0 :                        CA0 C |
 L0CA5 :                        CA5 C |  L0CC2 :                        CC2 C |
 L0CE1 :                        CE1 C |  L0CE4 :                        CE4 C |
 L0D0C :                        D0C C |  L0D2C :                        D2C C |
 L0D46 :                        D46 C |  L0D49 :                        D49 C |
 L0D5A :                        D5A C |  L0D61 :                        D61 C |
 L0D82 :                        D82 C |  L0D9F :                        D9F C |
 L0DBE :                        DBE C |  L0DD6 :                        DD6 C |
 L0DE4 :                        DE4 C |  L0DE7 :                        DE7 C |
 L0DF7 :                        DF7 C |  L0DFD :                        DFD C |
 L0E04 :                        E04 C |  L0E0C :                        E0C C |
 L0E13 :                        E13 C |  L0E3B :                        E3B C |
 L0E58 :                        E58 C |  L0E98 :                        E98 C |
 L0EA1 :                        EA1 C |  L0EAA :                        EAA C |
 L0EC0 :                        EC0 C |  L0ECC :                        ECC C |
 L0ED1 :                        ED1 C |  L0EDC :                        EDC C |
 L0EE6 :                        EE6 C |  L0EEA :                        EEA C |
 L0EEB :                        EEB C |  L0F40 :                        F40 C |
 L0F55 :                        F55 C |  L0F5D :                        F5D C |
 L0F60 :                        F60 C |  L0F68 :                        F68 C |
 L0F71 :                        F71 C |  L0F7F :                        F7F C |
 L0F9F :                        F9F C |  L0FF4 :                        FF4 C |
 L1001 :                       2DB7 C |  L1003 :                       2DEB C |
 L1006 :                       2E24 C |  L102A :                       102A C |
 L1050 :                       30B0 C |  L1051 :                       30CA C |
 L1067 :                       31EE C |  L1069 :                       3220 C |
 L106C :                       106C C |  L1071 :                       1071 C |
 L10BF :                       10BF C |  L10C5 :                       10C5 C |
 L10C8 :                       10C8 C |  L10E5 :                       10E5 C |
 L10F6 :                       10F6 C |  L1102 :                       1102 C |
 L11051 :                      30D2 C |  L11069 :                      321A C |
 L11111259 :                   3E13 C |  L111A :                       111A C |
 L1125 :                       1125 C |  L1132 :                       1132 C |
 L1162 :                       1162 C |  L1164 :                       1164 C |
 L1178 :                       1178 C |  L117D :                       117D C |
 L11997 :                      2D34 C |  L11A9 :                       11A9 C |
 L11AD :                       11AD C |  L11EB :                       11EB C |
 L1209 :                       1209 C |  L120C :                       120C C |
 L1224 :                       1224 C |  L122A :                       122A C |
 L1258 :                       1258 C |  L1263 :                       1263 C |
 L127A :                       127A C |  L1280 :                       1280 C |
 L12A8 :                       12A8 C |  L12AC :                       12AC C |
 L12EE :                       12EE C |  L12FA :                       12FA C |
 L13C2 :                       13C2 C |  L13CC :                       13CC C |
 L13DC :                       13DC C |  L13E2 :                       13E2 C |
 L141F :                       141F C |  L1425X :                      1425 C |
 L1451 :                        6A9 C |  L1476 :                       1476 C |
 L147D :                       147D C |  L148A :                       148A C |
 L149B :                       149B C |  L14AA :                       14AA C |
 L14AC :                       14AC C |  L14BC :                       14BC C |
 L14E7 :                       14E7 C |  L14F6 :                       14F6 C |
 L14FB :                       14FB C |  L1504 :                       1504 C |
 L159F :                       159F C |  L15A9 :                       15A9 C |
 L15F4 :                       15F4 C |  L1602 :                       1602 C |
 L160B :                       160B C |  L1622 :                       138C C |
 L1622_0 :                     1622 C |  L165C :                       165C C |
 L1669 :                       1669 C |  L168E :                       168E C |
 L1690 :                       1690 C |  L1697 :                       1697 C |
 L16B8 :                       16B8 C |  L16CC :                       16CC C |
 L16D1 :                       16D1 C |  L1712 :                       1712 C |
 L1715 :                       1715 C |  L1720 :                       1720 C |
 L1732 :                       1732 C |  L1735 :                       1735 C |
 L1745 :                       1745 C |  L174D :                       174D C |
 L1752 :                       1752 C |  L1769 :                       1769 C |
 L176B :                       176B C |  L1771 :                       1771 C |
 L177D :                       177D C |  L178F :                       178F C |
 L1793 :                       1793 C |  L1795 :                       1795 C |
 L17A5 :                       17A5 C |  L17A7 :                       17A7 C |
 L17AD :                       17AD C |  L17AF :                       17AF C |
 L1819 :                       1819 C |  L182E :                       182E C |
 L1832 :                       1832 C |  L1841 :                       1841 C |
 L186B :                       186B C |  L1872 :                       1872 C |
 L1883 :                       1883 C |  L190A :                       190A C |
 L1919 :                       1919 C |  L191F :                       191F C |
 L1929 :                       1929 C |  L1936 :                       1936 C |
 L1949 :                       1949 C |  L1957 :                       1957 C |
 L1968 :                       1968 C |  L197B :                       197B C |
 L1991 :                       1991 C |  L199B :                       199B C |
 L19B4 :                       19B4 C |  L19B8 :                       19B8 C |
 L19C8 :                       19C8 C |  L19D6 :                       19D6 C |
 L19E9 :                       19E9 C |  L1A11 :                       1A11 C |
 L1ADE :                       1ADE C |  L1AF3 :                       1AF3 C |
 L1B13 :                       1B13 C |  L1B30 :                       1B30 C |
 L1B52 :                       1B52 C |  L1B65 :                       1B65 C |
 L1BBA :                       1BBA C |  L1BBD :                       1BBD C |
 L1BE3 :                       1BE3 C |  L1BEB :                       1BEB C |
 L1C03 :                       1C03 C |  L1C09 :                       1C09 C |
 L1C21 :                       1C21 C |  L1C27 :                       1C27 C |
 L1C77 :                       1C77 C |  L1C7F :                       1C7F C |
 L1C83 :                       1C83 C |  L1CA1 :                       1CA1 C |
 L1CB0 :                       1CB0 C |  L1CBF :                       1CBF C |
 L1CCE :                       1CCE C |  L1CD3 :                       1CD3 C |
 L1CD6 :                       1CD6 C |  L1CEB :                       1CEB C |
 L1CEE :                       1CEE C |  L1CF6 :                       1CF6 C |
 L1CFB :                       1CFB C |  L1CFE :                       1CFE C |
 L1D08 :                       1D08 C |  L1D11 :                       1D11 C |
 L1D1B :                       1D1B C |  L1D37 :                       1D37 C |
 L1D42 :                       1D42 C |  L1D59 :                       1D59 C |
 L1D65 :                       1D65 C |  L1D97 :                       1D97 C |
 L1DA0 :                       1DA0 C |  L1DCE :                       1DCE C |
 L1DE4 :                       1DE4 C |  L1DFC :                       1DFC C |
 L1E27 :                       1E27 C |  L1E2A :                       1E2A C |
 L1E43 :                       1E43 C |  L1E58 :                       1E58 C |
 L1E5B :                       1E5B C |  L1E5E :                       1E5E C |
 L1E61 :                       1E61 C |  L1E67 :                       1E67 C |
 L1EAE :                       1EAE C |  L1EB4 :                       1EB4 C |
 L1EFE :                       1EFE C |  L1FFC :                       1FFC C |
 L1_778 :                      1E8C C |  L2095 :                       2095 C |
 L20DB :                       20DB C |  L21051 :                      30DE C |
 L2113 :                       2113 C |  L2123 :                       2123 C |
 L215F :                       215F C |  L216B :                       216B C |
 L2172 :                       2172 C |  L2174 :                       2174 C |
 L21AF :                       21AF C |  L21BC :                       21BC C |
 L21D4 :                       21D4 C |  L21DF :                       21DF C |
 L221F :                       221F C |  L2226 :                       2226 C |
 L223A :                       223A C |  L223D :                       223D C |
 L2250 :                       2250 C |  L2278 :                       2278 C |
 L2282 :                       2282 C |  L22B8 :                       22B8 C |
 L22DD :                       22DD C |  L22DE :                       22DE C |
 L22F3 :                       22F3 C |  L230B :                       230B C |
 L230E :                       230E C |  L231B :                       231B C |
 L231E :                       231E C |  L2355 :                       2355 C |
 L235D :                       235D C |  L2360 :                       2360 C |
 L236C :                       236C C |  L2391 :                       2391 C |
 L239D :                       239D C |  L2494 :                       2494 C |
 L24AA :                       24AA C |  L2583 :                       2583 C |
 L25A6 :                       25A6 C |  L25BB :                       25BB C |
 L25FA :                       25FA C |  L25FF :                       25FF C |
 L2600 :                       2600 C |  L261C :                       261C C |
 L2627 :                       2627 C |  L262F :                       262F C |
 L264E :                       264E C |  L2652 :                       2652 C |
 L2653 :                       2653 C |  L2665X :                      2665 C |
 L266F :                       266F C |  L267B :                       267B C |
 L2688 :                       17F4 C |  L268C :                       268C C |
 L26991 :                      2699 C |  L269C :                       269C C |
 L26A9 :                       26A9 C |  L26AB :                       26AB C |
 L26B8 :                       26B8 C |  L26CA :                       26CA C |
 L26D0 :                       26D0 C |  L26F5 :                       26F5 C |
 L26FC :                       26FC C |  L2702X :                      2702 C |
 L2729 :                       1B87 C |  L272A :                       272A C |
 L272D :                       272D C |  L2730X :                      2730 C |
 L2739 :                       1C45 C |  L2768X :                      2768 C |
 L2783 :                       2783 C |  L27A9 :                       27A9 C |
 L27BC :                       27BC C |  L27BF :                       27BF C |
 L27EA :                       27EA C |  L27FB :                       27FB C |
 L2817A :                      2817 C |  L282B :                       282B C |
 L282E :                       282E C |  L2835 :                       212E C |
 L2840 :                       2840 C |  L284D :                       284D C |
 L2856 :                       2856 C |  L28E7 :                       28E7 C |
 L28EB :                       28EB C |  L290B :                       290B C |
 L291948 :                     29E1 C |  L2931 :                       2931 C |
 L2998 :                       2D4F C |  L29A1 :                       29A1 C |
 L2A24 :                       2A24 C |  L2A32 :                       2A32 C |
 L2A4F :                       2A4F C |  L2A65 :                       2A65 C |
 L2A7A :                       2A7A C |  L2A89 :                       2A89 C |
 L2A91 :                       2A91 C |  L2AA0 :                       2AA0 C |
 L2AA8 :                       2AA8 C |  L2AC1 :                       2AC1 C |
 L2AD0 :                       2AD0 C |  L2AD7 :                       2AD7 C |
 L2AF3 :                       2AF3 C |  L2AF6 :                       2AF6 C |
 L2B07 :                       2B07 C |  L2B20 :                       2B20 C |
 L2B36 :                       2B36 C |  L2B4E :                       2B4E C |
 L2BB0 :                       2BB0 C |  L2C05 :                       2C05 C |
 L2C3A :                       2C3A C |  L2C4E :                       2C4E C |
 L2C5A :                       2C5A C |  L2C69 :                       2C69 C |
 L2C8F :                       2C8F C |  L2CCD :                       2CCD C |
 L2D14 :                       2D14 C |  L2D99 :                       2D99 C |
 L2DCE :                       2DCE C |  L2DF7 :                       2DF7 C |
 L2E02 :                       2E02 C |  L2E3F :                       2E3F C |
 L2E45 :                       2E45 C |  L2E4B :                       2E4B C |
 L2E4F :                       2E4F C |  L2EB5 :                       2EB5 C |
 L2EC3 :                       2EC3 C |  L2EDB :                       2EDB C |
 L2EDD :                       2EDD C |  L2EF7 :                       2EF7 C |
 L2F0A :                       2F0A C |  L2F3E :                       2F3E C |
 L2F4E :                       2F4E C |  L2F51 :                       2F51 C |
 L2F5A :                       2F5A C |  L2F6D :                       2F6D C |
 L2F9C :                       2F9C C |  L2FA5 :                       2FA5 C |
 L2FA8 :                       2FA8 C |  L2FCD :                       2FCD C |
 L2FD2 :                       2FD2 C |  L2FD5 :                       2FD5 C |
 L2FDA :                       2FDA C |  L2FDD :                       2FDD C |
 L2FED :                       2FED C |  L2FFD :                       2FFD C |
 L3002 :                       3002 C |  L3018 :                       3018 C |
 L302F :                       302F C |  L3058 :                       3058 C |
 L305D :                       305D C |  L3062 :                       3062 C |
 L3089 :                       3089 C |  L30FB :                       30FB C |
 L3101 :                       3101 C |  L3107 :                       3107 C |
 L3114 :                       3114 C |  L3125 :                       3125 C |
 L312B :                       312B C |  L3136 :                       3136 C |
 L315D :                       315D C |  L3160 :                       3160 C |
 L3173 :                       3173 C |  L3176 :                       3176 C |
 L318A :                       318A C |  L31A4 :                       31A4 C |
 L31DD :                       31DD C |  L3205 :                       3205 C |
 L3250 :                       3250 C |  L3263 :                       3263 C |
 L3268 :                       3268 C |  L3289 :                       3289 C |
 L3291 :                       3291 C |  L32B2 :                       32B2 C |
 L32BA :                       32BA C |  L32DB :                       32DB C |
 L32E3 :                       32E3 C |  L32E8 :                       32E8 C |
 L3314 :                       3314 C |  L3330 :                       3330 C |
 L3336 :                       3336 C |  L334B :                       334B C |
 L3379 :                       3379 C |  L337E :                       337E C |
 L33B5 :                       33B5 C |  L33B7 :                       33B7 C |
 L33BD :                       33BD C |  L33CF :                       33CF C |
 L33DB :                       33DB C |  L33ED :                       33ED C |
 L3408 :                       3408 C |  L3410 :                       3410 C |
 L341F :                       341F C | *L3432 :                       3432 C |
 L3437 :                       3437 C |  L3439 :                       3439 C |
 L344F :                       344F C |  L3454 :                       3454 C |
 L349 :                          66 C |  L34A0 :                       34A0 C |
 L34A3 :                       34A3 C |  L34AD :                       34AD C |
 L34BD :                       34BD C |  L34D8 :                       34D8 C |
 L34DA :                       34DA C |  L34F3 :                       34F3 C |
 L34F5 :                       34F5 C |  L350 :                          92 C |
 L3528 :                       3528 C |  L3533 :                       3533 C |
 L355E :                       355E C |  L3573 :                       3573 C |
 L357E :                       357E C |  L3594 :                       3594 C |
 L35A9 :                       35A9 C |  L35D0 :                       35D0 C |
 L35DA :                       35DA C |  L35F3 :                       35F3 C |
 L35FA :                       35FA C |  L3626 :                       3626 C |
*L362C :                       362C - |  L362E :                       362E C |
 L3636 :                       3636 C |  L364E :                       364E C |
 L3656 :                       3656 C |  L3659 :                       3659 C |
 L3676X :                      3676 C |  L367F :                       367F C |
 L3688 :                       17E3 C |  L3694 :                       3694 C |
 L36BA :                       36BA C |  L36C0 :                       36C0 C |
 L36D5 :                       36D5 C |  L36E6 :                       36E6 C |
 L36F5 :                       36F5 C |  L36F8 :                       36F8 C |
 L370B :                       370B C |  L3720X :                      3720 C |
 L3739 :                       1C74 C |  L373A :                       373A C |
 L373B :                       373B C |  L375C :                       375C C |
 L3760 :                       3760 C |  L3768 :                       3768 C |
 L3773 :                       3773 C |  L3781 :                       3781 C |
 L378B :                       378B C |  L378D :                       378D C |
 L3796 :                       3796 C |  L37B3 :                       37B3 C |
 L37CB :                       37CB C |  L37DD :                       37DD C |
 L37F2 :                       37F2 C |  L3807 :                       3807 C |
 L381A :                       381A C |  L3841 :                       3841 C |
 L3847 :                       3847 C |  L385 :                         2DA C |
 L3852 :                       3852 C |  L3855 :                       3855 C |
 L385B :                       385B C |  L386D :                       386D C |
 L3886 :                       3886 C |  L388E :                       388E C |
 L3897 :                       3897 C |  L38AC :                       38AC C |
 L38C4 :                       38C4 C |  L38F2 :                       38F2 C |
 L38FD :                       38FD C |  L3919 :                       3919 C |
 L391B :                       391B C |  L3928 :                       3928 C |
 L3933 :                       3933 C |  L3938 :                       3938 C |
 L393F :                       393F C |  L394D :                       394D C |
 L3957 :                       3957 C |  L395F :                       395F C |
 L3963 :                       3963 C |  L396C :                       396C C |
 L3973X :                      3973 C |  L397D :                       397D C |
 L3998 :                       2D58 C |  L399D :                       399D C |
 L39AB :                       39AB C |  L39B6 :                       39B6 C |
 L39C1 :                       39C1 C |  L39CC :                       39CC C |
 L39D7 :                       39D7 C |  L39DA :                       39DA C |
 L39E0 :                       39E0 C |  L39ED :                       39ED C |
 L3A08 :                       3A08 C |  L3A1B :                       3A1B C |
 L3A20 :                       3A20 C |  L3A2D :                       3A2D C |
 L3A40 :                       3A40 C |  L3A55 :                       3A55 C |
 L3A74 :                       3A74 C |  L3A7A :                       3A7A C |
 L3AB0 :                       3AB0 C |  L3AC5 :                       3AC5 C |
 L3ADD :                       3ADD C |  L3AFE :                       3AFE C |
 L3B06 :                       3B06 C |  L3B0E :                       3B0E C |
 L3B11 :                       3B11 C |  L3B1F :                       3B1F C |
 L3B31 :                       3B31 C |  L3B44 :                       3B44 C |
 L3B59 :                       3B59 C |  L3B6C :                       3B6C C |
 L3B81 :                       3B81 C |  L3B94 :                       3B94 C |
 L3BA9 :                       3BA9 C |  L3BBC :                       3BBC C |
 L3BD1 :                       3BD1 C |  L3BEF :                       3BEF C |
 L3C05 :                       3C05 C |  L3C10 :                       3C10 C |
 L3C1F :                       3C1F C |  L3C2A :                       3C2A C |
 L3C48 :                       3C48 C |  L3C72 :                       3C72 C |
 L3C89 :                       3C89 C |  L3CAE :                       3CAE C |
 L3CBC :                       3CBC C |  L3CF1 :                       3CF1 C |
 L3D11 :                       3D11 C |  L3D39 :                       3D39 C |
 L3D3B :                       3D3B C |  L3D4B :                       3D4B C |
 L3D77 :                       3D77 C |  L3D7F :                       3D7F C |
 L3D91 :                       3D91 C |  L3D99 :                       3D99 C |
 L3DA4 :                       3DA4 C |  L3DB2 :                       3DB2 C |
 L3DBE :                       3DBE C |  L3DCA :                       3DCA C |
 L3E01 :                       3E01 C |  L3E02 :                       3E02 C |
 L3E0A :                       3E0A C |  L3E2B :                       3E2B C |
 L3E38 :                       3E38 C |  L3E41 :                       3E41 C |
 L3E49 :                       3E49 C |  L3FFC :                       3FFC C |
 L448 :                         62E C |  L449 :                         65C C |
 L451 :                         6A5 C |  L484 :                         8EB C |
 L622 :                        137F C |  L638 :                        14D2 C |
 L688 :                        17DA C |  L698 :                        1904 C |
 L729 :                        1B7B C |  L733 :                        1BE0 C |
 L739 :                        1C35 C |  L777 :                        1E7F C |
 L779 :                        1E96 C |  L783 :                        1EBD C |
 L832 :                        20D3 C |  L835 :                        2130 C |
 L881 :                        2541 C |  L948 :                        29BF C |
 L997 :                        2D26 C |  L999 :                        2D72 C |
*LISTON :                         1 - |  LOADWFTABLECHANINFO :         2F17 C |
 LOCAL047B :                    47B C |  LOCAL1441 :                   1441 C |
 LOCAL1AB2 :                   1AB2 C |  LOCAL1AB6 :                   1AB6 C |
 LOCAL23ED :                   23ED C |  LOCAL23F3 :                   23F3 C |
 LOCAL2416 :                   2416 C |  LOCAL242E :                   242E C |
 LOCAL243D :                   243D C |  LOCAL244D :                   244D C |
 LOCAL2937 :                   2937 C |  LOCAL2983 :                   2983 C |
 LOCAL2B0D :                   2B0D C |  LOCAL2B57 :                   2B57 C |
 LOCAL2B71 :                   2B71 C |  LOCAL2B79 :                   2B79 C |
 LOCAL2BBE :                   2BBE C |  LOCAL2C7D :                   2C7D C |
 LOCAL2CC1 :                   2CC1 C |  LOCAL2D37 :                   2D37 C |
 LOCAL3083 :                   3083 C |  LONGWFMASK :                     4 - |
 LOOP23AF :                    23AF C |  LOOP23C8 :                    23C8 C |
 LOOP30B9 :                    30B9 C |  LOOP581 :                      FD1 C |
*MACEXP :                         1 - |  MAIN :                        1D66 C |
 MAIN_ACTION_1 :               203B C |  MAIN_ACTION_10 :               F6C C |
 MAIN_ACTION_10_ID :              A - |  MAIN_ACTION_1_0 :             30E5 C |
 MAIN_ACTION_1_ID :               1 - |  MAIN_ACTION_2 :               1BA6 C |
 MAIN_ACTION_2_ID :               2 - |  MAIN_ACTION_3 :               16FA C |
 MAIN_ACTION_3_ID :               3 - |  MAIN_ACTION_4 :                8F6 C |
 MAIN_ACTION_4_ID :               4 - |  MAIN_ACTION_5 :                 5E C |
 MAIN_ACTION_5_ID :               5 - |  MAIN_ACTION_6 :               2038 C |
 MAIN_ACTION_6_0 :             28D5 C |  MAIN_ACTION_6_ID :               6 - |
 MAIN_ACTION_7 :                4E4 C |  MAIN_ACTION_7_ID :               7 - |
 MAIN_ACTION_8 :                F95 C |  MAIN_ACTION_8_ID :               8 - |
 MAIN_ACTION_9 :                605 C |  MAIN_ACTION_9_ID :               9 - |
 MAIN_INIT :                    674 C |  MAPPEDMODULO3 :               2D6F C |
 MAX_DE_HL :                   3E20 C |  MIN_DE_HL :                   3E2D C |
*MOMCPU :                      8085 - | *MOMCPUNAME :                  8085 - |
 MULTIPLYNUMWINVALUE :         2E65 C |  MULTIPLY_HL_BY_2.5 :          2CA4 C |
 MULTIPLY_HL_BY_5 :            2C85 C |  MULTIPLY_HL_DE :              3E3A C |
*NESTMAX :                      100 - |  NEXTCURSORLINE :              25ED C |
 NORMALIZEUIVOLTS2 :           3019 C |  NR_SAMPLES_TBL :              1EF2 C |
 NUMBER5 :                     3E9C C | *NUMWINCNTDOWN :                  5 - |
*NUMWINCPLVT :                    3 - | *NUMWINNONE :                     0 - |
*NUMWINSWEEPS :                   4 - | *NUMWINTIME :                     2 - |
*NUMWINVOLTS :                    1 - | *PACKING :                        0 - |
*PADDING :                        1 - |  PREPNUMWIN :                  322E C |
 PROCESS_DISPLAYRB :           256F C |  PULSE_INTERPOLATION :          71F C |
 RAMTEST_ERROR :               1877 C |  RAM_ACQ :                     C000 - |
 RAM_ACQ_END :                 C1FF - |  RAM_DISPLAY :                 A000 - |
 RAM_DISPLAY_END :             A7FF - |  RAM_DOT :                     B000 - |
*RAM_DOT_END :                 B3FF - |  RAM_MIDDLE :                  8200 - |
 RAM_SCRATCH :                 8800 - |  RAM_SCRATCH_END :             8BFF - |
 RAM_SYSTEM :                  8000 - |  RAM_SYSTEM_END :              83FF - |
 RAM_TEST1 :                   190D C |  RAM_TEST2 :                   1986 C |
 RAM_TEST_1 :                  17D5 C |  RAM_TEST_2 :                  1812 C |
 READDEVICECONTROLS :            B8 C |  READJITTER :                  1ABC C |
 READPOST_PRETRIGGER_SETTINGS : 355 C |  READPULSE_SINE_SETTINGS :      364 C |
 READSAVEREFSETTINGS :          373 C |  READTB :                       3B1 C |
 READ_FP2_BUTTONS :             408 C |  RECORDCH1INFO :                200 C |
 RECORDCH2INFO :                262 C |  RECORDVERTICALMODE :           1A0 C |
 REFRESHNUMWIN :               16A2 C | *RELAXED :                        0 - |
 REMOVEREFWFFROMWFTBL :        1603 C |  REMOVE_GPIB_ACTIONS :         2047 C |
 REMOVE_GPIB_ACTIONS_0 :       1662 C |  RENDERCURSORLINE :              52 C |
 RENDERCURSORLINE_0 :          1037 C |  RENDERWF :                    217D C |
 RESTARTDISPLAYSYSTEM :        3D3F C |  ROM_CHECKSUM :                176E C |
 ROM_SIGNATURE :               1763 C | *RST0 :                           0 C |
*RST1 :                           8 C | *RST2 :                          10 C |
*RST3 :                          18 C | *RST4 :                          20 C |
*RST5DOT5 :                      2C C |  RST6 :                          30 C |
*RST6DOT5 :                      34 C | *RST7 :                          38 C |
*RST7DOT5 :                      3C C |  SAMPLE_RATE_TABLE :           1F26 C |
 SCHEDULENEXTDISPLAY :         260E C |  SCRATCHRAMTABLE :             2019 C |
 SETDEFAULTDASHEDLINE :        25C1 C |  SETDIGITALMODE :               2D1 C |
 SETNUMWINDISTANCE :           2AAF C |  SETTIMESCALECODE :            2C8B C |
 SETUIVOLTS :                  2F2C C |  SETUIVOLTSUNCAL :             2DC8 C |
 SETUPLINECURSOR :               58 C |  SETUPLINECURSOR_0 :           11B9 C |
 SETUP_AVERAGE :                E1A C |  SETUP_ENVELOPE :               DCD C |
 SETVERTPOSITIONING :          2465 C |  SET_ACTION5_FLG :              320 C |
 SET_FASTTIMEDIV :             2B7D C |  SET_IE :                      205F C |
 SET_RATE_DIRECTION :          3030 C |  SET_SLOWTIMEDIV :             2B5B C |
 SET_TRACK_HOLD :               4CE C |  SHIFTL_A_L_TIMES :            1E78 C |
 SHIFTR_A_L_TIMES :            1E8F C |  SHIFTR_DE_L_TIMES :           3E0D C |
 SHIFTR_HL :                   245C C |  SIGNED_COMPARE_A_L :          3D66 C |
 SIGNED_COMPARE_DE_HL :        3DEE C |  SIGNEXTEND_L_IN_H :           3D9C C |
 SINE_INTERPOLATION :           76D C |  SINE_INTERPOLATION2 :          840 C |
 START :                       1753 C |  STROBEDISPLAYRAM :              55 C |
 STROBEDISPLAYRAM_0 :          11B0 C |  SYSRAM_AREA :                   40 C |
 S_CHANMODE :                     4 - |  S_GNDREF :                       1 - |
 S_HGAIN :                        2 - |  S_JITTER :                       0 - |
 S_STATUS :                       5 - |  S_TB :                           6 - |
 S_VGAIN :                        3 - |  S_VOLTS :                        7 - |
 TAKE80PERCENT :               2CAD C |  TB20 :                          14 - |
 TBNUMWIN :                    2AF7 C |  TBNUMWIN1 :                   2BB4 C |
 TEST_DIFFERENT :              1EBF C |  TEST_EQUAL_A_L :              3D5D C |
*TIME :                    15:57:44 - |  TIMEEXPANDWF :                1312 C |
 TIMER_INTERRUPT :             1DA3 C |  TRAP :                          24 C |
*TRUE :                           1 - |  U788_BCD_2_BINARY :           3063 C |
 UNZIPACQUIREDWF :              DB3 C |  UPDATECHANNELVOLTS :          2E10 C |
 UPDATECPLVTDISPVAL :          2D83 C |  UPDATEFLAGSIFCHANGE :          4AA C |
 UPDATEINPUTCOUPLING :          2C4 C |  UPDATEVOLTSDISPVAL :          2E98 C |
 UPDATE_AVERAGE :               CA6 C |  UPDATE_DEV_FPC_AND :          2068 C |
 UPDATE_DEV_FPC_AND_0 :        2083 C |  UPDATE_DEV_FPC_OR :           208C C |
 UPDATE_DEV_WIFCTL_AND :       2065 C |  UPDATE_DEV_WIFCTL_AND_0 :     207A C |
 UPDATE_ENVELOPE :              D0D C |  UPDATE_FP_DISPLAY :           1A1C C |
 UPDATE_JITTER_VARS :          1B69 C |  UPDATE_NR_SWEEPS :            2789 C |
 UPDATE_V_WIFDO :              3C8F C |  VAR_8006 :                    8006 - |
 VAR_8009 :                    8009 - |  VAR_800E :                    800E - |
 VAR_8016 :                    8016 - |  VAR_8027 :                    8027 - |
 VAR_8042 :                    8042 - |  VAR_80DB :                    80DB - |
 VAR_80E0 :                    80E0 - |  VAR_80ED :                    80ED - |
 VAR_8111 :                    8111 - |  VAR_813E :                    813E - |
 VAR_8140 :                    8140 - |  VAR_8155 :                    8155 - |
 VAR_8165 :                    8165 - |  VAR_8166 :                    8166 - |
 VAR_8168 :                    8168 - |  VAR_816A :                    816A - |
 VAR_816B :                    816B - |  VAR_816D :                    816D - |
 VAR_816F :                    816F - |  VAR_8170 :                    8170 - |
 VAR_8171 :                    8171 - |  VAR_8174 :                    8174 - |
 VAR_8176 :                    8176 - |  VAR_817E :                    817E - |
 VAR_817F :                    817F - |  VAR_8180 :                    8180 - |
 VAR_8198 :                    8198 - | *VERSION :                     142F - |
 VGAIN_TBL :                   1EF5 C |  VOLTAGE4 :                       4 - |
 VOLTSMULTIPLY :               2E56 C |  V_ACQUIREDTB_4 :              8134 - |
 V_ACQUIREDTB_7 :              8125 - |  V_ACQVOLTS :                  8149 - |
 V_ACQWF_PTR :                 80F2 - |  V_ACQ_MODE :                  8008 - |
 V_ACTION3_FLG :               80D0 - |  V_ACTION5_FLG :               80CD - |
 V_ACTION6_FLG :               80D1 - |  V_ACTION7_FLG :               80CF - |
 V_ACTION9_FLG :               80CE - |  V_ACTIONLOOPIDX :             813B - |
 V_ACTUALTB_2 :                800C - |  V_ATIME :                     8018 - |
 V_ATIMEBASEACTIVE :           8023 - |  V_AVG_SWEEPS :                80C2 - |
 V_BCD_INPUT :                 814E - |  V_BCD_RESULT :                8151 - |
 V_BIT_6_CLEARED :             814A - |  V_BOTHODD :                   80E5 - |
 V_BTIME :                     8019 - |  V_CH1_COUPLING :              801C - |
 V_CH1_INFO :                  801A - |  V_CH1_INFO_COPY :             8147 - |
 V_CH2_COUPLING :              801D - |  V_CH2_INFO :                  801B - |
 V_CH2_INFO_COPY :             8148 - |  V_CHANNELMODE :               8029 - |
 V_CNT :                       80E8 - |  V_CNT01 :                     8113 - |
 V_CNT2 :                      812E - |  V_CNT_2 :                     80E9 - |
 V_CONTRL :                    80BF - |  V_COPYSIZE_6 :                815B - |
 V_CURRENTSWEEPS :             8118 - |  V_CURRWF :                    803E - |
 V_CURR_LEDRO :                8033 - |  V_CURSOREDGETIMECNT :         8010 - |
 V_CURSORINCREMENTVALUE :      8034 - |  V_CURSORLINE :                8041 - |
 V_CURSORMODE :                80AA - |  V_CURSORPOS1 :                8039 - |
 V_CURSORPOS2 :                8037 - |  V_CURSORPOT_DELAY :           803D - |
 V_CURSORSCALETBL :            3E7C C |  V_CURSOR_SELECT :             80D2 - |
 V_CVTFREQ2VOLTS :             3E76 C |  V_DECPNTDIGIT :               8032 - |
 V_DECPOINT :                  8157 - |  V_DELTATB_4 :                 8132 - |
 V_DELTATB_4_2 :               8131 - |  V_DIGITALMODE :               80A5 - |
 V_DIGITALMODE_4 :             8137 - |  V_DIGITALMODE_4A :            80EB - |
 V_DISPLAYACTION :             80EE - |  V_DISPLAYRB :                 8073 - |
 V_DISPLAYRB_END :             8071 - |  V_DISPLAYRB_INDEX :           8122 - |
 V_DISPLAYRB_START :           8072 - |  V_DISPWF :                    8040 - |
 V_DISREG :                    80A4 - |  V_ENV_SWEEPS :                80C4 - |
 V_FADD :                      8020 - |  V_FALT :                      8022 - |
 V_FALTERNATING :              802A - |  V_FATCURSOREDGE :             8012 - |
 V_FAVGENVFINISHED :           80EF - |  V_FAVGVOLTS :                 814C - |
 V_FCH1 :                      801E - |  V_FCH2 :                      801F - |
 V_FCHOPPED :                  802B - |  V_FCURSOR1SNAPPED :           8015 - |
 V_FCURSOREDGETRACKING :       8013 - |  V_FFIRSTCURSORACTIVE :        80AD - |
 V_FLG_6 :                     815C - |  V_FLIPPEDWF_6 :               815A - |
 V_FOK2PROCESSACQ :            8001 - |  V_FOK2UPDATEDISPWF :          8002 - |
 V_FP1 :                       80CA - |  V_FP2 :                       80C9 - |
 V_FPC :                       8070 - |  V_FPOSTPRETRIGGER :           80A7 - |
 V_FPULSESINE :                80A8 - |  V_FP_DISPLAY_CURR_DIGIT :     8187 - |
 V_FSAVEREFPUSHED :            800F - |  V_FSAVEREFSHOWING :           80A6 - |
 V_FSHORTWF :                  811C - |  V_FSKIPACQUIREDWF :           8003 - |
 V_FSNAPPEDCURSOR :            8014 - |  V_FTRIGVIEW :                 8021 - |
 V_FTRIGVIEWENA :              8024 - |  V_FUNCAL :                    814B - |
 V_FXY :                       8025 - |  V_GPIB8164 :                  8164 - |
 V_GPIBOUT :                   80A9 - |  V_GPIBSTAGE :                 806A - |
 V_GPIB_60 :                   8060 - |  V_GPIB_ACTIONWASREMOVED :     800D - |
 V_GPIB_ATNDAV :               805F - |  V_GPIB_BOOL2 :                8068 - |
 V_GPIB_BOOL3 :                806D - |  V_GPIB_BOOL4 :                806E - |
 V_GPIB_BOOL5 :                806F - |  V_GPIB_BOOL6 :                8062 - |
 V_GPIB_BOOL7 :                805D - |  V_GPIB_BOOL8 :                805C - |
 V_GPIB_BOOL9 :                805B - |  V_GPIB_CNT0 :                 806B - |
 V_GPIB_ENABLED :              803F - |  V_GPIB_ENDOFMESSAGE :         8067 - |
 V_GPIB_MTARECEIVED :          8055 - |  V_GPIB_NDAC :                 8063 - |
 V_GPIB_NRFD :                 805E - |  V_GPIB_PTR1 :                 817C - |
 V_GPIB_PTR2 :                 817A - |  V_GPIB_PTR3 :                 8178 - |
 V_GPIB_RATN :                 8061 - |  V_GPIB_TXT :                  8004 - |
 V_GPIB_XMITTINGWF :           8066 - |  V_GPIB_XMITWFRQSFACTIVE :     8007 - |
 V_INDEX_7 :                   8123 - |  V_JITTER :                    8056 - |
 V_JITTER_TB18 :               8192 - |  V_JITTER_TB19 :               8194 - |
 V_JITTER_TB20 :               8196 - |  V_JITTER_TBL :                8057 - |
 V_LASTPRCOUNT :               813C - |  V_LCLFLAG :                   80CC - |
 V_LCLWFENTRY :                80FA - |  V_LCLWFENTRY_2 :              8104 - |
 V_LCL_FACTIONREMOVED :        8162 - |  V_LEDCODE :                   8158 - |
 V_LED_DIGIT :                 8181 - |  V_LIGHTS :                    80D3 - |
 V_LINECURSORPOS :             80B7 - |  V_LOCAL810D :                 810D - |
 V_LOCALHGAIN_4 :              8135 - |  V_LOCALMAXSWEEPS :            8116 - |
 V_LOCALMINSWEEPS :            8114 - |  V_LOOPCNTAVG :                810F - |
 V_LOOP_CNTR_1 :               80DA - |  V_MAINACTIONEND :             8043 - |
 V_MAINACTIONSTART :           8044 - |  V_MAINACTIONTBL :             8045 - |
 V_NOTCOUNTINGDOWN :           80C8 - |  V_NSAMPLES :                  80D9 - |
 V_NUMWINBUF :                 802E - |  V_NUMWINVALUE :               802C - |
 V_ODDFLG_4 :                  8138 - |  V_PDEST_4 :                   812A - |
 V_PDEVICE :                   800A - |  V_PDISPWF :                   807D - |
 V_POSITIONRATECOUNT_VALUES :  80AB - |  V_PRAM_DOT :                  80E1 - |
 V_PRAM_DOT2 :                 80E3 - |  V_PRCOUNT :                   8144 - |
 V_PREVIOUSPRCOUNT :           803B - |  V_PRFASTMODE :                8036 - |
 V_PRIMARYWF :                 80A3 - |  V_PSCRATCHRAM :               80F4 - |
 V_PSCRATCHRAM2 :              80F6 - |  V_PSRC_4 :                    8128 - |
 V_PTR1_6 :                    815D - |  V_PTR2_6 :                    815F - |
 V_PWFTABLE3 :                 811D - |  V_PWFTBL_7 :                  8126 - |
 V_PWF_4 :                     80F8 - |  V_PWF_DESTINATION :           80DC - |
 V_PWF_SOURCE :                80DE - |  V_RAM_AREA :                  812C - |
 V_RAM_TEST_STATUS :           8186 - |  V_RANGE_END :                 8184 - |
 V_RANGE_START :               8182 - |  V_RATE_DIRECTION :            80C0 - |
 V_RECORDERJITTER :            8191 - |  V_SAMPLESCNT :                8130 - |
 V_SAVEDCHANNELMODE :          810C - |  V_SAVEDPWF_4 :                8102 - |
 V_SAVED_ARG :                 8120 - |  V_SAVED_ARG_DE :              80D7 - |
 V_SAVED_ARG_HL :              80D5 - |  V_SAVED_INT_MASK :            8121 - |
 V_SAVED_INT_MASK_2 :          813A - |  V_SAVED_PARAM1 :              8188 - |
 V_SAVED_PARAM2 :              8189 - |  V_SCALECODE :                 8028 - |
 V_SCALECODE2 :                8150 - |  V_SWEEP_CNT1 :                80C6 - |
 V_SWEEP_CNT2 :                80F0 - |  V_TALKADDR :                  8065 - |
 V_TALKREG :                   8064 - |  V_TARGETTB2 :                 80EA - |
 V_TARGETTB_4 :                8133 - |  V_THISLINECURSORPOS :         811A - |
 V_TIMECURSORPOS :             80B3 - |  V_TIMERCNTR :                 819A - |
 V_TIMERCNTR2 :                819B - |  V_TIMERCNTR3 :                819C - |
 V_TIMERCNTR4 :                819D - |  V_TIMERCNTRRATEINC2 :         8035 - |
 V_TIMERCNTRSWEEPSINCREMENT :  80C1 - |  V_TIMERCNTRSWEEPSSTOP :       819F - |
 V_TIMERCNTR_RATE_STOP2 :      819E - |  V_TIMERCNTR_RATE_TBL :        3E8B C |
 V_TMP8142 :                   8142 - |  V_TMP814D :                   814D - |
 V_TMP8154 :                   8154 - |  V_TMPCURSORPOS :              80BB - |
 V_TMP_7 :                     8124 - |  V_UIVOLTS :                   8026 - |
 V_VALIDWFS :                  809F - |  V_VOLTSCURSORPOS :            80AF - |
 V_VOLTSTEPS :                 810E - |  V_VSM :                       80D4 - |
 V_WFTABLE :                   807F - |  V_WF_4 :                      80EC - |
 V_WF_4A :                     8136 - |  V_WF_6 :                      8159 - |
 V_WIFCTL :                    8017 - |  V_WIFDO :                     8069 - |
 WFENTRYSIZE :                    8 - | *XXXX :                        1650 C |

   1394 symbols
     48 unused symbols

 AS V1.42 Beta [Bld 37] - source file rom468combined.asm - page 3 - 5/16/2023 15:57:44


  codepages:
  ----------

STANDARD (0 changed characters)


0.22 seconds assembly time

   9648 lines source file
   9926 lines incl. macro expansions
      2 passes
      0 errors
      0 warnings
